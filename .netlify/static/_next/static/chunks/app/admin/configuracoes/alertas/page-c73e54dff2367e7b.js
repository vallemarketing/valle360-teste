(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7358],{65615:function(e,t,r){Promise.resolve().then(r.bind(r,72371))},79205:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var a=r(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),s=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:d="",children:u,iconNode:m,...f}=e;return(0,a.createElement)("svg",{ref:t,...c,width:n,height:n,stroke:r,strokeWidth:s?24*Number(l)/Number(n):l,className:i("lucide",d),...!u&&!o(f)&&{"aria-hidden":"true"},...f},[...m.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let r=(0,a.forwardRef)((r,l)=>{let{className:o,...c}=r;return(0,a.createElement)(d,{ref:l,iconNode:t,className:i("lucide-".concat(n(s(e))),"lucide-".concat(e),o),...c})});return r.displayName=s(e),r}},94766:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(79205).Z)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])},99397:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(79205).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},82431:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(79205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},83229:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(79205).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},32489:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(79205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},27648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var a=r(72972),n=r.n(a)},72371:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var a=r(57437),n=r(2265),l=r(27648),s=r(94766),i=r(82431),o=r(83229),c=r(99397),d=r(32489),u=r(5526),m=r(12381),f=r(69174),h=r(79820),p=r(14438);let x=[{id:"payment_risk",label:"Risco de Pagamento"},{id:"budget_overrun",label:"Or\xe7amento estourando"},{id:"demand_capacity",label:"Demanda vs Capacidade"},{id:"churn",label:"Risco de Churn"}];async function v(){try{var e;let{data:t}=await u.supabase.auth.getSession(),r=null===(e=t.session)||void 0===e?void 0:e.access_token;return r?{Authorization:"Bearer ".concat(r)}:{}}catch(e){return{}}}function b(e){return e.trim().toLowerCase()}function g(){let[e,t]=(0,n.useState)(!0),[r,u]=(0,n.useState)(!1),[g,y]=(0,n.useState)([]),[j,N]=(0,n.useState)([]),[w,_]=(0,n.useState)(x[0].id),[k,C]=(0,n.useState)(""),S=async()=>{t(!0);try{let e=await v(),t=await fetch("/api/admin/alerts/recipients",{headers:e,cache:"no-store"}),r=await t.json().catch(()=>null);if(!t.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.error)||"Falha ao carregar");y(Array.isArray(r.rules)?r.rules:[]),N(Array.isArray(r.users)?r.users:[])}catch(e){p.Am.error((null==e?void 0:e.message)||"Falha ao carregar"),y([]),N([])}finally{t(!1)}};(0,n.useEffect)(()=>{S()},[]);let A=(0,n.useMemo)(()=>g.filter(e=>e.alert_type===w),[g,w]),I=(0,n.useMemo)(()=>A.filter(e=>"email"===e.channel&&!1!==e.is_enabled),[A]),R=(0,n.useMemo)(()=>A.filter(e=>"intranet"===e.channel&&!1!==e.is_enabled),[A]),Z=(0,n.useMemo)(()=>new Set(I.map(e=>String(e.recipient_user_id||"")).filter(Boolean)),[I]),M=(0,n.useMemo)(()=>new Set(R.map(e=>String(e.recipient_user_id||"")).filter(Boolean)),[R]),E=(0,n.useMemo)(()=>I.map(e=>String(e.recipient_email||"")).filter(Boolean),[I]),O=(e,t)=>{y(r=>{let a=r.filter(e=>e.alert_type!==w),n=r.filter(e=>e.alert_type===w),l=n.some(r=>r.channel===e&&String(r.recipient_user_id||"")===t&&!1!==r.is_enabled),s=n.filter(r=>!(r.channel===e&&String(r.recipient_user_id||"")===t));return[...a,...l?s:[...s,{alert_type:w,channel:e,recipient_user_id:t,recipient_email:null,is_enabled:!0}]]})},z=e=>{y(t=>t.filter(t=>!(t.alert_type===w&&"email"===t.channel&&b(String(t.recipient_email||""))===b(e))))},B=async()=>{u(!0);try{let e=await v(),t=g.filter(e=>e.alert_type===w),r=await fetch("/api/admin/alerts/recipients",{method:"PUT",headers:{"Content-Type":"application/json",...e},body:JSON.stringify({alert_type:w,rules:t})}),a=await r.json().catch(()=>null);if(!r.ok||!(null==a?void 0:a.success))throw Error((null==a?void 0:a.error)||"Falha ao salvar");p.Am.success("Salvo."),await S()}catch(e){p.Am.error((null==e?void 0:e.message)||"Falha ao salvar")}finally{u(!1)}},U=(0,n.useMemo)(()=>(j||[]).filter(e=>e.user_id&&e.email).sort((e,t)=>String(e.email||"").localeCompare(String(t.email||""),"pt-BR")),[j]);return(0,a.jsx)("div",{className:"min-h-screen p-6",style:{backgroundColor:"var(--bg-secondary)"},children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center",children:(0,a.jsx)(s.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-[#001533] dark:text-white",children:"Destinat\xe1rios de Alertas"}),(0,a.jsx)("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Controle via banco/UI (sem depender de env). Resolu\xe7\xe3o do sistema: env → banco → fallback (admins)."})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(m.z,{variant:"outline",onClick:()=>S(),disabled:e,className:"gap-2",children:[(0,a.jsx)(i.Z,{className:e?"w-4 h-4 animate-spin":"w-4 h-4"})," Atualizar"]}),(0,a.jsxs)(m.z,{onClick:B,disabled:r||e,className:"gap-2 bg-[#1672d6] hover:bg-[#1260b5]",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"})," Salvar"]}),(0,a.jsx)(l.default,{href:"/admin/configuracoes",className:"text-sm underline",style:{color:"var(--primary-500)"},children:"Voltar"})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,a.jsxs)("button",{onClick:()=>_(e.id),className:"px-3 py-2 rounded-xl border text-sm ".concat(w===e.id?"bg-white":"bg-transparent"),style:{borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[e.label,e.id===w?(0,a.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"editando"}):null]},e.id))}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(h.Zb,{children:[(0,a.jsx)(h.Ol,{children:(0,a.jsxs)(h.ll,{className:"text-base flex items-center justify-between",children:["Email ",(0,a.jsx)(f.C,{variant:"outline",children:I.length})]})}),(0,a.jsxs)(h.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Usu\xe1rios internos (email) + emails externos."}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{value:k,onChange:e=>C(e.target.value),placeholder:"Adicionar email externo…",className:"flex-1 px-3 py-2 rounded-xl border text-sm bg-transparent outline-none",style:{borderColor:"var(--border-light)",color:"var(--text-primary)"}}),(0,a.jsxs)(m.z,{onClick:()=>{let e=b(k);if(!e||!e.includes("@"))return p.Am.error("Email inv\xe1lido");C(""),y(t=>{let r=t.filter(e=>e.alert_type!==w),a=t.filter(e=>e.alert_type===w);return a.some(t=>"email"===t.channel&&b(String(t.recipient_email||""))===e)?t:[...r,...a,{alert_type:w,channel:"email",recipient_email:e,recipient_user_id:null,is_enabled:!0}]})},variant:"outline",className:"gap-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"})," Adicionar"]})]}),!!E.length&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:E.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border text-xs",children:[e,(0,a.jsx)("button",{onClick:()=>z(e),title:"Remover",children:(0,a.jsx)(d.Z,{className:"w-3 h-3"})})]},e))}),(0,a.jsxs)("div",{className:"pt-2 border-t",style:{borderColor:"var(--border-light)"},children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Usu\xe1rios"}),(0,a.jsx)("div",{className:"max-h-[340px] overflow-auto space-y-2",children:U.map(e=>{let t=String(e.user_id),r=Z.has(t);return(0,a.jsxs)("label",{className:"flex items-center justify-between gap-2 text-sm",children:[(0,a.jsx)("span",{className:"truncate",children:e.email}),(0,a.jsx)("input",{type:"checkbox",checked:r,onChange:()=>O("email",t)})]},t)})})]})]})]}),(0,a.jsxs)(h.Zb,{children:[(0,a.jsx)(h.Ol,{children:(0,a.jsxs)(h.ll,{className:"text-base flex items-center justify-between",children:["Intranet ",(0,a.jsx)(f.C,{variant:"outline",children:R.length})]})}),(0,a.jsxs)(h.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Mensagens internas (direct_messages) — precisa do ALERTS_ACTOR_USER_ID."}),(0,a.jsx)("div",{className:"max-h-[420px] overflow-auto space-y-2",children:U.map(e=>{let t=String(e.user_id),r=M.has(t);return(0,a.jsxs)("label",{className:"flex items-center justify-between gap-2 text-sm",children:[(0,a.jsx)("span",{className:"truncate",children:e.email}),(0,a.jsx)("input",{type:"checkbox",checked:r,onChange:()=>O("intranet",t)})]},t)})})]})]})]})]})})}},69174:function(e,t,r){"use strict";r.d(t,{C:function(){return i}});var a=r(57437);r(2265);var n=r(90535),l=r(93448);let s=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-valle-blue-600 text-white",secondary:"border-transparent bg-valle-silver-300 text-valle-navy-800",outline:"text-valle-navy-700 border-valle-silver-400",success:"border-transparent bg-green-600 text-white",warning:"border-transparent bg-yellow-600 text-white",danger:"border-transparent bg-red-600 text-white"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)(s({variant:r}),t),...n})}},12381:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var a=r(57437),n=r(2265),l=r(90535),s=r(93448);let i=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-valle-blue-600 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-gradient-to-r from-valle-blue-600 to-valle-blue-700 text-white hover:from-valle-blue-700 hover:to-valle-blue-800 shadow-lg",secondary:"bg-valle-silver-200 text-valle-navy-800 hover:bg-valle-silver-300",outline:"border-2 border-valle-blue-600 text-valle-blue-600 hover:bg-valle-blue-50",ghost:"hover:bg-valle-blue-50 hover:text-valle-blue-600",danger:"bg-red-600 text-white hover:bg-red-700"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,t)=>{let{className:r,variant:n,size:l,...o}=e;return(0,a.jsx)("button",{className:(0,s.cn)(i({variant:n,size:l,className:r})),ref:t,...o})});o.displayName="Button"},79820:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return s},aY:function(){return d},ll:function(){return o}});var a=r(57437),n=r(2265),l=r(93448);let s=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-xl border-2 border-valle-silver-200 bg-white shadow-md",r),...n})});s.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,l.cn)("font-semibold leading-none tracking-tight text-lg",r),...n})});o.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-foreground/70",r),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},5526:function(e,t,r){"use strict";r.r(t),r.d(t,{supabase:function(){return s}});var a=r(62724);let n="https://ikjgsqtykkhqimypacro.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";n&&l||console.error("❌ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let s=(0,a.eI)(n||"https://setup-missing.supabase.co",l||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})},93448:function(e,t,r){"use strict";r.d(t,{cn:function(){return l},x:function(){return s}});var a=r(61994),n=r(53335);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}function s(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}},90535:function(e,t,r){"use strict";r.d(t,{j:function(){return s}});var a=r(61994);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=a.W,s=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return l(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:s,defaultVariants:i}=t,o=Object.keys(s).map(e=>{let t=null==r?void 0:r[e],a=null==i?void 0:i[e];if(null===t)return null;let l=n(t)||n(a);return s[e][l]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return l(e,o,null==t?void 0:null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:r,className:a,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...c}[t]):({...i,...c})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[6137,4609,2724,4438,2972,2971,2117,1744],function(){return e(e.s=65615)}),_N_E=e.O()}]);