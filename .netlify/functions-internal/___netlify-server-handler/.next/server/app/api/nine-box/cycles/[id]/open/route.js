"use strict";(()=>{var e={};e.id=86149,e.ids=[86149],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},4438:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>x,routeModule:()=>y,serverHooks:()=>_,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>m,dynamic:()=>p});var n=r(49303),o=r(88716),s=r(60670),i=r(87070),c=r(20344),d=r(71615),l=r(52390),u=r(90176);let p="force-dynamic";async function m(e,t){try{let e=(0,d.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>e}),a=await (0,l.V)({supabase:r});if(!a.allowed)return i.NextResponse.json({error:a.reason||"Acesso negado"},{status:403});let n=String(t.params.id),{data:o,error:s}=await r.from("nine_box_cycles").select("*").eq("id",n).maybeSingle();if(s)throw s;if(!o)return i.NextResponse.json({error:"Ciclo n\xe3o encontrado"},{status:404});if("closed"===o.status)return i.NextResponse.json({error:"Ciclo fechado n\xe3o pode ser reaberto"},{status:400});let{data:p,error:m}=await r.from("nine_box_cycles").update({status:"open"}).eq("id",n).select("*").single();if(m)throw m;try{let e=(0,u.t)(),{data:t}=await e.from("employees").select("user_id, department, areas").or("department.eq.hr,department.ilike.%rh%").limit(500),r=(t||[]).map(e=>String(e.user_id||"")).filter(Boolean);r.length&&await e.from("notifications").insert(r.map(e=>({user_id:e,type:"nine_box_cycle_open",title:"Ciclo 9 Box aberto",message:`O ciclo "${p.name}" foi aberto e est\xe1 pronto para avalia\xe7\xf5es.`,link:`/admin/rh/nine-box?cycle=${encodeURIComponent(p.id)}`,metadata:{module:"nine_box",cycle_id:p.id},created_at:new Date().toISOString()})))}catch{}return i.NextResponse.json({success:!0,cycle:p})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/nine-box/cycles/[id]/open/route",pathname:"/api/nine-box/cycles/[id]/open",filename:"route",bundlePath:"app/api/nine-box/cycles/[id]/open/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\nine-box\\cycles\\[id]\\open\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:_}=y,g="/api/nine-box/cycles/[id]/open/route";function h(){return(0,s.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:f})}},90176:(e,t,r)=>{r.d(t,{t:()=>n});var a=r(54128);function n(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,a.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},52390:(e,t,r)=>{async function a(e,t,r){try{let{data:a,error:n}=await e.rpc(t,r);if(n)return{ok:!1,error:n};return{ok:!0,data:a}}catch(e){return{ok:!1,error:e}}}function n(e){return Array.from(new Set(e.map(e=>String(e)).filter(Boolean)))}async function o(e){let t=e.supabase,{data:r}=await t.auth.getUser(),o=r.user?.id;if(!o)return{userId:"",isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let s=await a(t,"is_admin"),i=!!s.ok&&!!s.data;if(i)return{userId:o,isAdmin:i,allowed:!0,areaKeys:[]};let c=await a(t,"employee_area_keys");if(c.ok&&Array.isArray(c.data)){let e=n(c.data),t=e.includes("rh");return{userId:o,isAdmin:i,allowed:t,reason:t?void 0:"Acesso restrito: RH",areaKeys:e}}let{data:d}=await t.from("employees").select("areas, department, is_active").eq("user_id",o).maybeSingle(),l=n([...Array.isArray(d?.areas)?d.areas.map(String):[]]),u=l.includes("rh")||String(d?.department||"").toLowerCase().includes("rh");return{userId:o,isAdmin:i,allowed:u,reason:u?void 0:"Acesso restrito: RH",areaKeys:l}}r.d(t,{V:()=>o})}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[89276,55972,54128,20958],()=>r(4438));module.exports=a})();