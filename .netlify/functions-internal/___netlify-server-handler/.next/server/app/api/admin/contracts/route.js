"use strict";(()=>{var e={};e.id=86345,e.ids=[86345],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},95089:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>_,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>u});var a=r(49303),s=r(88716),o=r(60670),i=r(87070),c=r(20344),l=r(71615);async function d(e){try{let t=(0,c.createRouteHandlerClient)({cookies:l.cookies}),{data:{user:r}}=await t.auth.getUser();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let n=e.nextUrl.searchParams,a=n.get("status"),s=n.get("client_id"),o=t.from("contracts").select("*").order("created_at",{ascending:!1});a&&(o=o.eq("status",a)),s&&(o=o.eq("client_id",s));let{data:d,error:u}=await o;if(u)return console.error("Error fetching contracts:",u),i.NextResponse.json({error:"Failed to fetch contracts"},{status:500});return i.NextResponse.json({contracts:d})}catch(e){return console.error("Error in contracts API:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(e){try{let t=(0,c.createRouteHandlerClient)({cookies:l.cookies}),{data:{user:r}}=await t.auth.getUser();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let n=await e.json();if(!n.client_name||!n.client_email||!n.client_company)return i.NextResponse.json({error:"Missing required fields: client_name, client_email, client_company"},{status:400});let a={client_name:n.client_name,client_email:n.client_email,client_company:n.client_company,client_cnpj:n.client_cnpj||null,client_address:n.client_address||null,client_id:n.client_id||null,type:n.type||"service",template_used:n.template_used||"standard",services:n.services||[],total_value:n.total_value||0,payment_terms:n.payment_terms||"Mensal, vencimento dia 10",duration_months:n.duration_months||12,start_date:n.start_date,end_date:n.end_date,renewal_type:n.renewal_type||"manual",cancellation_fee_percent:n.cancellation_fee_percent||30,cancellation_notice_days:n.cancellation_notice_days||30,status:"draft",created_by:r.id,created_at:new Date().toISOString()},{data:s,error:o}=await t.from("contracts").insert(a).select().single();if(o)return console.error("Error creating contract:",o),i.NextResponse.json({error:"Failed to create contract"},{status:500});let{data:d}=await t.from("user_profiles").select("user_id").in("user_type",["super_admin","admin","juridico"]);if(d&&d.length>0){let e=d.map(e=>({user_id:e.user_id,type:"contract_created",title:"Novo contrato criado",message:`Contrato para ${n.client_company} aguardando revis\xe3o.`,link:"/admin/contratos",is_read:!1,created_at:new Date().toISOString()}));await t.from("notifications").insert(e)}return i.NextResponse.json(s,{status:201})}catch(e){return console.error("Error in contracts API:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/contracts/route",pathname:"/api/admin/contracts",filename:"route",bundlePath:"app/api/admin/contracts/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\contracts\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:_,staticGenerationAsyncStorage:m,serverHooks:x}=p,f="/api/admin/contracts/route";function g(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958],()=>r(95089));module.exports=n})();