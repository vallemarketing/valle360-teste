"use strict";(()=>{var e={};e.id=42220,e.ids=[42220],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},95134:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var r={};i.r(r),i.d(r,{GET:()=>p,dynamic:()=>l});var a=i(49303),s=i(88716),n=i(60670),o=i(87070),c=i(17478),d=i(90176),u=i(17743);let l="force-dynamic";async function p(e){let t=await (0,c.k)(e);if(!t.ok)return t.res;let i=new URL(e.url),r=i.searchParams.get("role"),a=r?(0,u.U)(r):null,s=function(e,t,i,r){let a=Number(e);return Number.isFinite(a)?Math.max(5,Math.min(60,Math.floor(a))):25}(i.searchParams.get("limit"),0,0,0),n=(0,d.t)();try{let[{data:e},t,i,r]=await Promise.all([n.from("ai_executives").select("id, role, name, title").order("role"),n.from("ai_executive_meetings").select("id, created_at, title, meeting_type, initiated_by, participants, status, priority, scheduled_at, started_at, completed_at, outcome_summary, decisions_made, action_items, trigger_reason").order("created_at",{ascending:!1}).limit(s),n.from("ai_executive_decisions").select("id, created_at, decision_type, category, title, description, proposed_by, approved_by, meeting_id, status, rationale, chosen_option, success_metrics, implementation_plan, deadline, lessons_learned, human_approval_required, human_approved_by, human_approved_at").order("created_at",{ascending:!1}).limit(s),n.from("ai_executive_action_drafts").select("id, created_at, executive_id, created_by_user_id, source_insight_id, action_type, action_payload, preview, risk_level, requires_external, is_executable, status, executed_at, execution_result").order("created_at",{ascending:!1}).limit(s)]),c=new Map;for(let t of e||[])t?.id&&c.set(String(t.id),{id:String(t.id),role:String(t.role||""),name:String(t.name||""),title:String(t.title||"")});let d=(t.data||[]).map(e=>({...e,initiated_by_executive:e?.initiated_by&&c.get(String(e.initiated_by))||null,participants_executives:Array.isArray(e?.participants)?e.participants.map(e=>c.get(String(e))||{id:String(e),role:"",name:"",title:""}):[]})),u=(i.data||[]).map(e=>({...e,proposed_by_executive:e?.proposed_by&&c.get(String(e.proposed_by))||null,approved_by_executives:Array.isArray(e?.approved_by)?e.approved_by.map(e=>c.get(String(e))||{id:String(e),role:"",name:"",title:""}):[]})),l=(r.data||[]).map(e=>({...e,executive:e?.executive_id&&c.get(String(e.executive_id))||null}));if(a){let e=Array.from(c.values()).find(e=>String(e.role).toLowerCase()===a)?.id||null;e&&(d=d.filter(t=>{let i=String(t?.initiated_by||""),r=Array.isArray(t?.participants)?t.participants.map(e=>String(e)):[];return i===e||r.includes(e)}),u=u.filter(t=>String(t?.proposed_by||"")===e),l=l.filter(t=>String(t?.executive_id||"")===e))}return o.NextResponse.json({success:!0,role:a,limit:s,executives:Array.from(c.values()),meetings:d,decisions:u,drafts:l})}catch(e){return o.NextResponse.json({success:!0,role:a,limit:s,executives:[],meetings:[],decisions:[],drafts:[],warning:String(e?.message||"")},{status:200})}}let m=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/csuite/audit/route",pathname:"/api/admin/csuite/audit",filename:"route",bundlePath:"app/api/admin/csuite/audit/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\csuite\\audit\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:g,serverHooks:y}=m,x="/api/admin/csuite/audit/route";function v(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},90176:(e,t,i)=>{i.d(t,{t:()=>a});var r=i(54128);function a(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,r.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},17478:(e,t,i)=>{i.d(t,{k:()=>o});var r=i(87070),a=i(20344),s=i(71615),n=i(54128);async function o(e){let t=(0,s.cookies)(),i=(0,a.createRouteHandlerClient)({cookies:()=>t}),o=e.headers.get("authorization")||"",c=o.toLowerCase().startsWith("bearer ")?o.slice(7).trim():null,d=c?(0,n.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${c}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):i,{data:u}=await d.auth.getUser();if(!u.user?.id)return{ok:!1,res:r.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:l,error:p}=await d.rpc("is_admin");return p||!l?{ok:!1,res:r.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:u.user.id}}},17743:(e,t,i)=>{i.d(t,{G:()=>r,U:()=>a});let r=["ceo","cfo","cmo","cto","coo","cco","chro"];function a(e){let t=String(e||"").trim().toLowerCase();return r.includes(t)?t:null}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958],()=>i(95134));module.exports=r})();