"use strict";(()=>{var e={};e.id=22048,e.ids=[22048],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},11386:(e,s,o)=>{o.r(s),o.d(s,{originalPathname:()=>P,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var t={};o.r(t),o.d(t,{POST:()=>p,dynamic:()=>u});var r=o(49303),a=o(88716),n=o(60670),i=o(87070),c=o(20344),l=o(71615);let u="force-dynamic";async function p(e){try{let s=(0,l.cookies)(),o=(0,c.createRouteHandlerClient)({cookies:()=>s}),{data:t}=await o.auth.getUser();if(!t.user?.id)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:r,error:a}=await o.rpc("is_admin");if(a||!r)return i.NextResponse.json({error:"Acesso negado (admin)"},{status:403});let{email:n,password:u}=await e.json();if(!n||!u)return i.NextResponse.json({error:"Email e senha s\xe3o obrigat\xf3rios"},{status:400});let[p,d]=n.split("@");if(!p||!d)return i.NextResponse.json({success:!1,message:"Email inv\xe1lido (formato esperado: usuario@dominio)"},{status:400});let m=process.env.CPANEL_USER,x=process.env.CPANEL_PASSWORD,g=process.env.CPANEL_DOMAIN;if(!m||!x||!g)return console.warn("âš ï¸ Credenciais do cPanel n\xe3o configuradas"),i.NextResponse.json({success:!1,message:"Credenciais do cPanel n\xe3o configuradas. Configure CPANEL_USER, CPANEL_PASSWORD e CPANEL_DOMAIN (ex.: https://SEU_HOST:2083).",email:n},{status:200});let P=Buffer.from(`${m}:${x}`).toString("base64"),f=function(e){let s=String(e||"").trim();return s?(/^https?:\/\//i.test(s)?s:`https://${s}`).replace(/\/+$/,""):""}(g),E=`${f}/execute/Email/add_pop?email=${encodeURIComponent(p)}&password=${encodeURIComponent(u)}&domain=${encodeURIComponent(d)}&quota=500`;console.log(`ðŸ“§ Tentando criar email no cPanel: ${n}`),console.log(`ðŸ”— URL: ${E.replace(/password=[^&]+/,"password=***")}`);let R=await fetch(E,{method:"GET",headers:{Authorization:`Basic ${P}`,"Content-Type":"application/json"}}),h=R.headers.get("content-type");if(!h||!h.includes("application/json")){let e=await R.text();return console.error("âŒ cPanel retornou HTML ao inv\xe9s de JSON:",e.substring(0,300)),i.NextResponse.json({success:!1,message:"cPanel retornou resposta inv\xe1lida (HTML). Verifique a configura\xe7\xe3o.",hint:"CPANEL_DOMAIN deve ser a URL completa com porta, ex: https://seu-servidor.com:2083",details:"A resposta do servidor n\xe3o \xe9 JSON. Isso pode indicar URL incorreta ou problema de autentica\xe7\xe3o.",email:n},{status:500})}let j=await R.json();if(j.result?.status===1||1===j.status)return console.log(`âœ… Email criado no cPanel: ${n}`),i.NextResponse.json({success:!0,message:"Email criado com sucesso no cPanel",email:n,data:j.result?.data||j.data});{let e=j.result?.errors||j.errors||["Erro desconhecido"];if(console.error("âŒ Erro ao criar email no cPanel:",e),e.some(e=>e.toLowerCase().includes("already exists")||e.toLowerCase().includes("j\xe1 existe")))return console.log(`â„¹ï¸ Email j\xe1 existe no cPanel: ${n}`),i.NextResponse.json({success:!0,message:"Email j\xe1 existe no cPanel",email:n,alreadyExists:!0});return i.NextResponse.json({success:!1,message:"Erro ao criar email no cPanel",errors:e},{status:400})}}catch(e){return console.error("Erro na API de cria\xe7\xe3o de email:",e),i.NextResponse.json({success:!1,error:e.message||"Erro desconhecido"},{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/cpanel/create-email/route",pathname:"/api/cpanel/create-email",filename:"route",bundlePath:"app/api/cpanel/create-email/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\cpanel\\create-email\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:g}=d,P="/api/cpanel/create-email/route";function f(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var o=e=>s(s.s=e),t=s.X(0,[89276,55972,54128,20958],()=>o(11386));module.exports=t})();