"use strict";(()=>{var e={};e.id=74442,e.ids=[74442],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},55492:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};a.r(s),a.d(s,{GET:()=>d,PATCH:()=>p,dynamic:()=>c});var n=a(49303),r=a(88716),i=a(60670),o=a(87070),l=a(17478),u=a(90176);let c="force-dynamic";async function d(e,{params:t}){let a=await (0,l.k)(e);if(!a.ok)return a.res;let{clientId:s}=t,n=(0,u.t)();try{let e=null,{data:t}=await n.from("clients").select("*").eq("id",s).single();if(t&&(e=t),!e){let{data:t}=await n.from("clients").select("*").eq("user_id",s).single();t&&(e=t)}if(!e)return o.NextResponse.json({error:"Cliente n\xe3o encontrado"},{status:404});let a=e.user_id,{data:r}=await n.from("users").select("*").eq("id",a).single(),{data:i}=await n.from("user_profiles").select("*").eq("user_id",a).single();return o.NextResponse.json({client:e,user:r,profile:i})}catch(e){return o.NextResponse.json({error:e.message},{status:500})}}async function p(e,{params:t}){let a=await (0,l.k)(e);if(!a.ok)return a.res;let{clientId:s}=t,n=(0,u.t)(),r=await e.json();try{let e=null,{data:t}=await n.from("clients").select("id,user_id").eq("id",s).single();if(t&&(e=t),!e){let{data:t}=await n.from("clients").select("id,user_id").eq("user_id",s).single();t&&(e=t)}if(!e?.user_id)return o.NextResponse.json({error:"Cliente n\xe3o encontrado"},{status:404});let a=e.user_id,i={};return r.company_name&&(i.company_name=r.company_name),r.contact_name&&(i.contact_name=r.contact_name),r.email&&(i.contact_email=r.email,i.email=r.email),r.phone&&(i.contact_phone=r.phone),r.whatsapp&&(i.whatsapp=r.whatsapp),r.industry&&(i.industry=r.industry),r.website&&(i.website=r.website),r.address&&(i.address=r.address),r.city&&(i.cidade=r.city),r.state&&(i.estado=r.state),r.cpf_cnpj&&(i.cpf_cnpj=r.cpf_cnpj),r.status&&(i.status=r.status),Object.keys(i).length>0&&(i.updated_at=new Date().toISOString(),await n.from("clients").update(i).eq("id",e.id)),(r.full_name||r.phone||r.email||r.account_status)&&await n.from("users").update({...r.full_name&&{full_name:r.full_name,name:r.full_name},...r.phone&&{phone:r.phone},...r.email&&{email:r.email},...r.account_status&&{account_status:r.account_status}}).eq("id",a),(r.full_name||r.phone||r.email)&&await n.from("user_profiles").update({...r.full_name&&{full_name:r.full_name},...r.phone&&{phone:r.phone},...r.email&&{email:r.email},updated_at:new Date().toISOString()}).eq("user_id",a),r.email&&await n.auth.admin.updateUserById(a,{email:r.email}),r.password&&await n.auth.admin.updateUserById(a,{password:r.password}),o.NextResponse.json({success:!0,message:"Cliente atualizado"})}catch(e){return o.NextResponse.json({error:e.message},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/clients/[clientId]/route",pathname:"/api/admin/clients/[clientId]",filename:"route",bundlePath:"app/api/admin/clients/[clientId]/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\clients\\[clientId]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:f,serverHooks:h}=m,g="/api/admin/clients/[clientId]/route";function w(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},90176:(e,t,a)=>{a.d(t,{t:()=>n});var s=a(54128);function n(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,s.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},17478:(e,t,a)=>{a.d(t,{k:()=>o});var s=a(87070),n=a(20344),r=a(71615),i=a(54128);async function o(e){let t=(0,r.cookies)(),a=(0,n.createRouteHandlerClient)({cookies:()=>t}),o=e.headers.get("authorization")||"",l=o.toLowerCase().startsWith("bearer ")?o.slice(7).trim():null,u=l?(0,i.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${l}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):a,{data:c}=await u.auth.getUser();if(!c.user?.id)return{ok:!1,res:s.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:d,error:p}=await u.rpc("is_admin");return p||!d?{ok:!1,res:s.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:c.user.id}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958],()=>a(55492));module.exports=s})();