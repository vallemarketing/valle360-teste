"use strict";(()=>{var e={};e.id=28381,e.ids=[28381],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56200:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>k,patchFetch:()=>P,requestAsyncStorage:()=>d,routeModule:()=>_,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{GET:()=>l,POST:()=>g,dynamic:()=>c});var s=t(49303),n=t(88716),o=t(60670),i=t(87070);let c="force-dynamic",u=process.env.INSTAGRAM_APP_ID,p=process.env.INSTAGRAM_APP_SECRET;function m(e,a){let t=new URL(e.url).origin,r=new URL("/cliente/redes/callback",t);return r.searchParams.set("platform",a.platform),r.searchParams.set("ok",a.ok?"1":"0"),a.error&&r.searchParams.set("error",a.error.slice(0,180)),r.toString()}async function l(e){let{searchParams:a}=new URL(e.url),t=a.get("client_id"),r=a.get("state")||Math.random().toString(36).substring(7);if(!u)return i.NextResponse.redirect(m(e,{platform:"instagram",ok:!1,error:"Instagram App ID n\xe3o configurado"}));if(!t)return i.NextResponse.redirect(m(e,{platform:"instagram",ok:!1,error:"client_id \xe9 obrigat\xf3rio"}));let s=(process.env.NEXT_PUBLIC_APP_URL||new URL(e.url).origin).replace(/\/+$/,""),n=`${s}/api/oauth/instagram/callback`,o=new URL("https://www.facebook.com/v18.0/dialog/oauth");return o.searchParams.set("client_id",u),o.searchParams.set("redirect_uri",n),o.searchParams.set("scope","instagram_basic,instagram_content_publish,instagram_manage_comments,instagram_manage_insights,pages_show_list,pages_read_engagement"),o.searchParams.set("response_type","code"),o.searchParams.set("state",JSON.stringify({clientId:t,state:r})),i.NextResponse.redirect(o.toString())}async function g(e){try{let a;let{code:t,state:r}=await e.json();if(!u||!p)return i.NextResponse.json({error:"Credenciais do Instagram n\xe3o configuradas"},{status:500});if(!t)return i.NextResponse.json({error:"C\xf3digo de autoriza\xe7\xe3o n\xe3o fornecido"},{status:400});let s=(process.env.NEXT_PUBLIC_APP_URL||new URL(e.url).origin).replace(/\/+$/,""),n=`${s}/api/oauth/instagram/callback`,o=await fetch(`https://graph.facebook.com/v18.0/oauth/access_token?client_id=${u}&redirect_uri=${encodeURIComponent(n)}&client_secret=${p}&code=${t}`),c=await o.json();if(c.error)return i.NextResponse.json({error:c.error.message},{status:400});let m=await fetch(`https://graph.facebook.com/v18.0/oauth/access_token?grant_type=fb_exchange_token&client_id=${u}&client_secret=${p}&fb_exchange_token=${c.access_token}`),l=await m.json(),g=await fetch(`https://graph.facebook.com/v18.0/me/accounts?access_token=${l.access_token}`),_=await g.json(),d=[];for(let e of _.data||[]){let a=await fetch(`https://graph.facebook.com/v18.0/${e.id}?fields=instagram_business_account&access_token=${e.access_token}`),t=await a.json();if(t.instagram_business_account){let a=await fetch(`https://graph.facebook.com/v18.0/${t.instagram_business_account.id}?fields=username,name,profile_picture_url&access_token=${e.access_token}`),r=await a.json();d.push({id:t.instagram_business_account.id,username:r.username,name:r.name,profilePicture:r.profile_picture_url,pageId:e.id,pageAccessToken:e.access_token})}}try{a=JSON.parse(r).clientId}catch{a=r}return i.NextResponse.json({success:!0,accounts:d,expiresIn:l.expires_in,clientId:a})}catch(e){return console.error("Erro no OAuth do Instagram:",e),i.NextResponse.json({error:"Erro ao processar autentica\xe7\xe3o"},{status:500})}}let _=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/oauth/instagram/route",pathname:"/api/oauth/instagram",filename:"route",bundlePath:"app/api/oauth/instagram/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\oauth\\instagram\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:f}=_,k="/api/oauth/instagram/route";function P(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[89276,55972],()=>t(56200));module.exports=r})();