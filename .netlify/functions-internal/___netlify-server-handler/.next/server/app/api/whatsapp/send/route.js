"use strict";(()=>{var e={};e.id=69824,e.ids=[69824],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55844:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>d,dynamic:()=>u});var r=t(49303),o=t(88716),n=t(60670),i=t(87070),p=t(54128);let u="force-dynamic";async function d(e){try{let s=function(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return(0,p.eI)("https://ikjgsqtykkhqimypacro.supabase.co",e)}(),{phone:t,message:a,userId:r,conversationId:o,conversationType:n}=await e.json();if(!t||!a)return i.NextResponse.json({error:"Telefone e mensagem s\xe3o obrigat\xf3rios"},{status:400});let{data:u}=await s.from("whatsapp_settings").select("*").eq("is_enabled",!0).maybeSingle();if(!u||!u.api_token)return i.NextResponse.json({error:"WhatsApp n\xe3o configurado"},{status:400});let d=new Date,l=d.getHours(),c=d.getDay();if(u.business_hours_only){let e=parseInt(u.business_start_time.split(":")[0]),s=parseInt(u.business_end_time.split(":")[0]);if(l<e||l>=s)return i.NextResponse.json({error:"Fora do hor\xe1rio comercial"},{status:400})}if(u.exclude_weekends&&(0===c||6===c))return i.NextResponse.json({error:"Envio n\xe3o permitido aos finais de semana"},{status:400});let m=t.replace(/\D/g,""),g=await fetch("https://graph.facebook.com/v18.0/YOUR_PHONE_NUMBER_ID/messages",{method:"POST",headers:{Authorization:`Bearer ${u.api_token}`,"Content-Type":"application/json"},body:JSON.stringify({messaging_product:"whatsapp",to:m,type:"text",text:{body:a}})}),h=await g.json(),_={recipient_phone:m,message_sent:a,status:g.ok?"sent":"failed",error_message:g.ok?null:JSON.stringify(h),whatsapp_message_id:h.messages?.[0]?.id};if(r&&(_.recipient_user_id=r),o&&(_.conversation_id=o),n&&(_.conversation_type=n),await s.from("whatsapp_logs").insert(_),!g.ok)return i.NextResponse.json({error:"Erro ao enviar mensagem",details:h},{status:500});return i.NextResponse.json({success:!0,messageId:h.messages?.[0]?.id})}catch(e){return console.error("Erro ao enviar WhatsApp:",e),i.NextResponse.json({error:"Erro interno",details:e.message},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/whatsapp/send/route",pathname:"/api/whatsapp/send",filename:"route",bundlePath:"app/api/whatsapp/send/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\whatsapp\\send\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:g}=l,h="/api/whatsapp/send/route";function _(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[89276,55972,54128],()=>t(55844));module.exports=a})();