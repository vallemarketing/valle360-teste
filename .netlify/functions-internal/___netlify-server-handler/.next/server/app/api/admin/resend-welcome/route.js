"use strict";(()=>{var e={};e.id=25454,e.ids=[25454],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},3610:(e,a,r)=>{r.r(a),r.d(a,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{POST:()=>u,dynamic:()=>m});var t=r(49303),o=r(88716),i=r(60670),n=r(87070),l=r(90176),d=r(10603),c=r(17478);let m="force-dynamic";async function u(e){try{let a=await (0,c.k)(e);if(!a.ok)return a.res;let{employeeId:r,userId:s,clientId:t,emailPessoal:o,novaSenha:i,tipo:m="colaborador"}=await e.json();if(!r&&!s&&!t)return n.NextResponse.json({error:"employeeId, userId ou clientId \xe9 obrigat\xf3rio"},{status:400});let u=(0,l.t)(),p=s||"",f="",_="",h="",g=o||"";if(r||s||"colaborador"===m){let e=r||s||t,a=null;if(r||p){let e=[r?`id.eq.${r}`:null,p?`user_id.eq.${p}`:null].filter(Boolean).join(","),{data:s}=await u.from("employees").select("id, user_id, first_name, last_name, areas, whatsapp, personal_email").or(e).single();s&&(a=s)}if(!a&&e){let{data:r}=await u.from("employees").select("id, user_id, first_name, last_name, areas, whatsapp, personal_email").eq("user_id",e).single();if(r)a=r;else{let{data:r}=await u.from("employees").select("id, user_id, first_name, last_name, areas, whatsapp, personal_email").eq("id",e).single();r&&(a=r)}}if(a){let e=a?.user_id||p||"",{data:r}=await u.from("users").select("email").eq("id",e).single(),{data:s}=await u.from("user_profiles").select("email, metadata").eq("user_id",e).single();f=r?.email||"",_=a.first_name||"Colaborador",h=Array.isArray(a.areas)?a.areas.join(", "):"",g||(g=a.personal_email||s?.metadata?.personal_email||""),!p&&a?.user_id&&(p=a.user_id)}else{let e=p||"";if(!e)return n.NextResponse.json({error:"Colaborador n\xe3o encontrado"},{status:404});let{data:a}=await u.from("users").select("email, full_name, name").eq("id",e).single(),{data:r}=await u.from("user_profiles").select("full_name, email, metadata").eq("user_id",e).single();f=a?.email||r?.email||"",_=r?.full_name||a?.full_name||a?.name||"Colaborador",h="",g||(g=r?.metadata?.personal_email||r?.email||"")}}if(t&&"cliente"===m){let{data:e,error:a}=await u.from("clients").select("id, user_id, company_name, contact_name, contact_email").eq("id",t).single();if(a||!e)return n.NextResponse.json({error:"Cliente n\xe3o encontrado"},{status:404});p=e.user_id;let{data:r}=await u.from("users").select("email").eq("id",p).single();f=r?.email||e.contact_email||"",_=e.contact_name||e.company_name||"Cliente"}if(!f)return n.NextResponse.json({error:"Email corporativo n\xe3o encontrado"},{status:400});if("colaborador"===m&&!g)return n.NextResponse.json({error:"Email pessoal do colaborador n\xe3o encontrado"},{status:400});let x=i||function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$",a="Valle@";for(let r=0;r<6;r++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}();if(p){let{error:e}=await u.auth.admin.updateUserById(p,{password:x});e&&console.error("Erro ao atualizar senha:",e)}let w="colaborador"===m?g:g||f,I=await (0,d.Pi)({emailDestino:w,emailCorporativo:f,senha:x,nome:_,areasTexto:"colaborador"===m?h:void 0,tipo:m}),R=process.env.WEBMAIL_URL||"https://webmail.vallegroup.com.br/",b=process.env.NEXT_PUBLIC_APP_URL||"https://app.valle360.com.br/login";if(I.success)return n.NextResponse.json({success:!0,message:`Email enviado com sucesso para ${w}`,provider:I.provider,mailtoUrl:I.mailtoUrl,credentials:{email:f,senha:x,webmailUrl:R,loginUrl:b}});if(I.fallbackMode)return n.NextResponse.json({success:!1,fallbackMode:!0,message:I.message,error:I.error,mailtoUrl:I.mailtoUrl,credentials:{email:f,senha:x,webmailUrl:R,loginUrl:b,emailDestino:w},hint:"Falha no envio autom\xe1tico. Use o mailto abaixo."},{status:200});return n.NextResponse.json({success:!1,message:I.message,error:I.error},{status:500})}catch(e){return console.error("[ResendWelcome] Erro:",e),n.NextResponse.json({success:!1,error:e.message},{status:500})}}let p=new t.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/resend-welcome/route",pathname:"/api/admin/resend-welcome",filename:"route",bundlePath:"app/api/admin/resend-welcome/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\resend-welcome\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:h}=p,g="/api/admin/resend-welcome/route";function x(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},90176:(e,a,r)=>{r.d(a,{t:()=>t});var s=r(54128);function t(){let e="https://ikjgsqtykkhqimypacro.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!a)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,s.eI)(e,a,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},17478:(e,a,r)=>{r.d(a,{k:()=>n});var s=r(87070),t=r(20344),o=r(71615),i=r(54128);async function n(e){let a=(0,o.cookies)(),r=(0,t.createRouteHandlerClient)({cookies:()=>a}),n=e.headers.get("authorization")||"",l=n.toLowerCase().startsWith("bearer ")?n.slice(7).trim():null,d=l?(0,i.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${l}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):r,{data:c}=await d.auth.getUser();if(!c.user?.id)return{ok:!1,res:s.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:m,error:u}=await d.rpc("is_admin");return u||!m?{ok:!1,res:s.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:c.user.id}}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),s=a.X(0,[89276,55972,54128,20958,10603],()=>r(3610));module.exports=s})();