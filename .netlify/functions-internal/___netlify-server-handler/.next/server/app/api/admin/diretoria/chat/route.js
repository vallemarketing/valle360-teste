"use strict";(()=>{var e={};e.id=62618,e.ids=[62618],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},22646:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>j,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var a={};r.r(a),r.d(a,{POST:()=>f,dynamic:()=>m});var s=r(49303),o=r(88716),i=r(60670),n=r(87070),c=r(71615),d=r(20344),u=r(90176),l=r(51547),p=r(63576);let m="force-dynamic";async function g(e){try{let t=await e();return t&&"object"==typeof t&&"data"in t?t.data:null}catch{return null}}async function x(e){let t=(0,u.t)(),r=await g(()=>t.from("event_log").select("id, event_type, entity_type, entity_id, created_at, metadata").order("created_at",{ascending:!1}).limit(30)),a=await g(()=>t.from("kanban_tasks").select("id, title, status, priority, due_date, updated_at, created_at, board_id, column_id, area, client_id").order("updated_at",{ascending:!1}).limit(25)),s="chro"===e?await g(()=>t.from("employee_requests").select("id, request_type, start_date, end_date, status, created_at, employee_id").eq("status","pending").order("created_at",{ascending:!1}).limit(20)):null,o="cfo"===e?await g(()=>t.from("invoices").select("id, client_id, due_date, amount, status, created_at").in("status",["overdue","pending"]).order("due_date",{ascending:!0}).limit(20)):null;return{now:new Date().toISOString(),director:e,eventLog:r||[],recentTasks:a||[],pendingRequests:s||[],overdueInvoices:o||[]}}async function f(e){let t;let r=(0,c.cookies)(),a=(0,d.createRouteHandlerClient)({cookies:()=>r}),{data:s,error:o}=await a.auth.getUser(),i=s?.user;if(o||!i)return n.NextResponse.json({success:!1,error:"N\xe3o autorizado"},{status:401});let{data:u}=await a.rpc("is_admin");if(!u)return n.NextResponse.json({success:!1,error:"Acesso negado (admin)"},{status:403});try{t=await e.json()}catch{return n.NextResponse.json({success:!1,error:"Body inv\xe1lido (JSON)"},{status:400})}let m=String(t?.director||"").trim().toLowerCase(),g=String(t?.message||"").trim(),f=Array.isArray(t?.history)?t.history:[];if(!m||!["cfo","cto","cmo","chro"].includes(m))return n.NextResponse.json({success:!1,error:"Director inv\xe1lido"},{status:400});if(!g)return n.NextResponse.json({success:!1,error:"Mensagem vazia"},{status:400});let v=function(e){switch(e){case"cfo":return"financeiro";case"cto":return"operacao";case"cmo":return"head_marketing";case"chro":return"rh";default:return"super_admin"}}(m),y=p.TC[v]||p.TC.super_admin,_=`Voc\xea \xe9 a Diretoria Virtual (${m.toUpperCase()}).
Objetivo: avaliar a atividade do site e do sistema (eventos, tarefas, aprova\xe7\xf5es) e sugerir decis\xf5es executivas.
Regras:
- N\xe3o invente n\xfameros. Se faltar dado, diga o que falta e sugira como coletar.
- Sempre retorne: (1) Diagn\xf3stico curto, (2) 3 a\xe7\xf5es priorit\xe1rias, (3) 1 alerta (se houver), (4) como medir.
`,h=await x(m),q=f.slice(-10).map(e=>({role:e?.role,content:String(e?.content||"").slice(0,800)})).filter(e=>"user"===e.role||"assistant"===e.role);try{let e=await (0,l.F)({task:"chro"===m?"hr":"cmo"===m?"strategy":"analysis",temperature:.4,maxTokens:900,actorUserId:i.id,entityType:"diretoria_virtual",entityId:m,messages:[{role:"system",content:`${y.systemPrompt}

${_}`},{role:"user",content:`Contexto do sistema (JSON):
${JSON.stringify(h).slice(0,18e3)}

Hist\xf3rico recente:
${JSON.stringify(q)}

Pergunta:
${g}`}]});return n.NextResponse.json({success:!0,reply:e.text,provider:e.provider,model:e.model})}catch(r){let e=(0,l.getProviderStatus)(),t=e.openrouter||e.claude||e.openai||e.gemini?"N\xe3o consegui obter resposta do provedor de IA agora. Tente novamente em instantes.":"Integra\xe7\xf5es de IA ainda n\xe3o est\xe3o configuradas. Configure em Integrações (OpenRouter/Claude/OpenAI/Gemini) para habilitar respostas autom\xe1ticas.";return n.NextResponse.json({success:!0,reply:`${t}

Enquanto isso, posso te ajudar se voc\xea me disser: qual site/cliente/\xe1rea quer avaliar e qual m\xe9trica importa (leads, convers\xe3o, churn, SLA)?`,provider:null,model:null})}}let v=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/diretoria/chat/route",pathname:"/api/admin/diretoria/chat",filename:"route",bundlePath:"app/api/admin/diretoria/chat/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\diretoria\\chat\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:_,serverHooks:h}=v,q="/api/admin/diretoria/chat/route";function j(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[89276,55972,54128,20958,58658],()=>r(22646));module.exports=a})();