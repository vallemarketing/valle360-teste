"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7269],{97269:function(e,r,l){l.d(r,{m:function(){return E}});var a=l(57437),s=l(2265),t=l(27648),o=l(26892),i=l(14438),d=l(31047),n=l(99397),c=l(73247),m=l(7586),u=l(42488),x=l(96215),v=l(37760),h=l(79219),p=l(50598),g=l(42351),b=l(96362),y=l(18930),f=l(91436),j=l(21156),N=l(97059),C=l(62994),w=l(78155),k=l(52797),S=l(71006),A=l(33842);function _(e){return String(null!=e?e:"").trim()}function E(e){var r,l,E,F,P,Z,M,L,T,B;let I=e.uploadHref,[R,D]=(0,s.useState)("list"),[z,K]=(0,s.useState)(!0),[U,V]=(0,s.useState)(null),[W,G]=(0,s.useState)([]),[H,O]=(0,s.useState)("all"),[q,J]=(0,s.useState)(""),[Q,X]=(0,s.useState)("all"),[Y,$]=(0,s.useState)("all"),[ee,er]=(0,s.useState)([]),[el,ea]=(0,s.useState)(null),[es,et]=(0,s.useState)(!1),[eo,ei]=(0,s.useState)(null),[ed,en]=(0,s.useState)(!1),ec=async e=>{(null==e?void 0:e.silent)||K(!0),V(null);try{let e=H&&"all"!==H?"?client_id=".concat(encodeURIComponent(H)):"",[r,l]=await Promise.all([fetch("/api/social/posts-mirror".concat(e),{cache:"no-store"}),fetch("/api/social/clients",{cache:"no-store"})]),a=await r.json().catch(()=>null),s=await l.json().catch(()=>null);if(!r.ok)throw Error((null==a?void 0:a.error)||"Falha ao carregar posts");if(!l.ok)throw Error((null==s?void 0:s.error)||"Falha ao carregar clientes");er(Array.isArray(null==a?void 0:a.posts)?a.posts:[]),G((Array.isArray(null==s?void 0:s.clients)?s.clients:[]).map(e=>({id:_(null==e?void 0:e.id),name:_((null==e?void 0:e.name)||"Cliente")})))}catch(e){console.error("Erro ao carregar gest\xe3o de posts:",e),er([]),G([]),V(String((null==e?void 0:e.message)||"Falha ao carregar gest\xe3o de posts"))}finally{(null==e?void 0:e.silent)||K(!1)}},em=async()=>{if(ea(null),H&&"all"!==H)try{let e=await fetch("/api/social/metrics?client_id=".concat(encodeURIComponent(H),"&days=30"),{cache:"no-store"}),r=await e.json().catch(()=>null);if(!e.ok)throw Error((null==r?void 0:r.error)||"Falha ao carregar m\xe9tricas");ea({latest:(null==r?void 0:r.latest)||null,daily:Array.isArray(null==r?void 0:r.daily)?r.daily:[],range_days:Number((null==r?void 0:r.range_days)||30)})}catch(e){console.error("Falha ao carregar m\xe9tricas:",e),V(String((null==e?void 0:e.message)||"Falha ao carregar m\xe9tricas"))}};(0,s.useEffect)(()=>{ec()},[]),(0,s.useEffect)(()=>{(async()=>{await ec({silent:!0}),await em()})()},[H]);let eu=(0,s.useMemo)(()=>new Map(W.map(e=>[e.id,e.name])),[W]),ex=(0,s.useMemo)(()=>(ee||[]).map(e=>{let r=_(null==e?void 0:e.caption),l=r?r.slice(0,64)+(r.length>64?"…":""):"Post (".concat(_((null==e?void 0:e.post_type)||"m\xeddia"),")"),a=_(null==e?void 0:e.client_id),s=eu.get(a)||"Cliente",t=(null==e?void 0:e.scheduled_at)||(null==e?void 0:e.published_at)||(null==e?void 0:e.created_at)||new Date().toISOString(),o=function(e,r,l,a){let s=String(e||"").toLowerCase();return r||"draft"===s?"draft":"failed"===s?"failed":"published"===s||a?"published":"scheduled"}(null==e?void 0:e.status,null==e?void 0:e.is_draft,null==e||e.scheduled_at,null==e?void 0:e.published_at),i=(Array.isArray(null==e?void 0:e.platforms)?e.platforms.map(String):[]).filter(e=>["instagram","facebook","linkedin","twitter"].includes(String(e))),d=Array.isArray(null==e?void 0:e.media_urls)?e.media_urls:[],n=d.length?_(d[0]):void 0,c=_(null==e?void 0:e.error_message);return{id:_(null==e?void 0:e.id),title:l,caption:r,clientId:a,clientName:s,scheduledAt:t,status:o,platforms:i.length?i:["instagram"],thumbnail:n,errorMessage:c,raw:e}}).filter(e=>!!e.id),[ee,eu]),ev=(0,s.useMemo)(()=>{let e=q.trim().toLowerCase();return ex.filter(r=>!!("all"===Q||r.platforms.includes(Q))&&("all"===Y||String(r.status)===Y)&&(!e||"".concat(r.title," ").concat(r.caption," ").concat(r.clientName).toLowerCase().includes(e)))},[ex,q,Q,Y]),eh=(0,s.useMemo)(()=>ev.filter(e=>"failed"===e.status||!!e.errorMessage),[ev]),ep=(0,s.useMemo)(()=>{let e=ev.filter(e=>"scheduled"===e.status).length,r=ev.filter(e=>"draft"===e.status).length;return{scheduled:e,drafts:r,published:ev.filter(e=>"published"===e.status).length,failed:ev.filter(e=>"failed"===e.status).length,activeClients:new Set(ev.map(e=>e.clientId).filter(Boolean)).size}},[ev]),eg=e=>{ei(e),et(!0)},eb=async()=>{if(eo){en(!0),V(null);try{let e=await fetch("/api/social/posts-mirror?id=".concat(encodeURIComponent(eo)),{method:"DELETE"}),r=await e.json().catch(()=>null);if(!e.ok)throw Error((null==r?void 0:r.error)||"Falha ao deletar post");i.Am.success("Post deletado."),et(!1),ei(null),await ec({silent:!0})}catch(e){console.error("Falha ao deletar post:",e),i.Am.error(String((null==e?void 0:e.message)||"Falha ao deletar post")),V(String((null==e?void 0:e.message)||"Falha ao deletar post"))}finally{en(!1)}}},ey=e.titlePrefix?"".concat(e.titlePrefix," - Gest\xe3o de Posts"):"Gest\xe3o de Posts";return(0,a.jsx)("div",{className:"min-h-screen p-6",style:{backgroundColor:"var(--bg-secondary)"},children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{backgroundColor:"var(--primary-50)"},children:(0,a.jsx)(d.Z,{className:"w-7 h-7",style:{color:"var(--primary-500)"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:ey}),(0,a.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Vis\xe3o r\xe1pida (Calend\xe1rio/Lista/Monitoramento) baseada em `instagram_posts`."})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)(t.default,{href:I,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-medium text-white",style:{backgroundColor:"var(--primary-500)"},children:[(0,a.jsx)(n.Z,{className:"w-4 h-4"}),"Agendar Postagem"]})})]}),U?(0,a.jsx)("div",{className:"rounded-xl border p-3 text-sm",style:{backgroundColor:"var(--error-50)",borderColor:"var(--error-200)",color:"var(--error-700)"},children:U}):null,(0,a.jsx)("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2",style:{color:"var(--text-tertiary)"}}),(0,a.jsx)("input",{value:q,onChange:e=>J(e.target.value),placeholder:"Buscar por legenda/cliente…",className:"w-full pl-10 pr-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"}})]}),(0,a.jsxs)("select",{value:H,onChange:e=>O(e.target.value),className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[(0,a.jsx)("option",{value:"all",children:"Todos os clientes"}),W.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsxs)("select",{value:Q,onChange:e=>X(e.target.value),className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[(0,a.jsx)("option",{value:"all",children:"Todas as plataformas"}),(0,a.jsx)("option",{value:"instagram",children:"Instagram"}),(0,a.jsx)("option",{value:"facebook",children:"Facebook"}),(0,a.jsx)("option",{value:"linkedin",children:"LinkedIn"}),(0,a.jsx)("option",{value:"twitter",children:"Twitter"})]}),(0,a.jsxs)("select",{value:Y,onChange:e=>$(e.target.value),className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[(0,a.jsx)("option",{value:"all",children:"Todos os status"}),(0,a.jsx)("option",{value:"draft",children:"Rascunho"}),(0,a.jsx)("option",{value:"scheduled",children:"Agendado"}),(0,a.jsx)("option",{value:"published",children:"Publicado"}),(0,a.jsx)("option",{value:"failed",children:"Falhou"})]})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Agendados",value:ep.scheduled},{label:"Rascunhos",value:ep.drafts},{label:"Publicados",value:ep.published},{label:"Falhas",value:ep.failed},{label:"Clientes ativos",value:ep.activeClients}].map(e=>(0,a.jsxs)("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,a.jsx)("div",{className:"text-xs font-medium",style:{color:"var(--text-tertiary)"},children:e.label}),(0,a.jsx)("div",{className:"text-2xl font-bold mt-1",style:{color:"var(--text-primary)"},children:e.value})]},e.label))}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:[{id:"list",label:"Lista",icon:m.Z},{id:"calendar",label:"Calend\xe1rio",icon:d.Z},{id:"monitor",label:"Monitoramento",icon:u.Z},{id:"metrics",label:"M\xe9tricas",icon:x.Z}].map(e=>{let r=e.icon,l=R===e.id;return(0,a.jsxs)("button",{onClick:()=>D(e.id),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl border text-sm font-medium",style:{backgroundColor:l?"var(--primary-50)":"var(--bg-primary)",borderColor:l?"var(--primary-200)":"var(--border-light)",color:l?"var(--primary-700)":"var(--text-primary)"},children:[(0,a.jsx)(r,{className:"w-4 h-4"}),e.label]},e.id)})}),z?(0,a.jsx)("div",{className:"rounded-2xl border p-6",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:(0,a.jsx)("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Carregando…"})}):null,z||"calendar"!==R?null:(0,a.jsx)("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:(0,a.jsx)(S.d,{posts:ev,onAddPost:()=>{window.location.href=I},onEditPost:()=>{window.location.href=I},onViewPost:()=>{window.location.href=I},onDeletePost:e=>eg(String(e))})}),z||"list"!==R?null:(0,a.jsxs)("div",{className:"rounded-2xl border overflow-hidden",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,a.jsxs)("div",{className:"p-4 border-b",style:{borderColor:"var(--border-light)"},children:[(0,a.jsxs)("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["\xdaltimos posts (",ev.length,")"]}),(0,a.jsx)("div",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"A\xe7\xf5es avan\xe7adas (reagendar/editar m\xeddia) continuam no “Agendar Postagem”."})]}),(0,a.jsxs)("div",{className:"divide-y",style:{borderColor:"var(--border-light)"},children:[ev.slice(0,100).map(e=>{var r;let l=function(e){let r=String(e||"").toLowerCase();return"published"===r?{bg:"var(--success-100)",text:"var(--success-700)"}:"failed"===r?{bg:"var(--error-100)",text:"var(--error-700)"}:"draft"===r?{bg:"var(--neutral-200)",text:"var(--neutral-700)"}:{bg:"var(--primary-100)",text:"var(--primary-700)"}}(e.status);return(0,a.jsxs)("div",{className:"p-4 flex flex-col md:flex-row md:items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:l.bg,color:l.text},children:"draft"===(r=e.status)?"Rascunho":"scheduled"===r?"Agendado":"published"===r?"Publicado":"failed"===r?"Falhou":r}),(0,a.jsx)("span",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:e.clientName})]}),(0,a.jsx)("div",{className:"mt-1 font-medium truncate",style:{color:"var(--text-primary)"},children:e.title}),(0,a.jsx)("div",{className:"text-xs truncate mt-1",style:{color:"var(--text-secondary)"},children:e.caption||"—"}),e.errorMessage?(0,a.jsxs)("div",{className:"text-xs mt-1",style:{color:"var(--error-600)"},children:["Erro: ",e.errorMessage]}):null,(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-xs",style:{color:"var(--text-tertiary)"},children:[e.platforms.includes("instagram")?(0,a.jsx)(v.Z,{className:"w-4 h-4"}):null,e.platforms.includes("facebook")?(0,a.jsx)(h.Z,{className:"w-4 h-4"}):null,e.platforms.includes("linkedin")?(0,a.jsx)(p.Z,{className:"w-4 h-4"}):null,e.platforms.includes("twitter")?(0,a.jsx)(g.Z,{className:"w-4 h-4"}):null,(0,a.jsx)("span",{className:"ml-2",children:new Date(e.scheduledAt).toLocaleString("pt-BR")})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(t.default,{href:I,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:["Abrir no Agendar ",(0,a.jsx)(b.Z,{className:"w-4 h-4"})]}),(0,a.jsxs)(o.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>eg(e.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--error-50)",borderColor:"var(--error-200)",color:"var(--error-700)"},children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),"Excluir"]})]})]},e.id)}),0===ev.length?(0,a.jsx)("div",{className:"p-6 text-sm",style:{color:"var(--text-secondary)"},children:"Nenhum post encontrado com os filtros atuais."}):null]})]}),z||"monitor"!==R?null:(0,a.jsxs)("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,a.jsxs)("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Falhas e erros (",eh.length,")"]}),(0,a.jsx)("div",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"Use esta lista para identificar posts com `status=failed` ou `error_message`."}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[eh.slice(0,100).map(e=>(0,a.jsx)("div",{className:"rounded-xl border p-3",style:{borderColor:"var(--border-light)",backgroundColor:"var(--bg-secondary)"},children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("div",{className:"text-sm font-medium truncate",style:{color:"var(--text-primary)"},children:[e.clientName," — ",e.title]}),(0,a.jsx)("div",{className:"text-xs mt-1",style:{color:"var(--error-700)"},children:e.errorMessage||"Falha sem mensagem detalhada."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(t.default,{href:I,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:["Abrir ",(0,a.jsx)(b.Z,{className:"w-4 h-4"})]}),(0,a.jsxs)("button",{onClick:()=>eg(e.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--error-50)",borderColor:"var(--error-200)",color:"var(--error-700)"},children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),"Excluir"]})]})]})},e.id)),0===eh.length?(0,a.jsx)("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Nenhuma falha encontrada com os filtros atuais."}):null]})]}),z||"metrics"!==R?null:(0,a.jsxs)("div",{className:"rounded-2xl border p-4 space-y-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"M\xe9tricas (30 dias)"}),(0,a.jsx)("div",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"Baseado em `social_account_metrics_daily` (agregado por dia e plataforma)."})]}),(0,a.jsx)("button",{onClick:em,className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:"Atualizar"})]}),"all"===H?(0,a.jsx)("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Selecione um cliente para ver m\xe9tricas."}):el?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[{label:"Impress\xf5es",value:null!==(Z=null===(r=el.latest)||void 0===r?void 0:r.impressions)&&void 0!==Z?Z:0},{label:"Alcance",value:null!==(M=null===(l=el.latest)||void 0===l?void 0:l.reach)&&void 0!==M?M:0},{label:"Engajados",value:null!==(L=null===(E=el.latest)||void 0===E?void 0:E.engaged)&&void 0!==L?L:0},{label:"Fans",value:null!==(T=null===(F=el.latest)||void 0===F?void 0:F.fans)&&void 0!==T?T:0},{label:"Visitas Perfil",value:null!==(B=null===(P=el.latest)||void 0===P?void 0:P.profile_views)&&void 0!==B?B:0}].map(e=>(0,a.jsxs)("div",{className:"rounded-xl border p-3",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[(0,a.jsx)("div",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:e.label}),(0,a.jsx)("div",{className:"text-lg font-semibold mt-1",style:{color:"var(--text-primary)"},children:Number(e.value||0).toLocaleString("pt-BR")})]},e.label))}),(0,a.jsx)("div",{className:"h-72 rounded-xl border p-3",style:{borderColor:"var(--border-light)",backgroundColor:"var(--bg-secondary)"},children:(0,a.jsx)(f.h,{width:"100%",height:"100%",children:(0,a.jsxs)(j.w,{data:el.daily,children:[(0,a.jsx)(N.K,{dataKey:"date",tick:{fontSize:12}}),(0,a.jsx)(C.B,{tick:{fontSize:12}}),(0,a.jsx)(w.u,{}),(0,a.jsx)(k.x,{type:"monotone",dataKey:"impressions",stroke:"#1672d6",strokeWidth:2,dot:!1}),(0,a.jsx)(k.x,{type:"monotone",dataKey:"reach",stroke:"#10B981",strokeWidth:2,dot:!1}),(0,a.jsx)(k.x,{type:"monotone",dataKey:"engaged",stroke:"#F59E0B",strokeWidth:2,dot:!1})]})})})]}):(0,a.jsx)("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Sem dados de m\xe9tricas para este cliente (ou ainda n\xe3o coletado)."})]}),(0,a.jsx)(A.do,{isOpen:es,onClose:()=>{ed||(et(!1),ei(null))},onConfirm:eb,title:"Deletar post",message:"Tem certeza que deseja deletar este post? Essa a\xe7\xe3o n\xe3o pode ser desfeita.",confirmText:"Deletar",cancelText:"Cancelar",variant:"danger",loading:ed})]})})}}}]);