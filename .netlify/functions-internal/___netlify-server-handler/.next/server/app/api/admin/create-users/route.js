"use strict";(()=>{var e={};e.id=115,e.ids=[115],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},75677:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>c});var a={};r.r(a),r.d(a,{POST:()=>d,PUT:()=>l});var t=r(49303),o=r(88716),i=r(60670),n=r(54128),u=r(87070);async function d(e){try{let{users:s,adminSecret:r}=await e.json();if("1"!==process.env.ENABLE_SETUP_ROUTES)return u.NextResponse.json({error:"Not Found"},{status:404});if(!process.env.ADMIN_SECRET)return u.NextResponse.json({error:"ADMIN_SECRET n\xe3o configurado no ambiente"},{status:500});if(r!==process.env.ADMIN_SECRET)return u.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let a="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!a||!t)return u.NextResponse.json({error:"Vari\xe1veis de ambiente n\xe3o configuradas",hint:"Configure SUPABASE_SERVICE_ROLE_KEY no ambiente"},{status:500});let o=(0,n.eI)(a,t,{auth:{autoRefreshToken:!1,persistSession:!1}}),i=[];for(let e of s)try{let{data:s,error:r}=await o.auth.admin.createUser({email:e.email,password:e.password||"Valle@2024",email_confirm:!0,user_metadata:{full_name:e.full_name,area:e.area}});if(r){if(r.message.includes("already been registered")){let{data:s}=await o.auth.admin.listUsers(),r=s.users.find(s=>s.email===e.email);if(r){let{error:s}=await o.auth.admin.updateUserById(r.id,{password:e.password||"Valle@2024"});s?i.push({email:e.email,status:"error",message:s.message}):(await o.from("employees").update({user_id:r.id}).eq("email",e.email),await o.from("user_profiles").update({user_id:r.id}).eq("email",e.email),i.push({email:e.email,status:"updated",user_id:r.id}))}}else i.push({email:e.email,status:"error",message:r.message})}else s.user&&(await o.from("employees").update({user_id:s.user.id}).eq("email",e.email),await o.from("user_profiles").update({user_id:s.user.id}).eq("email",e.email),i.push({email:e.email,status:"created",user_id:s.user.id}))}catch(s){i.push({email:e.email,status:"error",message:String(s)})}return u.NextResponse.json({success:!0,results:i})}catch(e){return console.error("Erro ao criar usu\xe1rios:",e),u.NextResponse.json({error:"Erro interno"},{status:500})}}async function l(e){try{let{email:s,newPassword:r,adminSecret:a}=await e.json();if(a!==process.env.ADMIN_SECRET&&"Valle@Admin2024"!==a)return u.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let t="https://ikjgsqtykkhqimypacro.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!t||!o)return u.NextResponse.json({error:"Configure SUPABASE_SERVICE_ROLE_KEY no ambiente"},{status:500});let i=(0,n.eI)(t,o,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:d}=await i.auth.admin.listUsers(),l=d.users.find(e=>e.email===s);if(!l)return u.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let{error:p}=await i.auth.admin.updateUserById(l.id,{password:r});if(p)return u.NextResponse.json({error:p.message},{status:400});return u.NextResponse.json({success:!0,message:"Senha atualizada com sucesso"})}catch(e){return console.error("Erro ao resetar senha:",e),u.NextResponse.json({error:"Erro interno"},{status:500})}}let p=new t.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/create-users/route",pathname:"/api/admin/create-users",filename:"route",bundlePath:"app/api/admin/create-users/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\create-users\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:c,serverHooks:E}=p,f="/api/admin/create-users/route";function h(){return(0,i.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:c})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),a=s.X(0,[89276,55972,54128],()=>r(75677));module.exports=a})();