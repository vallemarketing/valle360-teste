"use strict";(()=>{var e={};e.id=80465,e.ids=[80465],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4050:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>S,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var a={};s.r(a),s.d(a,{DELETE:()=>g,GET:()=>p,POST:()=>m,PUT:()=>_,dynamic:()=>l});var r=s(49303),o=s(88716),i=s(60670),n=s(87070),d=s(1926);class c{async schedulePost(e){try{let t={...e,status:"scheduled",approval_status:e.approval_status||"pending",created_at:new Date().toISOString()},{data:s,error:a}=await d.O.from("scheduled_posts").insert(t).select().single();if(a)return console.error("Erro ao agendar post:",a),null;return"pending"===e.approval_status&&await this.notifyClientForApproval(s),s}catch(e){return console.error("Erro ao agendar post:",e),null}}async getScheduledPosts(e){try{let t=d.O.from("scheduled_posts").select("*").order("scheduled_for",{ascending:!0});e?.client_id&&(t=t.eq("client_id",e.client_id)),e?.status&&(t=t.eq("status",e.status)),e?.approval_status&&(t=t.eq("approval_status",e.approval_status)),e?.from_date&&(t=t.gte("scheduled_for",e.from_date)),e?.to_date&&(t=t.lte("scheduled_for",e.to_date));let{data:s,error:a}=await t;if(a)return console.error("Erro ao buscar posts:",a),[];return s||[]}catch(e){return console.error("Erro ao buscar posts:",e),[]}}async approvePost(e,t){try{let{error:s}=await d.O.from("scheduled_posts").update({approval_status:"approved",approved_by:t,approved_at:new Date().toISOString()}).eq("id",e);if(s)return console.error("Erro ao aprovar post:",s),!1;return await this.notifyPostApproved(e),!0}catch(e){return console.error("Erro ao aprovar post:",e),!1}}async rejectPost(e,t,s){try{let{error:a}=await d.O.from("scheduled_posts").update({approval_status:"rejected",rejection_reason:t,approved_by:s,approved_at:new Date().toISOString()}).eq("id",e);if(a)return console.error("Erro ao rejeitar post:",a),!1;return await this.notifyPostRejected(e,t),!0}catch(e){return console.error("Erro ao rejeitar post:",e),!1}}async publishPost(e){try{let{data:t}=await d.O.from("scheduled_posts").select("*").eq("id",e).single();if(!t)return{success:!1,results:[{error:"Post n\xe3o encontrado"}]};if("approved"!==t.approval_status)return{success:!1,results:[{error:"Post n\xe3o aprovado"}]};let s=[];for(let e of t.platforms){let a=await this.publishToPlatform(t,e);s.push({platform:e.name,...a})}let a=s.every(e=>e.success);return await d.O.from("scheduled_posts").update({status:a?"published":"failed",published_at:a?new Date().toISOString():null,publish_results:s}).eq("id",e),{success:a,results:s}}catch(e){return console.error("Erro ao publicar post:",e),{success:!1,results:[{error:"Erro interno"}]}}}async publishToPlatform(e,t){return(console.log(`[PUBLISH] Publicando em ${t.name}: ${e.title}`),await new Promise(e=>setTimeout(e,500)),Math.random()>.1)?{success:!0,post_id:`${t.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}:{success:!1,error:"Falha na conex\xe3o com a API"}}async getContentCalendar(e,t,s){let a=new Date(s,t-1,1),r=new Date(s,t,0),o=await this.getScheduledPosts({client_id:e,from_date:a.toISOString(),to_date:r.toISOString()}),i={},n={};for(let e of o){for(let t of e.platforms)i[t.name]=(i[t.name]||0)+1;n[e.status]=(n[e.status]||0)+1}return{client_id:e,month:t,year:s,posts:o,total_posts:o.length,by_platform:i,by_status:n}}getBestPostingTimes(e){let t={instagram:[{day:"Segunda",times:["11:00","14:00","19:00"]},{day:"Ter\xe7a",times:["10:00","13:00","19:00"]},{day:"Quarta",times:["11:00","15:00","19:00"]},{day:"Quinta",times:["12:00","14:00","19:00"]},{day:"Sexta",times:["10:00","14:00","17:00"]},{day:"S\xe1bado",times:["10:00","13:00"]},{day:"Domingo",times:["10:00","19:00"]}],facebook:[{day:"Segunda",times:["09:00","13:00","16:00"]},{day:"Ter\xe7a",times:["09:00","13:00","16:00"]},{day:"Quarta",times:["09:00","13:00","15:00"]},{day:"Quinta",times:["09:00","12:00","14:00"]},{day:"Sexta",times:["09:00","11:00","14:00"]},{day:"S\xe1bado",times:["12:00","13:00"]},{day:"Domingo",times:["13:00","14:00"]}],linkedin:[{day:"Segunda",times:["07:45","10:45","12:45"]},{day:"Ter\xe7a",times:["07:45","10:45","17:00"]},{day:"Quarta",times:["08:00","12:00","17:00"]},{day:"Quinta",times:["07:45","09:45","17:00"]},{day:"Sexta",times:["07:45","10:00","14:00"]}],twitter:[{day:"Segunda",times:["08:00","12:00","17:00"]},{day:"Ter\xe7a",times:["09:00","12:00","17:00"]},{day:"Quarta",times:["09:00","12:00","17:00"]},{day:"Quinta",times:["09:00","12:00","17:00"]},{day:"Sexta",times:["09:00","12:00","16:00"]}],tiktok:[{day:"Segunda",times:["06:00","10:00","22:00"]},{day:"Ter\xe7a",times:["02:00","04:00","09:00"]},{day:"Quarta",times:["07:00","08:00","23:00"]},{day:"Quinta",times:["09:00","12:00","19:00"]},{day:"Sexta",times:["05:00","13:00","15:00"]},{day:"S\xe1bado",times:["11:00","19:00","20:00"]},{day:"Domingo",times:["07:00","08:00","16:00"]}]};return t[e]||t.instagram}async generateContentSuggestions(e){return[`ðŸ“¢ Novidade chegando! Fique ligado nas pr\xf3ximas horas para uma surpresa especial. #Novidade #EmBreve`,`ðŸ’¡ Dica do dia: ${e.theme||"Invista em voc\xea"}. Pequenas mudan\xe7as fazem grandes diferen\xe7as! #Dicas #Motiva\xe7\xe3o`,`ðŸŽ¯ Voc\xea sabia? Empresas que investem em marketing digital crescem 2.8x mais r\xe1pido. Vamos conversar? #Marketing #Crescimento`,`âœ¨ Bastidores: \xe9 assim que a m\xe1gica acontece! Acompanhe nossa rotina e veja como trabalhamos para entregar o melhor. #Bastidores #Equipe`,`ðŸš€ Case de sucesso: como ajudamos nosso cliente a aumentar as vendas em 150%. Link na bio! #CaseDeSuccesso #Resultados`]}async processScheduledPosts(){let e={processed:0,published:0,failed:0};try{let t=new Date().toISOString(),{data:s}=await d.O.from("scheduled_posts").select("*").eq("status","scheduled").eq("approval_status","approved").lte("scheduled_for",t);if(!s||0===s.length)return e;for(let t of s)e.processed++,(await this.publishPost(t.id)).success?e.published++:e.failed++;return e}catch(t){return console.error("Erro ao processar posts:",t),e}}async collectPostPerformance(e){let t={impressions:Math.floor(1e4*Math.random())+1e3,reach:Math.floor(8e3*Math.random())+800,engagement:Math.floor(500*Math.random())+50,likes:Math.floor(400*Math.random())+40,comments:Math.floor(50*Math.random())+5,shares:Math.floor(30*Math.random())+3,saves:Math.floor(20*Math.random())+2,clicks:Math.floor(100*Math.random())+10,collected_at:new Date().toISOString()};return await d.O.from("scheduled_posts").update({performance:t}).eq("id",e),t}async notifyClientForApproval(e){try{let{data:t}=await d.O.from("clients").select("user_id, company_name, contact_email, email").eq("id",e.client_id).maybeSingle(),s=t?.user_id?String(t.user_id):null;if(!s)return;await d.O.from("notifications").insert({user_id:s,type:"post_approval",title:"Post aguardando aprova\xe7\xe3o",message:`Novo post "${e.title}" aguardando sua aprova\xe7\xe3o`,link:"/cliente/aprovacoes",metadata:{post_id:e.id,client_id:e.client_id},is_read:!1,created_at:new Date().toISOString()})}catch{}}async notifyPostApproved(e){try{let{data:t}=await d.O.from("user_profiles").select("user_id, user_type").in("user_type",["super_admin","admin"]),s=(t||[]).map(e=>e.user_id).filter(Boolean).map(e=>String(e));if(0===s.length)return;await d.O.from("notifications").insert(s.map(t=>({user_id:t,type:"post_approved",title:"Post aprovado",message:`Um post foi aprovado e ser\xe1 publicado no hor\xe1rio agendado`,link:"/admin",metadata:{post_id:e,target_role:"social_media"},is_read:!1,created_at:new Date().toISOString()})))}catch{}}async notifyPostRejected(e,t){try{let{data:s}=await d.O.from("user_profiles").select("user_id, user_type").in("user_type",["super_admin","admin"]),a=(s||[]).map(e=>e.user_id).filter(Boolean).map(e=>String(e));if(0===a.length)return;await d.O.from("notifications").insert(a.map(s=>({user_id:s,type:"post_rejected",title:"Post rejeitado",message:`Um post foi rejeitado. Motivo: ${t}`,link:"/admin",metadata:{post_id:e,reason:t,target_role:"social_media"},is_read:!1,created_at:new Date().toISOString()})))}catch{}}}let u=new c,l="force-dynamic";async function p(e){try{let{searchParams:t}=new URL(e.url),s=t.get("action"),a=t.get("client_id")||void 0,r=t.get("status")||void 0,o=t.get("approval_status")||void 0,i=t.get("platform")||void 0,d=t.get("from_date")||void 0,c=t.get("to_date")||void 0,l=t.get("month"),p=t.get("year");if("calendar"===s&&a&&l&&p){let e=await u.getContentCalendar(a,parseInt(l),parseInt(p));return n.NextResponse.json({success:!0,calendar:e})}if("best_times"===s&&i){let e=u.getBestPostingTimes(i);return n.NextResponse.json({success:!0,times:e})}let m=await u.getScheduledPosts({client_id:a,status:r,approval_status:o,platform:i,from_date:d,to_date:c});return n.NextResponse.json({success:!0,posts:m})}catch(e){return console.error("Erro ao buscar posts:",e),n.NextResponse.json({success:!1,error:"Erro ao buscar posts"},{status:500})}}async function m(e){try{let{action:t,...s}=await e.json();if("generate_suggestions"===t){let e=await u.generateContentSuggestions({client_id:s.client_id,platform:s.platform,theme:s.theme,tone:s.tone});return n.NextResponse.json({success:!0,suggestions:e})}if("process_scheduled"===t){let e=await u.processScheduledPosts();return n.NextResponse.json({success:!0,result:e})}if("publish"===t){let e=await u.publishPost(s.post_id);return n.NextResponse.json({success:e.success,result:e})}if("collect_performance"===t){let e=await u.collectPostPerformance(s.post_id);return n.NextResponse.json({success:!!e,performance:e})}let a=s.platforms||[],r={client_id:s.client_id,client_name:s.client_name,title:s.title,content:s.content,media_urls:s.media_urls,platforms:a,scheduled_for:s.scheduled_for,timezone:s.timezone||"America/Sao_Paulo",status:"scheduled",created_by:s.created_by,approval_status:s.approval_status||"pending",hashtags:s.hashtags,mentions:s.mentions,link:s.link,campaign_id:s.campaign_id,ai_generated:s.ai_generated||!1,ai_suggestions:s.ai_suggestions},o=await u.schedulePost(r);if(!o)return n.NextResponse.json({success:!1,error:"Erro ao agendar post"},{status:500});return n.NextResponse.json({success:!0,post:o})}catch(e){return console.error("Erro na API de posts:",e),n.NextResponse.json({success:!1,error:"Erro ao processar requisi\xe7\xe3o"},{status:500})}}async function _(e){try{let{id:t,action:s,...a}=await e.json();if(!t)return n.NextResponse.json({success:!1,error:"ID do post \xe9 obrigat\xf3rio"},{status:400});if("approve"===s){let e=await u.approvePost(t,a.approved_by);return n.NextResponse.json({success:e,message:e?"Post aprovado":"Erro ao aprovar"})}if("reject"===s){let e=await u.rejectPost(t,a.reason,a.rejected_by);return n.NextResponse.json({success:e,message:e?"Post rejeitado":"Erro ao rejeitar"})}if("cancel"===s){let{error:e}=await d.O.from("scheduled_posts").update({status:"cancelled"}).eq("id",t);return n.NextResponse.json({success:!e,message:e?"Erro ao cancelar":"Post cancelado"})}let{error:r}=await d.O.from("scheduled_posts").update(a).eq("id",t);if(r)return n.NextResponse.json({success:!1,error:"Erro ao atualizar post"},{status:500});return n.NextResponse.json({success:!0,message:"Post atualizado"})}catch(e){return console.error("Erro ao atualizar post:",e),n.NextResponse.json({success:!1,error:"Erro ao atualizar post"},{status:500})}}async function g(e){try{let{searchParams:t}=new URL(e.url),s=t.get("id");if(!s)return n.NextResponse.json({success:!1,error:"ID do post \xe9 obrigat\xf3rio"},{status:400});let{error:a}=await d.O.from("scheduled_posts").delete().eq("id",s);if(a)return n.NextResponse.json({success:!1,error:"Erro ao remover post"},{status:500});return n.NextResponse.json({success:!0,message:"Post removido"})}catch(e){return console.error("Erro ao remover post:",e),n.NextResponse.json({success:!1,error:"Erro ao remover post"},{status:500})}}let h=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/social/posts/route",pathname:"/api/social/posts",filename:"route",bundlePath:"app/api/social/posts/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\social\\posts\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:v}=h,S="/api/social/posts/route";function w(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},1926:(e,t,s)=>{s.d(t,{O:()=>i});var a=s(54128);let r="https://ikjgsqtykkhqimypacro.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";r&&o||console.error("âŒ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let i=(0,a.eI)(r||"https://setup-missing.supabase.co",o||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[89276,55972,54128],()=>s(4050));module.exports=a})();