"use strict";(()=>{var e={};e.id=93139,e.ids=[93139],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},23853:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var s={};a.r(s),a.d(s,{GET:()=>u,POST:()=>g,PUT:()=>l,dynamic:()=>d});var n=a(49303),o=a(88716),i=a(60670),r=a(87070),c=a(14836);let d="force-dynamic";async function u(e){try{let{searchParams:t}=new URL(e.url),a=t.get("action"),s=t.get("client_id"),n=t.get("platform"),o=t.get("account_id");if(!s)return r.NextResponse.json({success:!1,error:"client_id \xe9 obrigat\xf3rio"},{status:400});if("accounts"===a){let e={};return"meta"!==n&&"all"!==n&&n||(e.meta=await c.U.getMetaAdAccounts(s)),"google"!==n&&"all"!==n&&n||(e.google=await c.U.getGoogleAdAccounts(s)),r.NextResponse.json({success:!0,accounts:e})}if("campaigns"===a&&o){let e=[];return"meta"===n?e=await c.U.getMetaCampaigns(o):"google"===n&&(e=await c.U.getGoogleCampaigns(o)),r.NextResponse.json({success:!0,campaigns:e})}if("report"===a){let e=t.get("start_date")||new Date(Date.now()-2592e6).toISOString().split("T")[0],a=t.get("end_date")||new Date().toISOString().split("T")[0],o=await c.U.generatePerformanceReport(s,n||"all",{start:e,end:a});return r.NextResponse.json({success:!0,reports:o})}if("budget_alerts"===a){let e=await c.U.checkBudgetAlerts(s);return r.NextResponse.json({success:!0,alerts:e})}if("competitor_analysis"===a){let e=t.get("competitor_page");if(!e)return r.NextResponse.json({success:!1,error:"competitor_page \xe9 obrigat\xf3rio"},{status:400});let a=await c.U.analyzeCompetitorAds(e);return r.NextResponse.json({success:!0,analysis:a})}let i=await c.U.getMetaAdAccounts(s),d=await c.U.getGoogleAdAccounts(s);return r.NextResponse.json({success:!0,accounts:{meta:i,google:d}})}catch(e){return console.error("Erro na API de ads:",e),r.NextResponse.json({success:!1,error:"Erro ao buscar dados"},{status:500})}}async function g(e){try{let{action:t,platform:a,...s}=await e.json();if("create_campaign"===t&&"meta"===a){let e=await c.U.createMetaCampaign(s.account_id,{name:s.name,objective:s.objective,daily_budget:s.daily_budget,lifetime_budget:s.lifetime_budget,start_time:s.start_time,stop_time:s.stop_time});return r.NextResponse.json({success:!!e,campaign:e})}if("create_campaign"===t&&"google"===a){let e=await c.U.createGoogleCampaign(s.account_id,{name:s.name,type:s.type,budget:s.budget,bidding_strategy:s.bidding_strategy,start_date:s.start_date,end_date:s.end_date});return r.NextResponse.json({success:!!e,campaign:e})}if("send_recharge_notification"===t){let e=await c.U.sendRechargeNotification(s.client_id,s.account_id,s.platform);return r.NextResponse.json({success:e,message:e?"Notifica\xe7\xe3o enviada":"Erro ao enviar"})}return r.NextResponse.json({success:!1,error:"A\xe7\xe3o n\xe3o reconhecida"},{status:400})}catch(e){return console.error("Erro na API de ads:",e),r.NextResponse.json({success:!1,error:"Erro ao processar requisi\xe7\xe3o"},{status:500})}}async function l(e){try{let{campaign_id:t,platform:a,action:s,...n}=await e.json();if(!t)return r.NextResponse.json({success:!1,error:"campaign_id \xe9 obrigat\xf3rio"},{status:400});if("update_status"===s&&"meta"===a){let e=await c.U.updateMetaCampaignStatus(t,n.status);return r.NextResponse.json({success:e,message:e?"Status atualizado":"Erro ao atualizar"})}return r.NextResponse.json({success:!1,error:"A\xe7\xe3o n\xe3o reconhecida"},{status:400})}catch(e){return console.error("Erro ao atualizar campanha:",e),r.NextResponse.json({success:!1,error:"Erro ao atualizar"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ads/route",pathname:"/api/ads",filename:"route",bundlePath:"app/api/ads/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\ads\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:h}=p,f="/api/ads/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},14836:(e,t,a)=>{a.d(t,{U:()=>o});var s=a(1926);class n{setMetaCredentials(e){this.metaAccessToken=e}setGoogleCredentials(e){this.googleCredentials=e}async getMetaAdAccounts(e){return[{id:"act_123456789",name:"Conta Principal",currency:"BRL",timezone:"America/Sao_Paulo",status:"active",spend_cap:5e4,amount_spent:12500,balance:37500}]}async getMetaCampaigns(e){return[{id:"camp_001",account_id:e,name:"Campanha Black Friday",objective:"CONVERSIONS",status:"ACTIVE",daily_budget:500,start_time:"2024-11-20T00:00:00",stop_time:"2024-11-30T23:59:59",created_time:"2024-11-15T10:00:00",insights:{impressions:125e3,clicks:4500,ctr:3.6,spend:3500,cpc:.78,cpm:28,conversions:180,cost_per_conversion:19.44,roas:4.2,reach:85e3,frequency:1.47,date_range:{start:"2024-11-20",end:"2024-11-27"}}},{id:"camp_002",account_id:e,name:"Remarketing - Carrinho Abandonado",objective:"CONVERSIONS",status:"ACTIVE",daily_budget:200,created_time:"2024-10-01T10:00:00",insights:{impressions:45e3,clicks:2200,ctr:4.89,spend:1400,cpc:.64,cpm:31.11,conversions:95,cost_per_conversion:14.74,roas:6.8,reach:12e3,frequency:3.75,date_range:{start:"2024-11-01",end:"2024-11-27"}}}]}async createMetaCampaign(e,t){return console.log(`[META] Criando campanha: ${t.name}`),{id:`camp_${Date.now()}`,account_id:e,name:t.name||"Nova Campanha",objective:t.objective||"CONVERSIONS",status:"PAUSED",daily_budget:t.daily_budget,created_time:new Date().toISOString()}}async updateMetaCampaignStatus(e,t){return console.log(`[META] Atualizando campanha ${e} para ${t}`),!0}async getGoogleAdAccounts(e){return[{id:"123-456-7890",name:"Conta Google Ads Principal",currency:"BRL",timezone:"America/Sao_Paulo",status:"ENABLED",budget:3e4,cost:8500}]}async getGoogleCampaigns(e){return[{id:"gcamp_001",account_id:e,name:"Search - Marca",type:"SEARCH",status:"ENABLED",budget:100,bidding_strategy:"TARGET_CPA",insights:{impressions:35e3,clicks:2800,ctr:8,spend:2100,cpc:.75,cpm:60,conversions:120,cost_per_conversion:17.5,roas:5.5,date_range:{start:"2024-11-01",end:"2024-11-27"}}},{id:"gcamp_002",account_id:e,name:"Performance Max",type:"PERFORMANCE_MAX",status:"ENABLED",budget:150,bidding_strategy:"MAXIMIZE_CONVERSIONS",insights:{impressions:18e4,clicks:5400,ctr:3,spend:4200,cpc:.78,cpm:23.33,conversions:210,cost_per_conversion:20,roas:4.8,date_range:{start:"2024-11-01",end:"2024-11-27"}}}]}async createGoogleCampaign(e,t){return console.log(`[GOOGLE] Criando campanha: ${t.name}`),{id:`gcamp_${Date.now()}`,account_id:e,name:t.name||"Nova Campanha",type:t.type||"SEARCH",status:"PAUSED",budget:t.budget||100,bidding_strategy:t.bidding_strategy||"MANUAL_CPC"}}async generatePerformanceReport(e,t,a){let s=[];if("meta"===t||"all"===t)for(let t of(await this.getMetaAdAccounts(e))){let e=await this.getMetaCampaigns(t.id),n=e.reduce((e,t)=>e+(t.insights?.spend||0),0),o=e.reduce((e,t)=>e+(t.insights?.impressions||0),0),i=e.reduce((e,t)=>e+(t.insights?.clicks||0),0),r=e.reduce((e,t)=>e+(t.insights?.conversions||0),0);s.push({account_id:t.id,account_name:t.name,platform:"meta",period:`${a.start} a ${a.end}`,total_spend:n,total_impressions:o,total_clicks:i,avg_ctr:o>0?i/o*100:0,avg_cpc:i>0?n/i:0,total_conversions:r,avg_roas:this.calculateAvgRoas(e),campaigns:e.map(e=>({id:e.id,name:e.name,spend:e.insights?.spend||0,impressions:e.insights?.impressions||0,clicks:e.insights?.clicks||0,conversions:e.insights?.conversions||0})),recommendations:this.generateRecommendations(e,"meta")})}if("google"===t||"all"===t)for(let t of(await this.getGoogleAdAccounts(e))){let e=await this.getGoogleCampaigns(t.id),n=e.reduce((e,t)=>e+(t.insights?.spend||0),0),o=e.reduce((e,t)=>e+(t.insights?.impressions||0),0),i=e.reduce((e,t)=>e+(t.insights?.clicks||0),0),r=e.reduce((e,t)=>e+(t.insights?.conversions||0),0);s.push({account_id:t.id,account_name:t.name,platform:"google",period:`${a.start} a ${a.end}`,total_spend:n,total_impressions:o,total_clicks:i,avg_ctr:o>0?i/o*100:0,avg_cpc:i>0?n/i:0,total_conversions:r,avg_roas:this.calculateAvgRoas(e),campaigns:e.map(e=>({id:e.id,name:e.name,spend:e.insights?.spend||0,impressions:e.insights?.impressions||0,clicks:e.insights?.clicks||0,conversions:e.insights?.conversions||0})),recommendations:this.generateRecommendations(e,"google")})}return s}async checkBudgetAlerts(e){let t=[];for(let a of(await this.getMetaAdAccounts(e))){let e=a.spend_cap?a.amount_spent/a.spend_cap*100:0;e>=90&&t.push({account_id:a.id,platform:"meta",alert_type:e>=100?"budget_depleted":"budget_low",message:e>=100?`Or\xe7amento da conta ${a.name} esgotado!`:`Or\xe7amento da conta ${a.name} em ${e.toFixed(0)}%`,threshold_value:a.spend_cap||0,current_value:a.amount_spent,created_at:new Date().toISOString(),acknowledged:!1})}for(let a of(await this.getGoogleAdAccounts(e))){let e=a.budget?a.cost/a.budget*100:0;e>=90&&t.push({account_id:a.id,platform:"google",alert_type:e>=100?"budget_depleted":"budget_low",message:e>=100?`Or\xe7amento da conta ${a.name} esgotado!`:`Or\xe7amento da conta ${a.name} em ${e.toFixed(0)}%`,threshold_value:a.budget||0,current_value:a.cost,created_at:new Date().toISOString(),acknowledged:!1})}return t.length>0&&await s.O.from("budget_alerts").insert(t),t}async sendRechargeNotification(e,t,a){try{let{data:n}=await s.O.from("clients").select("*").eq("id",e).single();if(!n)return!1;let o=n.user_id?String(n.user_id):null;return o&&await s.O.from("notifications").insert({user_id:o,type:"budget_recharge",title:"\uD83D\uDCB0 Recarga de Or\xe7amento Necess\xe1ria",message:`O or\xe7amento da sua conta de ${"meta"===a?"Meta Ads":"Google Ads"} est\xe1 baixo. Recarregue para manter suas campanhas ativas.`,link:"/cliente/financeiro",metadata:{client_id:e,account_id:t,platform:a},is_read:!1,created_at:new Date().toISOString()}),console.log(`[NOTIFICA\xc7\xc3O] Recarga enviada para ${n.email}`),!0}catch(e){return console.error("Erro ao enviar notifica\xe7\xe3o:",e),!1}}async analyzeCompetitorAds(e){return{total_ads:Math.floor(50*Math.random())+10,active_ads:Math.floor(20*Math.random())+5,ad_formats:{image:Math.floor(15*Math.random())+5,video:Math.floor(10*Math.random())+3,carousel:Math.floor(8*Math.random())+2},themes:["Promo\xe7\xe3o","Lan\xe7amento","Institucional","Depoimentos"],avg_duration_days:Math.floor(30*Math.random())+7}}calculateAvgRoas(e){let t=e.map(e=>e.insights?.roas).filter(e=>null!=e);return 0===t.length?0:t.reduce((e,t)=>e+t,0)/t.length}generateRecommendations(e,t){let a=[];for(let t of e)t.insights&&(t.insights.ctr<1&&a.push(`${t.name}: CTR baixo (${t.insights.ctr.toFixed(2)}%). Considere revisar criativos e segmenta\xe7\xe3o.`),t.insights.cpc>2&&a.push(`${t.name}: CPC elevado (R$ ${t.insights.cpc.toFixed(2)}). Teste novos p\xfablicos ou ajuste lances.`),t.insights.roas&&t.insights.roas<2&&a.push(`${t.name}: ROAS abaixo do ideal (${t.insights.roas.toFixed(1)}x). Revise funil de convers\xe3o.`),t.insights.frequency&&t.insights.frequency>3&&a.push(`${t.name}: Frequ\xeancia alta (${t.insights.frequency.toFixed(1)}). Expanda o p\xfablico ou pause para evitar fadiga.`));return 0===a.length&&a.push("✅ Campanhas com performance saud\xe1vel. Continue monitorando."),a.slice(0,5)}}let o=new n},1926:(e,t,a)=>{a.d(t,{O:()=>i});var s=a(54128);let n="https://ikjgsqtykkhqimypacro.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";n&&o||console.error("❌ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let i=(0,s.eI)(n||"https://setup-missing.supabase.co",o||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[89276,55972,54128],()=>a(23853));module.exports=s})();