"use strict";(()=>{var e={};e.id=5854,e.ids=[5854],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},14384:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>E,requestAsyncStorage:()=>v,routeModule:()=>_,serverHooks:()=>U,staticGenerationAsyncStorage:()=>q});var o={};r.r(o),r.d(o,{DELETE:()=>j,GET:()=>h,POST:()=>w,PUT:()=>R,dynamic:()=>y});var s=r(49303),a=r(88716),n=r(60670),i=r(87070),c=r(20344),l=r(71615),p=r(84770),u=r.n(p);let d={randomUUID:u().randomUUID},m=new Uint8Array(256),x=m.length,f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));let g=function(e,t,r){if(d.randomUUID&&!t&&!e)return d.randomUUID();let o=(e=e||{}).random||(e.rng||function(){return x>m.length-16&&(u().randomFillSync(m),x=0),m.slice(x,x+=16)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=o[e];return t}return function(e,t=0){return f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]}(o)},y="force-dynamic";async function h(e){let t=(0,c.createRouteHandlerClient)({cookies:l.cookies});try{let{searchParams:r}=new URL(e.url),o=r.get("status"),s=r.get("client_id"),a=t.from("commercial_proposals").select("*").order("created_at",{ascending:!1});o&&"all"!==o&&(a=a.eq("status",o)),s&&(a=a.eq("client_id",s));let{data:n,error:c}=await a;if(c)throw c;return i.NextResponse.json({proposals:n})}catch(e){return console.error("Erro ao buscar propostas:",e),i.NextResponse.json({error:"Erro ao buscar propostas"},{status:500})}}async function w(e){let t=(0,c.createRouteHandlerClient)({cookies:l.cookies});try{let{client_id:r,client_name:o,client_email:s,lead_id:a,services:n,discount_percent:c,payment_terms:l,validity_days:p,notes:u,internal_notes:d}=await e.json(),m=n.reduce((e,t)=>e+t.price*(t.quantity||1),0),x=(c||0)/100*m,f=g(),y=new Date;y.setDate(y.getDate()+(p||30));let{data:{user:h}}=await t.auth.getUser(),{data:w,error:R}=await t.from("commercial_proposals").insert({client_id:r,client_name:o,client_email:s,lead_id:a,created_by:h?.id,status:"draft",services:n,subtotal:m,discount_percent:c||0,discount_value:x,total:m-x,payment_terms:l,validity_days:p||30,valid_until:y.toISOString().split("T")[0],notes:u,internal_notes:d,magic_link_token:f}).select().single();if(R)throw R;return i.NextResponse.json({proposal:w})}catch(e){return console.error("Erro ao criar proposta:",e),i.NextResponse.json({error:"Erro ao criar proposta"},{status:500})}}async function R(e){let t=(0,c.createRouteHandlerClient)({cookies:l.cookies});try{let{id:r,...o}=await e.json();if(!r)return i.NextResponse.json({error:"ID da proposta \xe9 obrigat\xf3rio"},{status:400});if(o.services){let e=o.services.reduce((e,t)=>e+t.price*(t.quantity||1),0),t=(o.discount_percent||0)/100*e,r=e-t;o.subtotal=e,o.discount_value=t,o.total=r}o.updated_at=new Date().toISOString();let{data:s,error:a}=await t.from("commercial_proposals").update(o).eq("id",r).select().single();if(a)throw a;return i.NextResponse.json({proposal:s})}catch(e){return console.error("Erro ao atualizar proposta:",e),i.NextResponse.json({error:"Erro ao atualizar proposta"},{status:500})}}async function j(e){let t=(0,c.createRouteHandlerClient)({cookies:l.cookies});try{let{searchParams:r}=new URL(e.url),o=r.get("id");if(!o)return i.NextResponse.json({error:"ID da proposta \xe9 obrigat\xf3rio"},{status:400});let{error:s}=await t.from("commercial_proposals").delete().eq("id",o);if(s)throw s;return i.NextResponse.json({success:!0})}catch(e){return console.error("Erro ao excluir proposta:",e),i.NextResponse.json({error:"Erro ao excluir proposta"},{status:500})}}let _=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/proposals/route",pathname:"/api/proposals",filename:"route",bundlePath:"app/api/proposals/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\proposals\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:q,serverHooks:U}=_,k="/api/proposals/route";function E(){return(0,n.patchFetch)({serverHooks:U,staticGenerationAsyncStorage:q})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[89276,55972,54128,20958],()=>r(14384));module.exports=o})();