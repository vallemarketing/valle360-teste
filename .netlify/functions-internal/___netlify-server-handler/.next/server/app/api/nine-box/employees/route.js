"use strict";(()=>{var e={};e.id=30494,e.ids=[30494],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},83128:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var r={};a.r(r),a.d(r,{GET:()=>p,dynamic:()=>d});var s=a(49303),n=a(88716),i=a(60670),o=a(87070),l=a(20344),u=a(71615),c=a(52390);let d="force-dynamic";async function p(e){try{let t=(0,u.cookies)(),a=(0,l.createRouteHandlerClient)({cookies:()=>t}),r=await (0,c.V)({supabase:a});if(!r.allowed)return o.NextResponse.json({error:r.reason||"Acesso negado"},{status:403});let{searchParams:s}=new URL(e.url),n="0"!==s.get("active"),i=s.get("department");try{let e=a.from("employees").select("id, user_id, full_name, email, department, position, manager_id, areas, is_active").order("full_name",{ascending:!0}).limit(2e3);n&&(e=e.eq("is_active",!0)),i&&(e=e.eq("department",i));let{data:t,error:r}=await e;if(r)throw r;return o.NextResponse.json({success:!0,employees:t||[]})}catch{let e=a.from("employees").select("id, user_id, name, email, position, is_active, created_at").order("created_at",{ascending:!1}).limit(2e3);n&&(e=e.eq("is_active",!0));let{data:t}=await e,r=(t||[]).map(e=>({id:e.id,user_id:e.user_id,full_name:e.name||e.email||"Colaborador",email:e.email||null,department:null,position:e.position||null,manager_id:null,areas:[],is_active:e.is_active??!0}));return o.NextResponse.json({success:!0,employees:r,warning:"employees_schema_fallback"})}}catch(e){return o.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/nine-box/employees/route",pathname:"/api/nine-box/employees",filename:"route",bundlePath:"app/api/nine-box/employees/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\nine-box\\employees\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:x,serverHooks:f}=m,g="/api/nine-box/employees/route";function _(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},52390:(e,t,a)=>{async function r(e,t,a){try{let{data:r,error:s}=await e.rpc(t,a);if(s)return{ok:!1,error:s};return{ok:!0,data:r}}catch(e){return{ok:!1,error:e}}}function s(e){return Array.from(new Set(e.map(e=>String(e)).filter(Boolean)))}async function n(e){let t=e.supabase,{data:a}=await t.auth.getUser(),n=a.user?.id;if(!n)return{userId:"",isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let i=await r(t,"is_admin"),o=!!i.ok&&!!i.data;if(o)return{userId:n,isAdmin:o,allowed:!0,areaKeys:[]};let l=await r(t,"employee_area_keys");if(l.ok&&Array.isArray(l.data)){let e=s(l.data),t=e.includes("rh");return{userId:n,isAdmin:o,allowed:t,reason:t?void 0:"Acesso restrito: RH",areaKeys:e}}let{data:u}=await t.from("employees").select("areas, department, is_active").eq("user_id",n).maybeSingle(),c=s([...Array.isArray(u?.areas)?u.areas.map(String):[]]),d=c.includes("rh")||String(u?.department||"").toLowerCase().includes("rh");return{userId:n,isAdmin:o,allowed:d,reason:d?void 0:"Acesso restrito: RH",areaKeys:c}}a.d(t,{V:()=>n})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958],()=>a(83128));module.exports=r})();