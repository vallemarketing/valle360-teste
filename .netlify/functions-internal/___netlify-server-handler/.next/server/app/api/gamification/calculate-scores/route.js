"use strict";(()=>{var e={};e.id=36192,e.ids=[36192],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},18996:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{POST:()=>p,dynamic:()=>u});var a=r(49303),i=r(88716),s=r(60670),n=r(87070),c=r(1926);let l={productivity:.4,quality:.3,collaboration:.2,wellbeing:.1},u="force-dynamic";async function p(e){try{let t=e.headers.get("authorization");if(!t)return n.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.replace("Bearer ",""),{data:{user:o},error:a}=await c.O.auth.getUser(r);if(a||!o)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{employee_id:i,task_metrics:s,quality_metrics:u,collaboration_metrics:p,wellbeing_metrics:d}=await e.json(),{data:m}=await c.O.from("user_profiles").select("user_type").eq("user_id",o.id).single();if(m?.user_type!=="super_admin"&&i!==o.id)return n.NextResponse.json({error:"Forbidden"},{status:403});let h=function(e,t,r,o,a=l){let i=function(e){let{completedOnTime:t,completedEarly:r,completedLate:o,totalDeliveries:a,targetDeliveries:i}=e;return Math.max(0,Math.min(100,.7*(10*t+15*r+-5*o)+.3*(i>0?Math.min(100,a/i*100):0)))}(e),s=function(e){let{approvedWithoutRevisions:t,revisionsNeeded:r,positiveClientFeedback:o,averageNPS:a}=e;return Math.max(0,Math.min(100,(20*t+-10*r+25*o)*(a>=9?2:a>=8?1.5:a>=7?1.2:a>=6?1:a>=5?.8:.5)))}(t),n=function(e){let{quickResponses:t,helpToColleagues:r,meetingsAttended:o,knowledgeShared:a}=e;return Math.max(0,Math.min(100,5*t+15*r+10*o+20*a))}(r),c=function(e){let{loginsOutsideHours:t,vacationDaysUsed:r,excessiveOvertimeWeeks:o}=e;return Math.max(0,Math.min(100,50+-5*t+30*r+-10*o+(r>0&&0===o?20:0)))}(o),u=function(e,t,r,o,a=l){return e*a.productivity+t*a.quality+r*a.collaboration+o*a.wellbeing}(i,s,n,c,a);return{productivity_score:Math.round(i),quality_score:Math.round(s),collaboration_score:Math.round(n),wellbeing_score:Math.round(c),total_score:Math.round(u),level:function(e){let t=10*e;return t>=1e4?21+Math.floor((t-1e4)/1e3):t>=6e3?16+Math.floor((t-6e3)/1e3):t>=3e3?11+Math.floor((t-3e3)/600):t>=1e3?6+Math.floor((t-1e3)/400):Math.floor(t/200)+1}(u),points:Math.round(10*u)}}(s,u,p,d),{data:f,error:g}=await c.O.from("employee_gamification").upsert({employee_id:i||o.id,productivity_score:h.productivity_score,quality_score:h.quality_score,collaboration_score:h.collaboration_score,wellbeing_score:h.wellbeing_score,level:h.level,updated_at:new Date().toISOString()},{onConflict:"employee_id"}).select().single();if(g)return console.error("Database error:",g),n.NextResponse.json({error:"Failed to update scores"},{status:500});return n.NextResponse.json({success:!0,scores:h,data:f})}catch(e){return console.error("Error calculating scores:",e),n.NextResponse.json({error:"Failed to calculate scores"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/gamification/calculate-scores/route",pathname:"/api/gamification/calculate-scores",filename:"route",bundlePath:"app/api/gamification/calculate-scores/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\gamification\\calculate-scores\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f}=d,g="/api/gamification/calculate-scores/route";function _(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},1926:(e,t,r)=>{r.d(t,{O:()=>s});var o=r(54128);let a="https://ikjgsqtykkhqimypacro.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";a&&i||console.error("âŒ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let s=(0,o.eI)(a||"https://setup-missing.supabase.co",i||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[89276,55972,54128],()=>r(18996));module.exports=o})();