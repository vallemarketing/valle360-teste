"use strict";(()=>{var e={};e.id=64379,e.ids=[64379],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},92613:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>S,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>_,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var r={};a.r(r),a.d(r,{GET:()=>m,dynamic:()=>p});var s=a(49303),n=a(88716),i=a(60670),o=a(87070),u=a(20344),c=a(71615),l=a(52955),d=a(90176);let p="force-dynamic";async function m(e){try{let t=(0,c.cookies)(),a=(0,u.createRouteHandlerClient)({cookies:()=>t}),r=await (0,l.U)({supabase:a});if(!r.allowed)return o.NextResponse.json({error:r.reason||"Acesso negado"},{status:403});let{searchParams:s}=new URL(e.url),n=String(s.get("client_id")||"").trim();if(!n)return o.NextResponse.json({error:"client_id \xe9 obrigat\xf3rio"},{status:400});let i=(0,d.t)(),{data:p,error:m}=await i.from("social_connected_accounts").select("id, client_id, platform, external_account_id, username, display_name, profile_picture_url, status, metadata, updated_at").eq("client_id",n).order("platform",{ascending:!0}).limit(200);if(m)return o.NextResponse.json({error:m.message},{status:500});let _=(p||[]).map(e=>({id:String(e.id),client_id:String(e.client_id),platform:String(e.platform),external_account_id:String(e.external_account_id),username:e.username?String(e.username):null,display_name:e.display_name?String(e.display_name):null,profile_picture_url:e.profile_picture_url?String(e.profile_picture_url):null,status:e.status?String(e.status):"active",metadata:e.metadata||{},updated_at:e.updated_at||null}));return o.NextResponse.json({success:!0,accounts:_})}catch(e){return o.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let _=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/social/accounts/route",pathname:"/api/social/accounts",filename:"route",bundlePath:"app/api/social/accounts/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\social\\accounts\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y}=_,S="/api/social/accounts/route";function x(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},90176:(e,t,a)=>{a.d(t,{t:()=>s});var r=a(54128);function s(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,r.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},52955:(e,t,a)=>{a.d(t,{U:()=>i});var r=a(57157);async function s(e,t,a){try{let{data:r,error:s}=await e.rpc(t,a);if(s)return{ok:!1,error:s};return{ok:!0,data:r}}catch(e){return{ok:!1,error:e}}}function n(e){return Array.from(new Set(e))}async function i(e){let t=e.supabase,{data:a}=await t.auth.getUser(),i=a.user?.id;if(!i)return{userId:"",isSuperAdmin:!1,isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let o=await s(t,"is_admin"),u=!!o.ok&&!!o.data,c=await s(t,"is_super_admin"),l=!!c.ok&&!!c.data;if(u||l)return{userId:i,isSuperAdmin:l,isAdmin:u,allowed:!0,areaKeys:[]};let d=await s(t,"employee_area_keys");if(d.ok&&Array.isArray(d.data)){let e=(d.data||[]).map(e=>String(e)),t=e.includes("social_media")||e.includes("head_marketing");return{userId:i,isSuperAdmin:l,isAdmin:u,allowed:t,reason:t?void 0:"Acesso restrito: necess\xe1rio Social Media ou Head Marketing",areaKeys:n(e)}}let{data:p}=await t.from("employees").select("department, area_of_expertise, areas, is_active").eq("user_id",i).maybeSingle(),m=[];p?.department&&m.push(String(p.department)),p?.area_of_expertise&&m.push(String(p.area_of_expertise)),Array.isArray(p?.areas)&&m.push(...p.areas.map(e=>String(e)));let _=n(m.map(e=>(0,r.IY)(e)).filter(Boolean).map(e=>e)),g=_.includes("social_media")||_.includes("head_marketing");return{userId:i,isSuperAdmin:l,isAdmin:u,allowed:g,reason:g?void 0:"Acesso restrito: necess\xe1rio Social Media ou Head Marketing",areaKeys:_}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958,57157],()=>a(92613));module.exports=r})();