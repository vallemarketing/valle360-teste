"use strict";(()=>{var e={};e.id=49011,e.ids=[49011],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},16510:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>_,dynamic:()=>i});var o=r(49303),s=r(88716),n=r(60670),c=r(87070);let i="force-dynamic",p=process.env.FACEBOOK_APP_ID,u=process.env.FACEBOOK_APP_SECRET;function l(e,t){let r=new URL(e.url).origin,a=new URL("/cliente/redes/callback",r);return a.searchParams.set("platform",t.platform),a.searchParams.set("ok",t.ok?"1":"0"),t.error&&a.searchParams.set("error",t.error.slice(0,180)),a.toString()}async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("client_id"),a=t.get("state")||Math.random().toString(36).substring(7);if(!p)return c.NextResponse.redirect(l(e,{platform:"facebook",ok:!1,error:"Facebook App ID n\xe3o configurado"}));if(!r)return c.NextResponse.redirect(l(e,{platform:"facebook",ok:!1,error:"client_id \xe9 obrigat\xf3rio"}));let o=(process.env.NEXT_PUBLIC_APP_URL||new URL(e.url).origin).replace(/\/+$/,""),s=`${o}/api/oauth/facebook/callback`,n=new URL("https://www.facebook.com/v18.0/dialog/oauth");return n.searchParams.set("client_id",p),n.searchParams.set("redirect_uri",s),n.searchParams.set("scope","pages_show_list,pages_read_engagement,pages_manage_posts,pages_manage_engagement,pages_read_user_content"),n.searchParams.set("response_type","code"),n.searchParams.set("state",JSON.stringify({clientId:r,state:a})),c.NextResponse.redirect(n.toString())}async function _(e){try{let t;let{code:r,state:a}=await e.json();if(!p||!u)return c.NextResponse.json({error:"Credenciais do Facebook n\xe3o configuradas"},{status:500});if(!r)return c.NextResponse.json({error:"C\xf3digo de autoriza\xe7\xe3o n\xe3o fornecido"},{status:400});let o=(process.env.NEXT_PUBLIC_APP_URL||new URL(e.url).origin).replace(/\/+$/,""),s=`${o}/api/oauth/facebook/callback`,n=await fetch(`https://graph.facebook.com/v18.0/oauth/access_token?client_id=${p}&redirect_uri=${encodeURIComponent(s)}&client_secret=${u}&code=${r}`),i=await n.json();if(i.error)return c.NextResponse.json({error:i.error.message},{status:400});let l=await fetch(`https://graph.facebook.com/v18.0/oauth/access_token?grant_type=fb_exchange_token&client_id=${p}&client_secret=${u}&fb_exchange_token=${i.access_token}`),d=await l.json(),_=await fetch(`https://graph.facebook.com/v18.0/me/accounts?fields=id,name,access_token,picture&access_token=${d.access_token}`),h=((await _.json()).data||[]).map(e=>({id:e.id,name:e.name,accessToken:e.access_token,picture:e.picture?.data?.url}));try{t=JSON.parse(a).clientId}catch{t=a}return c.NextResponse.json({success:!0,pages:h,expiresIn:d.expires_in,clientId:t})}catch(e){return console.error("Erro no OAuth do Facebook:",e),c.NextResponse.json({error:"Erro ao processar autentica\xe7\xe3o"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/oauth/facebook/route",pathname:"/api/oauth/facebook",filename:"route",bundlePath:"app/api/oauth/facebook/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\oauth\\facebook\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=h,k="/api/oauth/facebook/route";function b(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[89276,55972],()=>r(16510));module.exports=a})();