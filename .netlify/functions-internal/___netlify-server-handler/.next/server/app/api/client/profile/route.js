"use strict";(()=>{var e={};e.id=74847,e.ids=[74847],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},27023:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>S,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>j,staticGenerationAsyncStorage:()=>_});var n={};r.r(n),r.d(n,{GET:()=>y,PUT:()=>f,dynamic:()=>p});var s=r(49303),o=r(88716),i=r(60670),a=r(87070),l=r(20344),u=r(71615),c=r(90176);let p="force-dynamic";function d(e){return e?Array.isArray(e)?e.map(e=>String(e).trim()).filter(Boolean).slice(0,25):"string"==typeof e?e.split(/[\n,;]+/g).map(e=>e.trim()).filter(Boolean).slice(0,25):[]:[]}async function m(){let e=(0,u.cookies)(),t=(0,l.createRouteHandlerClient)({cookies:()=>e}),{data:r}=await t.auth.getUser();return r?.user||null}async function y(e){let t=await m();if(!t)return a.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let r=(0,c.t)(),n=await r.from("clients").select("id, user_id, company_name, industry, segment, competitors, concorrentes").eq("user_id",t.id).maybeSingle();if(!n.error){let e=n.data||null,t=Array.isArray(e?.competitors)?e.competitors.map(e=>String(e)).filter(Boolean):d(e?.concorrentes);return a.NextResponse.json({success:!0,profile:{id:e?.id,company_name:e?.company_name||null,industry:e?.industry||null,segment:e?.segment||null,competitors:t,concorrentes:e?.concorrentes||(t.length?t.join("\n"):null)}})}let s=await r.from("clients").select("id, user_id, company_name, industry").eq("user_id",t.id).maybeSingle();if(s.error)return a.NextResponse.json({error:s.error.message},{status:500});let o=s.data||null;return a.NextResponse.json({success:!0,profile:{id:o?.id,company_name:o?.company_name||null,industry:o?.industry||null,segment:null,competitors:[],concorrentes:null},warning:"fallback_basic"})}async function f(e){let t=await m();if(!t)return a.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let r=await e.json().catch(()=>({})),n="string"==typeof r?.segment?r.segment.trim():null,s="string"==typeof r?.industry?r.industry.trim():null,o="string"==typeof r?.concorrentes?r.concorrentes.trim():null,i=d(r?.competitors),l={};if(null!==n&&(l.segment=n||null),null!==s&&(l.industry=s||null),null!==o&&(l.concorrentes=o||null),r?.competitors!==void 0&&(l.competitors=i),0===Object.keys(l).length)return a.NextResponse.json({success:!0,updated:!1});let u=(0,c.t)(),p=await u.from("clients").update(l).eq("user_id",t.id).select("id").maybeSingle();return p.error?a.NextResponse.json({error:p.error.message},{status:500}):a.NextResponse.json({success:!0,updated:!0})}let g=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/client/profile/route",pathname:"/api/client/profile",filename:"route",bundlePath:"app/api/client/profile/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\client\\profile\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:_,serverHooks:j}=g,R="/api/client/profile/route";function S(){return(0,i.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:_})}},90176:(e,t,r)=>{r.d(t,{t:()=>s});var n=r(54128);function s(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,n.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958],()=>r(27023));module.exports=n})();