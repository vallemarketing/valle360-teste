"use strict";(()=>{var e={};e.id=13453,e.ids=[13453],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},30936:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>h,routeModule:()=>x,serverHooks:()=>j,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>m,PUT:()=>g,dynamic:()=>l});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),c=r(54128),u=r(17478);let p=(0,c.eI)("https://ikjgsqtykkhqimypacro.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),l="force-dynamic";async function d(e){let t=await (0,u.k)(e);if(!t.ok)return t.res;try{let{searchParams:t}=new URL(e.url),r=t.get("type"),s="false"!==t.get("active"),a=p.from("contract_templates").select("*").order("created_at",{ascending:!1});r&&(a=a.eq("type",r)),s&&(a=a.eq("is_active",!0));let{data:o,error:n}=await a;if(n)return console.error("Error fetching templates:",n),i.NextResponse.json({success:!1,error:"Erro ao buscar templates"},{status:500});return i.NextResponse.json({success:!0,templates:o||[]})}catch(e){return console.error("Error in GET /api/admin/contract-templates:",e),i.NextResponse.json({success:!1,error:e.message||"Erro interno"},{status:500})}}async function m(e){let t=await (0,u.k)(e);if(!t.ok)return t.res;try{let{name:r,type:s,description:a,content:o,variables:n,is_active:c}=await e.json();if(!r||!o)return i.NextResponse.json({success:!1,error:"Nome e conte\xfado s\xe3o obrigat\xf3rios"},{status:400});let{data:u,error:l}=await p.from("contract_templates").insert({name:r,type:s||"standard",description:a||null,content:o,variables:n||[],is_active:!1!==c,created_by:t.userId,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(l)return console.error("Error creating template:",l),i.NextResponse.json({success:!1,error:"Erro ao criar template"},{status:500});return i.NextResponse.json({success:!0,template:u})}catch(e){return console.error("Error in POST /api/admin/contract-templates:",e),i.NextResponse.json({success:!1,error:e.message||"Erro interno"},{status:500})}}async function g(e){let t=await (0,u.k)(e);if(!t.ok)return t.res;try{let{id:t,name:r,type:s,description:a,content:o,variables:n,is_active:c}=await e.json();if(!t)return i.NextResponse.json({success:!1,error:"ID do template \xe9 obrigat\xf3rio"},{status:400});let u={updated_at:new Date().toISOString()};void 0!==r&&(u.name=r),void 0!==s&&(u.type=s),void 0!==a&&(u.description=a),void 0!==o&&(u.content=o),void 0!==n&&(u.variables=n),void 0!==c&&(u.is_active=c);let{data:l,error:d}=await p.from("contract_templates").update(u).eq("id",t).select().single();if(d)return console.error("Error updating template:",d),i.NextResponse.json({success:!1,error:"Erro ao atualizar template"},{status:500});return i.NextResponse.json({success:!0,template:l})}catch(e){return console.error("Error in PUT /api/admin/contract-templates:",e),i.NextResponse.json({success:!1,error:e.message||"Erro interno"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/contract-templates/route",pathname:"/api/admin/contract-templates",filename:"route",bundlePath:"app/api/admin/contract-templates/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\contract-templates\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:j}=x,v="/api/admin/contract-templates/route";function I(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:f})}},17478:(e,t,r)=>{r.d(t,{k:()=>i});var s=r(87070),a=r(20344),o=r(71615),n=r(54128);async function i(e){let t=(0,o.cookies)(),r=(0,a.createRouteHandlerClient)({cookies:()=>t}),i=e.headers.get("authorization")||"",c=i.toLowerCase().startsWith("bearer ")?i.slice(7).trim():null,u=c?(0,n.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${c}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):r,{data:p}=await u.auth.getUser();if(!p.user?.id)return{ok:!1,res:s.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:l,error:d}=await u.rpc("is_admin");return d||!l?{ok:!1,res:s.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:p.user.id}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958],()=>r(30936));module.exports=s})();