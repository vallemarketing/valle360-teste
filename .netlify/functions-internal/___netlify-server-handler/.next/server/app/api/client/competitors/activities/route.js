"use strict";(()=>{var e={};e.id=19281,e.ids=[19281],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},46629:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_});var r={};i.r(r),i.d(r,{GET:()=>p,POST:()=>u});var s=i(49303),o=i(88716),a=i(60670),n=i(87070),c=i(20344),l=i(71615);async function p(e){let t=(0,c.createRouteHandlerClient)({cookies:l.cookies}),{data:{user:i},error:r}=await t.auth.getUser();if(r||!i)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{searchParams:s}=new URL(e.url),o=s.get("competitor_id"),a=parseInt(s.get("limit")||"20");try{let{data:e}=await t.from("clients").select("id").eq("user_id",i.id).single();if(!e)return n.NextResponse.json({error:"Cliente n\xe3o encontrado"},{status:404});let r=t.from("competitor_activities").select(`
        *,
        competitor:competitor_id (
          id,
          instagram_username,
          display_name,
          profile_picture_url
        )
      `).order("detected_at",{ascending:!1}).limit(a);if(o)r=r.eq("competitor_id",o);else{let{data:i}=await t.from("client_competitors").select("id").eq("client_id",e.id).eq("is_active",!0);if(!i||!(i.length>0))return n.NextResponse.json({success:!0,activities:[]});r=r.in("competitor_id",i.map(e=>e.id))}let{data:s,error:c}=await r;if(c)throw c;let l=s?.filter(e=>e.is_viral)||[],p=s?.filter(e=>!e.is_viral)||[];return n.NextResponse.json({success:!0,activities:s,viral:l,recent:p,total:s?.length||0})}catch(e){return console.error("Erro ao listar atividades:",e),n.NextResponse.json({error:e.message},{status:500})}}async function u(e){let t=(0,c.createRouteHandlerClient)({cookies:l.cookies}),i=e.headers.get("Authorization"),r=process.env.CRON_SECRET;if(!i||i!==`Bearer ${r}`){let{data:{user:e}}=await t.auth.getUser();if(!e)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:i}=await t.from("user_profiles").select("user_type").eq("id",e.id).single();if(!i||!["admin","super_admin"].includes(i.user_type))return n.NextResponse.json({error:"Acesso negado"},{status:403})}let{competitor_id:s,activity_type:o,content_url:a,thumbnail_url:p,caption:u,likes_count:d,comments_count:m,shares_count:_,engagement_rate:g,posted_at:f}=await e.json();if(!s||!o)return n.NextResponse.json({error:"competitor_id e activity_type s\xe3o obrigat\xf3rios"},{status:400});try{let e=g&&g>10||d&&d>1e3,{data:i,error:r}=await t.from("competitor_activities").insert({competitor_id:s,activity_type:o,content_url:a,thumbnail_url:p,caption:u,likes_count:d||0,comments_count:m||0,shares_count:_||0,engagement_rate:g||0,is_viral:e,posted_at:f||new Date().toISOString()}).select().single();if(r)throw r;if(e){let{data:e}=await t.from("client_competitors").select("client_id, display_name").eq("id",s).single();e&&await t.from("notifications").insert({user_id:e.client_id,type:"competitor_viral",title:"\uD83D\uDD25 Concorrente com post viral!",message:`${e.display_name} teve um post com alto engajamento. Confira!`,data:{activity_id:i.id,competitor_id:s},is_read:!1})}return n.NextResponse.json({success:!0,activity:i})}catch(e){return console.error("Erro ao registrar atividade:",e),n.NextResponse.json({error:e.message},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/client/competitors/activities/route",pathname:"/api/client/competitors/activities",filename:"route",bundlePath:"app/api/client/competitors/activities/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\client\\competitors\\activities\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:g}=d,f="/api/client/competitors/activities/route";function v(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958],()=>i(46629));module.exports=r})();