"use strict";exports.id=34548,exports.ids=[34548],exports.modules={29887:(e,a,t)=>{t.d(a,{g:()=>p});var s=t(10326),r=t(17577),l=t(91664),i=t(38443),n=t(71709),d=t(49758),c=t(56562),o=t(36283),m=t(39572),x=t(77506),u=t(56418),h=t(94019);let g={image:["image/jpeg","image/png","image/gif","image/webp"],video:["video/mp4","video/webm","video/quicktime"],audio:["audio/mpeg","audio/wav","audio/ogg","audio/mp3"],document:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]};function p({onAttachmentsChange:e,maxFiles:a=5,maxSizeInMB:t=50}){let[p,f]=(0,r.useState)([]),[j,y]=(0,r.useState)(!1),b=(0,r.useRef)(null),v=e=>g.image.includes(e)?"image":g.video.includes(e)?"video":g.audio.includes(e)?"audio":g.document.includes(e)?"document":"other",N=e=>e.size>1048576*t?`Arquivo muito grande. M\xe1ximo: ${t}MB`:[...g.image,...g.video,...g.audio,...g.document].includes(e.type)?null:"Tipo de arquivo n\xe3o suportado",w=(e,a)=>new Promise(t=>{if("image"===a){let a=new FileReader;a.onloadend=()=>t(a.result),a.onerror=()=>t(void 0),a.readAsDataURL(e)}else t(void 0)}),_=async t=>{let s=Array.from(t.target.files||[]);if(p.length+s.length>a){alert(`Voc\xea pode anexar no m\xe1ximo ${a} arquivos por vez`);return}y(!0);let r=[];for(let e of s){let a=N(e),t=v(e.type),s=await w(e,t);r.push({id:Math.random().toString(36).substr(2,9),file:e,type:t,preview:s,error:a||void 0})}let l=[...p,...r];f(l),e(l),y(!1),b.current&&(b.current.value="")},k=a=>{let t=p.filter(e=>e.id!==a);f(t),e(t)},S=e=>{switch(e){case"image":return s.jsx(n.Z,{className:"w-4 h-4"});case"video":return s.jsx(d.Z,{className:"w-4 h-4"});case"audio":return s.jsx(c.Z,{className:"w-4 h-4"});case"document":return s.jsx(o.Z,{className:"w-4 h-4"});default:return s.jsx(m.Z,{className:"w-4 h-4"})}},C=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB";return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("input",{ref:b,type:"file",multiple:!0,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx",onChange:_,className:"hidden",disabled:j||p.length>=a}),s.jsx(l.z,{type:"button",variant:"outline",size:"sm",onClick:()=>b.current?.click(),disabled:j||p.length>=a,children:j?s.jsx(x.Z,{className:"w-4 h-4 animate-spin"}):s.jsx(u.Z,{className:"w-4 h-4"})}),p.length>0&&(0,s.jsxs)(i.C,{variant:"outline",children:[p.length," arquivo",p.length>1?"s":""]})]}),p.length>0&&s.jsx("div",{className:"space-y-2",children:p.map(e=>(0,s.jsxs)("div",{className:`flex items-center gap-2 p-2 rounded-lg border ${e.error?"border-red-300 bg-red-50 dark:bg-red-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"}`,children:[e.preview&&"image"===e.type?s.jsx("img",{src:e.preview,alt:e.file.name,className:"w-12 h-12 object-cover rounded"}):s.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded",children:S(e.type)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.file.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("p",{className:"text-xs text-gray-500",children:C(e.file.size)}),e.error&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:e.error})]})]}),s.jsx(l.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>k(e.id),children:s.jsx(h.Z,{className:"w-4 h-4"})})]},e.id))})]})}},52862:(e,a,t)=>{t.d(a,{I:()=>h});var s=t(10326),r=t(17577),l=t(31540),i=t(69145),n=t(7937),d=t(11962),c=t(94019),o=t(91664),m=t(24266),x=t(36283),u=t(39572);function h({attachment:e,showInline:a=!0}){let t,[h,g]=(0,r.useState)(!1),[p,f]=(0,r.useState)(100),[j,y]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),N=e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB",w=async()=>{try{let a=await fetch(e.file_url),t=await a.blob(),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=e.file_name,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)}catch(e){console.error("Erro ao baixar arquivo:",e)}};return(0,s.jsxs)(s.Fragment,{children:[a&&(e.mime_type.startsWith("image/")?(0,s.jsxs)("div",{className:"relative group",children:[s.jsx("img",{src:e.file_url,alt:e.file_name,className:"max-w-full max-h-96 rounded-lg cursor-pointer object-contain",onClick:()=>g(!0)}),s.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx(o.z,{size:"sm",variant:"secondary",onClick:e=>{e.stopPropagation(),w()},children:s.jsx(l.Z,{className:"w-4 h-4"})})}),e.width&&e.height&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.width," \xd7 ",e.height]})]}):e.mime_type.startsWith("video/")?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("video",{controls:!0,className:"max-w-full max-h-96 rounded-lg",poster:e.thumbnail_url,children:[s.jsx("source",{src:e.file_url,type:e.mime_type}),"Seu navegador n\xe3o suporta v\xeddeos."]}),e.duration&&s.jsx(m.Z,{className:"absolute bottom-2 right-2 bg-black/70 text-white",children:(t=e.duration)?`${Math.floor(t/60)}:${Math.floor(t%60).toString().padStart(2,"0")}`:"0:00"})]}):e.mime_type.startsWith("audio/")?(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg max-w-md",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(i.Z,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.file_name}),(0,s.jsxs)("audio",{controls:!0,className:"w-full mt-2",children:[s.jsx("source",{src:e.file_url,type:e.mime_type}),"Seu navegador n\xe3o suporta \xe1udio."]})]}),s.jsx(o.z,{size:"sm",variant:"ghost",onClick:w,children:s.jsx(l.Z,{className:"w-4 h-4"})})]}):"application/pdf"===e.mime_type?s.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-w-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/20 rounded flex items-center justify-center",children:s.jsx(x.Z,{className:"w-6 h-6 text-red-600"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.file_name}),s.jsx("p",{className:"text-xs text-gray-500",children:N(e.file_size)})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(o.z,{size:"sm",variant:"outline",onClick:()=>window.open(e.file_url,"_blank"),children:"Abrir"}),s.jsx(o.z,{size:"sm",variant:"outline",onClick:w,children:s.jsx(l.Z,{className:"w-4 h-4"})})]})]})}):s.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-w-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded flex items-center justify-center",children:s.jsx(u.Z,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.file_name}),s.jsx("p",{className:"text-xs text-gray-500",children:N(e.file_size)})]}),s.jsx(o.z,{size:"sm",variant:"outline",onClick:w,children:s.jsx(l.Z,{className:"w-4 h-4"})})]})})),h&&e.mime_type.startsWith("image/")&&s.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>g(!1),children:(0,s.jsxs)("div",{className:"relative max-w-7xl max-h-full",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"absolute top-4 right-4 flex gap-2",children:[s.jsx(o.z,{size:"sm",variant:"secondary",onClick:()=>f(Math.min(200,p+25)),children:s.jsx(n.Z,{className:"w-4 h-4"})}),s.jsx(o.z,{size:"sm",variant:"secondary",onClick:()=>f(Math.max(50,p-25)),children:s.jsx(d.Z,{className:"w-4 h-4"})}),s.jsx(o.z,{size:"sm",variant:"secondary",onClick:w,children:s.jsx(l.Z,{className:"w-4 h-4"})}),s.jsx(o.z,{size:"sm",variant:"secondary",onClick:()=>g(!1),children:s.jsx(c.Z,{className:"w-4 h-4"})})]}),s.jsx("img",{src:e.file_url,alt:e.file_name,style:{transform:`scale(${p/100})`},className:"max-w-full max-h-[90vh] object-contain transition-transform"}),(0,s.jsxs)("p",{className:"text-white text-center mt-4 text-sm",children:[e.file_name," - ",N(e.file_size)]})]})})]})}},16065:(e,a,t)=>{t.d(a,{l:()=>R});var s=t(10326),r=t(17577),l=t(2777),i=t(91664),n=t(41190),d=t(67211),c=t(32933),o=t(70717),m=t(39447),x=t(69436),u=t(6507),h=t(8993),g=t(40877),p=t(5314),f=t(29752),j=t(38443),y=t(39730),b=t(94019),v=t(17069),N=t(48998),w=t(37358);function _({isOpen:e,onClose:a,clientId:t,clientName:l,conversationId:n}){let[d,c]=(0,r.useState)(null),[o,m]=(0,r.useState)(!0),x=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});return e?s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(f.Zb,{className:"w-full max-w-2xl max-h-[90vh] flex flex-col",children:[(0,s.jsxs)(f.Ol,{className:"flex-shrink-0 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(f.ll,{className:"flex items-center gap-2",children:[s.jsx(y.Z,{className:"w-5 h-5 text-blue-600"}),"Hist\xf3rico de Intera\xe7\xf5es"]}),s.jsx(i.z,{variant:"ghost",size:"sm",onClick:a,children:s.jsx(b.Z,{className:"w-5 h-5"})})]}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:l})]}),s.jsx(f.aY,{className:"flex-1 overflow-y-auto p-6",children:o?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):d?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(y.Z,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-xs font-medium text-blue-900 dark:text-blue-300",children:"Total de Mensagens"})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.total_messages})]}),(0,s.jsxs)("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(v.Z,{className:"w-4 h-4 text-green-600"}),s.jsx("span",{className:"text-xs font-medium text-green-900 dark:text-green-300",children:"Taxa de Resposta"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[d.messages_received>0?Math.round(d.messages_sent/d.messages_received*100):0,"%"]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(N.Z,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Tempo M\xe9dio de Resposta"})]}),s.jsx(j.C,{variant:"outline",children:(e=>{if(e<60)return`${e} minutos`;let a=Math.floor(e/60);if(a<24)return`${a} hora${a>1?"s":""}`;let t=Math.floor(a/24);return`${t} dia${t>1?"s":""}`})(d.avg_response_time_minutes)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(w.Z,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Dia Mais Ativo"})]}),s.jsx(j.C,{variant:"outline",className:"capitalize",children:d.most_active_day})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(y.Z,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Mensagens Enviadas"})]}),s.jsx(j.C,{className:"bg-blue-600 text-white",children:d.messages_sent})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(y.Z,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Mensagens Recebidas"})]}),s.jsx(j.C,{className:"bg-green-600 text-white",children:d.messages_received})]})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[s.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Linha do Tempo"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Primeira Mensagem"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:x(d.first_message_at)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"\xdaltima Mensagem"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:x(d.last_message_at)})]})]})]})]}):(0,s.jsxs)("div",{className:"text-center py-12",children:[s.jsx(y.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma intera\xe7\xe3o registrada ainda"})]})})]})}):null}var k=t(29887),S=t(52862),C=t(70375),I=t(47866),z=t(28194),D=t(9428),Z=t(55786);t(43931);var $=t(51858),E=t(51478),O=t(8130),M=t(54734);function R({conversation:e,currentUserId:a,readOnly:t=!1}){let[f,j]=(0,r.useState)([]),[y,b]=(0,r.useState)(""),[v,N]=(0,r.useState)(!0),[w,R]=(0,r.useState)(!1),[T,L]=(0,r.useState)(new Set),[A,B]=(0,r.useState)(!1),[U,q]=(0,r.useState)([]),[F,P]=(0,r.useState)(null),[V,G]=(0,r.useState)(new Map),H=(0,r.useRef)(null),[W,K]=(0,r.useState)(!1),[X,Y]=(0,r.useState)(""),[J,Q]=(0,r.useState)(null),ee=(0,r.useRef)(null),ea=(0,r.useRef)(null),{startTyping:et,stopTyping:es}=(0,g.o)({userId:a}),{playNotificationSound:er}=(0,p.r)(),el=async s=>{if(s.preventDefault(),!t&&(y.trim()||0!==U.length)&&!w){R(!0),es();try{let{data:t,error:s}=await l.O.from("direct_messages").insert({conversation_id:e.id,from_user_id:a,body:y.trim()||"(anexo)",message_type:U.length>0?"attachment":"text"}).select().single();if(s)throw s;if(U.length>0&&t)for(let s of U){let r=s.file,i=`${Date.now()}-${r.name}`,n=`messages/${e.id}/${i}`,{error:d}=await l.O.storage.from("attachments").upload(n,r,{cacheControl:"3600",upsert:!1});if(d){console.error("Erro ao fazer upload:",d);continue}let{data:{publicUrl:c}}=l.O.storage.from("attachments").getPublicUrl(n);await l.O.from("message_attachments").insert({message_id:t.id,message_type:"direct",file_name:r.name,file_url:c,file_type:s.type,file_size:r.size,mime_type:r.type,uploaded_by:a})}if(t?.id){try{await fetch("/api/mentions/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entityType:"direct_message",entityId:t.id,conversationId:e.id,otherUserId:e.other_user_id})})}catch{}(0,M.tC)({messageId:t.id,content:y.trim(),senderId:a,senderType:"collaborator",conversationType:e.is_client_conversation?"direct_client":"direct_team",clientId:e.is_client_conversation?e.other_user_id:void 0,conversationName:e.other_user_name||"Conversa direta"})}b(""),q([])}catch(e){console.error("Erro ao enviar mensagem:",e),alert("Erro ao enviar mensagem")}finally{R(!1)}}},ei=(0,r.useMemo)(()=>{let a={userId:e.other_user_id,label:e.other_user_name||"Usu\xe1rio",email:e.other_user_email||void 0,avatarUrl:e.other_user_avatar};return a.userId?[a]:[]},[e.other_user_email,e.other_user_avatar,e.other_user_id,e.other_user_name]),en=(0,r.useMemo)(()=>(0,O.X)(ei,X),[ei,X]),ed=()=>{let e=H.current;if(!e)return;let a=String(e.value||""),t="number"==typeof e.selectionStart?e.selectionStart:a.length,s=(0,E.XI)(a,t);if(!s.active){K(!1),Y(""),Q(null);return}K(!0),Y(s.query),Q({start:s.startIndex,end:s.endIndex})},ec=e=>{let a=H.current;if(!a||!J)return;let t=String(a.value||""),{nextValue:s,nextCaretIndex:r}=(0,E.CE)({value:t,startIndex:J.start,endIndex:J.end,userId:e.userId,trailingSpace:!0});b(s),K(!1),Y(""),Q(null),requestAnimationFrame(()=>{try{a.focus(),a.setSelectionRange(r,r)}catch{}})},eo=e=>{let a=document.getElementById(`message-${e}`);a&&ea.current&&(a.scrollIntoView({behavior:"smooth",block:"center"}),P(e),setTimeout(()=>P(null),2e3))},em=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),ex=e=>{let a=new Date(e),t=new Date,s=new Date(t);return(s.setDate(s.getDate()-1),a.toDateString()===t.toDateString())?"Hoje":a.toDateString()===s.toDateString()?"Ontem":a.toLocaleDateString("pt-BR")},eu=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),eh=(t,r)=>{let l=t.from_user_id===a,i=!l&&!!a&&String(t.body||"").includes(`@{${a}}`),n=0===r||new Date(f[r-1].created_at).toDateString()!==new Date(t.created_at).toDateString();return(0,s.jsxs)("div",{children:[n&&s.jsx("div",{className:"flex items-center justify-center my-4",children:s.jsx("span",{className:"px-3 py-1 text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:ex(t.created_at)})}),(0,s.jsxs)("div",{id:`message-${t.id}`,className:`flex gap-3 mb-4 group ${l?"flex-row-reverse":""} ${T.has(t.id)?"animate-slide-in":""} ${F===t.id?"bg-yellow-100 dark:bg-yellow-900/20 p-2 rounded-lg":""} ${i?"ring-2 ring-yellow-300/60 dark:ring-yellow-500/30 rounded-lg p-2":""}`,children:[!l&&(0,s.jsxs)("div",{className:"relative w-8 h-8 flex-shrink-0",children:[e.other_user_avatar?s.jsx("img",{src:e.other_user_avatar,alt:"",className:"w-8 h-8 rounded-full object-cover"}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-xs text-white font-medium",children:eu(e.other_user_name||"U")}),s.jsx("div",{className:"absolute bottom-0 right-0",children:s.jsx(h.n,{userId:e.other_user_id,size:"sm"})})]}),(0,s.jsxs)("div",{className:`flex flex-col ${l?"items-end":"items-start"} max-w-md`,children:[(0,s.jsxs)("div",{className:`rounded-2xl px-4 py-2 ${l?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[t.body&&"(anexo)"!==t.body&&s.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.jsx($.d,{text:t.body,profilesById:V,highlightUserId:a||void 0})}),t.attachments&&t.attachments.length>0&&s.jsx("div",{className:"mt-2 space-y-2",children:t.attachments.map(e=>s.jsx(S.I,{attachment:e},e.id))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[s.jsx("span",{className:"text-xs text-gray-500",children:em(t.created_at)}),l&&s.jsx("span",{title:t.is_read?"Lida":"Enviada",children:t.is_read?s.jsx(d.Z,{className:"w-3 h-3 text-blue-500"}):s.jsx(c.Z,{className:"w-3 h-3 text-gray-500"})})]}),s.jsx("div",{className:"mt-2",children:s.jsx(I.g,{messageId:t.id,messageType:"direct",currentUserId:a,compact:!0})})]}),s.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:s.jsx(Z.s,{messageId:t.id,messageType:"direct",conversationId:e.id,currentUserId:a,compact:!0})})]})]},t.id)};return v?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[e.other_user_avatar?s.jsx("img",{src:e.other_user_avatar,alt:"",className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white font-medium",children:eu(e.other_user_name)}),s.jsx("div",{className:"absolute bottom-0 right-0",children:s.jsx(h.n,{userId:e.other_user_id,size:"md"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.other_user_name}),e.is_client_conversation&&s.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded-full",children:"Cliente"})]}),s.jsx(h.n,{userId:e.other_user_id,showLabel:!0,size:"sm"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(z.w,{conversationId:e.id,conversationType:"direct",onResultClick:eo,participants:[{id:e.other_user_id,full_name:e.other_user_name}]}),e.is_client_conversation&&s.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>B(!0),title:"Hist\xf3rico de intera\xe7\xf5es",children:s.jsx(o.Z,{className:"w-5 h-5"})}),s.jsx(i.z,{variant:"ghost",size:"sm",children:s.jsx(m.Z,{className:"w-5 h-5"})})]})]}),s.jsx(D.q,{conversationId:e.id,conversationType:"direct",currentUserId:a,onMessageClick:eo}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",ref:ea,children:[0===f.length?s.jsx("div",{className:"h-full flex items-center justify-center text-center",children:(0,s.jsxs)("div",{children:[s.jsx(x.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma mensagem ainda"}),s.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Seja o primeiro a enviar uma mensagem!"})]})}):f.map((e,a)=>eh(e,a)),s.jsx("div",{ref:ee})]}),t?s.jsx("div",{className:"px-4 py-3 border-t bg-gray-50 dark:bg-gray-900",children:s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Visualiza\xe7\xe3o do Super Admin: somente leitura (envio e “lido” desativados)."})}):(0,s.jsxs)("div",{className:"p-4 border-t space-y-3",children:[s.jsx(k.g,{onAttachmentsChange:q,maxFiles:5,maxSizeInMB:50}),(0,s.jsxs)("form",{onSubmit:el,className:"flex items-start gap-2",children:[s.jsx(C.h,{onEmojiSelect:e=>{b(a=>a+e)}}),(0,s.jsxs)("div",{className:"relative flex-1",children:[s.jsx(n.II,{ref:H,value:y,onChange:e=>{b(e.target.value),e.target.value.length>0?et():es(),requestAnimationFrame(()=>ed())},onBlur:()=>{es(),setTimeout(()=>K(!1),150)},onKeyUp:()=>ed(),onClick:()=>ed(),placeholder:"Digite uma mensagem... (use @ para mencionar)",disabled:w,className:"flex-1"}),W&&en.length>0&&s.jsx("div",{className:"absolute left-0 right-0 bottom-full mb-2 z-50 rounded-lg border bg-white dark:bg-gray-900 shadow-lg overflow-hidden",children:s.jsx("div",{className:"max-h-56 overflow-y-auto",children:en.map(e=>(0,s.jsxs)("button",{type:"button",onMouseDown:e=>e.preventDefault(),onClick:()=>ec(e),className:"w-full px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-gray-800",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.label}),e.email&&s.jsx("div",{className:"text-xs text-gray-500",children:e.email})]},e.userId))})})]}),s.jsx(i.z,{type:"submit",disabled:!y.trim()&&0===U.length||w,className:"bg-blue-600 hover:bg-blue-700",children:s.jsx(x.Z,{className:"w-5 h-5"})})]})]}),e.is_client_conversation&&(0,s.jsxs)("div",{className:"px-4 py-2 bg-blue-50 dark:bg-blue-900/20 border-t flex items-center gap-2",children:[s.jsx(u.Z,{className:"w-4 h-4 text-blue-600"}),s.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Conversando com cliente - Mensagens s\xe3o priorit\xe1rias"})]}),A&&s.jsx(_,{isOpen:A,onClose:()=>B(!1),clientId:e.other_user_id,clientName:e.other_user_name,conversationId:e.id})]})}},53526:(e,a,t)=>{t.d(a,{f:()=>x});var s=t(10326),r=t(17577);t(2777);var l=t(38443),i=t(41190),n=t(91664),d=t(83855),c=t(88307),o=t(39730),m=t(8993);function x({onSelectConversation:e,selectedConversationId:a,onNewConversation:t,currentUserId:x,filterType:u="all",peerTypeFilter:h="all",titleOverride:g,adminView:p=!1,allowedUserIds:f}){let[j,y]=(0,r.useState)([]),[b,v]=(0,r.useState)(""),[N,w]=(0,r.useState)(!0),_=j.filter(e=>{if("clients"===u&&!e.is_client_conversation||"team"===u&&e.is_client_conversation||"client"===h&&"client"!==e.other_user_type||"non_client"===h&&"client"===e.other_user_type||f&&f.length>0&&!f.includes(e.other_user_id))return!1;if(!b)return!0;let a=b.toLowerCase();return e.other_user_name?.toLowerCase().includes(a)||e.other_user_email?.toLowerCase().includes(a)||e.last_message_preview?.toLowerCase().includes(a)}),k=e=>{if(!e)return"";let a=new Date(e),t=new Date().getTime()-a.getTime(),s=Math.floor(t/6e4),r=Math.floor(t/36e5),l=Math.floor(t/864e5);return s<1?"Agora":s<60?`${s}m`:r<24?`${r}h`:l<7?`${l}d`:a.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})},S=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return N?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900 border-r",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex-1",children:g||("clients"===u?"Clientes":"team"===u?"Equipe":"Conversas")}),!p&&s.jsx(n.z,{onClick:t,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:s.jsx(d.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(i.II,{type:"text",placeholder:"Buscar conversas...",value:b,onChange:e=>v(e.target.value),className:"pl-10"})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:0===_.length?(0,s.jsxs)("div",{className:"p-8 text-center",children:[s.jsx(o.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-gray-500",children:b?"Nenhuma conversa encontrada":"Nenhuma conversa ainda"}),!b&&(0,s.jsxs)(n.z,{onClick:t,variant:"outline",size:"sm",className:"mt-3",children:[s.jsx(d.Z,{className:"w-4 h-4 mr-2"}),"Nova Conversa"]})]}):_.map(t=>s.jsx("button",{onClick:()=>e(t),className:`w-full p-4 border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-left ${a===t.id?t.is_client_conversation?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-blue-600":"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-primary":t.is_client_conversation&&t.unread_count&&t.unread_count>0?"bg-blue-50/50 dark:bg-blue-900/10 border-l-2 border-l-blue-400":""}`,children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("div",{className:"relative flex-shrink-0",children:[t.other_user_avatar?s.jsx("img",{src:t.other_user_avatar,alt:"",className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white font-medium",children:S(t.other_user_name)}),s.jsx("div",{className:"absolute bottom-0 right-0",children:s.jsx(m.n,{userId:t.other_user_id,size:"md"})}),t.unread_count&&t.unread_count>0&&s.jsx(l.C,{className:"absolute -top-1 -right-1 h-5 min-w-5 flex items-center justify-center p-0 bg-red-600 text-white text-xs",children:t.unread_count>9?"9+":t.unread_count})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("span",{className:`font-medium text-gray-900 dark:text-white truncate ${t.unread_count&&t.unread_count>0?"font-bold":""}`,children:t.other_user_name}),t.is_client_conversation&&s.jsx(l.C,{className:"text-xs flex-shrink-0 bg-blue-600 text-white border-0 shadow-sm",children:"Cliente"})]}),s.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:k(t.last_message_at)})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mb-1",children:t.other_user_email}),t.last_message_preview&&s.jsx("p",{className:`text-sm text-gray-600 dark:text-gray-400 truncate ${t.unread_count&&t.unread_count>0?"font-semibold text-gray-900 dark:text-white":""}`,children:t.last_message_preview})]})]})},t.id))})]})}t(43931)},70375:(e,a,t)=>{t.d(a,{h:()=>c});var s=t(10326),r=t(17577),l=t(33265),i=t(15515),n=t(91664);let d=(0,l.default)(async()=>{},{loadableGenerated:{modules:["components\\messaging\\EmojiPicker.tsx -> emoji-picker-react"]},ssr:!1});function c({onEmojiSelect:e,buttonClassName:a}){let[t,l]=(0,r.useState)(!1),c=(0,r.useRef)(null);return(0,s.jsxs)("div",{className:"relative",ref:c,children:[s.jsx(n.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>l(!t),className:a,title:"Adicionar emoji",children:s.jsx(i.Z,{className:"w-5 h-5"})}),t&&s.jsx("div",{className:"absolute bottom-12 right-0 z-50 shadow-xl",children:s.jsx(d,{onEmojiClick:a=>{e(a.emoji),l(!1)},searchPlaceholder:"Buscar emoji...",previewConfig:{showPreview:!1},width:320,height:400})})]})}},785:(e,a,t)=>{t.d(a,{r:()=>U});var s=t(10326),r=t(17577),l=t(2777),i=t(91664),n=t(41190),d=t(24061),c=t(88378),o=t(69436),m=t(43931);function x({groupId:e,currentUserId:a}){let[t,l]=(0,r.useState)([]);return 0===t.length?null:(0,s.jsxs)("div",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 italic flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex gap-1",children:[s.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),s.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),s.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),(0,s.jsxs)("span",{children:[1===t.length?`${t[0].full_name} est\xe1 digitando`:2===t.length?`${t[0].full_name} e ${t[1].full_name} est\xe3o digitando`:`${t[0].full_name} e mais ${t.length-1} pessoas est\xe3o digitando`,"..."]})]})}var u=t(8993),h=t(29752),g=t(38443),p=t(85206),f=t(31215),j=t(94019),y=t(26092),b=t(99280),v=t(88307),N=t(74975),w=t(51896),_=t(63685);function k({isOpen:e,onClose:a,groupId:t,groupName:c,groupDescription:o,currentUserId:x,isAdmin:k}){let[S,C]=(0,r.useState)([]),[I,z]=(0,r.useState)([]),[D,Z]=(0,r.useState)(""),[$,E]=(0,r.useState)(!1),[O,M]=(0,r.useState)(c),[R,T]=(0,r.useState)(o||""),[L,A]=(0,r.useState)(!1),[B,U]=(0,r.useState)("members"),[q,F]=(0,r.useState)(null),[P,V]=(0,r.useState)(!1),G=async e=>{let a=e.target.files?.[0];if(a&&k){V(!0);try{let e=a.name.split(".").pop(),s=`${t}-${Date.now()}.${e}`,r=`group-avatars/${s}`,{error:i}=await l.O.storage.from("avatars").upload(r,a,{upsert:!0});if(i)throw i;let{data:{publicUrl:n}}=l.O.storage.from("avatars").getPublicUrl(r),{error:d}=await l.O.from("message_groups").update({avatar_url:n}).eq("id",t);if(d)throw d;F(n),alert("Avatar atualizado com sucesso!")}catch(e){console.error("Erro ao fazer upload:",e),alert("Erro ao fazer upload do avatar")}finally{V(!1)}}},H=async()=>{try{let{data:e,error:a}=await l.O.from("group_participants").select("id, user_id, role, joined_at").eq("group_id",t).eq("is_active",!0).order("role",{ascending:!1}).order("joined_at",{ascending:!0});if(a)throw a;let s=Array.from(new Set((e||[]).map(e=>String(e?.user_id||"")).filter(Boolean))),r=await (0,m.m)(l.O,s),i=(e||[]).map(e=>({id:e.id,user_id:e.user_id,role:e.role,joined_at:e.joined_at,full_name:r.get(String(e.user_id))?.full_name||"Usu\xe1rio",email:r.get(String(e.user_id))?.email||"",avatar_url:r.get(String(e.user_id))?.avatar_url}));C(i)}catch(e){console.error("Erro ao carregar membros:",e)}},W=async()=>{try{let e=[],a=await l.O.from("user_profiles").select("id, user_id, full_name, email, user_type, avatar_url, avatar").neq("user_type","client");if(a.error){let a=await l.O.from("user_profiles").select("id, full_name, email, user_type, avatar_url, avatar").neq("user_type","client");if(a.error)throw a.error;e=a.data||[]}else e=a.data||[];let t=new Set(S.map(e=>String(e.user_id))),s=(e||[]).map(e=>{let a=e?.user_id?String(e.user_id):e?.id?String(e.id):null;return a?{id:a,full_name:String(e?.full_name||"Usu\xe1rio"),email:String(e?.email||""),user_type:String(e?.user_type||""),avatar_url:e?.avatar_url?String(e.avatar_url):e?.avatar?String(e.avatar):void 0}:null}).filter(Boolean).filter(e=>!t.has(String(e.id)));z(s)}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}},K=async e=>{if(!k){alert("Apenas administradores podem adicionar membros");return}A(!0);try{let{error:a}=await l.O.from("group_participants").insert({group_id:t,user_id:e,role:"member",is_active:!0});if(a)throw a;await H(),await W()}catch(e){console.error("Erro ao adicionar membro:",e),alert("Erro ao adicionar membro")}finally{A(!1)}},X=async(e,a)=>{if(!k){alert("Apenas administradores podem remover membros");return}if(a===x){alert("Voc\xea n\xe3o pode remover a si mesmo");return}if(confirm("Tem certeza que deseja remover este membro?")){A(!0);try{let{error:a}=await l.O.from("group_participants").update({is_active:!1}).eq("id",e);if(a)throw a;await H(),await W()}catch(e){console.error("Erro ao remover membro:",e),alert("Erro ao remover membro")}finally{A(!1)}}},Y=async(e,a)=>{if(!k){alert("Apenas administradores podem alterar fun\xe7\xf5es");return}A(!0);try{let{error:t}=await l.O.from("group_participants").update({role:"admin"===a?"member":"admin"}).eq("id",e);if(t)throw t;await H()}catch(e){console.error("Erro ao alterar fun\xe7\xe3o:",e),alert("Erro ao alterar fun\xe7\xe3o")}finally{A(!1)}},J=async()=>{if(!k){alert("Apenas administradores podem editar informa\xe7\xf5es do grupo");return}A(!0);try{let{error:e}=await l.O.from("message_groups").update({name:O,description:R,updated_at:new Date().toISOString()}).eq("id",t);if(e)throw e;E(!1),alert("Informa\xe7\xf5es do grupo atualizadas!")}catch(e){console.error("Erro ao atualizar grupo:",e),alert("Erro ao atualizar informa\xe7\xf5es")}finally{A(!1)}},Q=I.filter(e=>e.full_name.toLowerCase().includes(D.toLowerCase())||e.email.toLowerCase().includes(D.toLowerCase())),ee=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return e?s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(h.Zb,{className:"w-full max-w-3xl max-h-[90vh] flex flex-col",children:[s.jsx(h.Ol,{className:"flex-shrink-0 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex-1",children:$?(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(n.II,{value:O,onChange:e=>M(e.target.value),className:"text-lg font-semibold"}),s.jsx(n.II,{value:R,onChange:e=>T(e.target.value),placeholder:"Descri\xe7\xe3o do grupo",className:"text-sm"})]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)(h.ll,{className:"flex items-center gap-2",children:[s.jsx(d.Z,{className:"w-5 h-5"}),O,k&&s.jsx("button",{onClick:()=>E(!0),className:"ml-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:s.jsx(p.Z,{className:"w-4 h-4"})})]}),R&&s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:R}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[S.length," membros"]})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[$&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(i.z,{size:"sm",onClick:J,disabled:L,children:s.jsx(f.Z,{className:"w-4 h-4"})}),s.jsx(i.z,{size:"sm",variant:"outline",onClick:()=>{E(!1),M(c),T(o||"")},children:s.jsx(j.Z,{className:"w-4 h-4"})})]}),s.jsx(i.z,{variant:"ghost",size:"sm",onClick:a,children:s.jsx(j.Z,{className:"w-5 h-5"})})]})]})}),s.jsx("div",{className:"flex-shrink-0 border-b",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("button",{onClick:()=>U("members"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${"members"===B?"border-b-2 border-primary text-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Membros (",S.length,")"]}),k&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("button",{onClick:()=>U("add"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${"add"===B?"border-b-2 border-primary text-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"Adicionar Membros"}),s.jsx("button",{onClick:()=>U("settings"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${"settings"===B?"border-b-2 border-primary text-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"Configura\xe7\xf5es"})]})]})}),s.jsx(h.aY,{className:"flex-1 overflow-y-auto p-0",children:"members"===B?s.jsx("div",{children:S.map(e=>s.jsx("div",{className:"p-4 border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[e.avatar_url?s.jsx("img",{src:e.avatar_url,alt:"",className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white font-medium",children:ee(e.full_name)}),s.jsx("div",{className:"absolute bottom-0 right-0",children:s.jsx(u.n,{userId:e.user_id,size:"md"})})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.full_name}),"admin"===e.role&&(0,s.jsxs)(g.C,{className:"bg-blue-600 text-white",children:[s.jsx(y.Z,{className:"w-3 h-3 mr-1"}),"Admin"]}),e.user_id===x&&s.jsx(g.C,{variant:"outline",children:"Voc\xea"})]}),s.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.email}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["Entrou em ",new Date(e.joined_at).toLocaleDateString("pt-BR")]})]}),k&&e.user_id!==x&&(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(i.z,{size:"sm",variant:"outline",onClick:()=>Y(e.id,e.role),title:"admin"===e.role?"Remover como admin":"Promover a admin",children:s.jsx(y.Z,{className:"w-4 h-4"})}),s.jsx(i.z,{size:"sm",variant:"outline",onClick:()=>X(e.id,e.user_id),title:"Remover do grupo",className:"text-red-600 hover:bg-red-50",children:s.jsx(b.Z,{className:"w-4 h-4"})})]})]})},e.id))}):"add"===B?(0,s.jsxs)("div",{children:[s.jsx("div",{className:"p-4 border-b",children:(0,s.jsxs)("div",{className:"relative",children:[s.jsx(v.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(n.II,{type:"text",placeholder:"Buscar por nome ou email...",value:D,onChange:e=>Z(e.target.value),className:"pl-10"})]})}),s.jsx("div",{children:0===Q.length?s.jsx("div",{className:"p-8 text-center",children:s.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum usu\xe1rio dispon\xedvel"})}):Q.map(e=>s.jsx("div",{className:"p-4 border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[e.avatar_url?s.jsx("img",{src:e.avatar_url,alt:"",className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white font-medium",children:ee(e.full_name)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.full_name}),s.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.email})]}),(0,s.jsxs)(i.z,{size:"sm",onClick:()=>K(e.id),disabled:L,className:"bg-blue-600 hover:bg-blue-700",children:[s.jsx(N.Z,{className:"w-4 h-4 mr-1"}),"Adicionar"]})]})},e.id))})]}):(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Avatar do Grupo"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative",children:[q?s.jsx("img",{src:q,alt:"Avatar do grupo",className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700"}):s.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center border-4 border-gray-200 dark:border-gray-700",children:s.jsx(d.Z,{className:"w-12 h-12 text-white"})}),k&&s.jsx("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",children:s.jsx(w.Z,{className:"w-4 h-4 text-white"})}),s.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:G,className:"hidden",disabled:!k||P})]}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Personalize o avatar do grupo"}),k&&(0,s.jsxs)("label",{htmlFor:"avatar-upload",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:[s.jsx(_.Z,{className:"w-4 h-4"}),P?"Enviando...":"Carregar Imagem"]}),s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Recomendado: 256x256px, m\xe1x 2MB"})]})]})]}),(0,s.jsxs)("div",{className:"border-t pt-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Informa\xe7\xf5es do Grupo"}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total de membros:"}),s.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:S.length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Administradores:"}),s.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:S.filter(e=>"admin"===e.role).length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Tipo:"}),s.jsx(g.C,{variant:"outline",children:"Grupo"})]})]})]})]})})]})}):null}var S=t(67211);function C({messageId:e,groupId:a,currentUserId:t,isOwnMessage:l}){let[i,n]=(0,r.useState)([]),[d,c]=(0,r.useState)(!1);if(!l||0===i.length)return null;let o=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});return(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 cursor-pointer",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[s.jsx(S.Z,{className:"w-3 h-3 text-blue-500"}),s.jsx("span",{className:"text-xs text-blue-500",children:i.length})]}),d&&(0,s.jsxs)("div",{className:"absolute bottom-full right-0 mb-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-3 z-50",children:[s.jsx("p",{className:"text-xs font-semibold text-gray-900 dark:text-white mb-2",children:"Visto por"}),s.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:i.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.avatar_url?s.jsx("img",{src:e.avatar_url,alt:"",className:"w-6 h-6 rounded-full object-cover"}):s.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-xs text-white",children:e.full_name[0]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs font-medium text-gray-900 dark:text-white truncate",children:e.full_name}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o(e.read_at)})]})]},e.user_id))})]})]})}var I=t(29887),z=t(52862),D=t(70375),Z=t(47866),$=t(28194),E=t(9428),O=t(55786),M=t(40877),R=t(5314),T=t(51858),L=t(51478),A=t(8130),B=t(54734);function U({group:e,currentUserId:a,readOnly:t=!1}){let[m,h]=(0,r.useState)([]),[g,p]=(0,r.useState)(""),[f,j]=(0,r.useState)(!0),[y,b]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[S,U]=(0,r.useState)(new Set),[q,F]=(0,r.useState)([]),[P,V]=(0,r.useState)(null),[G,H]=(0,r.useState)(new Map),W=(0,r.useRef)(null),[K,X]=(0,r.useState)(!1),[Y,J]=(0,r.useState)(""),[Q,ee]=(0,r.useState)(null),[ea,et]=(0,r.useState)([]),es=(0,r.useRef)(null),er=(0,r.useRef)(null);(0,r.useRef)(0);let{startTyping:el,stopTyping:ei}=(0,M.o)({userId:a,groupId:e.id}),{playNotificationSound:en}=(0,R.r)(),ed=async s=>{if(s.preventDefault(),!t&&(g.trim()||0!==q.length)&&!y){b(!0),ei();try{let{data:t,error:s}=await l.O.from("messages").insert({group_id:e.id,from_user_id:a,body:g.trim()||"(anexo)",type:q.length>0?"attachment":"text"}).select().single();if(s)throw s;if(q.length>0&&t)for(let s of q){let r=s.file,i=`${Date.now()}-${r.name}`,n=`messages/${e.id}/${i}`,{error:d}=await l.O.storage.from("attachments").upload(n,r,{cacheControl:"3600",upsert:!1});if(d){console.error("Erro ao fazer upload:",d);continue}let{data:{publicUrl:c}}=l.O.storage.from("attachments").getPublicUrl(n);await l.O.from("message_attachments").insert({message_id:t.id,message_type:"group",file_name:r.name,file_url:c,file_type:s.type,file_size:r.size,mime_type:r.type,uploaded_by:a})}if(t?.id){try{await fetch("/api/mentions/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entityType:"group_message",entityId:t.id,groupId:e.id})})}catch{}(0,B.tC)({messageId:t.id,content:g.trim(),senderId:a,senderType:"collaborator",conversationType:"group",groupId:e.id,conversationName:e.name})}p(""),F([])}catch(e){console.error("Erro ao enviar mensagem:",e),alert("Erro ao enviar mensagem")}finally{b(!1)}}},ec=(0,r.useMemo)(()=>(ea||[]).map(e=>({userId:String(e.id),label:String(e.full_name||"Usu\xe1rio")})).filter(e=>!!e.userId&&e.userId!==a),[ea,a]),eo=(0,r.useMemo)(()=>(0,A.X)(ec,Y),[ec,Y]),em=()=>{let e=W.current;if(!e)return;let a=String(e.value||""),t="number"==typeof e.selectionStart?e.selectionStart:a.length,s=(0,L.XI)(a,t);if(!s.active){X(!1),J(""),ee(null);return}X(!0),J(s.query),ee({start:s.startIndex,end:s.endIndex})},ex=e=>{let a=W.current;if(!a||!Q)return;let t=String(a.value||""),{nextValue:s,nextCaretIndex:r}=(0,L.CE)({value:t,startIndex:Q.start,endIndex:Q.end,userId:e.userId,trailingSpace:!0});p(s),X(!1),J(""),ee(null),requestAnimationFrame(()=>{try{a.focus(),a.setSelectionRange(r,r)}catch{}})},eu=e=>{let a=document.getElementById(`message-${e}`);a&&er.current&&(a.scrollIntoView({behavior:"smooth",block:"center"}),V(e),setTimeout(()=>V(null),2e3))},eh=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),eg=e=>{let a=new Date(e),t=new Date,s=new Date(t);return(s.setDate(s.getDate()-1),a.toDateString()===t.toDateString())?"Hoje":a.toDateString()===s.toDateString()?"Ontem":a.toLocaleDateString("pt-BR")},ep=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),ef=(t,r)=>{let l=t.from_user_id===a,i=!l&&!!a&&String(t.body||"").includes(`@{${a}}`),n=0===r||new Date(m[r-1].created_at).toDateString()!==new Date(t.created_at).toDateString();return(0,s.jsxs)("div",{children:[n&&s.jsx("div",{className:"flex items-center justify-center my-4",children:s.jsx("span",{className:"px-3 py-1 text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full",children:eg(t.created_at)})}),(0,s.jsxs)("div",{id:`message-${t.id}`,className:`flex gap-3 mb-4 group ${l?"flex-row-reverse":""} ${S.has(t.id)?"animate-slide-in":""} ${P===t.id?"bg-yellow-100 dark:bg-yellow-900/20 p-2 rounded-lg":""} ${i?"ring-2 ring-yellow-300/60 dark:ring-yellow-500/30 rounded-lg p-2":""}`,style:{animation:S.has(t.id)?"slideIn 0.3s ease-out":void 0},children:[!l&&(0,s.jsxs)("div",{className:"relative w-8 h-8 flex-shrink-0",children:[t.sender_avatar?s.jsx("img",{src:t.sender_avatar,alt:"",className:"w-8 h-8 rounded-full object-cover"}):s.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-xs text-white font-medium",children:ep(t.sender_name||"U")}),s.jsx("div",{className:"absolute bottom-0 right-0",children:s.jsx(u.n,{userId:t.from_user_id,size:"sm"})})]}),(0,s.jsxs)("div",{className:`flex flex-col ${l?"items-end":"items-start"} max-w-md`,children:[!l&&s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:t.sender_name}),(0,s.jsxs)("div",{className:`rounded-2xl px-4 py-2 ${l?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:[t.body&&"(anexo)"!==t.body&&s.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.jsx(T.d,{text:t.body,profilesById:G,highlightUserId:a||void 0})}),t.attachments&&t.attachments.length>0&&s.jsx("div",{className:"mt-2 space-y-2",children:t.attachments.map(e=>s.jsx(z.I,{attachment:e},e.id))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("span",{className:"text-xs text-gray-500",children:eh(t.created_at)}),s.jsx(C,{messageId:t.id,groupId:e.id,currentUserId:a,isOwnMessage:l})]}),s.jsx("div",{className:"mt-2",children:s.jsx(Z.g,{messageId:t.id,messageType:"group",currentUserId:a,compact:!0})})]}),w&&s.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-1",children:s.jsx(O.s,{messageId:t.id,messageType:"group",conversationId:e.id,currentUserId:a,compact:!0})})]})]},t.id)};return f?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white",children:s.jsx(d.Z,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),e.description&&s.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx($.w,{conversationId:e.id,conversationType:"group",onResultClick:eu,participants:ea}),!t&&s.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>N(!0),title:"Gerenciar grupo",children:s.jsx(c.Z,{className:"w-5 h-5"})})]})]}),s.jsx(E.q,{conversationId:e.id,conversationType:"group",currentUserId:a,onMessageClick:eu}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",ref:er,children:[0===m.length?s.jsx("div",{className:"h-full flex items-center justify-center text-center",children:(0,s.jsxs)("div",{children:[s.jsx(o.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma mensagem ainda"}),s.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Seja o primeiro a enviar uma mensagem!"})]})}):m.map((e,a)=>ef(e,a)),s.jsx("div",{ref:es})]}),!t&&s.jsx(x,{groupId:e.id,currentUserId:a}),t?s.jsx("div",{className:"px-4 py-3 border-t bg-gray-50 dark:bg-gray-900",children:s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Visualiza\xe7\xe3o do Super Admin: somente leitura (envio e “lido” desativados)."})}):(0,s.jsxs)("div",{className:"p-4 border-t space-y-3",children:[s.jsx(I.g,{onAttachmentsChange:F,maxFiles:5,maxSizeInMB:50}),(0,s.jsxs)("form",{onSubmit:ed,className:"flex items-start gap-2",children:[s.jsx(D.h,{onEmojiSelect:e=>{p(a=>a+e)}}),(0,s.jsxs)("div",{className:"relative flex-1",children:[s.jsx(n.II,{ref:W,value:g,onChange:e=>{p(e.target.value),e.target.value.length>0?el():ei(),requestAnimationFrame(()=>em())},onBlur:()=>{ei(),setTimeout(()=>X(!1),150)},onKeyUp:()=>em(),onClick:()=>em(),placeholder:"Digite uma mensagem... (use @ para mencionar)",disabled:y,className:"flex-1"}),K&&eo.length>0&&s.jsx("div",{className:"absolute left-0 right-0 bottom-full mb-2 z-50 rounded-lg border bg-white dark:bg-gray-900 shadow-lg overflow-hidden",children:s.jsx("div",{className:"max-h-56 overflow-y-auto",children:eo.map(e=>(0,s.jsxs)("button",{type:"button",onMouseDown:e=>e.preventDefault(),onClick:()=>ex(e),className:"w-full px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-gray-800",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.label}),e.email&&s.jsx("div",{className:"text-xs text-gray-500",children:e.email})]},e.userId))})})]}),s.jsx(i.z,{type:"submit",disabled:!g.trim()&&0===q.length||y,className:"bg-blue-600 hover:bg-blue-700",children:s.jsx(o.Z,{className:"w-5 h-5"})})]})]}),v&&s.jsx(k,{isOpen:v,onClose:()=>N(!1),groupId:e.id,groupName:e.name,groupDescription:e.description,currentUserId:a,isAdmin:w})]})}},30627:(e,a,t)=>{t.d(a,{c:()=>x});var s=t(10326),r=t(17577);t(2777);var l=t(38443),i=t(41190),n=t(91664),d=t(24061),c=t(39730),o=t(83855),m=t(88307);function x({onSelectGroup:e,selectedGroupId:a,currentUserId:t,adminView:x=!1,onCreateGroup:u}){let[h,g]=(0,r.useState)([]),[p,f]=(0,r.useState)(""),[j,y]=(0,r.useState)(!0),b=h.filter(e=>{if(!p)return!0;let a=p.toLowerCase();return e.name?.toLowerCase().includes(a)||e.description?.toLowerCase().includes(a)||e.last_message_preview?.toLowerCase().includes(a)}),v=e=>{if(!e)return"";let a=new Date(e),t=new Date().getTime()-a.getTime(),s=Math.floor(t/6e4),r=Math.floor(t/36e5),l=Math.floor(t/864e5);return s<1?"Agora":s<60?`${s}m`:r<24?`${r}h`:l<7?`${l}d`:a.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})},N=e=>{switch(e){case"general":default:return s.jsx(d.Z,{className:"w-5 h-5"});case"project":return s.jsx(c.Z,{className:"w-5 h-5"})}};return j?s.jsx("div",{className:"h-full flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900 border-r",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex-1",children:"Grupos"}),u&&s.jsx(n.z,{size:"sm",onClick:u,className:"bg-primary hover:bg-[#1260b5]",title:"Criar novo grupo",children:s.jsx(o.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx(m.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(i.II,{type:"text",placeholder:"Buscar grupos...",value:p,onChange:e=>f(e.target.value),className:"pl-10"})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:0===b.length?(0,s.jsxs)("div",{className:"p-8 text-center",children:[s.jsx(c.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-gray-500",children:p?"Nenhum grupo encontrado":"Nenhum grupo ainda"})]}):b.map(t=>s.jsx("button",{onClick:()=>e(t),className:`w-full p-4 border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-left ${a===t.id?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-primary":""}`,children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("div",{className:"relative flex-shrink-0",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white font-medium",children:N(t.type)}),t.unread_count&&t.unread_count>0&&s.jsx(l.C,{className:"absolute -top-1 -right-1 h-5 min-w-5 flex items-center justify-center p-0 bg-red-600 text-white text-xs",children:t.unread_count>9?"9+":t.unread_count})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("span",{className:`font-medium text-gray-900 dark:text-white truncate ${t.unread_count&&t.unread_count>0?"font-bold":""}`,children:t.name}),"general"===t.type&&s.jsx(l.C,{variant:"outline",className:"text-xs flex-shrink-0",children:"Geral"})]}),s.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:v(t.last_message_at)})]}),t.description&&s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mb-1",children:t.description}),t.last_message_preview&&s.jsx("p",{className:`text-sm text-gray-600 dark:text-gray-400 truncate ${t.unread_count&&t.unread_count>0?"font-semibold text-gray-900 dark:text-white":""}`,children:t.last_message_preview})]})]})},t.id))})]})}},47866:(e,a,t)=>{t.d(a,{g:()=>u});var s=t(10326),r=t(17577),l=t(2777),i=t(91664),n=t(59593),d=t(67427),c=t(84412),o=t(23781),m=t(37043);let x={like:{icon:n.Z,label:"Curtir",emoji:"\uD83D\uDC4D"},love:{icon:d.Z,label:"Amar",emoji:"❤️"},laugh:{icon:c.Z,label:"Rir",emoji:"\uD83D\uDE02"},wow:{icon:d.Z,label:"Uau",emoji:"\uD83D\uDE2E"},sad:{icon:o.Z,label:"Triste",emoji:"\uD83D\uDE22"},angry:{icon:m.Z,label:"Bravo",emoji:"\uD83D\uDE20"}};function u({messageId:e,messageType:a,currentUserId:t,compact:n=!1}){let[d,c]=(0,r.useState)([]),[o,m]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),[g,p]=(0,r.useState)(!1),f=async()=>{try{let{data:s,error:r}=await l.O.rpc("get_message_reactions",{p_message_id:e,p_message_type:a});if(r)throw r;c(s||[]);let i=(s||[]).find(e=>e.users.some(e=>e.user_id===t));h(i?.reaction_type||null)}catch(e){console.error("Erro ao carregar rea\xe7\xf5es:",e)}},j=async s=>{if(!g){p(!0);try{let{error:r}=await l.O.rpc("toggle_message_reaction",{p_message_id:e,p_message_type:a,p_user_id:t,p_reaction_type:s});if(r)throw r;m(!1),await f()}catch(e){console.error("Erro ao reagir:",e)}finally{p(!1)}}},y=d.reduce((e,a)=>e+a.count,0);return n?(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[d.slice(0,3).map(e=>{let a=x[e.reaction_type];return(0,s.jsxs)("button",{onClick:()=>j(e.reaction_type),className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-xs transition-colors",title:e.users.map(e=>e.full_name).join(", "),children:[s.jsx("span",{children:a.emoji}),s.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:e.count})]},e.reaction_type)}),y>0&&d.length>3&&(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["+",d.length-3]})]}):s.jsx("div",{className:"relative",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[d.length>0&&s.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:d.map(e=>{let a=x[e.reaction_type],r=e.users.some(e=>e.user_id===t);return(0,s.jsxs)("button",{onClick:()=>j(e.reaction_type),disabled:g,className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm transition-all ${r?"bg-amber-100 dark:bg-amber-900/30 border-2 border-primary":"bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700"}`,title:e.users.map(e=>e.full_name).join(", "),children:[s.jsx("span",{className:"text-base",children:a.emoji}),s.jsx("span",{className:`font-medium ${r?"text-amber-700 dark:text-amber-300":"text-gray-700 dark:text-gray-300"}`,children:e.count})]},e.reaction_type)})}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>m(!o),disabled:g,className:"h-7 px-2",title:"Adicionar rea\xe7\xe3o",children:s.jsx("span",{className:"text-lg",children:"➕"})}),o&&s.jsx("div",{className:"absolute bottom-full mb-2 left-0 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-50",children:s.jsx("div",{className:"flex items-center gap-1",children:Object.entries(x).map(([e,a])=>s.jsx("button",{onClick:()=>j(e),disabled:g,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:a.label,children:s.jsx("span",{className:"text-2xl",children:a.emoji})},e))})})]})]})})}},28194:(e,a,t)=>{t.d(a,{w:()=>g});var s=t(10326),r=t(17577),l=t(2777),i=t(91664),n=t(41190),d=t(88307),c=t(94019),o=t(69561),m=t(37358),x=t(79635),u=t(31540),h=t(24118);function g({conversationId:e,conversationType:a,onResultClick:t,participants:g=[]}){let[p,f]=(0,r.useState)(!1),[j,y]=(0,r.useState)(""),[b,v]=(0,r.useState)([]),[N,w]=(0,r.useState)(!1),[_,k]=(0,r.useState)(!1),[S,C]=(0,r.useState)(""),[I,z]=(0,r.useState)(""),[D,Z]=(0,r.useState)(""),$=async()=>{if(j.trim()){w(!0);try{let t={p_search_query:j};"group"===a?t.p_group_id=e:t.p_conversation_id=e,S&&(t.p_date_from=new Date(S).toISOString()),I&&(t.p_date_to=new Date(I).toISOString()),D&&(t.p_sender_id=D);let{data:s,error:r}=await l.O.rpc("group"===a?"search_group_messages":"search_direct_messages",t);if(r)throw r;v(s||[]),await l.O.from("message_search_history").insert({user_id:(await l.O.auth.getUser()).data.user?.id,search_query:j,search_filters:{dateFrom:S,dateTo:I,selectedSender:D},results_count:s?.length||0})}catch(e){console.error("Erro ao buscar:",e)}finally{w(!1)}}},E=async()=>{if(0===b.length)return;let e=new Blob([[["Data","Remetente","Mensagem"],...b.map(e=>[new Date(e.created_at).toLocaleString("pt-BR"),e.sender_name,e.body.replace(/"/g,'""')])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=`mensagens_${new Date().toISOString().split("T")[0]}.csv`,a.click()},O=(e,a)=>a?e.split(RegExp(`(${a})`,"gi")).map((e,t)=>e.toLowerCase()===a.toLowerCase()?s.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-800",children:e},t):e):e;return(0,s.jsxs)(s.Fragment,{children:[s.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>f(!0),title:"Buscar mensagens",children:s.jsx(d.Z,{className:"w-5 h-5"})}),s.jsx(h.Vq,{open:p,onOpenChange:f,children:s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Buscar Mensagens"}),s.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>f(!1),children:s.jsx(c.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"p-4 border-b space-y-3",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(n.II,{value:j,onChange:e=>y(e.target.value),onKeyDown:e=>"Enter"===e.key&&$(),placeholder:"Digite sua busca...",className:"flex-1"}),s.jsx(i.z,{onClick:$,disabled:N||!j.trim(),children:s.jsx(d.Z,{className:"w-5 h-5"})}),s.jsx(i.z,{variant:"outline",onClick:()=>k(!_),title:"Filtros",children:s.jsx(o.Z,{className:"w-5 h-5"})})]}),_&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(m.Z,{className:"w-3 h-3 inline mr-1"}),"Data Inicial"]}),s.jsx(n.II,{type:"date",value:S,onChange:e=>C(e.target.value),className:"text-sm"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(m.Z,{className:"w-3 h-3 inline mr-1"}),"Data Final"]}),s.jsx(n.II,{type:"date",value:I,onChange:e=>z(e.target.value),className:"text-sm"})]}),g.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(x.Z,{className:"w-3 h-3 inline mr-1"}),"Remetente"]}),(0,s.jsxs)("select",{value:D,onChange:e=>Z(e.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900",children:[s.jsx("option",{value:"",children:"Todos"}),g.map(e=>s.jsx("option",{value:e.id,children:e.full_name},e.id))]})]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:N?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===b.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[s.jsx(d.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-sm text-gray-500",children:j?"Nenhum resultado encontrado":"Digite algo para buscar"})]}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[b.length," resultado(s) encontrado(s)"]}),(0,s.jsxs)(i.z,{variant:"outline",size:"sm",onClick:E,title:"Exportar resultados",children:[s.jsx(u.Z,{className:"w-4 h-4 mr-1"}),"Exportar"]})]}),b.map(e=>(0,s.jsxs)("button",{onClick:()=>{t(e.id),f(!1)},className:"w-full text-left p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.sender_name}),s.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("pt-BR")})]}),s.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-2",children:O(e.body,j)})]},e.id))]})})]})})})]})}},96397:(e,a,t)=>{t.d(a,{y:()=>u});var s=t(10326),r=t(17577),l=t(2777),i=t(29752),n=t(91664),d=t(41190),c=t(38443),o=t(39730),m=t(94019),x=t(88307);function u({isOpen:e,onClose:a,onConversationCreated:t,currentUserId:u,filterType:h="all"}){let[g,p]=(0,r.useState)([]),[f,j]=(0,r.useState)(""),[y,b]=(0,r.useState)(!1),[v,N]=(0,r.useState)(""),w=g.filter(e=>{if(!f)return!0;let a=f.toLowerCase();return e.full_name.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)}),_=async e=>{b(!0);try{let a="client"===v||"client"===e.user_type,{data:s,error:r}=await l.O.rpc("get_or_create_direct_conversation",{p_user_id_1:u,p_user_id_2:e.id,p_is_client_conversation:a});if(r)throw r;t(s),k()}catch(e){console.error("Erro ao criar conversa:",e),alert("Erro ao criar conversa")}finally{b(!1)}},k=()=>{j(""),a()},S=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),C=e=>({super_admin:"Super Admin",admin:"Admin",client:"Cliente",video_maker:"Videomaker",web_designer:"Web Designer",graphic_designer:"Designer Gr\xe1fico",social_media:"Social Media",traffic_manager:"Tr\xe1fego",marketing_head:"Head Marketing",financial:"Financeiro",hr:"RH",commercial:"Comercial"})[e]||e;return e?s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(i.Zb,{className:"w-full max-w-2xl max-h-[90vh] flex flex-col",children:[s.jsx(i.Ol,{className:"flex-shrink-0 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(i.ll,{className:"flex items-center gap-2",children:[s.jsx(o.Z,{className:"w-5 h-5"}),"clients"===h?"Nova Conversa com Cliente":"team"===h?"Nova Conversa com Equipe":"Nova Conversa"]}),s.jsx(n.z,{variant:"ghost",size:"sm",onClick:k,children:s.jsx(m.Z,{className:"w-5 h-5"})})]})}),(0,s.jsxs)(i.aY,{className:"flex-1 overflow-hidden p-0",children:[s.jsx("div",{className:"p-4 border-b",children:(0,s.jsxs)("div",{className:"relative",children:[s.jsx(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx(d.II,{type:"text",placeholder:"Buscar por nome ou email...",value:f,onChange:e=>j(e.target.value),className:"pl-10"})]})}),s.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:0===w.length?s.jsx("div",{className:"p-8 text-center",children:s.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum usu\xe1rio encontrado"})}):w.map(e=>s.jsx("button",{onClick:()=>_(e),disabled:y,className:"w-full p-4 border-b hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[e.avatar_url?s.jsx("img",{src:e.avatar_url,alt:"",className:"w-12 h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-white font-medium",children:S(e.full_name)}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:e.full_name}),"client"===e.user_type&&s.jsx(c.C,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Cliente"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:e.email}),s.jsx("p",{className:"text-xs text-gray-400",children:C(e.user_type)})]}),s.jsx(o.Z,{className:"w-5 h-5 text-gray-400"})]})},e.id))})]})]})}):null}t(43931)},55786:(e,a,t)=>{t.d(a,{s:()=>o});var s=t(10326),r=t(17577),l=t(2777),i=t(91664),n=t(41190),d=t(81466),c=t(24118);function o({messageId:e,messageType:a,conversationId:t,currentUserId:o,compact:m=!1}){let[x,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),j=async()=>{f(!0);try{let{error:s}=await l.O.from("pinned_messages").insert({message_id:e,message_type:a,conversation_id:t,pinned_by:o,note:h.trim()||null});if(s){if("23505"===s.code)alert("Esta mensagem j\xe1 est\xe1 fixada!");else throw s}else u(!1),g("")}catch(e){console.error("Erro ao fixar mensagem:",e),alert("Erro ao fixar mensagem")}finally{f(!1)}};return(0,s.jsxs)(s.Fragment,{children:[s.jsx(i.z,{variant:"ghost",size:m?"sm":"default",onClick:()=>u(!0),className:m?"h-6 w-6 p-0":"",title:"Fixar mensagem",children:s.jsx(d.Z,{className:m?"w-3 h-3":"w-4 h-4"})}),s.jsx(c.Vq,{open:x,onOpenChange:u,children:s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Fixar Mensagem"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nota (opcional)"}),s.jsx(n.II,{value:h,onChange:e=>g(e.target.value),placeholder:"Adicione uma nota explicativa...",maxLength:200}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[h.length,"/200 caracteres"]})]}),(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[s.jsx(i.z,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),s.jsx(i.z,{onClick:j,disabled:p,children:p?"Fixando...":"Fixar"})]})]})]})})})]})}},9428:(e,a,t)=>{t.d(a,{q:()=>c});var s=t(10326),r=t(17577),l=t(2777),i=t(91664),n=t(81466),d=t(94019);function c({conversationId:e,conversationType:a,currentUserId:t,onMessageClick:c}){let[o,m]=(0,r.useState)([]),[x,u]=(0,r.useState)(!0),[h,g]=(0,r.useState)(!1),p=async e=>{try{let{error:a}=await l.O.from("pinned_messages").delete().eq("id",e);if(a)throw a}catch(e){console.error("Erro ao desfixar mensagem:",e)}};return 0===o.length?null:s.jsx("div",{className:"border-b bg-blue-50 dark:bg-blue-900/20",children:(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("button",{onClick:()=>u(!x),className:"w-full flex items-center justify-between text-sm font-medium text-amber-800 dark:text-amber-200 hover:text-amber-900 dark:hover:text-amber-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(n.Z,{className:"w-4 h-4"}),(0,s.jsxs)("span",{children:[o.length," mensagem",1!==o.length?"s":""," fixada",1!==o.length?"s":""]})]}),s.jsx("span",{className:"text-xs",children:x?"▼":"▶"})]}),x&&s.jsx("div",{className:"mt-3 space-y-2",children:o.map(e=>s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("button",{onClick:()=>c(e.message_id),className:"flex-1 text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-xs font-medium text-gray-900 dark:text-white",children:e.sender_name}),s.jsx("span",{className:"text-xs text-gray-500",children:e.message_created_at&&new Date(e.message_created_at).toLocaleDateString("pt-BR")})]}),s.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-2",children:e.message_body}),e.note&&(0,s.jsxs)("p",{className:"text-xs text-blue-600 dark:text-amber-400 mt-1 italic",children:["Nota: ",e.note]})]}),h&&s.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>p(e.id),className:"h-6 w-6 p-0",title:"Desfixar mensagem",children:s.jsx(d.Z,{className:"w-4 h-4"})})]})},e.id))})]})})}t(43931)},8993:(e,a,t)=>{t.d(a,{n:()=>l});var s=t(10326),r=t(17577);function l({userId:e,showLabel:a=!1,size:t="sm"}){let[l,i]=(0,r.useState)("offline"),[n,d]=(0,r.useState)(""),c=()=>{switch(l){case"online":return"bg-green-500";case"away":return"bg-yellow-500";default:return"bg-gray-400"}},o=()=>{switch(l){case"online":return"Online";case"away":return"Ausente";default:return m()}},m=()=>{if(!n)return"Offline";let e=new Date(n),a=new Date().getTime()-e.getTime(),t=Math.floor(a/6e4),s=Math.floor(a/36e5),r=Math.floor(a/864e5);return t<1?"Agora mesmo":t<60?`Visto h\xe1 ${t}m`:s<24?`Visto h\xe1 ${s}h`:r<7?`Visto h\xe1 ${r}d`:"Offline"},x={sm:"w-2 h-2",md:"w-3 h-3",lg:"w-4 h-4"};return a?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`${x[t]} ${c()} rounded-full`}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:o()})]}):s.jsx("div",{className:`${x[t]} ${c()} rounded-full border-2 border-white dark:border-gray-800`,title:o()})}t(2777)},29752:(e,a,t)=>{t.d(a,{Ol:()=>n,SZ:()=>c,Zb:()=>i,aY:()=>o,ll:()=>d});var s=t(10326),r=t(17577),l=t(51223);let i=r.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:(0,l.cn)("rounded-xl border-2 border-valle-silver-200 bg-white shadow-md",e),...a}));i.displayName="Card";let n=r.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",e),...a}));n.displayName="CardHeader";let d=r.forwardRef(({className:e,...a},t)=>s.jsx("h3",{ref:t,className:(0,l.cn)("font-semibold leading-none tracking-tight text-lg",e),...a}));d.displayName="CardTitle";let c=r.forwardRef(({className:e,...a},t)=>s.jsx("p",{ref:t,className:(0,l.cn)("text-sm text-foreground/70",e),...a}));c.displayName="CardDescription";let o=r.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:(0,l.cn)("p-6 pt-0",e),...a}));o.displayName="CardContent",r.forwardRef(({className:e,...a},t)=>s.jsx("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter"},24118:(e,a,t)=>{t.d(a,{$N:()=>d,Be:()=>c,Vq:()=>l,a7:()=>o,cN:()=>m,cZ:()=>i,fK:()=>n});var s=t(10326),r=t(94019);function l({open:e,onOpenChange:a,children:t}){return e?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>a(!1)}),s.jsx("div",{className:"relative z-50 w-full max-w-4xl max-h-[90vh] overflow-y-auto mx-4",children:t})]}):null}function i({children:e,onClose:a,className:t}){return(0,s.jsxs)("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-xl border border-gray-200 dark:border-gray-800 ${t||""}`,children:[a&&s.jsx("button",{onClick:a,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:s.jsx(r.Z,{className:"w-5 h-5"})}),e]})}function n({children:e}){return s.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-800",children:e})}function d({children:e}){return s.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e})}function c({children:e}){return s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:e})}function o({children:e}){return s.jsx("div",{className:"px-6 py-4",children:e})}function m({children:e,className:a}){return s.jsx("div",{className:`px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex items-center justify-end gap-3 ${a||""}`,children:e})}t(17577)},5314:(e,a,t)=>{t.d(a,{r:()=>r});var s=t(17577);function r(){let e=(0,s.useRef)(null),a=(0,s.useRef)(null);return{playNotificationSound:(t=!1)=>{let s=t?a.current:e.current;s&&(s.currentTime=0,t&&(s.playbackRate=1.1),s.play().catch(e=>{console.log("N\xe3o foi poss\xedvel reproduzir o som:",e)}))}}}},40877:(e,a,t)=>{t.d(a,{o:()=>l});var s=t(17577),r=t(2777);function l({userId:e,groupId:a}={}){(0,s.useRef)(void 0);let t=(0,s.useRef)(!1),l=(0,s.useRef)(void 0),i=async()=>{if(e&&a&&t.current){t.current=!1,l.current&&clearTimeout(l.current);try{await r.O.from("typing_indicators").delete().eq("group_id",a).eq("user_id",e)}catch(e){console.error("Erro ao remover indicador:",e)}}};return{startTyping:async()=>{if(e&&a){if(l.current&&clearTimeout(l.current),!t.current){t.current=!0;try{await r.O.rpc("upsert_typing_indicator",{p_group_id:a,p_user_id:e})}catch(e){console.error("Erro ao registrar digita\xe7\xe3o:",e)}}l.current=setTimeout(()=>{i()},3e3)}},stopTyping:i,updatePresence:async t=>{if(e)try{await r.O.rpc("update_user_presence",{p_user_id:e,p_status:t,p_group_id:a||null})}catch(e){console.error("Erro ao atualizar presen\xe7a:",e)}}}}},51478:(e,a,t)=>{t.d(a,{CE:()=>i,MN:()=>r,XI:()=>l});let s=/@\{([0-9a-fA-F-]{36})\}/g;function r(e){return Array.from(new Set((function(e){let a;let t=String(e||""),r=[];for(;a=s.exec(t);){let e=a[1];r.push({userId:e,raw:a[0],index:a.index})}return r})(e).map(e=>e.userId)))}function l(e,a){let t=String(e||""),s=Math.max(0,Math.min(t.length,a)),r=t.slice(0,s),l=r.lastIndexOf("@");if(l<0)return{active:!1};let i=r.slice(l+1);if(/\s/.test(i)||i.startsWith("{"))return{active:!1};let n=l>0?r[l-1]:"";return n&&/[0-9a-zA-Z._%+-]/.test(n)?{active:!1}:{active:!0,startIndex:l,endIndex:s,query:i}}function i(e){let{value:a,startIndex:t,endIndex:s,userId:r}=e,l=!1!==e.trailingSpace,i=a.slice(0,t),n=a.slice(s),d=`@{${r}}`,c=l?`${d} `:d;return{nextValue:`${i}${c}${n}`,nextCaretIndex:(i+c).length}}},51858:(e,a,t)=>{t.d(a,{d:()=>n});var s=t(10326),r=t(17577),l=t.n(r);let i=/@\{([0-9a-fA-F-]{36})\}/g;function n({text:e,profilesById:a,highlightUserId:t,className:r}){let n;let d=String(e||""),c=[],o=0;for(;n=i.exec(d);){let e=n.index,a=e+n[0].length;e>o&&c.push({type:"text",value:d.slice(o,e),key:`t-${o}`}),c.push({type:"mention",userId:n[1],key:`m-${e}`}),o=a}return o<d.length&&c.push({type:"text",value:d.slice(o),key:`t-${o}`}),s.jsx("span",{className:r,children:c.map(e=>{if("text"===e.type)return s.jsx(l().Fragment,{children:e.value},e.key);let r=a?.get(e.userId),i=r?.full_name||"Usu\xe1rio",n=t&&e.userId===t;return(0,s.jsxs)("span",{className:["inline-flex items-center rounded-md px-1.5 py-0.5 mx-0.5",n?"bg-yellow-200/80 text-yellow-900 dark:bg-yellow-400/20 dark:text-yellow-200":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-200"].join(" "),"data-mention-user-id":e.userId,title:r?.email||void 0,children:["@",i]},e.key)})})}},8130:(e,a,t)=>{t.d(a,{X:()=>s});function s(e,a){let t=String(a||"").trim().toLowerCase();return t?e.map(e=>{let a=String(e.label||"").toLowerCase(),s=String(e.email||"").toLowerCase();return{c:e,score:(a.startsWith(t)||s.startsWith(t)?2:0)+(a.includes(t)||s.includes(t)?1:0)}}).filter(e=>e.score>0).sort((e,a)=>a.score-e.score||e.c.label.localeCompare(a.c.label)).slice(0,8).map(e=>e.c):e.slice(0,8)}},54734:(e,a,t)=>{function s(e){e.content&&!(e.content.trim().length<10)&&fetch("/api/ai/analyze-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(e=>{console.debug("[SilentAnalysis] Erro (ignorado):",e)})}t.d(a,{tC:()=>s})},43931:(e,a,t)=>{function s(e,a){return{user_id:a,full_name:String(e.full_name||"Usu\xe1rio"),email:e.email?String(e.email):void 0,avatar_url:e.avatar_url?String(e.avatar_url):e.avatar?String(e.avatar):void 0,user_type:e.user_type?String(e.user_type):e.role?String(e.role):void 0}}async function r(e,a,t){try{let{data:s,error:r}=await e.from("user_profiles").select("id"===a?"id, full_name, email, avatar_url, avatar, user_type, role":"user_id, full_name, email, avatar_url, avatar, user_type, role").in(a,t);if(r)return[];return s||[]}catch{return[]}}async function l(e,a){let t=Array.from(new Set((a||[]).filter(Boolean))),l=new Map;if(0===t.length)return l;for(let a of(await r(e,"id",t))){let e=a?.id?String(a.id):null;e&&l.set(e,s(a,e))}for(let a of(await r(e,"user_id",t))){let e=a?.user_id?String(a.user_id):null;e&&l.set(e,s(a,e))}return l}async function i(e,a){return a&&(await l(e,[a])).get(a)||null}t.d(a,{T:()=>i,m:()=>l})}};