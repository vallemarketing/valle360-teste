(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5309],{26776:function(e,r,a){Promise.resolve().then(a.bind(a,58205))},58205:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return N}});var s=a(57437),t=a(2265),l=a(57586),i=a(26892),o=a(33245),c=a(76865),n=a(99388),d=a(88906),m=a(82431),u=a(92735),x=a(73247),p=a(3577),y=a(40875),v=a(10407),h=a(41671),g=a(92369),j=a(91723);let w=[{id:"1",timestamp:new Date(Date.now()-3e5),action:"auth.login",severity:"info",userId:"user-1",userEmail:"joao@valle360.com",userName:"Jo\xe3o Silva",userRole:"colaborador",description:"Login bem-sucedido: joao@valle360.com",ipAddress:"192.168.1.100",success:!0},{id:"2",timestamp:new Date(Date.now()-9e5),action:"task.created",severity:"info",userId:"user-2",userEmail:"maria@valle360.com",userName:"Maria Santos",userRole:"head",targetType:"task",targetId:"task-123",targetName:"Banner Cliente X",description:"Tarefa criada: Banner Cliente X",success:!0},{id:"3",timestamp:new Date(Date.now()-18e5),action:"auth.login_failed",severity:"warning",userEmail:"hacker@evil.com",description:"Tentativa de login falhou: hacker@evil.com",metadata:{reason:"Credenciais inv\xe1lidas"},ipAddress:"45.67.89.123",success:!1,errorMessage:"Credenciais inv\xe1lidas"},{id:"4",timestamp:new Date(Date.now()-27e5),action:"security.rate_limit_exceeded",severity:"warning",description:"Rate limit excedido: /api/login",metadata:{endpoint:"/api/login",attempts:10},ipAddress:"45.67.89.123",success:!1},{id:"5",timestamp:new Date(Date.now()-36e5),action:"payment.received",severity:"info",userId:"user-3",userEmail:"admin@valle360.com",userName:"Admin",userRole:"admin",targetType:"client",targetId:"client-456",targetName:"Tech Corp",description:"Pagamento recebido: R$ 5.000,00 de Tech Corp",metadata:{amount:5e5},success:!0},{id:"6",timestamp:new Date(Date.now()-54e5),action:"user.role_changed",severity:"warning",userId:"user-3",userEmail:"admin@valle360.com",userName:"Admin",userRole:"admin",targetType:"user",targetId:"user-1",targetName:"Jo\xe3o Silva",description:"Role alterada: Jo\xe3o Silva de colaborador para head",metadata:{oldRole:"colaborador",newRole:"head"},success:!0},{id:"7",timestamp:new Date(Date.now()-72e5),action:"system.error",severity:"error",description:"Erro ao processar pagamento",metadata:{error:"Gateway timeout",paymentId:"pay-789"},success:!1,errorMessage:"Gateway timeout"},{id:"8",timestamp:new Date(Date.now()-108e5),action:"security.suspicious_activity",severity:"critical",description:"M\xfaltiplas tentativas de login de IP suspeito",metadata:{attempts:50,timeWindow:"5 minutos"},ipAddress:"123.45.67.89",success:!1}];function f(){let[e,r]=(0,t.useState)(w),[a,f]=(0,t.useState)(w),[N,b]=(0,t.useState)(""),[C,k]=(0,t.useState)("all"),[E,D]=(0,t.useState)(null),[S,I]=(0,t.useState)(!1),T=async()=>{try{I(!0);let e=await fetch("/api/admin/audit-logs?limit=300"),a=await e.json().catch(()=>null);if(!e.ok)throw Error((null==a?void 0:a.error)||"Falha ao carregar logs [".concat(e.status,"]"));let s=((null==a?void 0:a.logs)||[]).map(e=>({...e,timestamp:new Date(e.timestamp)}));Array.isArray(s)&&s.length>0?r(s):r(w)}catch(e){r(w)}finally{I(!1)}};(0,t.useEffect)(()=>{let r=e;N&&(r=r.filter(e=>{var r,a;return e.description.toLowerCase().includes(N.toLowerCase())||e.action.toLowerCase().includes(N.toLowerCase())||(null===(r=e.userEmail)||void 0===r?void 0:r.toLowerCase().includes(N.toLowerCase()))||(null===(a=e.userName)||void 0===a?void 0:a.toLowerCase().includes(N.toLowerCase()))})),"all"!==C&&(r=r.filter(e=>e.severity===C)),f(r)},[e,N,C]);let Z=e=>{switch(e){case"info":return(0,s.jsx)(o.Z,{className:"w-4 h-4",style:{color:"var(--info-500)"}});case"warning":return(0,s.jsx)(c.Z,{className:"w-4 h-4",style:{color:"var(--warning-500)"}});case"error":return(0,s.jsx)(n.Z,{className:"w-4 h-4",style:{color:"var(--error-500)"}});case"critical":return(0,s.jsx)(d.Z,{className:"w-4 h-4",style:{color:"var(--error-600)"}});default:return(0,s.jsx)(o.Z,{className:"w-4 h-4"})}},A=e=>{switch(e){case"info":return"var(--info-100)";case"warning":return"var(--warning-100)";case"error":return"var(--error-100)";case"critical":return"var(--error-200)";default:return"var(--bg-secondary)"}},R=e=>{let r=new Date().getTime()-e.getTime(),a=Math.floor(r/6e4),s=Math.floor(r/36e5);return a<1?"Agora":a<60?"".concat(a,"m atr\xe1s"):s<24?"".concat(s,"h atr\xe1s"):e.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})},L=async()=>{await T()};return(0,t.useEffect)(()=>{T()},[]),(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[(0,s.jsx)(d.Z,{className:"w-7 h-7",style:{color:"var(--primary-500)"}}),"Logs de Auditoria"]}),(0,s.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Monitoramento de atividades e seguran\xe7a do sistema"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{onClick:L,disabled:S,className:"flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"},children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 ".concat(S?"animate-spin":"")}),"Atualizar"]}),(0,s.jsxs)("button",{onClick:()=>{let e=new Blob([[["Timestamp","A\xe7\xe3o","Severidade","Usu\xe1rio","Descri\xe7\xe3o","IP","Sucesso"],...a.map(e=>[e.timestamp.toISOString(),e.action,e.severity,e.userEmail||"-",e.description,e.ipAddress||"-",e.success?"Sim":"N\xe3o"])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download="audit-logs-".concat(new Date().toISOString().split("T")[0],".csv"),s.click()},className:"flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all",style:{backgroundColor:"var(--primary-500)",color:"white"},children:[(0,s.jsx)(u.Z,{className:"w-4 h-4"}),"Exportar CSV"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 p-4 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(x.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"var(--text-tertiary)"}}),(0,s.jsx)("input",{type:"text",placeholder:"Buscar por a\xe7\xe3o, usu\xe1rio, descri\xe7\xe3o...",value:N,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-xl",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-light)"}})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5",style:{color:"var(--text-tertiary)"}}),(0,s.jsxs)("select",{value:C,onChange:e=>k(e.target.value),className:"px-4 py-2 rounded-xl",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",border:"1px solid var(--border-light)"},children:[(0,s.jsx)("option",{value:"all",children:"Todas severidades"}),(0,s.jsx)("option",{value:"info",children:"Info"}),(0,s.jsx)("option",{value:"warning",children:"Warning"}),(0,s.jsx)("option",{value:"error",children:"Error"}),(0,s.jsx)("option",{value:"critical",children:"Critical"})]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total",value:e.length,color:"var(--primary-500)"},{label:"Info",value:e.filter(e=>"info"===e.severity).length,color:"var(--info-500)"},{label:"Warnings",value:e.filter(e=>"warning"===e.severity).length,color:"var(--warning-500)"},{label:"Erros",value:e.filter(e=>"error"===e.severity||"critical"===e.severity).length,color:"var(--error-500)"}].map((e,r)=>(0,s.jsxs)("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,s.jsx)("p",{className:"text-sm",style:{color:"var(--text-tertiary)"},children:e.label}),(0,s.jsx)("p",{className:"text-2xl font-bold",style:{color:e.color},children:e.value})]},r))}),(0,s.jsxs)("div",{className:"rounded-xl overflow-hidden",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-light)"},children:[(0,s.jsx)(l.M,{children:a.map((e,r)=>(0,s.jsxs)(i.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.05*r},className:"border-b last:border-b-0",style:{borderColor:"var(--border-light)"},children:[(0,s.jsx)("div",{className:"p-4 cursor-pointer hover:bg-opacity-50 transition-colors",style:{backgroundColor:E===e.id?A(e.severity):"transparent"},onClick:()=>D(E===e.id?null:e.id),children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{children:E===e.id?(0,s.jsx)(y.Z,{className:"w-5 h-5",style:{color:"var(--text-tertiary)"}}):(0,s.jsx)(v.Z,{className:"w-5 h-5",style:{color:"var(--text-tertiary)"}})}),(0,s.jsx)("div",{className:"p-2 rounded-lg",style:{backgroundColor:A(e.severity)},children:Z(e.severity)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",style:{color:"var(--text-primary)"},children:e.action}),e.success?(0,s.jsx)(h.Z,{className:"w-4 h-4",style:{color:"var(--success-500)"}}):(0,s.jsx)(n.Z,{className:"w-4 h-4",style:{color:"var(--error-500)"}})]}),(0,s.jsx)("p",{className:"text-sm truncate",style:{color:"var(--text-secondary)"},children:e.description})]}),e.userName&&(0,s.jsxs)("div",{className:"hidden md:flex items-center gap-2",children:[(0,s.jsx)(g.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,s.jsx)("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:e.userName})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,s.jsx)("span",{className:"text-sm whitespace-nowrap",style:{color:"var(--text-tertiary)"},children:R(e.timestamp)})]})]})}),(0,s.jsx)(l.M,{children:E===e.id&&(0,s.jsx)(i.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:(0,s.jsxs)("div",{className:"p-4 pt-0 grid grid-cols-1 md:grid-cols-2 gap-4",style:{backgroundColor:A(e.severity)},children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:"Detalhes"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{style:{color:"var(--text-tertiary)"},children:"ID:"})," ",(0,s.jsx)("span",{style:{color:"var(--text-secondary)"},children:e.id})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{style:{color:"var(--text-tertiary)"},children:"Timestamp:"})," ",(0,s.jsx)("span",{style:{color:"var(--text-secondary)"},children:e.timestamp.toISOString()})]}),e.userEmail&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{style:{color:"var(--text-tertiary)"},children:"Email:"})," ",(0,s.jsx)("span",{style:{color:"var(--text-secondary)"},children:e.userEmail})]}),e.userRole&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{style:{color:"var(--text-tertiary)"},children:"Role:"})," ",(0,s.jsx)("span",{style:{color:"var(--text-secondary)"},children:e.userRole})]}),e.ipAddress&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{style:{color:"var(--text-tertiary)"},children:"IP:"})," ",(0,s.jsx)("span",{style:{color:"var(--text-secondary)"},children:e.ipAddress})]}),e.targetType&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{style:{color:"var(--text-tertiary)"},children:"Target:"})," ",(0,s.jsxs)("span",{style:{color:"var(--text-secondary)"},children:[e.targetType," - ",e.targetName]})]})]})]}),e.metadata&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:"Metadata"}),(0,s.jsx)("pre",{className:"text-xs p-3 rounded-lg overflow-auto max-h-40",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-secondary)"},children:JSON.stringify(e.metadata,null,2)})]}),e.errorMessage&&(0,s.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,s.jsx)("h4",{className:"font-medium text-sm",style:{color:"var(--error-600)"},children:"Mensagem de Erro"}),(0,s.jsx)("p",{className:"text-sm p-3 rounded-lg",style:{backgroundColor:"var(--error-100)",color:"var(--error-700)"},children:e.errorMessage})]})]})})})]},e.id))}),0===a.length&&(0,s.jsxs)("div",{className:"p-12 text-center",children:[(0,s.jsx)(d.Z,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--text-tertiary)"}}),(0,s.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Nenhum log encontrado"})]})]})]})}function N(){return(0,s.jsx)(f,{})}}},function(e){e.O(0,[2882,2934,2971,2117,1744],function(){return e(e.s=26776)}),_N_E=e.O()}]);