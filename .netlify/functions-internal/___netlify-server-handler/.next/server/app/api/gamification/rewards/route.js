"use strict";(()=>{var e={};e.id=7606,e.ids=[7606],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29040:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>j,patchFetch:()=>b,requestAsyncStorage:()=>y,routeModule:()=>_,serverHooks:()=>v,staticGenerationAsyncStorage:()=>f});var s={};a.r(s),a.d(s,{GET:()=>m,PATCH:()=>w,POST:()=>g,dynamic:()=>c});var t=a(49303),o=a(88716),n=a(60670),i=a(87070),d=a(54128),p=a(29317);let c="force-dynamic",u="https://ikjgsqtykkhqimypacro.supabase.co",l=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";async function m(e){let r=(0,d.eI)(u,l);try{let{searchParams:a}=new URL(e.url),s=a.get("employeeId"),t=a.get("status"),o="true"===a.get("forRH"),n=r.from("employee_rewards").select(`
        *,
        employee:employees!employee_id(id, full_name, email, avatar),
        approver:employees!approved_by(id, full_name)
      `).order("requested_at",{ascending:!1});o?n=n.eq("status","pending"):s&&(n=n.eq("employee_id",s)),t&&!o&&(n=n.eq("status",t));let{data:d,error:p}=await n;if(p)throw p;return i.NextResponse.json({success:!0,rewards:d||[]})}catch(e){return console.error("Erro ao buscar recompensas:",e),i.NextResponse.json({success:!1,error:e.message},{status:500})}}async function g(e){let r=(0,d.eI)(u,l);try{let a=await e.json(),{action:s,employeeId:t,badgeId:o,rewardType:n,rewardValue:d,rewardDescription:c}=a;if("grant_badge"===s){let e=p.Er.find(e=>e.id===o);if(!e)return i.NextResponse.json({success:!1,error:"Badge n\xe3o encontrada"},{status:400});let{data:a}=await r.from("employee_badges").select("id").eq("employee_id",t).eq("badge_id",o).single();if(a)return i.NextResponse.json({success:!1,error:"Colaborador j\xe1 possui esta badge"},{status:400});let{error:s}=await r.from("employee_badges").insert({employee_id:t,badge_id:e.id,badge_name:e.name,badge_category:e.category,badge_rarity:e.rarity,points_awarded:e.pointsAwarded});if(s)throw s;let n=e.rewards.map(r=>({employee_id:t,badge_id:e.id,badge_name:e.name,reward_type:r.type,reward_value:String(r.value),reward_description:r.description,status:r.requiresHRApproval?"pending":"approved",expires_at:"time_off"===r.type?new Date(Date.now()+7776e6).toISOString():null})),{error:d}=await r.from("employee_rewards").insert(n);if(d)throw d;return i.NextResponse.json({success:!0,message:`Badge "${e.name}" concedida com sucesso!`,badge:e,rewardsCreated:n.length})}if("request_reward"===s){let{error:e}=await r.from("employee_rewards").insert({employee_id:t,badge_id:o,badge_name:a.badgeName||"Recompensa Manual",reward_type:n,reward_value:String(d),reward_description:c,status:"pending"});if(e)throw e;return i.NextResponse.json({success:!0,message:"Solicita\xe7\xe3o de recompensa enviada para aprova\xe7\xe3o"})}return i.NextResponse.json({success:!1,error:"A\xe7\xe3o inv\xe1lida"},{status:400})}catch(e){return console.error("Erro ao processar recompensa:",e),i.NextResponse.json({success:!1,error:e.message},{status:500})}}async function w(e){let r=(0,d.eI)(u,l);try{let{rewardId:a,action:s,approvedBy:t,rejectedReason:o}=await e.json();if(!a||!s)return i.NextResponse.json({success:!1,error:"rewardId e action s\xe3o obrigat\xf3rios"},{status:400});let n={};switch(s){case"approve":n={status:"approved",approved_by:t,approved_at:new Date().toISOString()};break;case"reject":n={status:"rejected",approved_by:t,approved_at:new Date().toISOString(),rejected_reason:o||"N\xe3o aprovado pelo RH"};break;case"redeem":n={status:"redeemed",redeemed_at:new Date().toISOString()};break;default:return i.NextResponse.json({success:!1,error:"A\xe7\xe3o inv\xe1lida. Use: approve, reject ou redeem"},{status:400})}let{data:d,error:p}=await r.from("employee_rewards").update(n).eq("id",a).select().single();if(p)throw p;return i.NextResponse.json({success:!0,message:`Recompensa ${"approve"===s?"aprovada":"reject"===s?"rejeitada":"resgatada"} com sucesso`,reward:d})}catch(e){return console.error("Erro ao atualizar recompensa:",e),i.NextResponse.json({success:!1,error:e.message},{status:500})}}let _=new t.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/gamification/rewards/route",pathname:"/api/gamification/rewards",filename:"route",bundlePath:"app/api/gamification/rewards/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\gamification\\rewards\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:v}=_,j="/api/gamification/rewards/route";function b(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:f})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),s=r.X(0,[89276,55972,54128,64394],()=>a(29040));module.exports=s})();