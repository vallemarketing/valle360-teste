"use strict";(()=>{var e={};e.id=61240,e.ids=[61240],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},83522:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>q,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>l,dynamic:()=>p});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),u=r(20344),d=r(71615),c=r(96181);let p="force-dynamic";function x(e){let t=String(e||"").trim();if(t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(String(t||"")))return t;try{return crypto.randomUUID()}catch{return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}async function l(e){try{let t=(0,d.cookies)(),r=(0,u.createRouteHandlerClient)({cookies:()=>t}),{data:{user:s},error:a}=await r.auth.getUser();if(a||!s)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:n}=await r.rpc("is_admin");if(!n)return i.NextResponse.json({error:"Acesso negado (admin)"},{status:403});let{text:o,texts:p,source_type:l="feedback",source_id:m,client_id:f,provider:g,queue:y=!1,priority:q=0}=await e.json();if(!o&&(!p||!Array.isArray(p)))return i.NextResponse.json({error:"Texto \xe9 obrigat\xf3rio (text para \xfanico ou texts para batch)"},{status:400});if(p&&Array.isArray(p)){let e=[];for(let t of p){let r="string"==typeof t?t:t.text,a="string"==typeof t?x():x(t.id);if(y){let t=await (0,c.dT)(l,a,r,{clientId:f,userId:s.id,priority:q});e.push({id:a,queued:!0,queue_id:t})}else{let t=await (0,c.nJ)(l,a,r,{clientId:f,userId:s.id,provider:g});e.push(t)}}return i.NextResponse.json({success:!0,batch:!0,count:e.length,results:e})}let h=x(m);if(y){let e=await (0,c.dT)(l,h,o,{clientId:f,userId:s.id,priority:q});return i.NextResponse.json({success:!0,queued:!0,queue_id:e,message:"Texto adicionado \xe0 fila de processamento"})}let j=await (0,c.nJ)(l,h,o,{clientId:f,userId:s.id,provider:g});if(!j)return i.NextResponse.json({error:"Erro ao processar an\xe1lise"},{status:500});return i.NextResponse.json({success:!0,result:j})}catch(e){return console.error("Erro na API de sentimento:",e),i.NextResponse.json({error:"Erro interno",details:e.message},{status:500})}}async function m(e){try{let t=(0,d.cookies)(),r=(0,u.createRouteHandlerClient)({cookies:()=>t}),{data:{user:s},error:a}=await r.auth.getUser();if(a||!s)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:n}=await r.rpc("is_admin");if(!n)return i.NextResponse.json({error:"Acesso negado (admin)"},{status:403});let{searchParams:o}=new URL(e.url),c=o.get("client_id"),p=o.get("source_type"),x=o.get("sentiment"),l=o.get("start_date"),m=o.get("end_date"),f=parseInt(o.get("limit")||"50"),g=parseInt(o.get("offset")||"0"),y=r.from("sentiment_analyses").select("*",{count:"exact"}).order("analyzed_at",{ascending:!1}).range(g,g+f-1);c&&(y=y.eq("client_id",c)),p&&(y=y.eq("source_type",p)),x&&(y=y.eq("overall_sentiment",x)),l&&(y=y.gte("analyzed_at",l)),m&&(y=y.lte("analyzed_at",m));let{data:q,error:h,count:j}=await y;if(h)throw h;return i.NextResponse.json({success:!0,data:q,pagination:{total:j,limit:f,offset:g,has_more:!!j&&g+f<j}})}catch(e){return console.error("Erro ao buscar an\xe1lises:",e),i.NextResponse.json({error:"Erro interno",details:e.message},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/sentiment/analyze/route",pathname:"/api/sentiment/analyze",filename:"route",bundlePath:"app/api/sentiment/analyze/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\sentiment\\analyze\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:q}=f,h="/api/sentiment/analyze/route";function j(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:y})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,54214,68546,96181],()=>r(83522));module.exports=s})();