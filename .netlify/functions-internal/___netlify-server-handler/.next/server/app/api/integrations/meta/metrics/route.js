"use strict";(()=>{var e={};e.id=48182,e.ids=[48182],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},4988:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>g,serverHooks:()=>_,staticGenerationAsyncStorage:()=>h});var a={};s.r(a),s.d(a,{GET:()=>l,dynamic:()=>m});var r=s(49303),i=s(88716),n=s(60670),o=s(87070),c=s(20344),d=s(71615),u=s(22887);let m="force-dynamic";async function l(e){try{let t;let s=(0,d.cookies)(),a=(0,c.createRouteHandlerClient)({cookies:()=>s}),{data:{user:r},error:i}=await a.auth.getUser();if(i||!r)return o.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:n,error:m}=await a.from("integration_configs").select("*").eq("integration_id","meta_ads").single();if(m||!n||"connected"!==n.status)return o.NextResponse.json({error:"Meta Ads n\xe3o est\xe1 conectado",needsSetup:!0},{status:400});let{searchParams:l}=new URL(e.url),g=l.get("type")||"account",p=l.get("period")||"last_30d",h=(0,u.nt)({accessToken:n.access_token,adAccountId:n.config?.adAccountId}),_=Date.now();switch(g){case"account":t=await h.getAdAccountInsights(p);break;case"campaigns":t=await h.getAdCampaigns(["id","name","status","objective","daily_budget","lifetime_budget","created_time"]);break;case"campaign":let y=l.get("campaignId");if(!y)return o.NextResponse.json({error:"Campaign ID \xe9 obrigat\xf3rio"},{status:400});t=await h.getCampaignInsights(y,p);break;default:return o.NextResponse.json({error:"Tipo inv\xe1lido"},{status:400})}let f=Date.now()-_;return await a.from("integration_logs").insert({integration_id:"meta_ads",action:`get_${g}`,status:"success",duration_ms:f}),await a.from("integration_configs").update({last_sync:new Date().toISOString()}).eq("integration_id","meta_ads"),o.NextResponse.json({success:!0,data:t,metadata:{type:g,period:p,fetchedAt:new Date().toISOString()}})}catch(e){return console.error("Erro ao buscar m\xe9tricas Meta:",e),o.NextResponse.json({error:"Erro ao buscar m\xe9tricas",details:e.message},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/integrations/meta/metrics/route",pathname:"/api/integrations/meta/metrics",filename:"route",bundlePath:"app/api/integrations/meta/metrics/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\integrations\\meta\\metrics\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:_}=g,y="/api/integrations/meta/metrics/route";function f(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:h})}},22887:(e,t,s)=>{s.d(t,{F9:()=>r,nt:()=>i});let a="https://graph.facebook.com/v18.0";class r{constructor(e){this.accessToken=e.accessToken,this.adAccountId=e.adAccountId,this.businessAccountId=e.businessAccountId}async request(e,t={}){let s=new URL(`${a}${e}`);s.searchParams.set("access_token",this.accessToken);let r=await fetch(s.toString(),{...t,headers:{"Content-Type":"application/json",...t.headers}}),i=await r.json();if(i.error)throw Error(`Meta API Error: ${i.error.message}`);return i}async verifyToken(){return this.request("/debug_token",{method:"GET"})}async getMe(){return this.request("/me?fields=id,name,email")}async getInstagramAccount(e){return this.request(`/${e}?fields=instagram_business_account{id,username,followers_count,media_count}`)}async getInstagramInsights(e,t=["impressions","reach","profile_views"],s="day"){let a=t.join(",");return this.request(`/${e}/insights?metric=${a}&period=${s}`)}async getInstagramMedia(e,t=25){return this.request(`/${e}/media?fields=id,caption,media_type,media_url,thumbnail_url,timestamp,like_count,comments_count&limit=${t}`)}async createInstagramPost(e,t,s){let a=await this.request(`/${e}/media`,{method:"POST",body:JSON.stringify({image_url:t,caption:s})});return this.request(`/${e}/media_publish`,{method:"POST",body:JSON.stringify({creation_id:a.id})})}async createInstagramVideoPost(e,t,s){let a=await this.request(`/${e}/media`,{method:"POST",body:JSON.stringify({video_url:t,media_type:"VIDEO",caption:s})});return this.request(`/${e}/media_publish`,{method:"POST",body:JSON.stringify({creation_id:a.id})})}async createInstagramCarouselPost(e,t,s){let a=[];for(let s of t.slice(0,10)){let t=await this.request(`/${e}/media`,{method:"POST",body:JSON.stringify("video"===s.type?{video_url:s.url,media_type:"VIDEO",is_carousel_item:!0}:{image_url:s.url,is_carousel_item:!0})});a.push(t.id)}let r=await this.request(`/${e}/media`,{method:"POST",body:JSON.stringify({media_type:"CAROUSEL",caption:s,children:a.join(",")})});return this.request(`/${e}/media_publish`,{method:"POST",body:JSON.stringify({creation_id:r.id})})}async getAdCampaigns(e=["id","name","status","objective"]){if(!this.adAccountId)throw Error("Ad Account ID n\xe3o configurado");let t=e.join(",");return this.request(`/${this.adAccountId}/campaigns?fields=${t}`)}async getCampaignInsights(e,t="last_30d"){return this.request(`/${e}/insights?fields=impressions,clicks,spend,reach,cpc,cpm,ctr,conversions&date_preset=${t}`)}async getAdAccountInsights(e="last_30d"){if(!this.adAccountId)throw Error("Ad Account ID n\xe3o configurado");return this.request(`/${this.adAccountId}/insights?fields=impressions,clicks,spend,reach,actions&date_preset=${e}`)}async getPages(){return this.request("/me/accounts")}async createPagePost(e,t,s,r){let i={message:s};r&&(i.link=r);let n=new URL(`${a}/${e}/feed`);return n.searchParams.set("access_token",t),(await fetch(n.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json()}async createPagePhotoPost(e,t,s,r){let i=new URL(`${a}/${e}/photos`);i.searchParams.set("access_token",t);let n=new URLSearchParams;return n.set("url",s),r&&n.set("caption",r),n.set("published","true"),(await fetch(i.toString(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n})).json()}async createPageVideoPost(e,t,s,r){let i=new URL(`${a}/${e}/videos`);i.searchParams.set("access_token",t);let n=new URLSearchParams;return n.set("file_url",s),r&&n.set("description",r),(await fetch(i.toString(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n})).json()}async getPageInsights(e,t,s=["page_impressions","page_engaged_users","page_fans"],r="day"){let i=s.join(","),n=new URL(`${a}/${e}/insights`);return n.searchParams.set("access_token",t),n.searchParams.set("metric",i),n.searchParams.set("period",r),(await fetch(n.toString())).json()}}function i(e){return new r(e)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[89276,55972,54128,20958],()=>s(4988));module.exports=a})();