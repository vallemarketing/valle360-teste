"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{54868:function(e,t,a){a.d(t,{s:function(){return x}});var r=a(57437),s=a(2265),n=a(57586),i=a(26892),l=a(53417),o=a(29202),c=a(32489),d=a(44743),u=a(12381),m=a(93448),h=a(5526);async function v(){try{var e;let{data:t}=await h.supabase.auth.getSession(),a=null===(e=t.session)||void 0===e?void 0:e.access_token;return a?{Authorization:"Bearer ".concat(a)}:{}}catch(e){return{}}}function x(e){let[t,a]=(0,s.useState)(!1),[h,x]=(0,s.useState)([{role:"assistant",content:function(e,t){let a=t?"".concat(t):e.toUpperCase();switch(e){case"ceo":return"Ol\xe1! Sou ".concat(a,", sua CEO virtual (consultiva). Posso sintetizar inputs dos C-Levels, estruturar decis\xf5es e propor planos com CTAs (sempre com sua confirma\xe7\xe3o). O que voc\xea quer decidir?");case"coo":return"Ol\xe1! Sou ".concat(a,", sua COO virtual (consultiva). Posso analisar execu\xe7\xe3o, prazos, capacidade e gargalos, e propor um plano com CTAs (com sua confirma\xe7\xe3o). Qual projeto/\xe1rea est\xe1 mais cr\xedtica?");case"cco":return"Ol\xe1! Sou ".concat(a,", sua CCO virtual (consultiva). Posso analisar sa\xfade de clientes, churn, inadimpl\xeancia e oportunidades de expans\xe3o, com CTAs (com sua confirma\xe7\xe3o). Qual cliente/segmento voc\xea quer avaliar?");default:return"Ol\xe1! Sou ".concat(a,". Como posso ajudar?")}}(e.role,e.execName||null)}]),[f,g]=(0,s.useState)(""),[p,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),[w,N]=(0,s.useState)(!1),C=(0,s.useMemo)(()=>f.trim().length>0&&!p,[f,p]),S=async()=>{let t=f.trim();if(!t||p)return;g("");let a=[...h,{role:"user",content:t}];x(a),y(!0);try{let r=await v(),s=await fetch("/api/admin/csuite/executive-chat",{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify({role:e.role,message:t,history:a,conversation_id:b,include_market:w})}),n=await s.json().catch(()=>null),i=(null==n?void 0:n.reply)?String(n.reply):"N\xe3o consegui responder agora.";(null==n?void 0:n.conversation_id)&&!b&&j(String(n.conversation_id)),x(e=>[...e,{role:"assistant",content:i}])}catch(e){x(e=>[...e,{role:"assistant",content:"Falha ao conversar agora. Tente novamente em instantes."}])}finally{y(!1)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.z,{className:(0,m.cn)("bg-[#1672d6] hover:bg-[#1260b5]",e.buttonClassName),onClick:()=>a(!0),children:[(0,r.jsx)(l.Z,{className:"w-4 h-4 mr-2"}),e.title]}),(0,r.jsx)(n.M,{children:t&&(0,r.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>a(!1),children:(0,r.jsxs)(i.E.div,{initial:{scale:.96,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.96,opacity:0},className:"w-full max-w-2xl rounded-2xl border shadow-2xl overflow-hidden flex flex-col h-[680px]",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",style:{borderColor:"var(--border-light)"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-bold",style:{color:"var(--text-primary)"},children:e.title}),(0,r.jsx)("div",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:e.subtitle})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>N(e=>!e),className:(0,m.cn)("px-2 py-1 rounded-lg text-xs border flex items-center gap-1",w?"bg-blue-50":"bg-transparent"),style:{borderColor:"var(--border-light)",color:"var(--text-primary)"},title:"Usar Perplexity Sonar para contexto de mercado",children:[(0,r.jsx)(o.Z,{className:"w-3.5 h-3.5"}),"Mercado"]}),(0,r.jsx)(u.z,{variant:"ghost",size:"icon",onClick:()=>a(!1),children:(0,r.jsx)(c.Z,{className:"w-5 h-5"})})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-auto p-4 space-y-3",style:{backgroundColor:"var(--bg-secondary)"},children:[h.map((e,t)=>(0,r.jsx)("div",{className:(0,m.cn)("flex","user"===e.role?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:(0,m.cn)("max-w-[85%] px-4 py-3 rounded-2xl text-sm whitespace-pre-wrap","user"===e.role?"bg-[#1672d6] text-white rounded-br-none":"bg-white rounded-bl-none"),style:"assistant"===e.role?{color:"var(--text-primary)"}:void 0,children:e.content})},t)),p&&(0,r.jsx)("div",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Digitando…"})]}),(0,r.jsxs)("div",{className:"p-3 border-t flex items-center gap-2",style:{borderColor:"var(--border-light)"},children:[(0,r.jsx)("input",{value:f,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&S()},placeholder:"Digite sua pergunta…",className:"flex-1 px-3 py-2 rounded-xl border text-sm bg-transparent outline-none",style:{borderColor:"var(--border-light)",color:"var(--text-primary)"}}),(0,r.jsx)(u.z,{onClick:S,disabled:!C,className:"bg-[#1672d6] hover:bg-[#1260b5]",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})})]})]})})})]})}},93987:function(e,t,a){a.d(t,{r:function(){return c}});var r=a(57437),s=a(2265),n=a(12381),i=a(5526),l=a(14438);async function o(){try{var e;let{data:t}=await i.supabase.auth.getSession(),a=null===(e=t.session)||void 0===e?void 0:e.access_token;return a?{Authorization:"Bearer ".concat(a)}:{}}catch(e){return{}}}function c(e){let[t,a]=(0,s.useState)(!1),i=async()=>{a(!0);try{let t=await o(),a=await fetch("/api/admin/csuite/insights/generate",{method:"POST",headers:{"Content-Type":"application/json",...t},body:JSON.stringify({role:e.role,include_market:"cmo"===e.role||"all"===e.role})}),r=await a.json().catch(()=>null);if(!a.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.error)||"Falha ao gerar insights");l.Am.success("Insights gerados: ".concat(Number(r.created||0)))}catch(e){l.Am.error((null==e?void 0:e.message)||"Falha ao gerar insights")}finally{a(!1)}};return(0,r.jsx)(n.z,{onClick:i,disabled:t,variant:"outline",children:t?"Gerando…":e.label||"Gerar insights"})}},56025:function(e,t,a){a.d(t,{$:function(){return u}});var r=a(57437),s=a(2265),n=a(69174),i=a(12381),l=a(79820),o=a(5526);async function c(){try{var e;let{data:t}=await o.supabase.auth.getSession(),a=null===(e=t.session)||void 0===e?void 0:e.access_token;return a?{Authorization:"Bearer ".concat(a)}:{}}catch(e){return{}}}var d=a(14438);function u(e){let{loading:t,insights:a,reload:o}=function(e){let[t,a]=(0,s.useState)(!0),[r,n]=(0,s.useState)([]),[i,l]=(0,s.useState)(null),o=async()=>{a(!0),l(null);try{let t=await c(),a=await fetch("/api/admin/csuite/insights?role=".concat(encodeURIComponent(e)),{headers:t}),r=await a.json().catch(()=>null);n(Array.isArray(null==r?void 0:r.insights)?r.insights:[])}catch(e){l(String((null==e?void 0:e.message)||"Falha ao carregar insights")),n([])}finally{a(!1)}};return(0,s.useEffect)(()=>{o()},[e]),{loading:t,insights:r,error:i,reload:o}}(e.role),u=function(e){let[t,a]=(0,s.useState)(!0),[r,n]=(0,s.useState)([]),[i,l]=(0,s.useState)(null),o=async()=>{a(!0),l(null);try{let t=await c(),a=await fetch("/api/admin/csuite/actions/drafts?role=".concat(encodeURIComponent(e)),{headers:t}),r=await a.json().catch(()=>null);n(Array.isArray(null==r?void 0:r.drafts)?r.drafts:[])}catch(e){l(String((null==e?void 0:e.message)||"Falha ao carregar rascunhos")),n([])}finally{a(!1)}};return(0,s.useEffect)(()=>{o()},[e]),{loading:t,drafts:r,error:i,reload:o}}(e.role),m=function(){let[e,t]=(0,s.useState)(null),a=async e=>{var t,a,r,s;let n=await c(),i=await fetch("/api/admin/csuite/actions/draft",{method:"POST",headers:{"Content-Type":"application/json",...n},body:JSON.stringify({role:e.role,source_insight_id:e.source_insight_id,action_type:String((null===(t=e.action)||void 0===t?void 0:t.action_type)||"create_kanban_task"),payload:(null===(a=e.action)||void 0===a?void 0:a.payload)||{},risk_level:(null===(r=e.action)||void 0===r?void 0:r.risk_level)||"medium",preview:{label:(null===(s=e.action)||void 0===s?void 0:s.label)||null}})}),l=await i.json().catch(()=>null);if(!i.ok||!(null==l?void 0:l.success))throw Error((null==l?void 0:l.error)||"Falha ao criar rascunho");return null==l?void 0:l.draft},r=async e=>{t(e);try{let t=await c(),a=await fetch("/api/admin/csuite/actions/confirm",{method:"POST",headers:{"Content-Type":"application/json",...t},body:JSON.stringify({draft_id:e})}),r=await a.json().catch(()=>null);if(!a.ok||!(null==r?void 0:r.success))throw Error((null==r?void 0:r.error)||"Falha ao executar");return r}finally{t(null)}};return(0,s.useMemo)(()=>({workingId:e,draftFromInsight:a,confirmDraft:r}),[e])}(),h=(0,s.useMemo)(()=>{let e=new Map;for(let t of u.drafts||[]){let a=(null==t?void 0:t.source_insight_id)?String(t.source_insight_id):"";a&&e.set(a,[...e.get(a)||[],t])}return e},[u.drafts]),v=async(t,a)=>{try{await m.draftFromInsight({role:e.role,source_insight_id:String(t.id),action:a}),d.Am.success("Rascunho criado."),await u.reload()}catch(e){d.Am.error((null==e?void 0:e.message)||"Falha ao criar rascunho")}},x=async e=>{try{await m.confirmDraft(e),d.Am.success("A\xe7\xe3o executada."),await u.reload()}catch(e){d.Am.error((null==e?void 0:e.message)||"Falha ao executar")}},f=(a||[]).slice(0,12);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsx)("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Insights (sem mocks) com evid\xeancias e CTAs consultivos."}),(0,r.jsx)(i.z,{variant:"outline",onClick:()=>o(),disabled:t,children:"Atualizar"})]}),f.length?(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3",children:f.map(e=>{var t;let a=Array.isArray(t=null==e?void 0:e.recommended_actions)?t:[],s=h.get(String(e.id))||[];return(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-start justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.ll,{className:"text-base",children:String(e.title||"Insight")}),(0,r.jsxs)("div",{className:"mt-1 flex flex-wrap gap-2",children:[(0,r.jsx)(n.C,{children:String(e.category||"general")}),(0,r.jsx)(n.C,{variant:"secondary",children:String(e.insight_type||"strategy")}),e.urgency?(0,r.jsxs)(n.C,{variant:"outline",children:["urg\xeancia: ",String(e.urgency)]}):null,e.impact_level?(0,r.jsxs)(n.C,{variant:"outline",children:["impacto: ",String(e.impact_level)]}):null,null!=e.confidence_score?(0,r.jsxs)(n.C,{variant:"outline",children:["confian\xe7a: ",Math.round(100*Number(e.confidence_score)),"%"]}):null]})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleString("pt-BR"):""})]}),(0,r.jsxs)(l.aY,{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-sm",style:{color:"var(--text-primary)"},children:String(e.description||"")}),!!a.length&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold",style:{color:"var(--text-secondary)"},children:"CTAs sugeridos (rascunho → confirma\xe7\xe3o)"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:a.slice(0,5).map((t,a)=>{let s=!!(null==t?void 0:t.requires_external),n=function(e){let t=String(e||"").toLowerCase();return"high"===t||"critical"===t?"alto":"low"===t?"baixo":"m\xe9dio"}(null==t?void 0:t.risk_level);return(0,r.jsxs)(i.z,{variant:s?"outline":"default",className:s?"":"bg-[#1672d6] hover:bg-[#1260b5]",onClick:()=>v(e,t),title:s?"Vai gerar rascunho (n\xe3o execut\xe1vel autom\xe1tico)":"Gera rascunho execut\xe1vel (com sua confirma\xe7\xe3o)",children:[String((null==t?void 0:t.label)||"Criar rascunho")," \xb7 risco ",n]},a)})})]}),!!s.length&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold",style:{color:"var(--text-secondary)"},children:"Rascunhos gerados"}),(0,r.jsx)("div",{className:"space-y-2",children:s.slice(0,3).map(e=>{var t;let a=!!e.is_executable&&!e.requires_external,s=String(e.status||"draft");return(0,r.jsxs)("div",{className:"rounded-xl border p-3 flex items-center justify-between gap-3",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:String((null===(t=e.preview)||void 0===t?void 0:t.label)||e.action_type||"A\xe7\xe3o")}),(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["status: ",s," \xb7 execut\xe1vel: ",a?"sim":"n\xe3o"]})]}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:"draft"===s&&a?(0,r.jsx)(i.z,{onClick:()=>x(String(e.id)),disabled:m.workingId===String(e.id),className:"bg-[#1672d6] hover:bg-[#1260b5]",children:"Confirmar"}):null})]},e.id)})})]})]})]},e.id)})}):(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsx)(l.ll,{className:"text-base",children:"Sem insights ainda"})}),(0,r.jsx)(l.aY,{children:(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Rode o cron de ML/alertas e gere insights. Se as tabelas do C‑Suite ainda n\xe3o existirem neste ambiente, rode a migration/SQL consolidado."})})]})]})}},69174:function(e,t,a){a.d(t,{C:function(){return l}});var r=a(57437);a(2265);var s=a(90535),n=a(93448);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-valle-blue-600 text-white",secondary:"border-transparent bg-valle-silver-300 text-valle-navy-800",outline:"text-valle-navy-700 border-valle-silver-400",success:"border-transparent bg-green-600 text-white",warning:"border-transparent bg-yellow-600 text-white",danger:"border-transparent bg-red-600 text-white"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:a}),t),...s})}},12381:function(e,t,a){a.d(t,{z:function(){return o}});var r=a(57437),s=a(2265),n=a(90535),i=a(93448);let l=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-valle-blue-600 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-gradient-to-r from-valle-blue-600 to-valle-blue-700 text-white hover:from-valle-blue-700 hover:to-valle-blue-800 shadow-lg",secondary:"bg-valle-silver-200 text-valle-navy-800 hover:bg-valle-silver-300",outline:"border-2 border-valle-blue-600 text-valle-blue-600 hover:bg-valle-blue-50",ghost:"hover:bg-valle-blue-50 hover:text-valle-blue-600",danger:"bg-red-600 text-white hover:bg-red-700"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,...o}=e;return(0,r.jsx)("button",{className:(0,i.cn)(l({variant:s,size:n,className:a})),ref:t,...o})});o.displayName="Button"},79820:function(e,t,a){a.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return o}});var r=a(57437),s=a(2265),n=a(93448);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border-2 border-valle-silver-200 bg-white shadow-md",a),...s})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight text-lg",a),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-foreground/70",a),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},5526:function(e,t,a){a.r(t),a.d(t,{supabase:function(){return i}});var r=a(62724);let s="https://ikjgsqtykkhqimypacro.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";s&&n||console.error("❌ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let i=(0,r.eI)(s||"https://setup-missing.supabase.co",n||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})},93448:function(e,t,a){a.d(t,{cn:function(){return n},x:function(){return i}});var r=a(61994),s=a(53335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}function i(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}}}]);