"use strict";(()=>{var e={};e.id=3949,e.ids=[3949],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},46109:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>_,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var i={};a.r(i),a.d(i,{GET:()=>p,dynamic:()=>l});var r=a(49303),n=a(88716),s=a(60670),o=a(87070),c=a(17478),d=a(90176);let l="force-dynamic";async function p(e){let t=await (0,c.k)(e);if(!t.ok)return t.res;let{searchParams:a}=new URL(e.url),i=a.get("client_id");if(!i)return o.NextResponse.json({success:!1,error:"client_id is required"},{status:400});try{let e=[],t=(0,d.t)(),a=new Date,r=new Date;r.setDate(r.getDate()+7);let{data:n}=await t.from("content_calendar_posts").select("id, scheduled_for").eq("client_id",i).gte("scheduled_for",a.toISOString()).lte("scheduled_for",r.toISOString()).in("status",["scheduled","draft"]);(!n||n.length<3)&&e.push({id:"gap_"+Date.now(),type:"calendar_gap",severity:n?.length===0?"critical":"warning",title:"Gap no Calend\xe1rio",description:`Apenas ${n?.length||0} posts agendados para os pr\xf3ximos 7 dias. Recomendamos m\xednimo de 3.`,action:"Gerar Ideias",actionUrl:"/admin/social-media/ideias",createdAt:a.toISOString()});let{data:s}=await t.from("social_connected_accounts").select("id, platform, token_expires_at, display_name").eq("client_id",i);if(s){for(let t of s)if(t.token_expires_at){let i=new Date(t.token_expires_at),r=Math.floor((i.getTime()-a.getTime())/864e5);r<=7&&r>0?e.push({id:`token_${t.id}`,type:"token_expiring",severity:r<=2?"critical":"warning",title:"Token Expirando",description:`O token do ${t.platform} (${t.display_name}) expira em ${r} dias.`,action:"Reconectar",actionUrl:"/admin/integracoes",createdAt:a.toISOString()}):r<=0&&e.push({id:`token_expired_${t.id}`,type:"token_expiring",severity:"critical",title:"Token Expirado",description:`O token do ${t.platform} (${t.display_name}) expirou. Reconecte para continuar publicando.`,action:"Reconectar",actionUrl:"/admin/integracoes",createdAt:a.toISOString()})}}let c=new Date;c.setDate(c.getDate()-7);let{data:l}=await t.from("content_calendar_posts").select("id, metrics, caption").eq("client_id",i).eq("status","published").gte("scheduled_for",c.toISOString()).limit(10);if(l&&l.length>0){let t=l.filter(e=>{let t=e.metrics;return!!t&&2>(t.engagement_rate||0)});t.length>=3&&e.push({id:"engagement_"+Date.now(),type:"low_engagement",severity:"warning",title:"Engajamento Baixo",description:`${t.length} posts recentes t\xeam engajamento abaixo de 2%. Considere revisar a estrat\xe9gia.`,action:"Ver An\xe1lise",actionUrl:"/admin/social-media/analise",createdAt:a.toISOString()})}let{data:p}=await t.from("content_calendar_posts").select("id, caption, scheduled_for").eq("client_id",i).eq("status","scheduled").lt("scheduled_for",a.toISOString()).limit(5);p&&p.length>0&&e.push({id:"missed_"+Date.now(),type:"missed_schedule",severity:"critical",title:"Posts N\xe3o Publicados",description:`${p.length} posts agendados n\xe3o foram publicados. Verifique as integra\xe7\xf5es.`,action:"Ver Posts",actionUrl:"/admin/social-media/calendario",createdAt:a.toISOString()});let u={critical:0,warning:1,info:2};return e.sort((e,t)=>u[e.severity]-u[t.severity]),o.NextResponse.json({success:!0,alerts:e,summary:{total:e.length,critical:e.filter(e=>"critical"===e.severity).length,warning:e.filter(e=>"warning"===e.severity).length,info:e.filter(e=>"info"===e.severity).length}})}catch(e){return console.error("Alerts error:",e),o.NextResponse.json({success:!1,error:e.message||"Failed to get alerts"},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/agency/alerts/route",pathname:"/api/admin/agency/alerts",filename:"route",bundlePath:"app/api/admin/agency/alerts/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\agency\\alerts\\route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:h}=u,_="/api/admin/agency/alerts/route";function f(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},90176:(e,t,a)=>{a.d(t,{t:()=>r});var i=a(54128);function r(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,i.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},17478:(e,t,a)=>{a.d(t,{k:()=>o});var i=a(87070),r=a(20344),n=a(71615),s=a(54128);async function o(e){let t=(0,n.cookies)(),a=(0,r.createRouteHandlerClient)({cookies:()=>t}),o=e.headers.get("authorization")||"",c=o.toLowerCase().startsWith("bearer ")?o.slice(7).trim():null,d=c?(0,s.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${c}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):a,{data:l}=await d.auth.getUser();if(!l.user?.id)return{ok:!1,res:i.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:p,error:u}=await d.rpc("is_admin");return u||!p?{ok:!1,res:i.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:l.user.id}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[89276,55972,54128,20958],()=>a(46109));module.exports=i})();