"use strict";(()=>{var e={};e.id=18873,e.ids=[18873],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},98408:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>b,patchFetch:()=>A,requestAsyncStorage:()=>k,routeModule:()=>R,serverHooks:()=>C,staticGenerationAsyncStorage:()=>S});var r={};a.r(r),a.d(r,{GET:()=>_,POST:()=>w,dynamic:()=>y});var i=a(49303),o=a(88716),n=a(60670),s=a(87070),c=a(20344),l=a(71615),d=a(10306),m=a(4940),u=a(29235),p=a(53247),g=a(51547);let v=`Voc\xea \xe9 a Diretoria Virtual da Valle 360, combinando as perspectivas de CFO, CTO, CMO e CHRO.
Quando responder, considere todas as \xe1reas de forma integrada e estrat\xe9gica.

Voc\xea pode responder como:
- A Diretoria completa (vis\xe3o 360\xb0)
- Um executivo espec\xedfico quando a pergunta for de uma \xe1rea

Sempre forne\xe7a respostas equilibradas que considerem finan\xe7as, opera\xe7\xf5es, clientes e pessoas.`;async function x(){let[e,t,a,r]=await Promise.all([(0,d.k3)().catch(()=>null),(0,m.tl)().catch(()=>null),(0,u.qI)().catch(()=>null),(0,p.At)().catch(()=>null)]),i=[];e?.alerts&&i.push(...e.alerts.map(e=>({...e,executive:"cfo"}))),t?.alerts&&i.push(...t.alerts.map(e=>({...e,executive:"cto"}))),a?.alerts&&i.push(...a.alerts.map(e=>({...e,executive:"cmo"}))),r?.alerts&&i.push(...r.alerts.map(e=>({...e,executive:"chro"}))),i.sort((e,t)=>{let a={critical:0,high:1,medium:2,low:3};return a[e.severity]-a[t.severity]});let o=100,n=i.filter(e=>"critical"===e.severity).length,s=i.filter(e=>"high"===e.severity).length;o-=15*n,o-=5*s,o=Math.max(0,o);let c=await h({cfo:e,cto:t,cmo:a,chro:r,alertsCount:i.length,criticalCount:n});return{cfo:e,cto:t,cmo:a,chro:r,consolidatedAlerts:i.slice(0,10),healthScore:o,summary:c}}async function h(e){try{let t=`
CFO: ${e.cfo?`Receita R$${e.cfo.kpis.totalRevenue.toLocaleString("pt-BR")}, Margem ${e.cfo.kpis.averageMargin.toFixed(1)}%`:"Sem dados"}
CTO: ${e.cto?`Utiliza\xe7\xe3o ${e.cto.overview.totalUtilization.toFixed(1)}%, ${e.cto.overview.bottlenecks} gargalos`:"Sem dados"}
CMO: ${e.cmo?`${e.cmo.kpis.activeClients} clientes ativos, Churn ${e.cmo.kpis.churnRate.toFixed(1)}%`:"Sem dados"}
CHRO: ${e.chro?`Performance ${e.chro.kpis.averagePerformance}%, Risco turnover ${e.chro.kpis.turnoverRate.toFixed(1)}%`:"Sem dados"}
Alertas: ${e.alertsCount} total, ${e.criticalCount} cr\xedticos
`;return(await (0,g.F)({task:"strategy",json:!1,temperature:.7,maxTokens:200,entityType:"csuite_summary",entityId:null,messages:[{role:"system",content:"Voc\xea gera resumos executivos concisos (2-3 frases) para diretoria."},{role:"user",content:`Gere um resumo executivo da situa\xe7\xe3o atual da empresa:
${t}`}]})).text||"Situa\xe7\xe3o geral est\xe1vel. Monitorando indicadores."}catch{return"Dashboard da diretoria carregado. Verifique os alertas cr\xedticos."}}async function f(e,t="all",a){if("all"!==t){let r="";switch(t){case"cfo":r=await (0,d.dL)(e,a);break;case"cto":r=await (0,m.Fm)(e,a);break;case"cmo":r=await (0,u.ae)(e,a);break;case"chro":r=await (0,p.eZ)(e,a)}return{response:r,executive:t,insights:[]}}let r=await x(),i=`
RESUMO DA EMPRESA:
${r.summary}

SA\xdaDE GERAL: ${r.healthScore}%

ALERTAS CR\xcdTICOS:
${r.consolidatedAlerts.filter(e=>"critical"===e.severity).map(e=>`[${e.executive.toUpperCase()}] ${e.title}`).join("\n")||"Nenhum alerta cr\xedtico"}

M\xc9TRICAS PRINCIPAIS:
- Financeiro: ${r.cfo?`Receita R$${r.cfo.kpis.totalRevenue.toLocaleString("pt-BR")}, Margem ${r.cfo.kpis.averageMargin.toFixed(1)}%`:"N/A"}
- Opera\xe7\xf5es: ${r.cto?`Utiliza\xe7\xe3o ${r.cto.overview.totalUtilization.toFixed(1)}%`:"N/A"}
- Clientes: ${r.cmo?`${r.cmo.kpis.activeClients} ativos, Churn ${r.cmo.kpis.churnRate.toFixed(1)}%`:"N/A"}
- Pessoas: ${r.chro?`Performance ${r.chro.kpis.averagePerformance}%, Engajamento ${r.chro.kpis.averageEngagement}%`:"N/A"}
`;try{let t=await (0,g.F)({task:"strategy",json:!1,temperature:.7,maxTokens:1500,entityType:"csuite_chat",entityId:null,messages:[{role:"system",content:v},{role:"system",content:i},{role:"user",content:e}]}),a=r.consolidatedAlerts.slice(0,3).map(e=>({executive:e.executive,insight:e.title,priority:"critical"===e.severity?"high":"high"===e.severity?"medium":"low",category:e.type,actionable:!0}));return{response:t.text||"Erro ao processar.",executive:"all",insights:a}}catch(e){return console.error("Erro no chat C-Suite:",e),{response:"Erro ao processar solicita\xe7\xe3o. Tente novamente.",executive:"all",insights:[]}}}async function $(){let e=await x(),t=[];e.cfo&&t.push({title:"An\xe1lise Financeira",executive:"cfo",summary:`Receita mensal de R$ ${e.cfo.kpis.totalRevenue.toLocaleString("pt-BR")} com margem m\xe9dia de ${e.cfo.kpis.averageMargin.toFixed(1)}%.`,kpis:[{label:"Receita",value:`R$ ${e.cfo.kpis.totalRevenue.toLocaleString("pt-BR")}`,trend:e.cfo.kpis.revenueGrowth>0?"up":"down"},{label:"Margem Bruta",value:`${e.cfo.kpis.averageMargin.toFixed(1)}%`},{label:"Crescimento",value:`${e.cfo.kpis.revenueGrowth.toFixed(1)}%`,trend:e.cfo.kpis.revenueGrowth>0?"up":"down"}],alerts:e.cfo.alerts.slice(0,2).map(e=>e.title),recommendations:e.cfo.pricingIssues.slice(0,2).map(e=>`Ajustar pre\xe7o de ${e.service}`)}),e.cto&&t.push({title:"An\xe1lise Operacional",executive:"cto",summary:`Utiliza\xe7\xe3o de capacidade em ${e.cto.overview.totalUtilization.toFixed(1)}% com ${e.cto.overview.bottlenecks} gargalos identificados.`,kpis:[{label:"Utiliza\xe7\xe3o",value:`${e.cto.overview.totalUtilization.toFixed(1)}%`,trend:e.cto.overview.totalUtilization>85?"up":"stable"},{label:"Efici\xeancia",value:`${e.cto.overview.averageEfficiency.toFixed(1)}%`},{label:"Economia Potencial",value:`${e.cto.overview.potentialSavings}h/m\xeas`}],alerts:e.cto.alerts.slice(0,2).map(e=>e.title),recommendations:e.cto.toolRecommendations.slice(0,2).map(e=>`Implementar ${e.toolName}`)}),e.cmo&&t.push({title:"An\xe1lise de Clientes",executive:"cmo",summary:`${e.cmo.kpis.activeClients} clientes ativos com taxa de churn de ${e.cmo.kpis.churnRate.toFixed(1)}%.`,kpis:[{label:"Clientes Ativos",value:`${e.cmo.kpis.activeClients}`},{label:"Taxa de Churn",value:`${e.cmo.kpis.churnRate.toFixed(1)}%`,trend:e.cmo.kpis.churnRate>10?"down":"stable"},{label:"Pipeline Upsell",value:`R$ ${e.cmo.kpis.upsellPipeline.toLocaleString("pt-BR")}`}],alerts:e.cmo.alerts.slice(0,2).map(e=>e.title),recommendations:e.cmo.upsellOpportunities.slice(0,2).map(e=>`Upsell ${e.suggestedService} para ${e.clientName}`)}),e.chro&&t.push({title:"An\xe1lise de Pessoas",executive:"chro",summary:`${e.chro.kpis.totalEmployees} colaboradores com performance m\xe9dia de ${e.chro.kpis.averagePerformance}%.`,kpis:[{label:"Performance",value:`${e.chro.kpis.averagePerformance}%`},{label:"Engajamento",value:`${e.chro.kpis.averageEngagement}%`},{label:"Risco Turnover",value:`${e.chro.kpis.turnoverRate.toFixed(1)}%`,trend:e.chro.kpis.turnoverRate>15?"down":"stable"}],alerts:e.chro.alerts.slice(0,2).map(e=>e.title),recommendations:e.chro.turnoverPredictions.slice(0,2).map(e=>`A\xe7\xe3o preventiva para ${e.name}`)});let a=e.consolidatedAlerts.filter(e=>"critical"===e.severity||"high"===e.severity).slice(0,5).map(e=>`[${e.executive.toUpperCase()}] ${e.title}`);return{title:"Relat\xf3rio Executivo Valle 360",date:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),sections:t,overallHealth:e.healthScore,topPriorities:a}}let y="force-dynamic";async function _(e){try{let t=(0,l.cookies)(),a=(0,c.createServerComponentClient)({cookies:()=>t}),{data:{user:r}}=await a.auth.getUser();if(!r)return s.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{searchParams:i}=new URL(e.url);switch(i.get("type")||"dashboard"){case"dashboard":let o=await x();return s.NextResponse.json(o);case"report":let n=await $();return s.NextResponse.json(n);default:return s.NextResponse.json({error:"Tipo inv\xe1lido"},{status:400})}}catch(e){return console.error("Erro na API C-Suite:",e),s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function w(e){try{let t=(0,l.cookies)(),a=(0,c.createServerComponentClient)({cookies:()=>t}),{data:{user:r}}=await a.auth.getUser();if(!r)return s.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{message:i,executive:o="all",context:n}=await e.json();if(!i)return s.NextResponse.json({error:"Mensagem \xe9 obrigat\xf3ria"},{status:400});let d=await f(i,o,n);try{await a.from("csuite_conversations").insert({user_id:r.id,executive_type:o,title:i.slice(0,100)})}catch(e){console.warn("Erro ao registrar conversa:",e)}return s.NextResponse.json(d)}catch(e){return console.error("Erro no chat C-Suite:",e),s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let R=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/csuite/route",pathname:"/api/csuite",filename:"route",bundlePath:"app/api/csuite/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\csuite\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:k,staticGenerationAsyncStorage:S,serverHooks:C}=R,b="/api/csuite/route";function A(){return(0,n.patchFetch)({serverHooks:C,staticGenerationAsyncStorage:S})}},10306:(e,t,a)=>{a.d(t,{Qu:()=>n,dL:()=>p,ed:()=>d,k3:()=>u,ki:()=>c,nN:()=>l});var r=a(1926),i=a(51547);let o=`Voc\xea \xe9 o CFO virtual da Valle 360, uma ag\xeancia de marketing digital.
Seu papel \xe9 analisar dados financeiros e fornecer insights estrat\xe9gicos como um diretor financeiro experiente.

Suas responsabilidades:
1. Precifica\xe7\xe3o inteligente de servi\xe7os
2. An\xe1lise de rentabilidade por cliente
3. Previs\xf5es financeiras
4. Identifica\xe7\xe3o de riscos e oportunidades
5. Recomenda\xe7\xf5es de ajustes de pre\xe7o

Sempre forne\xe7a:
- N\xfameros espec\xedficos e justificativas
- Compara\xe7\xf5es com benchmarks de mercado
- A\xe7\xf5es concretas e priorizadas
- An\xe1lise de risco vs retorno

Seja direto, anal\xedtico e focado em resultados financeiros.`;async function n(e){let{data:t}=await r.O.from("employee_costs").select("hourly_cost, department:user_profiles(role)").order("effective_date",{ascending:!1}),a=t?.length?t.reduce((e,t)=>e+(t.hourly_cost||0),0)/t.length:150,i={low:1,medium:1.3,high:1.6}[e.complexity],o={social_media:.4,design:.45,trafego:.35,video:.5,web:.45,default:.4},n=o[e.category]||o.default,c=e.hoursEstimate*a*i,l=e.includeTools?.1*c:0,d=c+l,m=d/(1-n),u=d/.75,p=d/(1-.55),g={social_media:3500,design:2800,trafego:4500,video:5e3,web:8e3}[e.category]||3e3,v=m<.9*g?"below":m>1.1*g?"above":"average",x=await s({service:e.serviceName,cost:d,price:m,margin:n,benchmark:g,marketComparison:v});return{service:e.serviceName,currentPrice:0,recommendedPrice:Math.round(m),minPrice:Math.round(u),maxPrice:Math.round(p),margin:100*n,justification:x,marketComparison:v}}async function s(e){try{return(await (0,i.F)({task:"analysis",json:!1,temperature:.7,maxTokens:200,entityType:"cfo_pricing_justification",entityId:null,messages:[{role:"system",content:o},{role:"user",content:`Gere uma justificativa de pre\xe7o em 2-3 frases para:
Servi\xe7o: ${e.service}
Custo base: R$ ${e.cost.toFixed(2)}
Pre\xe7o sugerido: R$ ${e.price.toFixed(2)}
Margem: ${(100*e.margin).toFixed(0)}%
Benchmark de mercado: R$ ${e.benchmark.toFixed(2)}
Posi\xe7\xe3o: ${e.marketComparison}

Seja direto e focado no valor.`}]})).text||`Pre\xe7o baseado em custo de R$ ${e.cost.toFixed(2)} com margem de ${(100*e.margin).toFixed(0)}%.`}catch{return`Pre\xe7o calculado com base nos custos operacionais e margem alvo de ${(100*e.margin).toFixed(0)}%.`}}async function c(){let{data:e}=await r.O.from("service_pricing").select("*").eq("is_active",!0),t=[],a=[],i=[],o=0;for(let r of e||[]){let e=r.margin_percentage-35;e>=0?t.push(r):(e>=-15?a.push(r):i.push(r),o+=r.suggested_price-r.current_price||0)}return{healthy:t,needsAttention:a,critical:i,totalPotentialRevenue:o}}async function l(){let{data:e}=await r.O.from("client_profitability").select(`
      *,
      clients:client_id(name, industry)
    `).order("margin_percentage",{ascending:!0}).limit(50);return e?e.map(e=>({client_id:e.client_id,client_name:e.clients?.name||"Cliente",revenue:e.revenue,direct_costs:e.direct_costs,hours_spent:e.hours_spent,gross_margin:e.gross_margin,margin_percentage:e.margin_percentage,profitability_score:e.profitability_score,trend:e.margin_percentage>30?"up":e.margin_percentage>20?"stable":"down",ai_insights:e.ai_insights||[]})):[]}async function d(e=3){let{data:t}=await r.O.from("financial_forecasts").select("*").order("period_month",{ascending:!1}).limit(12),{data:a}=await r.O.from("client_profitability").select("revenue").gte("period_month",new Date(Date.now()-7776e6).toISOString()),i=(a?.reduce((e,t)=>e+(t.revenue||0),0)||1e5)/3,o=[],n=new Date;for(let t=1;t<=e;t++){let e=new Date(n.getFullYear(),n.getMonth()+t,1),a=e.toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),r=e.getMonth()+1,s=1;(12===r||11===r)&&(s=1.2),(1===r||2===r)&&(s=.85);let c=1.05*i*s,l=1.15*c,d=.85*c,m=[];s>1&&m.push("Alta sazonalidade"),s<1&&m.push("Baixa temporada"),m.push("Tend\xeancia de crescimento de 5%"),o.push({period:a,optimistic:Math.round(l),expected:Math.round(c),conservative:Math.round(d),confidence:75,factors:m})}return o}async function m(){let e=[],{data:t}=await r.O.from("client_profitability").select("*, clients:client_id(name)").lt("margin_percentage",20).order("margin_percentage",{ascending:!0}).limit(5);for(let a of t||[])e.push({id:`margin-${a.client_id}`,type:"low_margin",severity:a.margin_percentage<10?"critical":"high",title:`Margem cr\xedtica: ${a.clients?.name||"Cliente"}`,description:`Margem de apenas ${a.margin_percentage?.toFixed(1)}%. Receita: R$ ${a.revenue?.toLocaleString("pt-BR")}, Custos: R$ ${a.direct_costs?.toLocaleString("pt-BR")}`,potentialImpact:(35-a.margin_percentage)*a.revenue/100,recommendedAction:"Renegociar valores ou reduzir escopo de servi\xe7os",createdAt:new Date().toISOString()});let{data:a}=await r.O.from("service_pricing").select("*").lt("margin_percentage",25).eq("is_active",!0);for(let t of a||[])e.push({id:`pricing-${t.id}`,type:"underpriced_service",severity:"medium",title:`Servi\xe7o subprecificado: ${t.service_name}`,description:`Pre\xe7o atual R$ ${t.current_price?.toLocaleString("pt-BR")} com margem de ${t.margin_percentage?.toFixed(1)}%. Sugest\xe3o: R$ ${t.suggested_price?.toLocaleString("pt-BR")}`,potentialImpact:(t.suggested_price||0)-(t.current_price||0),recommendedAction:"Ajustar pre\xe7o na pr\xf3xima renova\xe7\xe3o",createdAt:new Date().toISOString()});let i=(await d(1))[0];return i&&i.expected<1.1*i.conservative&&e.push({id:"forecast-warning",type:"revenue_forecast",severity:"high",title:"Previs\xe3o de queda de receita",description:`Pr\xf3ximo m\xeas previsto: R$ ${i.expected.toLocaleString("pt-BR")} (cen\xe1rio esperado)`,potentialImpact:i.expected-i.conservative,recommendedAction:"Acelerar prospec\xe7\xe3o e upsells",createdAt:new Date().toISOString()}),e.sort((e,t)=>{let a={critical:0,high:1,medium:2,low:3};return a[e.severity]-a[t.severity]})}async function u(){let{data:e}=await r.O.from("client_profitability").select("revenue, direct_costs, gross_margin, margin_percentage").gte("period_month",new Date(Date.now()-2592e6).toISOString()),t=e?.reduce((e,t)=>e+(t.revenue||0),0)||0,a=e?.reduce((e,t)=>e+(t.direct_costs||0),0)||0,i=e?.length?e.reduce((e,t)=>e+(t.margin_percentage||0),0)/e.length:0,{data:o}=await r.O.from("client_profitability").select("revenue").gte("period_month",new Date(Date.now()-5184e6).toISOString()).lt("period_month",new Date(Date.now()-2592e6).toISOString()),n=o?.reduce((e,t)=>e+(t.revenue||0),0)||t,s=await l(),u=[...s].sort((e,t)=>t.margin_percentage-e.margin_percentage).slice(0,5),p=[...s].sort((e,t)=>e.margin_percentage-t.margin_percentage).slice(0,5),g=await m(),v=await d(3),x=await c();return{kpis:{totalRevenue:t,totalCosts:a,grossMargin:t-a,averageMargin:i,mrr:t,revenueGrowth:n>0?(t-n)/n*100:0},alerts:g,topClients:u,worstClients:p,forecasts:v,pricingIssues:[...x.critical,...x.needsAttention].map(e=>({service:e.service_name,currentPrice:e.current_price,recommendedPrice:e.suggested_price,minPrice:1.25*e.base_cost,maxPrice:1.55*e.base_cost,margin:e.margin_percentage,justification:e.ai_recommendation||"Ajustar para margem saud\xe1vel",marketComparison:e.current_price<.9*(e.market_benchmark||0)?"below":"average"}))}}async function p(e,t){let a=await u(),r=`
DADOS ATUAIS DA EMPRESA:
- Receita mensal: R$ ${a.kpis.totalRevenue.toLocaleString("pt-BR")}
- Margem m\xe9dia: ${a.kpis.averageMargin.toFixed(1)}%
- Crescimento: ${a.kpis.revenueGrowth.toFixed(1)}%
- Alertas ativos: ${a.alerts.length}
- Clientes com margem cr\xedtica: ${a.worstClients.filter(e=>e.margin_percentage<25).length}

TOP 3 CLIENTES (por margem):
${a.topClients.slice(0,3).map(e=>`- ${e.client_name}: ${e.margin_percentage.toFixed(1)}% margem`).join("\n")}

CLIENTES EM RISCO:
${a.worstClients.slice(0,3).map(e=>`- ${e.client_name}: ${e.margin_percentage.toFixed(1)}% margem`).join("\n")}

PREVIS\xc3O PR\xd3XIMO M\xcaS:
- Otimista: R$ ${a.forecasts[0]?.optimistic.toLocaleString("pt-BR")}
- Esperado: R$ ${a.forecasts[0]?.expected.toLocaleString("pt-BR")}
- Conservador: R$ ${a.forecasts[0]?.conservative.toLocaleString("pt-BR")}
`;try{return(await (0,i.F)({task:"analysis",json:!1,temperature:.7,maxTokens:1e3,entityType:"cfo_chat",entityId:null,messages:[{role:"system",content:o},{role:"system",content:r},{role:"user",content:e}]})).text||"Desculpe, n\xe3o consegui processar sua solicita\xe7\xe3o."}catch(e){return console.error("Erro no chat CFO:",e),"Erro ao processar solicita\xe7\xe3o. Tente novamente."}}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958,53247,29235,4940],()=>a(98408));module.exports=r})();