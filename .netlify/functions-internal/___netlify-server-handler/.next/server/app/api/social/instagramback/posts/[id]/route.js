"use strict";(()=>{var e={};e.id=21801,e.ids=[21801],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},69602:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>k,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{DELETE:()=>f,PUT:()=>g,dynamic:()=>p});var s=a(49303),o=a(88716),n=a(60670),i=a(87070),c=a(20344),l=a(71615),d=a(87008),u=a(52955);let p="force-dynamic";async function m(e){let{data:t,error:a}=await e.from("integration_configs").select("status, access_token, config").eq("integration_id","instagramback").maybeSingle();if(a)throw a;if(!t||"connected"!==t.status)throw Error("InstagramBack n\xe3o est\xe1 conectado");let r=String(t?.config?.baseUrl||"").trim(),s=String(t?.access_token||"").trim();if(!r)throw Error("InstagramBack: baseUrl n\xe3o configurado");if(!s)throw Error("InstagramBack: access_token n\xe3o configurado");return{baseUrl:r,accessToken:s}}async function g(e,t){try{let r=(0,l.cookies)(),s=(0,c.createRouteHandlerClient)({cookies:()=>r}),o=await (0,u.U)({supabase:s});if(!o.allowed)return i.NextResponse.json({error:o.reason||"Acesso negado"},{status:403});let n=t?.params?.id;if(!n)return i.NextResponse.json({error:"ID \xe9 obrigat\xf3rio"},{status:400});let p=await e.json(),{baseUrl:g,accessToken:f}=await m(s),y=(0,d.s)({baseUrl:g,accessToken:f}),h=await y.updatePost(n,p);try{var a;let e=h?.data??h;await s.from("instagram_posts").upsert({external_id:String(e?.id||e?._id||n),post_type:function(e){let t=String(e?.post_type||e?.type||e?.mediaType||"").toLowerCase();return t.includes("carousel")?"carousel":t.includes("video")?"video":"image"}({...p,...e}),caption:e?.caption??p?.caption??p?.legenda??null,collaborators:e?.collaborators??p?.collaborators??p?.colaboradores??null,status:e?.status??p?.status??null,scheduled_at:e?.scheduled_at??e?.scheduledAt??p?.scheduled_at??p?.scheduledAt??null,media_urls:(a=e?.media_urls??e?.mediaUrls??p?.media_urls??p?.mediaUrls??p?.carrossel??p?.urlimagem??p?.urlvideo)?Array.isArray(a)?a.map(String).filter(Boolean):"string"==typeof a?a.split(",").map(e=>e.trim()).filter(Boolean):[]:[],created_by:o.userId,raw_payload:e},{onConflict:"external_id"})}catch{}return i.NextResponse.json({success:!0,updated:h})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}async function f(e,t){try{let e=(0,l.cookies)(),a=(0,c.createRouteHandlerClient)({cookies:()=>e}),r=await (0,u.U)({supabase:a});if(!r.allowed)return i.NextResponse.json({error:r.reason||"Acesso negado"},{status:403});let s=t?.params?.id;if(!s)return i.NextResponse.json({error:"ID \xe9 obrigat\xf3rio"},{status:400});let{baseUrl:o,accessToken:n}=await m(a),p=(0,d.s)({baseUrl:o,accessToken:n}),g=await p.deletePost(s);try{await a.from("instagram_posts").delete().eq("external_id",s)}catch{}return i.NextResponse.json({success:!0,deleted:g})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let y=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/social/instagramback/posts/[id]/route",pathname:"/api/social/instagramback/posts/[id]",filename:"route",bundlePath:"app/api/social/instagramback/posts/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\social\\instagramback\\posts\\[id]\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:_,serverHooks:x}=y,w="/api/social/instagramback/posts/[id]/route";function k(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:_})}},87008:(e,t,a)=>{async function r(e,t,a={}){let r=function(e,t){let a=String(e||"").trim().replace(/\/+$/,""),r=t.startsWith("/")?t:`/${t}`;return a.endsWith("/api")?`${a}${r}`:`${a}/api${r}`}(e.baseUrl,t),s=await fetch(r,{...a,headers:{Authorization:`Bearer ${e.accessToken}`,"Content-Type":"application/json",...a.headers||{}},cache:"no-store"}),o=await s.text();if(!s.ok)throw Error(o||`Falha na requisi\xe7\xe3o (${s.status})`);try{return o?JSON.parse(o):null}catch{return o}}function s(e){return{me:()=>r(e,"/auth/me"),listPosts:()=>r(e,"/posts"),createPost:t=>r(e,"/posts",{method:"POST",body:JSON.stringify(t)}),updatePost:(t,a)=>r(e,`/posts/${encodeURIComponent(t)}`,{method:"PUT",body:JSON.stringify(a)}),deletePost:t=>r(e,`/posts/${encodeURIComponent(t)}`,{method:"DELETE"})}}a.d(t,{s:()=>s})},52955:(e,t,a)=>{a.d(t,{U:()=>n});var r=a(57157);async function s(e,t,a){try{let{data:r,error:s}=await e.rpc(t,a);if(s)return{ok:!1,error:s};return{ok:!0,data:r}}catch(e){return{ok:!1,error:e}}}function o(e){return Array.from(new Set(e))}async function n(e){let t=e.supabase,{data:a}=await t.auth.getUser(),n=a.user?.id;if(!n)return{userId:"",isSuperAdmin:!1,isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let i=await s(t,"is_admin"),c=!!i.ok&&!!i.data,l=await s(t,"is_super_admin"),d=!!l.ok&&!!l.data;if(c||d)return{userId:n,isSuperAdmin:d,isAdmin:c,allowed:!0,areaKeys:[]};let u=await s(t,"employee_area_keys");if(u.ok&&Array.isArray(u.data)){let e=(u.data||[]).map(e=>String(e)),t=e.includes("social_media")||e.includes("head_marketing");return{userId:n,isSuperAdmin:d,isAdmin:c,allowed:t,reason:t?void 0:"Acesso restrito: necess\xe1rio Social Media ou Head Marketing",areaKeys:o(e)}}let{data:p}=await t.from("employees").select("department, area_of_expertise, areas, is_active").eq("user_id",n).maybeSingle(),m=[];p?.department&&m.push(String(p.department)),p?.area_of_expertise&&m.push(String(p.area_of_expertise)),Array.isArray(p?.areas)&&m.push(...p.areas.map(e=>String(e)));let g=o(m.map(e=>(0,r.IY)(e)).filter(Boolean).map(e=>e)),f=g.includes("social_media")||g.includes("head_marketing");return{userId:n,isSuperAdmin:d,isAdmin:c,allowed:f,reason:f?void 0:"Acesso restrito: necess\xe1rio Social Media ou Head Marketing",areaKeys:g}}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958,57157],()=>a(69602));module.exports=r})();