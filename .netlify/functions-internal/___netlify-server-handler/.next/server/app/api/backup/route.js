"use strict";(()=>{var e={};e.id=55005,e.ids=[55005],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>O,patchFetch:()=>j,requestAsyncStorage:()=>k,routeModule:()=>x,serverHooks:()=>I,staticGenerationAsyncStorage:()=>S});var n={};r.r(n),r.d(n,{DELETE:()=>y,GET:()=>h,POST:()=>w,dynamic:()=>b});var a=r(49303),s=r(88716),o=r(60670),i=r(87070),c=r(1926);let l=["employees","clients","tasks","messages","notifications","approvals","invoices","payments","nps_responses","gamification_points","audit_logs"];async function u(){let e=function(){let e=new Date,t=e.toISOString().split("T")[0].replace(/-/g,""),r=e.toTimeString().split(" ")[0].replace(/:/g,"");return`backup_${t}_${r}`}(),t={id:e,createdAt:new Date,size:0,tables:l,status:"pending"};try{let r={};for(let e of l)try{let{data:t,error:n}=await c.O.from(e).select("*");n?(console.warn(`Warning: Could not backup table ${e}:`,n.message),r[e]=[]):(r[e]=t||[],JSON.stringify(t).length)}catch(t){console.warn(`Warning: Error backing up table ${e}:`,t),r[e]=[]}let n=JSON.stringify({metadata:{id:e,createdAt:t.createdAt.toISOString(),version:"1.0",tables:l},data:r},null,2);return t.size=n.length,t.status="completed",t.expiresAt=new Date(Date.now()+6048e5),console.log(`Backup ${e} created successfully. Size: ${function(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}(t.size)}`),t}catch(e){throw t.status="failed",console.error("Backup failed:",e),e}}async function p(e){let t=e.tables||l,r={};for(let n of t)try{let t=c.O.from(n).select("*");e.dateRange&&(t=t.gte("created_at",e.dateRange.start.toISOString()).lte("created_at",e.dateRange.end.toISOString()));let{data:a,error:s}=await t;s?(console.warn(`Warning: Could not export table ${n}:`,s.message),r[n]=[]):r[n]=a||[]}catch(e){console.warn(`Warning: Error exporting table ${n}:`,e),r[n]=[]}return"csv"===e.format?function(e){let t=[];for(let[r,n]of Object.entries(e))0!==n.length&&(t.push(`# Table: ${r}`),t.push(g(n)),t.push(""));return t.join("\n")}(r):JSON.stringify(r,null,2)}async function d(e){try{let{data:t,error:r}=await c.O.from(e).select("*");if(r)throw r;if(!t||0===t.length)return"";return g(t)}catch(t){throw console.error(`Error exporting table ${e}:`,t),t}}function g(e){if(0===e.length)return"";let t=Object.keys(e[0]),r=e.map(e=>t.map(t=>{let r=e[t];if(null==r)return"";if("object"==typeof r)return JSON.stringify(r);let n=String(r);return n.includes(",")||n.includes('"')||n.includes("\n")?`"${n.replace(/"/g,'""')}"`:n}).join(","));return[t.join(","),...r].join("\n")}async function f(){return[{id:"backup_20241127_030000",createdAt:new Date(Date.now()-108e5),size:256e6,tables:l,status:"completed",expiresAt:new Date(Date.now()+6048e5)},{id:"backup_20241126_030000",createdAt:new Date(Date.now()-972e5),size:254e6,tables:l,status:"completed",expiresAt:new Date(Date.now()+5184e5)},{id:"backup_20241125_030000",createdAt:new Date(Date.now()-1836e5),size:252e6,tables:l,status:"completed",expiresAt:new Date(Date.now()+432e6)}]}async function m(e){try{return console.log(`Backup ${e} deleted`),!0}catch(e){return console.error("Error deleting backup:",e),!1}}let b="force-dynamic";async function h(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action");if("export-table"===r){let e=t.get("table");if(!e)return i.NextResponse.json({error:"Table name is required"},{status:400});let r=await d(e);return new Response(r,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="${e}_${new Date().toISOString().split("T")[0]}.csv"`}})}if("export"===r){let e=t.get("format")||"json",r=t.get("tables")?.split(","),n=await p({format:e,tables:r}),a="csv"===e?"text/csv":"application/json";return new Response(n,{headers:{"Content-Type":a,"Content-Disposition":`attachment; filename="valle360_export_${new Date().toISOString().split("T")[0]}.${e}"`}})}let n=await f();return i.NextResponse.json({backups:n})}catch(e){return console.error("Error in backup GET:",e),i.NextResponse.json({error:"Failed to process request"},{status:500})}}async function w(){try{let e=await u();return i.NextResponse.json({success:!0,backup:e},{status:201})}catch(e){return console.error("Error creating backup:",e),i.NextResponse.json({error:"Failed to create backup"},{status:500})}}async function y(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"Backup ID is required"},{status:400});if(!await m(r))return i.NextResponse.json({error:"Failed to delete backup"},{status:500});return i.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting backup:",e),i.NextResponse.json({error:"Failed to delete backup"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/backup/route",pathname:"/api/backup",filename:"route",bundlePath:"app/api/backup/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\backup\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:k,staticGenerationAsyncStorage:S,serverHooks:I}=x,O="/api/backup/route";function j(){return(0,o.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:S})}},1926:(e,t,r)=>{r.d(t,{O:()=>o});var n=r(54128);let a="https://ikjgsqtykkhqimypacro.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";a&&s||console.error("âŒ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let o=(0,n.eI)(a||"https://setup-missing.supabase.co",s||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128],()=>r(84));module.exports=n})();