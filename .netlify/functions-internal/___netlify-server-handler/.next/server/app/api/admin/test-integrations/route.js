"use strict";(()=>{var e={};e.id=29955,e.ids=[29955],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},98336:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>R,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var r={};n.r(r),n.d(r,{GET:()=>u,dynamic:()=>l});var s=n(49303),o=n(88716),a=n(60670),i=n(87070),c=n(20344),p=n(71615);let l="force-dynamic";async function u(e){try{let e=(0,p.cookies)(),t=(0,c.createRouteHandlerClient)({cookies:()=>e}),{data:n}=await t.auth.getUser();if(!n.user?.id)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:r}=await t.rpc("is_admin");if(!r)return i.NextResponse.json({error:"Acesso negado"},{status:403});let s={timestamp:new Date().toISOString(),environment:"production"};s.sendgrid={configured:!0,mode:"mailto",fromEmail:process.env.SENDGRID_FROM_EMAIL||"noreply@valle360.com.br",fromName:process.env.SENDGRID_FROM_NAME||"Valle 360",connectionTest:"MAILTO"};let o=(process.env.CPANEL_USER||"").trim(),a=(process.env.CPANEL_PASSWORD||"").trim(),l=(process.env.CPANEL_DOMAIN||"").trim();if(s.cpanel={configured:!!(o&&a&&l),user:o||"N\xc3O CONFIGURADO",passwordSet:a?"SIM (****)":"N\xc3O CONFIGURADO",domain:l||"N\xc3O CONFIGURADO"},o&&a&&l)try{let e=Buffer.from(`${o}:${a}`).toString("base64"),t=l;/^https?:\/\//i.test(t)||(t=`https://${t}`),t=t.replace(/\/+$/,"");let n=`${t}/execute/Email/list_pops`,r=await fetch(n,{method:"GET",headers:{Authorization:`Basic ${e}`}}),i=await r.text();if(r.ok&&!i.includes("<!DOCTYPE"))try{let e=JSON.parse(i);s.cpanel.connectionTest="SUCCESS",s.cpanel.emailAccounts=e.data?.length||0}catch{s.cpanel.connectionTest="PARTIAL",s.cpanel.note="Resposta n\xe3o \xe9 JSON v\xe1lido"}else i.includes("<!DOCTYPE")||i.includes("<html")?(s.cpanel.connectionTest="FAILED",s.cpanel.error="cPanel retornou p\xe1gina HTML (prov\xe1vel erro de autentica\xe7\xe3o ou URL incorreta)",s.cpanel.hint="Verifique: 1) URL com porta (ex: https://servidor:2083), 2) Usu\xe1rio/senha corretos, 3) IP n\xe3o bloqueado"):(s.cpanel.connectionTest="FAILED",s.cpanel.error=`Status ${r.status}`,s.cpanel.responsePreview=i.substring(0,200))}catch(e){s.cpanel.connectionTest="ERROR",s.cpanel.error=e.message}let{data:u}=await t.from("integration_configs").select("integration_id, status").in("integration_id",["sendgrid","cpanel"]);return s.database={integrations:u||[]},i.NextResponse.json({success:!0,results:s})}catch(e){return console.error("[TestIntegrations] Erro:",e),i.NextResponse.json({success:!1,error:e.message},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/test-integrations/route",pathname:"/api/admin/test-integrations",filename:"route",bundlePath:"app/api/admin/test-integrations/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\test-integrations\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x}=d,R="/api/admin/test-integrations/route";function f(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[89276,55972,54128,20958],()=>n(98336));module.exports=r})();