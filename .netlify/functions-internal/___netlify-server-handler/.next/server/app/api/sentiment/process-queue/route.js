"use strict";(()=>{var e={};e.id=46634,e.ids=[46634],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},31659:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>_,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>q,POST:()=>x,dynamic:()=>d});var n=r(49303),o=r(88716),a=r(60670),i=r(87070),u=r(96181),c=r(20344),p=r(71615),l=r(90176);let d="force-dynamic";async function m(e){try{let e=(0,p.cookies)(),t=(0,c.createRouteHandlerClient)({cookies:()=>e}),{data:r}=await t.auth.getUser();if(!r?.user?.id)return!1;let{data:s}=await t.rpc("is_admin");return!!s}catch{return!1}}async function x(e){try{if(!(function(e){let t=e.headers.get("x-cron-key")||e.headers.get("authorization")?.replace("Bearer ",""),r=process.env.CRON_SECRET||process.env.VERCEL_CRON_SECRET;return t===r}(e)||await m(e)))return i.NextResponse.json({error:"Unauthorized",message:"Cron key inv\xe1lida (ou sess\xe3o admin ausente)"},{status:401});let{mode:t="batch",max_items:r=50}=await e.json().catch(()=>({}));if("single"===t){let e=await (0,u.dH)();return i.NextResponse.json({success:!0,mode:"single",processed:null!==e,result:e?{id:e.id,source_type:e.source_type,overall_sentiment:e.overall_sentiment,score:e.score,alert_generated:e.alert_generated}:null})}let s=await (0,u.cv)(r);return i.NextResponse.json({success:!0,mode:"batch",...s})}catch(e){return console.error("Erro ao processar fila:",e),i.NextResponse.json({error:"Internal Server Error",message:e.message},{status:500})}}async function q(e){try{let e=(0,p.cookies)(),t=(0,c.createRouteHandlerClient)({cookies:()=>e}),{data:r}=await t.auth.getUser();if(!r?.user?.id)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:s}=await t.rpc("is_admin");if(!s)return i.NextResponse.json({error:"Acesso negado (admin)"},{status:403});let n=(0,l.t)(),[o,a,u,d]=await Promise.all([n.from("sentiment_processing_queue").select("id",{count:"exact",head:!0}).eq("status","pending"),n.from("sentiment_processing_queue").select("id",{count:"exact",head:!0}).eq("status","processing"),n.from("sentiment_processing_queue").select("id",{count:"exact",head:!0}).eq("status","failed"),n.from("sentiment_processing_queue").select("id",{count:"exact",head:!0}).eq("status","completed").gte("completed_at",new Date().toISOString().split("T")[0])]);return i.NextResponse.json({queue_status:{pending:o.count||0,processing:a.count||0,failed:u.count||0,completed_today:d.count||0}})}catch(e){return console.error("Erro ao buscar status da fila:",e),i.NextResponse.json({error:"Internal Server Error",message:e.message},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/sentiment/process-queue/route",pathname:"/api/sentiment/process-queue",filename:"route",bundlePath:"app/api/sentiment/process-queue/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\sentiment\\process-queue\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:_}=g,v="/api/sentiment/process-queue/route";function y(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,54214,68546,96181],()=>r(31659));module.exports=s})();