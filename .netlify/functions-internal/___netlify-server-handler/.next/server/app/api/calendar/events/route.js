"use strict";(()=>{var e={};e.id=62989,e.ids=[62989],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},35816:e=>{e.exports=require("process")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},72254:e=>{e.exports=require("node:buffer")},87561:e=>{e.exports=require("node:fs")},83074:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},97742:e=>{e.exports=require("node:process")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},65628:e=>{e.exports=require("node:zlib")},41044:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>R,requestAsyncStorage:()=>h,routeModule:()=>q,serverHooks:()=>y,staticGenerationAsyncStorage:()=>k});var s={};r.r(s),r.d(s,{GET:()=>f,POST:()=>g,dynamic:()=>_});var o=r(49303),n=r(88716),a=r(60670),i=r(87070),c=r(20344),u=r(71615),d=r(90176),l=r(97816);function p(e,t){let r=new l.lkr.auth.OAuth2(process.env.GOOGLE_CLIENT_ID,process.env.GOOGLE_CLIENT_SECRET,process.env.GOOGLE_REDIRECT_URI);return r.setCredentials({access_token:e,refresh_token:t}),l.lkr.calendar({version:"v3",auth:r})}async function m(e,t,r,s="primary"){try{let o=p(e,t),n={summary:r.summary,description:r.description,location:r.location,start:{dateTime:r.start.toISOString(),timeZone:"America/Sao_Paulo"},end:{dateTime:r.end.toISOString(),timeZone:"America/Sao_Paulo"},attendees:r.attendees?.map(e=>({email:e})),reminders:{useDefault:!1,overrides:[...r.reminders?.email?[{method:"email",minutes:r.reminders.email}]:[],...r.reminders?.popup?[{method:"popup",minutes:r.reminders.popup}]:[]]},recurrence:r.recurrence,colorId:r.colorId};r.conferenceData&&(n.conferenceData={createRequest:{requestId:`valle360-${Date.now()}`,conferenceSolutionKey:{type:"hangoutsMeet"}}});let a=await o.events.insert({calendarId:s,requestBody:n,conferenceDataVersion:r.conferenceData?1:void 0,sendUpdates:"all"});return{success:!0,eventId:a.data.id||void 0,htmlLink:a.data.htmlLink||void 0,meetLink:a.data.hangoutLink||a.data.conferenceData?.entryPoints?.[0]?.uri||void 0}}catch(e){return console.error("Google Calendar create event error:",e),{success:!1,error:e.message||"Failed to create event"}}}async function x(e,t,r={},s="primary"){try{let o=p(e,t),n=await o.events.list({calendarId:s,timeMin:(r.timeMin||new Date).toISOString(),timeMax:r.timeMax?.toISOString(),maxResults:r.maxResults||50,singleEvents:!0,orderBy:"startTime",q:r.query});return{success:!0,events:n.data.items?.map(e=>({id:e.id,summary:e.summary,description:e.description,location:e.location,start:e.start?.dateTime||e.start?.date,end:e.end?.dateTime||e.end?.date,htmlLink:e.htmlLink,meetLink:e.hangoutLink||e.conferenceData?.entryPoints?.[0]?.uri,attendees:e.attendees?.map(e=>({email:e.email,responseStatus:e.responseStatus})),status:e.status}))}}catch(e){return console.error("Google Calendar list events error:",e),{success:!1,error:e.message||"Failed to list events"}}}let v={kickoff:(e,t)=>({summary:`Kickoff - ${e}`,description:`Reuni\xe3o de kickoff com ${e}.

**Pauta:**
- Apresenta\xe7\xe3o da equipe
- Entendimento do projeto
- Defini\xe7\xe3o de objetivos
- Pr\xf3ximos passos

_Valle 360_`,attendees:t,conferenceData:!0,reminders:{email:60,popup:15}}),monthly:(e,t)=>({summary:`Reuni\xe3o Mensal - ${e}`,description:`Reuni\xe3o mensal de acompanhamento com ${e}.

**Pauta:**
- Revis\xe3o de m\xe9tricas
- Apresenta\xe7\xe3o de resultados
- Planejamento do pr\xf3ximo m\xeas
- Feedbacks

_Valle 360_`,attendees:t,conferenceData:!0,reminders:{email:60,popup:15}}),strategy:(e,t)=>({summary:`Reuni\xe3o de Estrat\xe9gia - ${e}`,description:`Reuni\xe3o estrat\xe9gica com ${e}.

**Pauta:**
- An\xe1lise de mercado
- Revis\xe3o de posicionamento
- Planejamento de campanhas
- Defini\xe7\xe3o de metas

_Valle 360_`,attendees:t,conferenceData:!0,reminders:{email:60,popup:15}}),approval:(e,t,r)=>({summary:`Aprova\xe7\xe3o de Conte\xfado - ${e}`,description:`Apresenta\xe7\xe3o e aprova\xe7\xe3o de conte\xfado.

**Conte\xfado:** ${t}

_Valle 360_`,attendees:r,conferenceData:!0,reminders:{email:30,popup:10}})},_="force-dynamic";async function f(e){try{let t=(0,u.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:s}=await r.auth.getUser(),o=s?.user;if(!o)return i.NextResponse.json({success:!1,error:"N\xe3o autorizado"},{status:401});let n=(0,d.t)(),{searchParams:a}=new URL(e.url),l=a.get("start"),p=a.get("end"),{data:m}=await n.from("user_oauth_tokens").select("access_token, refresh_token").eq("user_id",o.id).eq("provider","google_calendar").maybeSingle();if(!m?.access_token){let{data:e}=await n.from("calendar_events").select("*").eq("user_id",o.id).gte("start_time",l||new Date().toISOString()).order("start_time",{ascending:!0});return i.NextResponse.json({success:!0,events:e||[],source:"local"})}let v=await x(m.access_token,m.refresh_token,{timeMin:l?new Date(l):void 0,timeMax:p?new Date(p):void 0,maxResults:100});if(!v.success)return i.NextResponse.json({success:!1,error:v.error},{status:500});return i.NextResponse.json({success:!0,events:v.events,source:"google"})}catch(e){return console.error("Calendar events GET error:",e),i.NextResponse.json({success:!1,error:e?.message||"Erro interno"},{status:500})}}async function g(e){try{let t=(0,u.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:s}=await r.auth.getUser(),o=s?.user;if(!o)return i.NextResponse.json({success:!1,error:"N\xe3o autorizado"},{status:401});let n=(0,d.t)(),{title:a,description:l,start_time:p,end_time:x,duration_minutes:_,attendees:f,create_meet_link:g,template:q,client_id:h,client_name:k,location:y}=await e.json();if(!a||!p)return i.NextResponse.json({success:!1,error:"title e start_time s\xe3o obrigat\xf3rios"},{status:400});let{data:S}=await n.from("user_oauth_tokens").select("access_token, refresh_token").eq("user_id",o.id).eq("provider","google_calendar").maybeSingle(),R=null;if(S?.access_token){let e;if(q&&v[q]){let t=v[q];(e="approval"===q?t(k||"Cliente",l||"",f||[]):t(k||"Cliente",f||[])).start=new Date(p),e.end=new Date(x||new Date(p).getTime()+6e4*(_||60))}else{let t=new Date(p),r=new Date(x||t.getTime()+6e4*(_||60));e={summary:a,description:l,location:y,start:t,end:r,attendees:f,conferenceData:!1!==g,reminders:{email:60,popup:15}}}let t=await m(S.access_token,S.refresh_token,e);t.success?R=t:console.error("Google Calendar error:",t.error)}let{data:w,error:D}=await n.from("calendar_events").insert({user_id:o.id,client_id:h,title:a,description:l,location:y,start_time:p,end_time:x||new Date(new Date(p).getTime()+6e4*(_||60)).toISOString(),attendees:f||[],meet_link:R?.meetLink,google_event_id:R?.eventId,google_event_link:R?.htmlLink,created_at:new Date().toISOString()}).select().single();return D&&console.error("Local event save error:",D),f&&f.length,i.NextResponse.json({success:!0,event:w,google_event:R})}catch(e){return console.error("Calendar events POST error:",e),i.NextResponse.json({success:!1,error:e?.message||"Erro interno"},{status:500})}}let q=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/calendar/events/route",pathname:"/api/calendar/events",filename:"route",bundlePath:"app/api/calendar/events/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\calendar\\events\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:k,serverHooks:y}=q,S="/api/calendar/events/route";function R(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:k})}},90176:(e,t,r)=>{r.d(t,{t:()=>o});var s=r(54128);function o(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,s.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,2749,6684,80843,97816],()=>r(41044));module.exports=s})();