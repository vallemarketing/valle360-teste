"use strict";(()=>{var e={};e.id=16969,e.ids=[16969],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},16585:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>_,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>b});var s={};r.r(s),r.d(s,{GET:()=>h,PUT:()=>w,dynamic:()=>p});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),l=r(20344),c=r(71615),d=r(96263),u=r(52390),m=r(50844);let p="force-dynamic",f=d.Ryn({status:d.KmV(["draft","submitted"]).optional(),notes:d.Z_8().optional().nullable(),responses:d.IXX(d.Ryn({criterion_id:d.Z_8().uuid(),score:d.Rxh().int().min(1).max(5),comment:d.Z_8().optional().nullable()})).optional()});async function x(e,t){let{data:r,error:s}=await e.from("nine_box_responses").select("score, comment, criterion:nine_box_criteria(axis, weight)").eq("assessment_id",t).limit(500);if(s)throw s;let a=[],o=[];for(let e of r||[]){let t=String(e?.criterion?.axis||""),r=Number(e?.criterion?.weight||0),s=Number(e?.score||1);"performance"===t&&a.push({score:s,weight:r}),"potential"===t&&o.push({score:s,weight:r})}let n=(0,m.S)(a),i=(0,m.S)(o),l=(0,m.UA)(n),c=(0,m.UA)(i),d=(0,m.wu)(l,c),u={assessment_id:t,performance_score:(0,m.Xp)(n),potential_score:(0,m.Xp)(i),performance_level:l,potential_level:c,quadrant:d,recommendation:{Q1:"Prioridade: plano de melhoria imediato, alinhamento de expectativas e acompanhamento semanal.",Q2:"Refor\xe7ar consist\xeancia: coaching e metas claras para elevar performance.",Q3:"Baixo potencial com alta performance: manter, reconhecer e explorar especializa\xe7\xe3o t\xe9cnica.",Q4:"Potencial m\xe9dio e baixa performance: identificar bloqueios, treinar e definir plano de curto prazo.",Q5:"Centro: manter desenvolvimento cont\xednuo e objetivos progressivos.",Q6:"Boa performance: ampliar desafios e preparar para responsabilidades maiores.",Q7:"Alto potencial, baixa performance: focar em fit de fun\xe7\xe3o, mentoria e plano estruturado.",Q8:"Alto potencial e performance m\xe9dia: acelerar desenvolvimento e oportunidades de lideran\xe7a.",Q9:"Top talent: reten\xe7\xe3o, crescimento acelerado e trilha de lideran\xe7a."}[d]||"Plano de desenvolvimento recomendado conforme quadrante.",computed_at:new Date().toISOString()},{data:p,error:f}=await e.from("nine_box_results").upsert(u,{onConflict:"assessment_id"}).select("*").single();if(f)throw f;return p}async function h(e,t){try{let e=(0,c.cookies)(),r=(0,l.createRouteHandlerClient)({cookies:()=>e}),s=await (0,u.V)({supabase:r});if(!s.allowed)return i.NextResponse.json({error:s.reason||"Acesso negado"},{status:403});let a=String(t.params.id),{data:o,error:n}=await r.from("nine_box_assessments").select(`
        *,
        employee:employees(id, full_name, department, position),
        result:nine_box_results(*)
      `).eq("id",a).maybeSingle();if(n)throw n;if(!o)return i.NextResponse.json({error:"Avalia\xe7\xe3o n\xe3o encontrada"},{status:404});let{data:d,error:m}=await r.from("nine_box_responses").select("*, criterion:nine_box_criteria(id, axis, key, label, description, weight)").eq("assessment_id",a).limit(500);if(m)throw m;return i.NextResponse.json({success:!0,assessment:o,responses:d||[]})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}async function w(e,t){try{let r=(0,c.cookies)(),s=(0,l.createRouteHandlerClient)({cookies:()=>r}),a=await (0,u.V)({supabase:s});if(!a.allowed)return i.NextResponse.json({error:a.reason||"Acesso negado"},{status:403});let o=String(t.params.id),n=f.parse(await e.json()),{data:d,error:m}=await s.from("nine_box_assessments").select("*").eq("id",o).maybeSingle();if(m)throw m;if(!d)return i.NextResponse.json({error:"Avalia\xe7\xe3o n\xe3o encontrada"},{status:404});if(n.responses&&n.responses.length){let{error:e}=await s.from("nine_box_responses").upsert(n.responses.map(e=>({assessment_id:o,criterion_id:e.criterion_id,score:e.score,comment:e.comment||null})),{onConflict:"assessment_id,criterion_id"});if(e)throw e}let p=n.status||d.status;if("submitted"===p){let{data:e}=await s.from("nine_box_responses").select("score, comment").eq("assessment_id",o).limit(500);if((e||[]).filter(e=>[1,2,5].includes(Number(e.score))&&!String(e.comment||"").trim()).length)return i.NextResponse.json({error:"Justificativa obrigat\xf3ria para notas 1, 2 e 5."},{status:400})}let{data:h,error:w}=await s.from("nine_box_assessments").update({...void 0!==n.notes?{notes:n.notes}:{},...void 0!==n.status?{status:n.status}:{},..."submitted"===n.status?{submitted_at:new Date().toISOString()}:{}}).eq("id",o).select("*").single();if(w)throw w;let g=null;return"submitted"===h.status&&(g=await x(s,o)),i.NextResponse.json({success:!0,assessment:h,result:g})}catch(e){if(e?.name==="ZodError")return i.NextResponse.json({error:"Payload inv\xe1lido",details:e.errors},{status:400});return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/nine-box/assessments/[id]/route",pathname:"/api/nine-box/assessments/[id]",filename:"route",bundlePath:"app/api/nine-box/assessments/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\nine-box\\assessments\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:b,serverHooks:y}=g,v="/api/nine-box/assessments/[id]/route";function A(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:b})}},52390:(e,t,r)=>{async function s(e,t,r){try{let{data:s,error:a}=await e.rpc(t,r);if(a)return{ok:!1,error:a};return{ok:!0,data:s}}catch(e){return{ok:!1,error:e}}}function a(e){return Array.from(new Set(e.map(e=>String(e)).filter(Boolean)))}async function o(e){let t=e.supabase,{data:r}=await t.auth.getUser(),o=r.user?.id;if(!o)return{userId:"",isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let n=await s(t,"is_admin"),i=!!n.ok&&!!n.data;if(i)return{userId:o,isAdmin:i,allowed:!0,areaKeys:[]};let l=await s(t,"employee_area_keys");if(l.ok&&Array.isArray(l.data)){let e=a(l.data),t=e.includes("rh");return{userId:o,isAdmin:i,allowed:t,reason:t?void 0:"Acesso restrito: RH",areaKeys:e}}let{data:c}=await t.from("employees").select("areas, department, is_active").eq("user_id",o).maybeSingle(),d=a([...Array.isArray(c?.areas)?c.areas.map(String):[]]),u=d.includes("rh")||String(c?.department||"").toLowerCase().includes("rh");return{userId:o,isAdmin:i,allowed:u,reason:u?void 0:"Acesso restrito: RH",areaKeys:d}}r.d(t,{V:()=>o})},50844:(e,t,r)=>{function s(e){return e<=2.33?"low":e<=3.66?"mid":"high"}function a(e,t){return"low"===t&&"low"===e?"Q1":"low"===t&&"mid"===e?"Q2":"low"===t&&"high"===e?"Q3":"mid"===t&&"low"===e?"Q4":"mid"===t&&"mid"===e?"Q5":"mid"===t&&"high"===e?"Q6":"high"===t&&"low"===e?"Q7":"high"===t&&"mid"===e?"Q8":"Q9"}function o(e){return Math.round(100*e)/100}function n(e){let t=e.filter(e=>Number.isFinite(e.score)&&Number.isFinite(e.weight)&&e.weight>0),r=t.reduce((e,t)=>e+t.weight,0);return r?t.reduce((e,t)=>e+t.score*t.weight,0)/r:1}r.d(t,{S:()=>n,UA:()=>s,Xp:()=>o,wu:()=>a})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,96263],()=>r(16585));module.exports=s})();