"use strict";(()=>{var e={};e.id=36148,e.ids=[36148],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},59900:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>I,routeModule:()=>S,serverHooks:()=>A,staticGenerationAsyncStorage:()=>b});var s={};a.r(s),a.d(s,{GET:()=>v,dynamic:()=>d});var n=a(49303),r=a(88716),i=a(60670),o=a(87070),l=a(20344),c=a(71615),p=a(54128),u=a(57157),_=a(90176);let d="force-dynamic";function m(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function g(e){return String(e||"").split(",").map(e=>e.trim()).filter(Boolean)}function E(e){return e?"pass":"fail"}function f(e){return String(e||"").toLowerCase()}async function h(e,t){let{error:a}=await e.from(t).select("*",{head:!0,count:"exact"}).limit(1);return a?!function(e){let t=f(e);return t.includes("does not exist")||t.includes("relation")||t.includes("not found")||t.includes("schema cache")||t.includes("could not find the table")}(a.message)?{ok:!1,status:"warn",reason:a.message}:{ok:!1,status:"fail",reason:a.message}:{ok:!0,status:"pass"}}async function v(e){let t=(0,c.cookies)(),a=(0,l.createRouteHandlerClient)({cookies:()=>t}),s=e.headers.get("authorization")||"",n=s.toLowerCase().startsWith("bearer ")?s.slice(7).trim():null,r=n?(0,p.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${n}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):a,{data:i}=await r.auth.getUser();if(!i.user?.id)return o.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:d,error:v}=await r.rpc("is_admin");if(v||!d)return o.NextResponse.json({error:"Acesso negado (admin)"},{status:403});try{let e=new Date().toISOString(),t=function(){let e=String(process.env.VERCEL_ENV||process.env.NEXT_PUBLIC_VERCEL_ENV||"").trim().toLowerCase();return"production"===e||"preview"===e||"development"===e?e:"production"}(),a=function(){let e=process.env.NEXT_PUBLIC_APP_URL||process.env.NEXT_PUBLIC_SITE_URL||process.env.SITE_URL||null;if(e)return String(e);let t=process.env.VERCEL_URL?String(process.env.VERCEL_URL):null;return t?t.startsWith("http")?t:`https://${t}`:null}(),s=(0,_.t)(),[{count:n},{count:r},{count:i}]=await Promise.all([s.from("event_log").select("*",{count:"exact",head:!0}).eq("status","pending"),s.from("workflow_transitions").select("*",{count:"exact",head:!0}).eq("status","pending"),s.from("workflow_transitions").select("*",{count:"exact",head:!0}).eq("status","error")]),{data:l}=await s.from("integration_configs").select("integration_id, display_name, category, status, last_sync, error_message, api_key, access_token, config").order("display_name"),c=(l||[]).map(e=>({id:e.integration_id,name:e.display_name,category:e.category,status:e.status,connected:"connected"===e.status,hasCredentials:!!(e.api_key||e.access_token),lastSync:e.last_sync,error:e.error_message})),p={},d={},S=e=>(l||[]).find(t=>t.integration_id===e);for(let e of["openrouter","openai","stripe"]){let t=S(e),a=t?.status==="connected"&&!!(t?.api_key||t?.access_token),s="openrouter"===e&&!!process.env.OPENROUTER_API_KEY||"openai"===e&&!!process.env.OPENAI_API_KEY||"stripe"===e&&!!process.env.STRIPE_SECRET_KEY;p[e]=a||s?"pass":"warn"}for(let e of["whatsapp","instagramback","n8n","perplexity"]){let t=S(e),a="whatsapp"===e?t?.status==="connected"&&!!t?.access_token&&!!t?.config?.phoneNumberId:t?.status==="connected"&&(!!(t?.api_key||t?.access_token)||!!(t?.config?.baseUrl||t?.config?.webhookUrl)),s="whatsapp"===e&&!!process.env.WHATSAPP_ACCESS_TOKEN&&!!process.env.WHATSAPP_PHONE_NUMBER_ID||"perplexity"===e&&!!process.env.PERPLEXITY_API_KEY,n=!!(t?.api_key||t?.access_token||t?.config&&Object.keys(t.config||{}).length>0),r=!!(a||s||n);d[e]={applicable:r,status:r&&(a||s)?"pass":"warn"}}let I={openrouter:(l||[]).find(e=>"openrouter"===e.integration_id)?.status==="connected"&&(l||[]).find(e=>"openrouter"===e.integration_id)?.api_key?"db":process.env.OPENROUTER_API_KEY?"env":"none",openai:(l||[]).find(e=>"openai"===e.integration_id)?.status==="connected"&&(l||[]).find(e=>"openai"===e.integration_id)?.api_key?"db":process.env.OPENAI_API_KEY?"env":"none"},b={status:process.env.CPANEL_USER&&process.env.CPANEL_PASSWORD&&process.env.CPANEL_DOMAIN?"pass":"warn",env:{hasUser:!!process.env.CPANEL_USER,hasPassword:!!process.env.CPANEL_PASSWORD,hasDomain:!!process.env.CPANEL_DOMAIN,hasWebmailUrl:!!(process.env.WEBMAIL_URL||process.env.CPANEL_WEBMAIL_URL||process.env.NEXT_PUBLIC_WEBMAIL_URL)}},A=await Promise.all(["notifications","integration_configs","integration_logs","kanban_boards","kanban_columns","kanban_tasks","kanban_task_comments","clients","employees","user_profiles","direct_conversations","direct_conversation_participants","direct_messages","alert_recipient_rules","instagram_posts","social_connected_accounts","social_account_metrics_daily","social_post_metrics","client_ai_insights","prospecting_leads","goal_configs","collaborator_goals","production_history","ml_predictions_log","client_health_scores","super_admin_insights","ai_executives","ai_executive_conversations","ai_executive_messages","ai_executive_meetings","ai_executive_meeting_messages","ai_executive_insights","ai_executive_decisions","ai_executive_knowledge","ai_executive_web_searches","ai_executive_data_access_log","ai_executive_alerts","ai_executive_triggers","ai_executive_action_drafts","sentiment_analyses","sentiment_processing_queue","sentiment_alerts","sentiment_daily_stats","sentiment_automation_config","job_openings"].map(async e=>{let t=await h(s,e);return{table:e,...t}})),y=A.some(e=>"fail"===e.status)?"fail":A.some(e=>"warn"===e.status)?"warn":"pass",w=["collection","overdue","ml","alerts","social-publish","social-metrics"],R="production"===t||"true"===process.env.ENABLE_CRON_IN_PREVIEW,P=R?await Promise.all(w.map(async e=>{let t=new Date(Date.now()-864e5).toISOString(),{data:a}=await s.from("integration_logs").select("status, created_at, error_message").eq("integration_id","cron").eq("action",e).gte("created_at",t).order("created_at",{ascending:!1}).limit(1).maybeSingle(),n=a?.created_at&&"ok"===String(a?.status)?"pass":"warn";return{job:e,applicable:!0,status:n,lastRunAt:a?.created_at||null,lastStatus:a?.status||null,lastError:a?.error_message||null}})):w.map(e=>({job:e,applicable:!1,status:"warn",lastRunAt:null,lastStatus:null,lastError:null})),N=P.some(e=>e.applicable&&"warn"===e.status)?"warn":"pass",{data:C}=await s.from("employees").select("id, department, area_of_expertise, areas, is_active").eq("is_active",!0),T=new Map;for(let e of u.Nd)T.set(e.areaKey,0);let L=e=>{e&&T.has(e)&&T.set(e,(T.get(e)||0)+1)};for(let e of C||[]){let t=[];e?.department&&t.push(String(e.department)),e?.area_of_expertise&&t.push(String(e.area_of_expertise)),Array.isArray(e?.areas)&&t.push(...e.areas.map(e=>String(e)));let a=new Set;for(let e of t){let t=(0,u.IY)(e);t&&a.add(t)}if(0===a.size&&e?.department){let t=(0,u.IY)(String(e.department));t&&a.add(t)}for(let e of a)L(e)}let k=u.Nd.map(e=>{let t=T.get(e.areaKey)||0;return{area:e.label,areaKey:e.areaKey,activeEmployees:t,status:t>0?"pass":"warn"}}),[{count:x},{count:U}]=await Promise.all([s.from("goal_configs").select("*",{count:"exact",head:!0}),s.from("ml_models").select("*",{count:"exact",head:!0})]),O=!v,B="true"===String(process.env.NEXT_PUBLIC_TEST_MODE||"").toLowerCase(),q=String(process.env.ALERTS_ACTOR_USER_ID||"").trim(),D=0,X=0;try{let{data:e}=await s.from("user_profiles").select("user_id,email,role,user_type,is_active").eq("is_active",!0).limit(200),t=e||[],a=e=>{let t=String(e?.role||"").toLowerCase(),a=String(e?.user_type||"").toLowerCase();return"admin"===t||"super_admin"===t||"super_admin"===a};D=t.filter(a).map(e=>String(e.email||"")).filter(Boolean).length,X=t.filter(a).map(e=>String(e.user_id||"")).filter(m).length}catch{}let j=g(process.env.ALERTS_NOTIFY_EMAILS),M=g(process.env.ALERTS_NOTIFY_WHATSAPP_PHONES),Y=g(process.env.ALERTS_NOTIFY_INTRANET_USER_IDS).filter(e=>m(e)),F=0,K=0,V=!1;try{let{data:e}=await s.from("alert_recipient_rules").select("channel,is_enabled").eq("is_enabled",!0).limit(1e3),t=e||[];V=t.length>0,F=t.filter(e=>"email"===String(e.channel||"")).length,K=t.filter(e=>"intranet"===String(e.channel||"")).length}catch{V=!1,F=0,K=0}let W={applicable:!0,actorUserIdConfigured:!!q,actorUserIdValid:m(q),sendgridFromConfigured:!0,hasEmailRecipientsEnv:j.length>0,hasWhatsAppRecipientsEnv:M.length>0,hasIntranetRecipientsEnv:Y.length>0,hasRecipientsDb:V,dbEmailRecipients:F,dbIntranetRecipients:K,fallbackAdminEmails:D,fallbackAdminUserIds:X,status:j.length>0||F>0||D>0||d.whatsapp?.status==="pass"&&M.length>0||m(q)&&(Y.length>0||K>0||X>0)?"pass":"warn"},J=!!process.env.TAVILY_API_KEY,z=[],G=!1,H=!1,Z=null,$=!0,Q=null;try{let{data:e}=await s.from("kanban_boards").select("id,area_key").limit(200),t=e||[];z=u.Nd.map(e=>String(e.areaKey)).filter(e=>!t.some(t=>String(t?.area_key||"")===e));let a=e=>t.find(t=>String(t?.area_key||"")===e)?.id||null,n=a("rh"),r=a("operacao");if(n){let{data:e}=await s.from("kanban_columns").select("id").eq("board_id",n).eq("stage_key","demanda").maybeSingle();G=!!e?.id}if(r){let{data:e}=await s.from("kanban_columns").select("id").eq("board_id",r).eq("stage_key","demanda").maybeSingle();H=!!e?.id}}catch{}Z=await h(s,"employee_client_assignments");try{let{error:e}=await s.from("clients").select("id,segment,competitors",{head:!0}).limit(1);e&&function(e){let t=f(e);return t.includes("column")&&(t.includes("does not exist")||t.includes("could not find"))}(e.message)&&($=!1,Q=e.message)}catch(e){$=!1,Q=e?.message||"Falha ao validar colunas do perfil do cliente"}let ee=$&&(G||H)?z.length>0||Z?.status!=="pass"||!J?"warn":"pass":"fail",et={applicable:!0,status:ee,collaborator:{employeeClientAssignments:Z},kanban:{missingAreaBoards:z,requestsDemandColumn:{rh:G,operacao:H,ok:G||H}},client:{profileColumns:{ok:$,reason:Q}},prospecting:{tavilyConfigured:J}},ea={hub:{applicable:!0,status:"pass",pendingEvents:n||0,pendingTransitions:r||0,errorTransitions:i||0},security:{applicable:!0,testModeEnabled:B,status:"production"===t&&B?"fail":B?"warn":"pass",notes:"production"===t&&B?"NEXT_PUBLIC_TEST_MODE=true em produ\xe7\xe3o \xe9 cr\xedtico (bypass de autentica\xe7\xe3o).":B?"NEXT_PUBLIC_TEST_MODE=true: permitido apenas para QA local/preview.":"OK"},areas:{applicable:!0,status:k.some(e=>"pass"!==e.status)?"warn":"pass",coverage:k},integrations:{applicable:!0,status:Object.values(p).some(e=>"warn"===e)?"warn":"pass",required:p,optional:d,items:c},ai:{applicable:!0,status:"pass"===p.openrouter||"pass"===p.openai?"pass":"warn",providers:{openrouter:p.openrouter,openai:p.openai},source:I},ml:{applicable:!0,status:E((x||0)>0||(U||0)>0),goalConfigs:x||0,mlModels:U||0},sql:{applicable:!0,status:E(O),rpc:{is_admin:O?"pass":"fail"}},schema:{applicable:!0,status:y,criticalTables:A},cron:{applicable:R,status:N,reason:R?null:"Crons do Vercel rodam apenas em produ\xe7\xe3o (preview: n\xe3o aplic\xe1vel).",jobs:P},alerts:W,qa:et,cpanel:{...b,applicable:!0}},es={applicable:"true"===process.env.ENABLE_FIREBASE_STORAGE,status:"true"===process.env.ENABLE_FIREBASE_STORAGE&&process.env.NEXT_PUBLIC_FIREBASE_API_KEY&&process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN&&process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID&&process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET&&process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID&&process.env.NEXT_PUBLIC_FIREBASE_APP_ID?"pass":"warn"},en=[ea.hub.applicable?ea.hub.status:null,ea.security?.applicable?ea.security.status:null,ea.areas.applicable?ea.areas.status:null,ea.integrations.applicable?ea.integrations.status:null,ea.ai.applicable?ea.ai.status:null,ea.ml.applicable?ea.ml.status:null,ea.sql.applicable?ea.sql.status:null,ea.schema.applicable?ea.schema.status:null,ea.cron.applicable?ea.cron.status:null,ea.alerts?.applicable?ea.alerts.status:null,ea.qa?.applicable?ea.qa.status:null,ea.cpanel.applicable?ea.cpanel.status:null,es.applicable?es.status:null].filter(Boolean),er=en.includes("fail")?"fail":en.includes("warn")?"warn":"pass";return o.NextResponse.json({success:!0,timestamp:e,environment:{vercelEnv:t,nodeEnv:"production",appUrl:a},overall:er,checks:ea,firebase:es})}catch(e){return o.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let S=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/readiness/route",pathname:"/api/admin/readiness",filename:"route",bundlePath:"app/api/admin/readiness/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\readiness\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:I,staticGenerationAsyncStorage:b,serverHooks:A}=S,y="/api/admin/readiness/route";function w(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:b})}},90176:(e,t,a)=>{a.d(t,{t:()=>n});var s=a(54128);function n(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,s.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,57157],()=>a(59900));module.exports=s})();