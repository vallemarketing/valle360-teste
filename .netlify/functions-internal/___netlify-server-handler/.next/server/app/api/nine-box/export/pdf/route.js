"use strict";(()=>{var e={};e.id=84835,e.ids=[84835],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},51745:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>$,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>c,dynamic:()=>f});var a=r(49303),o=r(88716),s=r(60670),i=r(87070),u=r(20344),l=r(71615),p=r(52390);let f="force-dynamic";function d(e){return null==e?"":String(e)}async function c(e){try{let t=(0,l.cookies)(),r=(0,u.createRouteHandlerClient)({cookies:()=>t}),n=await (0,p.V)({supabase:r});if(!n.allowed)return i.NextResponse.json({error:n.reason||"Acesso negado"},{status:403});let{searchParams:a}=new URL(e.url),o=a.get("cycle_id");if(!o)return i.NextResponse.json({error:"cycle_id \xe9 obrigat\xf3rio"},{status:400});let{data:s}=await r.from("nine_box_cycles").select("*").eq("id",o).maybeSingle(),{data:f,error:c}=await r.from("nine_box_assessments").select(`
        id, status, submitted_at, updated_at,
        employee:employees(id, full_name, department, position),
        result:nine_box_results(performance_score, potential_score, quadrant, recommendation)
      `).eq("cycle_id",o).order("updated_at",{ascending:!1}).limit(2e3);if(c)throw c;let m=(f||[]).filter(e=>e.result),h={};for(let e of m){let t=String(e.result.quadrant||"â€”");h[t]=(h[t]||0)+1}let g=[];for(let e of(g.push(`Ciclo: ${d(s?.name||o)} (${d(s?.status||"")})`),g.push(`Gerado em: ${new Date().toISOString()}`),g.push(""),g.push("Distribui\xe7\xe3o por quadrante:"),["Q9","Q8","Q7","Q6","Q5","Q4","Q3","Q2","Q1"]))g.push(`- ${e}: ${h[e]||0}`);for(let e of(g.push(""),g.push("Amostra (at\xe9 60 colaboradores):"),m.slice(0,60))){let t=e.employee||{},r=e.result||{};g.push(`${d(t.full_name||t.name||t.id)} | ${d(t.department||"")} | ${d(t.position||"")} | Perf ${d(r.performance_score)} / Pot ${d(r.potential_score)} | ${d(r.quadrant)}`)}m.length>60&&g.push(`... (${m.length-60} a mais)`);let x=function(e){let t=Buffer.from("%PDF-1.4\n","utf8"),r=[],n=[];function a(e){let t=r.length+1,n=Buffer.isBuffer(e)?e:Buffer.from(e,"utf8"),a=Buffer.concat([Buffer.from(`${t} 0 obj
`,"utf8"),n,Buffer.from("\nendobj\n","utf8")]);return r.push(a),t}let o=a("<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>"),s=[e.title,"",...e.lines],i=[];i.push("BT"),i.push("/F1 12 Tf"),i.push("50 800 Td");for(let e=0;e<s.length;e++){let t=String(s[e]||"").replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)");0===e||i.push("0 -14 Td"),i.push(`(${t}) Tj`)}i.push("ET");let u=i.join("\n"),l=Buffer.from(u,"utf8"),p=a(Buffer.concat([Buffer.from(`<< /Length ${l.length} >>
stream
`,"utf8"),l,Buffer.from("\nendstream","utf8")])),f=a(`<< /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Resources << /Font << /F1 ${o} 0 R >> >> /Contents ${p} 0 R >>`),d=a(`<< /Type /Pages /Count 1 /Kids [${f} 0 R] >>`),c=a(`<< /Type /Catalog /Pages ${d} 0 R >>`),m=[t],h=t.length;for(let e of(n.push(0),r))n.push(h),m.push(e),h+=e.length;let g=h,x=[];x.push("xref"),x.push(`0 ${r.length+1}`),x.push("0000000000 65535 f ");for(let e=1;e<n.length;e++)x.push(`${String(n[e]).padStart(10,"0")} 00000 n `);let y=`trailer
<< /Size ${r.length+1} /Root ${c} 0 R >>
startxref
${g}
%%EOF
`;return m.push(Buffer.from(x.join("\n")+"\n"+y,"utf8")),Buffer.concat(m)}({title:"Relat\xf3rio 9 Box (Matriz de Talentos)",lines:g}),y=`nine-box_${o}.pdf`,$=new Uint8Array(x);return new i.NextResponse($,{status:200,headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename="${y}"`,"Cache-Control":"no-store"}})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/nine-box/export/pdf/route",pathname:"/api/nine-box/export/pdf",filename:"route",bundlePath:"app/api/nine-box/export/pdf/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\nine-box\\export\\pdf\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:x}=m,y="/api/nine-box/export/pdf/route";function $(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},52390:(e,t,r)=>{async function n(e,t,r){try{let{data:n,error:a}=await e.rpc(t,r);if(a)return{ok:!1,error:a};return{ok:!0,data:n}}catch(e){return{ok:!1,error:e}}}function a(e){return Array.from(new Set(e.map(e=>String(e)).filter(Boolean)))}async function o(e){let t=e.supabase,{data:r}=await t.auth.getUser(),o=r.user?.id;if(!o)return{userId:"",isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let s=await n(t,"is_admin"),i=!!s.ok&&!!s.data;if(i)return{userId:o,isAdmin:i,allowed:!0,areaKeys:[]};let u=await n(t,"employee_area_keys");if(u.ok&&Array.isArray(u.data)){let e=a(u.data),t=e.includes("rh");return{userId:o,isAdmin:i,allowed:t,reason:t?void 0:"Acesso restrito: RH",areaKeys:e}}let{data:l}=await t.from("employees").select("areas, department, is_active").eq("user_id",o).maybeSingle(),p=a([...Array.isArray(l?.areas)?l.areas.map(String):[]]),f=p.includes("rh")||String(l?.department||"").toLowerCase().includes("rh");return{userId:o,isAdmin:i,allowed:f,reason:f?void 0:"Acesso restrito: RH",areaKeys:p}}r.d(t,{V:()=>o})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958],()=>r(51745));module.exports=n})();