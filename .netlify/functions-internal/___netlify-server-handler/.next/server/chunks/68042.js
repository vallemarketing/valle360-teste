"use strict";exports.id=68042,exports.ids=[68042],exports.modules={90176:(e,t,a)=>{a.d(t,{t:()=>o});var r=a(54128);function o(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,r.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},51547:(e,t,a)=>{a.d(t,{F:()=>v,getProviderStatus:()=>x});var r=a(90176);function o(e){let t=e.match(/\{[\s\S]*\}|\[[\s\S]*\]/);if(!t)throw Error("Resposta n\xe3o cont\xe9m JSON");return JSON.parse(t[0])}function n(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function s(e){return e?Array.isArray(e)?e.map(e=>String(e).trim()).filter(Boolean):"string"==typeof e?[e.trim()].filter(Boolean):[]:[]}async function i(e){try{let t=(0,r.t)();await t.from("audit_logs").insert({user_id:e.userId||null,action:e.action,entity_type:e.entityType||"ai",entity_id:e.entityId||null,old_values:null,new_values:e.newValues,ip_address:null,user_agent:null,created_at:new Date().toISOString()})}catch{}}let c=null;async function l(){if(c&&Date.now()-c.fetchedAt<6e4)return{apiKey:c.apiKey,config:c.config};let e=null,t=null;try{let a=(0,r.t)(),{data:o}=await a.from("integration_configs").select("api_key, config").eq("integration_id","openrouter").single();e=o?.api_key||null,t=o?.config||null}catch{}return e=e||process.env.OPENROUTER_API_KEY||null,c={fetchedAt:Date.now(),apiKey:e,config:t},{apiKey:e,config:t}}function u(e){return e?"string"==typeof e?n(e):"object"==typeof e?e:null:null}async function d(e="general"){let t=process.env.OPENROUTER_MODEL;if(t)return[t].filter(Boolean);let{config:a}=await l(),r=a?.model?String(a.model).trim():"";if(r)return[r];let o=n(process.env.OPENROUTER_MODEL_POLICY_JSON),i=u(a?.model_policy)||u(a?.modelPolicy)||o||{default:["openrouter/auto"],general:["openrouter/auto"],analysis:["anthropic/claude-3.5-sonnet","openrouter/auto"],strategy:["anthropic/claude-3.5-sonnet","openrouter/auto"],kanban_insights:["anthropic/claude-3.5-sonnet","openrouter/auto"],kanban_message:["openai/gpt-4o","openrouter/auto"],copywriting:["openai/gpt-4o","openrouter/auto"],sales:["openai/gpt-4o","openrouter/auto"],sentiment:["google/gemini-1.5-pro","openrouter/auto"],classification:["google/gemini-1.5-pro","openrouter/auto"],hr:["anthropic/claude-3.5-sonnet","openrouter/auto"]},c=[...s(i[e]),...s(i.default),"openrouter/auto"],d=new Set,p=[];for(let e of c){let t=String(e).trim();!t||d.has(t)||(d.add(t),p.push(t))}return p.length?p:["openrouter/auto"]}async function p(){try{let e=(0,r.t)(),{data:t}=await e.from("integration_configs").select("api_key").eq("integration_id","anthropic").single();if(t?.api_key)return t.api_key}catch{}return process.env.ANTHROPIC_API_KEY||null}async function m(){try{let e=(0,r.t)(),{data:t}=await e.from("integration_configs").select("api_key").eq("integration_id","openai").single();if(t?.api_key)return t.api_key}catch{}return process.env.OPENAI_API_KEY||null}async function y(){try{let e=(0,r.t)(),{data:t}=await e.from("integration_configs").select("api_key").eq("integration_id","gemini").single();if(t?.api_key)return t.api_key}catch{}return process.env.GOOGLE_GEMINI_API_KEY||process.env.GOOGLE_CLOUD_API_KEY||null}async function _(e,t,a){let r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json","HTTP-Referer":process.env.NEXT_PUBLIC_APP_URL||"http://localhost","X-Title":"Valle 360"},body:JSON.stringify({model:t,messages:e.messages,temperature:e.temperature??.7,max_tokens:e.maxTokens??1024,response_format:e.json?{type:"json_object"}:void 0})}),o=await r.text();if(!r.ok)throw Error(`OpenRouter error (${r.status}): ${o.slice(0,500)}`);let n=JSON.parse(o),s=n?.choices?.[0]?.message?.content||"";return{provider:"openrouter",model:n?.model||t,text:s,usage:n?.usage}}async function g(e){let{apiKey:t}=await l();if(!t)throw Error("OPENROUTER_API_KEY n\xe3o configurada");let a=await d(e.task),r=Date.now(),n=[];for(let c of a)try{let n=await _(e,c,t);return await i({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:n.provider,model:n.model,ok:!0,ms:Date.now()-r,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json,openrouter_models_tried:a}}),e.json&&(n.json=o(n.text)),n}catch(t){var s;let e=t?.message||String(t);if(n.push({model:c,error:e}),!(!(s=function(e){let t=e.match(/OpenRouter error \\((\\d+)\\):/);if(!t?.[1])return null;let a=Number(t[1]);return Number.isFinite(a)?a:null}(e))||401!==s&&403!==s&&(429===s||408===s||s>=500&&s<=599||400===s&&/model|not found|no such|invalid/i.test(e))))break}let c=n.map(e=>`${e.model}: ${e.error}`).join(" | ");throw Error(`OpenRouter falhou em ${n.length} tentativa(s). ${c}`)}async function h(e){let t=await p();if(!t)throw Error("ANTHROPIC_API_KEY n\xe3o configurada");let a=function(e="general"){return process.env.ANTHROPIC_MODEL||"claude-3-5-sonnet-20241022"}(e.task),r=Date.now(),n=e.messages.find(e=>"system"===e.role)?.content,s=e.messages.filter(e=>"system"!==e.role).map(e=>`${e.role.toUpperCase()}: ${e.content}`).join("\n\n"),c=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":t,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:a,max_tokens:e.maxTokens??1024,temperature:e.temperature??.7,system:e.json?`${n||""}

Responda APENAS com um JSON v\xe1lido, sem texto extra.`:n,messages:[{role:"user",content:s}]})}),l=await c.text();if(!c.ok)throw Error(`Claude error (${c.status}): ${l.slice(0,500)}`);let u=JSON.parse(l),d=u?.content?.[0]?.text||"",m={provider:"claude",model:a,text:d,usage:u?.usage};return await i({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:m.provider,model:m.model,ok:!0,ms:Date.now()-r,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json}}),e.json&&(m.json=o(d)),m}async function f(e){let t=await m();if(!t)throw Error("OPENAI_API_KEY n\xe3o configurada");let a=function(e="general"){return process.env.OPENAI_MODEL||"gpt-4o-mini"}(e.task),r=Date.now(),n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:a,messages:e.messages,temperature:e.temperature??.7,max_tokens:e.maxTokens??1024,response_format:e.json?{type:"json_object"}:void 0})}),s=await n.text();if(!n.ok)throw Error(`OpenAI error (${n.status}): ${s.slice(0,500)}`);let c=JSON.parse(s),l=c?.choices?.[0]?.message?.content||"",u={provider:"openai",model:c?.model||a,text:l,usage:c?.usage};return await i({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:u.provider,model:u.model,ok:!0,ms:Date.now()-r,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json}}),e.json&&(u.json=o(l)),u}async function w(e){let t=await y();if(!t)throw Error("GOOGLE_GEMINI_API_KEY/GOOGLE_CLOUD_API_KEY n\xe3o configurada");let a=function(e="general"){return process.env.GEMINI_MODEL||"gemini-1.5-flash"}(e.task),r=Date.now(),n=e.messages.find(e=>"system"===e.role)?.content,s=e.messages.filter(e=>"system"!==e.role).map(e=>`${e.role.toUpperCase()}: ${e.content}`).join("\n\n"),c=e.json?`${n||""}

Responda APENAS com um JSON v\xe1lido, sem texto extra.

${s}`:`${n||""}

${s}`,l=`https://generativelanguage.googleapis.com/v1beta/models/${a}:generateContent?key=${encodeURIComponent(t)}`,u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:c}]}],generationConfig:{temperature:e.temperature??.7,maxOutputTokens:e.maxTokens??1024}})}),d=await u.text();if(!u.ok)throw Error(`Gemini error (${u.status}): ${d.slice(0,500)}`);let p=JSON.parse(d),m=p?.candidates?.[0]?.content?.parts?.map(e=>e.text).join("")||"",_={provider:"gemini",model:a,text:m,usage:p?.usageMetadata};return await i({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:_.provider,model:_.model,ok:!0,ms:Date.now()-r,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json}}),e.json&&(_.json=o(m)),_}function x(){return{openrouter:!!process.env.OPENROUTER_API_KEY,claude:!!process.env.ANTHROPIC_API_KEY,openai:!!process.env.OPENAI_API_KEY,gemini:!!(process.env.GOOGLE_GEMINI_API_KEY||process.env.GOOGLE_CLOUD_API_KEY)}}async function v(e){let t=e.correlationId||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),a={...e,correlationId:t},r=[];for(let e of[{provider:"openrouter",fn:g},{provider:"claude",fn:h},{provider:"openai",fn:f},{provider:"gemini",fn:w}])try{return await e.fn(a)}catch(n){let o=n?.message||String(n);r.push({provider:e.provider,error:o}),await i({userId:a.actorUserId||null,action:"ai.request_failed",entityType:a.entityType||"ai",entityId:a.entityId||null,newValues:{provider:e.provider,ok:!1,error:o.slice(0,500),task:a.task||"general",correlation_id:t,json:!!a.json}})}let o=r.map(e=>`${e.provider}: ${e.error}`).join(" | ");throw Error(`Falha em todos os provedores. ${o}`)}},68042:(e,t,a)=>{a.d(t,{h:()=>s});var r=a(52019),o=a(51547);class n{async searchLeads(e){try{let t="empresas";e.industry&&(t+=` ${e.industry}`),e.location&&(t+=` em ${e.location}`),e.keywords?.length&&(t+=` ${e.keywords.join(" ")}`),t+=" contato site email";let a=await r.T.search({query:t,searchDepth:"advanced",maxResults:20,includeAnswer:!0}),o=await this.processSearchResults(a.results,e);return{success:!0,leads:o,total_found:o.length,source:"tavily_search",timestamp:new Date().toISOString()}}catch(e){return console.error("Erro no scraping de leads:",e),{success:!1,leads:[],total_found:0,source:"tavily_search",timestamp:new Date().toISOString()}}}async processSearchResults(e,t){let a=`Voc\xea \xe9 um especialista em qualifica\xe7\xe3o de leads B2B.
Analise os resultados de busca e extraia informa\xe7\xf5es de empresas potenciais.

Para cada empresa encontrada, retorne:
{
  "leads": [
    {
      "company_name": "Nome da empresa",
      "website": "URL se encontrada",
      "industry": "Setor",
      "location": "Cidade/Estado",
      "description": "Breve descri\xe7\xe3o",
      "score": 0-100 (potencial como lead),
      "potential_services": ["servi\xe7os que podem precisar"],
      "notes": "Observa\xe7\xf5es relevantes"
    }
  ]
}

Crit\xe9rios de qualifica\xe7\xe3o:
- Empresas com presen\xe7a digital ativa = maior score
- Empresas do setor ${t.industry||"diversos"} = maior score
- Empresas em ${t.location||"Brasil"} = maior score`;try{return(((await (0,o.F)({task:"sales",json:!0,temperature:.3,maxTokens:1400,entityType:"lead_scraper",entityId:null,messages:[{role:"system",content:a},{role:"user",content:JSON.stringify(e.map(e=>({title:e.title,url:e.url,content:e.content})))}]})).json||{}).leads||[]).map(e=>({company_name:e.company_name,website:e.website,industry:e.industry||t.industry,location:e.location||t.location,score:e.score||50,status:"new",source:"scraping",notes:e.notes,ai_insights:{potential_services:e.potential_services||[],conversion_probability:e.score/100,best_approach:e.notes}}))}catch(e){return console.error("Erro ao processar resultados:",e),[]}}async enrichLead(e){try{let[t,a,n]=await Promise.all([r.T.searchCompany(e.company_name),r.T.searchSocialMedia(e.company_name),r.T.searchReputation(e.company_name)]),s=(await (0,o.F)({task:"sales",json:!0,temperature:.3,maxTokens:1400,entityType:"lead_enrich",entityId:null,messages:[{role:"system",content:`Analise as informa\xe7\xf5es e extraia dados estruturados da empresa.
Retorne JSON:
{
  "website": "url principal",
  "email": "email de contato se encontrado",
  "phone": "telefone se encontrado",
  "social_media": {
    "instagram": "@handle ou url",
    "facebook": "url",
    "linkedin": "url"
  },
  "size": "small/medium/large/enterprise",
  "industry": "setor",
  "score_adjustment": -20 a +20 (baseado na reputa\xe7\xe3o),
  "insights": {
    "potential_services": ["servi\xe7os recomendados"],
    "best_approach": "melhor abordagem de vendas",
    "competitors_using": ["concorrentes que usam marketing digital"]
  }
}`},{role:"user",content:JSON.stringify({company:e.company_name,companyResults:t.results.slice(0,5),socialResults:a.results.slice(0,5),reputationResults:n.results.slice(0,5)})}]})).json||{};return{...e,website:s.website||e.website,email:s.email||e.email,phone:s.phone||e.phone,social_media:s.social_media||e.social_media,size:s.size||e.size,industry:s.industry||e.industry,score:Math.max(0,Math.min(100,e.score+(s.score_adjustment||0))),ai_insights:{...e.ai_insights,...s.insights}}}catch(t){return console.error("Erro ao enriquecer lead:",t),e}}async findLeadsByIndustry(e,t){return this.searchLeads({industry:e,location:t,keywords:["marketing digital","precisa marketing","quer crescer","sem presen\xe7a online"]})}async findLeadsNeedingMarketing(e){return this.searchLeads({location:e,keywords:["empresa sem site","sem redes sociais","precisa divulga\xe7\xe3o","quer vender mais online"]})}async getLeads(e){let t=[{id:"1",company_name:"Tech Solutions SP",website:"www.techsolutions.com.br",email:"contato@techsolutions.com.br",phone:"(11) 99999-8888",industry:"Tecnologia",size:"medium",location:"S\xe3o Paulo, SP",score:85,status:"qualified",source:"scraping",tags:["b2b","software"],created_at:new Date().toISOString(),ai_insights:{potential_services:["Social Media","Tr\xe1fego Pago"],estimated_value:5e3,conversion_probability:.75}},{id:"2",company_name:"Boutique Fashion",website:"www.boutiquefashion.com.br",email:"vendas@boutiquefashion.com.br",phone:"(21) 98888-7777",industry:"Moda",size:"small",location:"Rio de Janeiro, RJ",score:72,status:"new",source:"scraping",tags:["ecommerce","varejo"],created_at:new Date().toISOString(),ai_insights:{potential_services:["E-commerce","Instagram Ads"],estimated_value:3500,conversion_probability:.6}},{id:"3",company_name:"Restaurante Sabor & Arte",email:"contato@saborarte.com.br",phone:"(11) 97777-6666",industry:"Restaurante",size:"small",location:"S\xe3o Paulo, SP",score:90,status:"proposal",source:"referral",tags:["food","local"],created_at:new Date().toISOString(),ai_insights:{potential_services:["Google Meu Neg\xf3cio","Social Media"],estimated_value:2500,conversion_probability:.85}}];return e.status&&(t=t.filter(t=>t.status===e.status)),e.industry&&(t=t.filter(t=>t.industry?.toLowerCase().includes(e.industry.toLowerCase()))),e.min_score&&(t=t.filter(t=>t.score>=e.min_score)),e.assigned_to&&(t=t.filter(t=>t.assigned_to===e.assigned_to)),t}generateOutreachMessage(e,t="initial"){let a={initial:`Ol\xe1! Notamos que a ${e.company_name} tem um grande potencial no setor de ${e.industry||"neg\xf3cios"}. 

Somos a Valle 360, especialistas em marketing digital e gostar\xedamos de apresentar solu\xe7\xf5es que podem impulsionar seus resultados.

${e.ai_insights?.potential_services?.length?`Identificamos oportunidades em: ${e.ai_insights.potential_services.join(", ")}.`:""}

Podemos agendar uma conversa r\xe1pida de 15 minutos?

Atenciosamente,
Equipe Valle 360`,followup:`Ol\xe1! Estou fazendo um acompanhamento do nosso contato anterior.

A ${e.company_name} continua sendo uma empresa com perfil ideal para nossas solu\xe7\xf5es de marketing digital.

Gostaria de retomar nossa conversa. Qual o melhor hor\xe1rio para voc\xea?

Atenciosamente,
Equipe Valle 360`,proposal:`Ol\xe1! Conforme conversamos, segue nossa proposta para a ${e.company_name}.

Com base na an\xe1lise do seu neg\xf3cio, preparamos um plano personalizado que pode gerar resultados expressivos.

${e.ai_insights?.estimated_value?`Investimento estimado: R$ ${e.ai_insights.estimated_value.toLocaleString("pt-BR")}/m\xeas`:""}

Aguardo seu retorno para discutirmos os detalhes.

Atenciosamente,
Equipe Valle 360`};return a[t]||a.initial}async saveLead(e){try{return{...e,id:`lead_${Date.now()}`,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}catch(e){return console.error("Erro ao salvar lead:",e),null}}async updateLead(e,t){try{return{id:e,company_name:t.company_name||"Lead Atualizado",score:t.score||50,status:t.status||"new",source:t.source||"manual",...t,updated_at:new Date().toISOString()}}catch(e){return console.error("Erro ao atualizar lead:",e),null}}async deleteLead(e){try{return console.log(`Lead ${e} removido`),!0}catch(e){return console.error("Erro ao deletar lead:",e),!1}}async updateLeadScore(e,t){let a={email_opened:5,email_clicked:10,email_replied:20,call_answered:15,call_scheduled:25,meeting_scheduled:30,proposal_sent:20,proposal_viewed:15,contract_sent:25,negative_response:-10,no_response:-5,unsubscribed:-20}[t]||0;console.log(`Lead ${e}: score ${a>0?"+":""}${a} (${t})`)}}let s=new n},52019:(e,t,a)=>{a.d(t,{T:()=>o});class r{constructor(){this.apiKey=process.env.TAVILY_API_KEY||""}async request(e,t){if(!this.apiKey)throw Error("TAVILY_API_KEY n\xe3o configurada");let a=await fetch(`https://api.tavily.com${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:this.apiKey,...t})});if(!a.ok){let e=await a.text();throw Error(`Erro Tavily: ${a.status} - ${e}`)}return a.json()}async search(e){let t=Date.now(),a=await this.request("/search",{query:e.query,search_depth:e.searchDepth||"basic",include_answer:e.includeAnswer??!0,include_raw_content:e.includeRawContent??!1,max_results:e.maxResults||10,include_domains:e.includeDomains,exclude_domains:e.excludeDomains,topic:e.topic||"general"});return{query:e.query,answer:a.answer,results:a.results.map(e=>({title:e.title,url:e.url,content:e.content,rawContent:e.raw_content,score:e.score,publishedDate:e.published_date})),responseTime:Date.now()-t}}async extract(e){return(await this.request("/extract",{urls:e.urls})).results.map(e=>({url:e.url,rawContent:e.raw_content,error:e.error}))}async searchNews(e,t=10){return this.search({query:e,topic:"news",searchDepth:"advanced",maxResults:t,includeAnswer:!0})}async searchCompany(e){return this.search({query:`${e} empresa informa\xe7\xf5es contato site`,searchDepth:"advanced",maxResults:10,includeAnswer:!0})}async searchCompetitors(e,t,a){let r=`principais empresas ${e}`;return t&&(r+=` em ${t}`),a&&(r+=` exceto ${a}`),this.search({query:r,searchDepth:"advanced",maxResults:15,includeAnswer:!0})}async searchTrends(e){return this.search({query:`tend\xeancias ${e} 2024 2025 mercado brasil`,topic:"news",searchDepth:"advanced",maxResults:10,includeAnswer:!0})}async searchSocialMedia(e){return this.search({query:`${e} instagram facebook linkedin twitter site:instagram.com OR site:facebook.com OR site:linkedin.com`,searchDepth:"advanced",maxResults:10,includeDomains:["instagram.com","facebook.com","linkedin.com","twitter.com"]})}async searchReputation(e){return this.search({query:`${e} avalia\xe7\xe3o review reclama\xe7\xe3o opini\xe3o`,searchDepth:"advanced",maxResults:15,includeAnswer:!0,includeDomains:["reclameaqui.com.br","google.com/maps","trustpilot.com"]})}}let o=new r}};