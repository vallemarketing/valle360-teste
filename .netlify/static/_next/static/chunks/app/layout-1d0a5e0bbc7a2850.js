(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{58194:function(e,a,s){Promise.resolve().then(s.t.bind(s,2778,23)),Promise.resolve().then(s.bind(s,46346)),Promise.resolve().then(s.bind(s,42295)),Promise.resolve().then(s.t.bind(s,18155,23))},46346:function(e,a,s){"use strict";s.d(a,{ToasterProvider:function(){return t}});var i=s(57437),r=s(14438);function t(){return(0,i.jsx)(r.x7,{richColors:!0,position:"top-right",closeButton:!0,duration:4500})}},42295:function(e,a,s){"use strict";s.d(a,{AppProvider:function(){return d}});var i=s(57437),r=s(2265),t=s(5526);let n={super_admin:["dashboard","kanban","messages","gamification","approvals","financial_dashboard","commercial_dashboard","rh_dashboard","rh_tests","rh_recruitment","integrations","intelligence_center","social_scheduling","nps_dashboard","team_management","client_portal","val_ai","reports","settings"],admin:["dashboard","kanban","messages","gamification","approvals","financial_dashboard","commercial_dashboard","nps_dashboard","team_management","val_ai","reports","settings"],head_marketing:["dashboard","kanban","messages","gamification","approvals","team_management","val_ai","reports","nps_dashboard"],financeiro:["dashboard","messages","gamification","financial_dashboard","val_ai","reports","nps_dashboard"],comercial:["dashboard","kanban","messages","gamification","commercial_dashboard","val_ai","reports"],rh:["dashboard","messages","gamification","rh_dashboard","rh_tests","rh_recruitment","val_ai","reports"],trafego:["dashboard","kanban","messages","gamification","approvals","val_ai"],social_media:["dashboard","kanban","messages","gamification","approvals","social_scheduling","val_ai"],designer:["dashboard","kanban","messages","gamification","approvals","val_ai"],web_designer:["dashboard","kanban","messages","gamification","approvals","val_ai"],video_maker:["dashboard","kanban","messages","gamification","approvals","val_ai"],employee:["dashboard","kanban","messages","gamification","val_ai"]},o=(0,r.createContext)(void 0);function d(e){let{children:a}=e,[s,d]=(0,r.useState)(null),[l,c]=(0,r.useState)(!0),[u,m]=(0,r.useState)([]),[_,p]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!0),[b,f]=(0,r.useState)(!1),v=(0,r.useCallback)(async()=>{try{let{data:{user:e}}=await t.supabase.auth.getUser();if(!e){d(null),c(!1);return}let{data:a}=await t.supabase.from("user_profiles").select("*").eq("user_id",e.id).single(),{data:s}=await t.supabase.from("employees").select("*").eq("user_id",e.id).single(),i=(null==s?void 0:s.area_of_expertise)||(null==s?void 0:s.department)||(null==a?void 0:a.role)||"employee";d({id:e.id,email:e.email||"",fullName:(null==a?void 0:a.full_name)||(null==s?void 0:s.full_name)||"Usu\xe1rio",avatar:(null==s?void 0:s.avatar)||(null==a?void 0:a.avatar_url),role:{super_admin:"super_admin",superadmin:"super_admin",admin:"admin",administrador:"admin",head_marketing:"head_marketing",head:"head_marketing",financeiro:"financeiro",finance:"financeiro",comercial:"comercial",commercial:"comercial",vendas:"comercial",sales:"comercial",rh:"rh",recursos_humanos:"rh",hr:"rh",trafego:"trafego",trafego_pago:"trafego",traffic:"trafego",gestor_de_trafego:"trafego",social_media:"social_media",social:"social_media",designer:"designer",designer_grafico:"designer",graphic_designer:"designer",web_designer:"web_designer",webdesigner:"web_designer",video_maker:"video_maker",videomaker:"video_maker",editor:"video_maker",employee:"employee",colaborador:"employee"}[((null==a?void 0:a.user_type)||(null==a?void 0:a.role)||i).toLowerCase().replace(/\s+/g,"_").replace(/-/g,"_")]||"employee",area:i,department:null==s?void 0:s.department})}catch(e){console.error("Erro ao carregar usu\xe1rio:",e),d(null)}finally{c(!1)}},[]),k=(0,r.useCallback)(async()=>{if(s)try{let{data:e}=await t.supabase.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(50);e&&m(e.map(e=>({id:e.id,type:e.type,title:e.title,message:e.message,read:!!e.is_read,createdAt:new Date(e.created_at),actionUrl:e.link,metadata:e.metadata})))}catch(e){console.error("Erro ao carregar notifica\xe7\xf5es:",e)}},[s]);(0,r.useEffect)(()=>{if(!s)return;let e=t.supabase.channel("notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"user_id=eq.".concat(s.id)},e=>{let a={id:e.new.id,type:e.new.type,title:e.new.title,message:e.new.message,read:!!e.new.is_read,createdAt:new Date(e.new.created_at),actionUrl:e.new.link,metadata:e.new.metadata};m(e=>[a,...e])}).subscribe(e=>{p("SUBSCRIBED"===e)}),a=t.supabase.channel("tasks").on("postgres_changes",{event:"*",schema:"public",table:"kanban_tasks"},()=>{window.dispatchEvent(new CustomEvent("kanban-update"))}).subscribe();return()=>{t.supabase.removeChannel(e),t.supabase.removeChannel(a)}},[s]),(0,r.useEffect)(()=>{v();let{data:{subscription:e}}=t.supabase.auth.onAuthStateChange((e,a)=>{a?v():(d(null),m([]))});return()=>e.unsubscribe()},[v]),(0,r.useEffect)(()=>{s&&k()},[s,k]);let w=(0,r.useCallback)(e=>{var a;return!!s&&((null===(a=n[s.role])||void 0===a?void 0:a.includes(e))||!1)},[s]),C=(0,r.useCallback)(async e=>{s&&(await t.supabase.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",e).eq("user_id",s.id),m(a=>a.map(a=>a.id===e?{...a,read:!0}:a)))},[s]),I=(0,r.useCallback)(async()=>{s&&(await t.supabase.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("user_id",s.id).eq("is_read",!1),m(e=>e.map(e=>({...e,read:!0}))))},[s]),y=(0,r.useCallback)(async()=>{await t.supabase.auth.signOut(),d(null),m([])},[]),S={user:s,loading:l,isAuthenticated:!!s,hasPermission:w,notifications:u,unreadCount:u.filter(e=>!e.read).length,markAsRead:C,markAllAsRead:I,isConnected:_,refreshUser:v,logout:y,sidebarOpen:g,setSidebarOpen:h,valChatOpen:b,setValChatOpen:f};return(0,i.jsx)(o.Provider,{value:S,children:a})}},5526:function(e,a,s){"use strict";s.r(a),s.d(a,{supabase:function(){return n}});var i=s(62724);let r="https://ikjgsqtykkhqimypacro.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";r&&t||console.error("‚ùå ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let n=(0,i.eI)(r||"https://setup-missing.supabase.co",t||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})},2778:function(){},18155:function(){}},function(e){e.O(0,[2461,7306,4609,2724,4438,2971,2117,1744],function(){return e(e.s=58194)}),_N_E=e.O()}]);