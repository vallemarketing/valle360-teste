"use strict";(()=>{var e={};e.id=30486,e.ids=[30486],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},52355:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>k,requestAsyncStorage:()=>T,routeModule:()=>E,serverHooks:()=>$,staticGenerationAsyncStorage:()=>N});var a={};r.r(a),r.d(a,{GET:()=>A,POST:()=>I,dynamic:()=>g});var s=r(49303),n=r(88716),i=r(60670),o=r(87070),c=r(90176),l=r(87881),u=r(17478),p=r(46882),d=r(73701);let m={sendText:async(e,t)=>(0,d.U3)({to:e,type:"text",text:t})},g="force-dynamic";function _(e){if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return e;if("object"==typeof e&&e?.value!=null){let t=Number(e.value);return Number.isFinite(t)?t:null}let t=Number(e);return Number.isFinite(t)?t:null}function h(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function f(e){return String(e||"").split(",").map(e=>e.trim()).filter(Boolean)}function y(){return!!(process.env.WHATSAPP_PHONE_NUMBER_ID&&process.env.WHATSAPP_ACCESS_TOKEN)}async function S(e,t){let r=new Date;r.setHours(0,0,0,0);let a=r.toISOString();try{let{data:r}=await e.from("super_admin_insights").select("id").eq("insight_title",t.insight_title).gte("created_at",a).limit(1);if(r&&r.length>0)return!1;return await e.from("super_admin_insights").insert({insight_category:t.insight_category,insight_priority:t.insight_priority,insight_title:t.insight_title,insight_description:t.insight_description,affected_area:t.affected_area||null,confidence_score:t.confidence_score??70,urgency_score:t.urgency_score??70,source_type:t.source_type||"system",generated_by:t.generated_by||"system",status:"new"}),!0}catch{return!1}}async function x(e){let{supabase:t,fromUserId:r,toUserId:a,text:s}=e;if(!h(r)||!h(a))return{success:!1,error:"user_id inv\xe1lido"};try{let{data:e,error:n}=await t.rpc("get_or_create_direct_conversation",{p_user_id_1:r,p_user_id_2:a,p_is_client_conversation:!1});if(n||!e)return{success:!1,error:n?.message||"Falha ao criar conversa"};let{error:i}=await t.from("direct_messages").insert({conversation_id:e,from_user_id:r,body:s,message_type:"text"});if(i)return{success:!1,error:i.message};return{success:!0}}catch(e){return{success:!1,error:e?.message||"Falha intranet"}}}async function v(e){let t=f(process.env.ALERTS_NOTIFY_EMAILS),r=f(process.env.ALERTS_NOTIFY_INTRANET_USER_IDS).filter(h);if(t.length||r.length)return{emails:t,userIds:r};try{let{data:t}=await e.from("user_profiles").select("user_id,email,role,user_type,is_active").eq("is_active",!0).limit(200),r=t||[],a=e=>{let t=String(e?.role||"").toLowerCase(),r=String(e?.user_type||"").toLowerCase();return"admin"===t||"super_admin"===t||"super_admin"===r},s=r.filter(a).map(e=>String(e.email||"")).filter(Boolean),n=r.filter(a).map(e=>String(e.user_id||"")).filter(h);return{emails:Array.from(new Set(s)),userIds:Array.from(new Set(n))}}catch{return{emails:[],userIds:[]}}}async function w(e,t){let r=f(process.env.ALERTS_NOTIFY_EMAILS),a=f(process.env.ALERTS_NOTIFY_INTRANET_USER_IDS).filter(h);if(r.length||a.length)return{emails:r,userIds:a,source:"env"};try{let{data:r}=await e.from("alert_recipient_rules").select("channel,recipient_user_id,recipient_email,is_enabled").eq("alert_type",t).eq("is_enabled",!0).limit(500),a=r||[];if(a.length){let t=a.filter(e=>"intranet"===String(e.channel||"")).map(e=>String(e.recipient_user_id||"")).filter(h),r=a.filter(e=>"email"===String(e.channel||"")).map(e=>String(e.recipient_user_id||"")).filter(h),s=a.filter(e=>"email"===String(e.channel||"")).map(e=>String(e.recipient_email||"")).map(e=>e.trim()).filter(e=>e&&e.includes("@")),n=[];if(r.length)try{let{data:t}=await e.from("user_profiles").select("user_id,email,is_active").in("user_id",Array.from(new Set(r))).eq("is_active",!0);n=(t||[]).map(e=>String(e.email||"")).filter(Boolean)}catch{n=[]}let i=Array.from(new Set([...s,...n])),o=Array.from(new Set(t));if(i.length||o.length)return{emails:i,userIds:o,source:"db"}}}catch{}let s=await v(e);return{emails:s.emails,userIds:s.userIds,source:"fallback"}}async function b(){let e=(0,c.t)(),t=Date.now(),r={payment_risk:Math.max(1,Math.min(100,Number(process.env.ALERT_THRESHOLD_PAYMENT_RISK||80))),budget_overrun:Math.max(1,Math.min(100,Number(process.env.ALERT_THRESHOLD_BUDGET_OVERRUN||85))),demand_capacity:Math.max(1,Math.min(100,Number(process.env.ALERT_THRESHOLD_DEMAND_CAPACITY||85))),churn:Math.max(1,Math.min(100,Number(process.env.ALERT_THRESHOLD_CHURN||70)))},a=String(process.env.ALERTS_ACTOR_USER_ID||"").trim(),s=h(a),n=new Date(Date.now()-6048e5).toISOString(),i=[];try{let{data:t}=await e.from("ml_predictions_log").select("id,prediction_type,predicted_at,predicted_probability,predicted_value,prediction_target,target_id").gte("predicted_at",n).order("predicted_at",{ascending:!1}).limit(500);i=t||[]}catch{i=[]}let o=e=>{let t=i.filter(t=>String(t?.prediction_type||"")===e).map(e=>({p:e,v:_(e.predicted_value)})).filter(e=>"number"==typeof e.v&&Number.isFinite(e.v));return t.sort((e,t)=>Number(t.v)-Number(e.v)),t[0]?.p||null},l=o("payment_risk"),u=o("budget_overrun"),d=o("demand_capacity"),g=o("churn"),v=[],b=async t=>{let r=t?.predicted_value,a=r&&"object"==typeof r?String(r.entity_name||""):"";if(a)return a;let s=String(t?.prediction_type||""),n=t?.target_id?String(t.target_id):null;if(!n||!h(n))return null;try{if("payment_risk"===s||"churn"===s||"ltv"===s||"upsell"===s){let{data:t}=await e.from("clients").select("company_name").eq("id",n).maybeSingle();return(t?.company_name?String(t.company_name):null)||null}if("budget_overrun"===s){let{data:t}=await e.from("campaigns").select("name").eq("id",n).maybeSingle();return(t?.name?String(t.name):null)||null}}catch{}return null},A=async(t,a,s,n,i)=>{if(!t?.id)return;let o=_(t.predicted_value);if(null==o||o<r[a])return;let c=await b(t);await S(e,{insight_category:"ml_alert",insight_priority:"high",insight_title:s,insight_description:n(o,c),affected_area:i,confidence_score:Math.round(Number(t.predicted_probability||0)),urgency_score:Math.min(100,Math.round(o)),source_type:"ml_predictions_log",generated_by:"cron.alerts"})&&v.push({type:a,value:o,predictionId:String(t.id),entityName:c})};await A(l,"payment_risk",`Alerta ML: Risco de pagamento â‰¥ ${r.payment_risk}%`,(e,t)=>`Cliente${t?`: ${t}`:""} com risco elevado de atraso/inadimpl\xeancia.
Score: ${Math.round(e)}%.
Sugest\xe3o: revisar Financeiro e acionar cobran\xe7a (intranet/email/WhatsApp).`,"financeiro"),await A(u,"budget_overrun",`Alerta ML: Risco de estouro de or\xe7amento â‰¥ ${r.budget_overrun}%`,(e,t)=>`Campanha${t?`: ${t}`:""} com risco alto de estourar or\xe7amento.
Score: ${Math.round(e)}%.
Sugest\xe3o: revisar budget, pacing e metas.`,"marketing"),await A(d,"demand_capacity",`Alerta ML: Capacidade cr\xedtica â‰¥ ${r.demand_capacity}%`,(e,t)=>`Utiliza\xe7\xe3o da capacidade est\xe1 cr\xedtica.${t?` (${t})`:""}
Score: ${Math.round(e)}%.
Sugest\xe3o: replanejar demanda, ajustar prioridades e acionar RH.`,"operacao"),await A(g,"churn",`Alerta ML: Risco de churn â‰¥ ${r.churn}%`,(e,t)=>`Cliente${t?`: ${t}`:""} em risco de cancelamento.
Score: ${Math.round(e)}%.
Sugest\xe3o: plano de reten\xe7\xe3o + contato imediato.`,"comercial");let I={payment_risk:await w(e,"payment_risk"),budget_overrun:await w(e,"budget_overrun"),demand_capacity:await w(e,"demand_capacity"),churn:await w(e,"churn")},E={emails:Array.from(new Set(Object.values(I).flatMap(e=>e.emails))),userIds:Array.from(new Set(Object.values(I).flatMap(e=>e.userIds)))},T={email:0,whatsapp:0,intranet:0,skipped:[]};if(v.length>0){let t=v.map(e=>`- ${e.type}${e.entityName?` (${e.entityName})`:""}: ${Math.round(e.value)}%`).join("\n"),r=`Valle360 â€¢ Alertas ML (${v.length})`,n=`Alertas por threshold (cron):
${t}

Ver detalhes: /admin/analytics/preditivo`,i=function(){let e=process.env.SENDGRID_API_KEY||"mailto",t=process.env.SENDGRID_FROM_EMAIL||"noreply@valle360.com.br",r=process.env.SENDGRID_FROM_NAME||"Valle 360";return new p.Rp({apiKey:e,fromEmail:t,fromName:r})}();if(i&&E.emails.length)for(let e of E.emails.slice(0,20))(await i.sendEmail({to:{email:e},subject:r,text:n,categories:["valle360","cron","ml_alerts"],customArgs:{source:"cron.alerts"}})).success&&(T.email+=1);else i||T.skipped.push("email:not_configured"),E.emails.length||T.skipped.push("email:no_recipients");let o=f(process.env.ALERTS_NOTIFY_WHATSAPP_PHONES);if(y()&&o.length)for(let e of o.slice(0,10))(await m.sendText(e,n)).success&&(T.whatsapp+=1);else y()||T.skipped.push("whatsapp:not_configured"),o.length||T.skipped.push("whatsapp:no_recipients");if(s&&E.userIds.length)for(let t of E.userIds.slice(0,20))(await x({supabase:e,fromUserId:a,toUserId:t,text:n})).success&&(T.intranet+=1);else s||T.skipped.push("intranet:missing_ALERTS_ACTOR_USER_ID"),E.userIds.length||T.skipped.push("intranet:no_recipients")}return{success:!0,thresholds:r,triggered:v,sent:T,durationMs:Date.now()-t}}async function A(e){let t=(0,l.T)(e);if(t)return t;let r=(0,c.t)(),a=Date.now();try{let e=await b();return await (0,l.m)({supabase:r,action:"alerts",status:"ok",durationMs:Date.now()-a,requestData:{source:"cron",path:"/api/cron/alerts"},responseData:e}),o.NextResponse.json(e)}catch(e){return await (0,l.m)({supabase:r,action:"alerts",status:"error",durationMs:Date.now()-a,requestData:{source:"cron",path:"/api/cron/alerts"},errorMessage:e?.message||"Erro interno"}),o.NextResponse.json({success:!1,error:e?.message||"Erro interno"},{status:500})}}async function I(e){let t=await (0,u.k)(e);if(!t.ok)return t.res;try{let e=await b();return o.NextResponse.json({...e,ranBy:t.userId})}catch(e){return o.NextResponse.json({success:!1,error:e?.message||"Erro interno"},{status:500})}}let E=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cron/alerts/route",pathname:"/api/cron/alerts",filename:"route",bundlePath:"app/api/cron/alerts/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\cron\\alerts\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:T,staticGenerationAsyncStorage:N,serverHooks:$}=E,R="/api/cron/alerts/route";function k(){return(0,i.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:N})}},90176:(e,t,r)=>{r.d(t,{t:()=>s});var a=r(54128);function s(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,a.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},17478:(e,t,r)=>{r.d(t,{k:()=>o});var a=r(87070),s=r(20344),n=r(71615),i=r(54128);async function o(e){let t=(0,n.cookies)(),r=(0,s.createRouteHandlerClient)({cookies:()=>t}),o=e.headers.get("authorization")||"",c=o.toLowerCase().startsWith("bearer ")?o.slice(7).trim():null,l=c?(0,i.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${c}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):r,{data:u}=await l.auth.getUser();if(!u.user?.id)return{ok:!1,res:a.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:p,error:d}=await l.rpc("is_admin");return d||!p?{ok:!1,res:a.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:u.user.id}}},87881:(e,t,r)=>{r.d(t,{T:()=>s,m:()=>n});var a=r(87070);function s(e){let t=String(process.env.CRON_SECRET||"").trim(),r=String(e.headers.get("authorization")||"").trim();return t&&r===`Bearer ${t}`?null:"1"===String(e.headers.get("x-vercel-cron")||"").trim()||String(e.headers.get("user-agent")||"").toLowerCase().includes("vercel-cron")?null:a.NextResponse.json({success:!1,error:"Unauthorized"},{status:401})}async function n(e){try{await e.supabase.from("integration_logs").insert({integration_id:"cron",action:e.action,status:e.status,request_data:e.requestData??null,response_data:e.responseData??null,error_message:e.errorMessage??null,duration_ms:Math.max(0,Math.floor(e.durationMs||0)),created_at:new Date().toISOString()})}catch{}}},46882:(e,t,r)=>{r.d(t,{Rp:()=>a,qC:()=>n,w2:()=>s});class a{constructor(e){this.apiKey=e.apiKey,this.fromEmail=e.fromEmail,this.fromName=e.fromName}async request(e,t={}){let r=await fetch(`https://api.sendgrid.com/v3${e}`,{...t,headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json",...t.headers}});if(202===r.status||200===r.status||201===r.status){let e=await r.text();return e?JSON.parse(e):{success:!0}}let a=await r.json();throw Error(a.errors?.[0]?.message||"Erro na API SendGrid")}async sendEmail(e){let t=Array.isArray(e.to)?e.to:[e.to],r=t[0]?.email||"",a=e.subject||"",s=(e.text||e.html||"").replace(/<[^>]+>/g,"").trim();return{success:!0,mailtoUrl:`mailto:${r}?subject=${encodeURIComponent(a)}&body=${encodeURIComponent(s)}`}}async sendBulkEmail(e,t){return{success:0,failed:e.length,errors:["Envio em lote n\xe3o suportado via mailto. Use envio manual."]}}async listTemplates(){return this.request("/templates?generations=dynamic")}async getTemplate(e){return this.request(`/templates/${e}`)}async getStats(e,t){let r=`/stats?start_date=${e}`;return t&&(r+=`&end_date=${t}`),this.request(r)}async getCategoryStats(e,t,r){let a=`/categories/${e}/stats?start_date=${t}`;return r&&(a+=`&end_date=${r}`),this.request(a)}async addContact(e,t){let r={email:e};t?.firstName&&(r.first_name=t.firstName),t?.lastName&&(r.last_name=t.lastName),t?.customFields&&(r.custom_fields=t.customFields);let a={contacts:[r]};return t?.listIds&&(a.list_ids=t.listIds),this.request("/marketing/contacts",{method:"PUT",body:JSON.stringify(a)})}async searchContacts(e){return this.request("/marketing/contacts/search",{method:"POST",body:JSON.stringify({query:e})})}async deleteContact(e){return this.request(`/marketing/contacts?ids=${e}`,{method:"DELETE"})}async getLists(){return this.request("/marketing/lists")}async createList(e){return this.request("/marketing/lists",{method:"POST",body:JSON.stringify({name:e})})}async addToSuppressionList(e,t){let r="unsubscribes"===t?"/asm/suppressions/global":`/suppression/${t}`;await this.request(r,{method:"POST",body:JSON.stringify({recipient_emails:e})})}async getSuppressionList(e){let t="unsubscribes"===e?"/asm/suppressions/global":`/suppression/${e}`;return this.request(t)}}function s(e){return new a(e)}let n={welcome:(e,t)=>({subject:`Bem-vindo \xe0 ${t}! ðŸŽ‰`,html:`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
        <h1 style="color: #4370d1;">Ol\xe1, ${e}!</h1>
        <p>Seja muito bem-vindo(a) \xe0 ${t}!</p>
        <p>Estamos muito felizes em ter voc\xea conosco. A partir de agora, voc\xea ter\xe1 acesso a todas as nossas ferramentas e recursos.</p>
        <p>Se precisar de ajuda, n\xe3o hesite em entrar em contato.</p>
        <p>Abra\xe7os,<br/>Equipe ${t}</p>
      </div>
    `}),notification:(e,t,r,a)=>({subject:e,html:`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
        <h2 style="color: #333;">${e}</h2>
        <p>${t}</p>
        ${r?`
          <p style="margin-top: 20px;">
            <a href="${r}" style="background-color: #4370d1; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">
              ${a||"Ver mais"}
            </a>
          </p>
        `:""}
      </div>
    `}),meetingScheduled:(e,t,r,a,s)=>({subject:`Reuni\xe3o Agendada - ${t} \xe0s ${r}`,html:`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
        <h2 style="color: #4370d1;">Reuni\xe3o Confirmada! ðŸ“…</h2>
        <p>Ol\xe1 ${e},</p>
        <p>Sua reuni\xe3o foi agendada com sucesso.</p>
        <div style="background-color: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0;">
          <p><strong>Data:</strong> ${t}</p>
          <p><strong>Hor\xe1rio:</strong> ${r}</p>
          ${s?`<p><strong>Descri\xe7\xe3o:</strong> ${s}</p>`:""}
        </div>
        <p>
          <a href="${a}" style="background-color: #4370d1; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">
            Entrar na Reuni\xe3o
          </a>
        </p>
        <p style="color: #666; font-size: 12px; margin-top: 20px;">
          Adicione este evento ao seu calend\xe1rio para n\xe3o esquecer!
        </p>
      </div>
    `}),invoice:(e,t,r,a,s)=>({subject:`Fatura #${t} - Pagamento Pendente`,html:`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
        <h2 style="color: #333;">Fatura #${t}</h2>
        <p>Ol\xe1 ${e},</p>
        <p>Segue sua fatura para pagamento:</p>
        <div style="background-color: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0;">
          <p><strong>Valor:</strong> ${r}</p>
          <p><strong>Vencimento:</strong> ${a}</p>
        </div>
        <p>
          <a href="${s}" style="background-color: #22c55e; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">
            Pagar Agora
          </a>
        </p>
      </div>
    `})}},73701:(e,t,r)=>{async function a(e){let t=function(){switch(process.env.WHATSAPP_PROVIDER||"meta"){case"evolution":return{provider:"evolution",apiUrl:process.env.EVOLUTION_API_URL||"https://api.evolution.com",accessToken:process.env.EVOLUTION_API_KEY||"",instanceName:process.env.EVOLUTION_INSTANCE_NAME||"valle360"};case"twilio":return{provider:"twilio",accessToken:process.env.TWILIO_AUTH_TOKEN||"",accountSid:process.env.TWILIO_ACCOUNT_SID||"",phoneNumberId:process.env.TWILIO_WHATSAPP_NUMBER||""};default:return{provider:"meta",apiUrl:"https://graph.facebook.com/v18.0",accessToken:process.env.WHATSAPP_ACCESS_TOKEN||"",phoneNumberId:process.env.WHATSAPP_PHONE_NUMBER_ID||""}}}();if(!t.accessToken)return console.warn("WhatsApp not configured"),{success:!1,error:"WhatsApp not configured"};try{switch(t.provider){case"meta":return await s(t,e);case"evolution":return await n(t,e);case"twilio":return await i(t,e);default:return{success:!1,error:"Unknown provider"}}}catch(e){return console.error("WhatsApp send error:",e),{success:!1,error:e.message}}}async function s(e,t){let r=`${e.apiUrl}/${e.phoneNumberId}/messages`,a={messaging_product:"whatsapp",recipient_type:"individual",to:o(t.to)};"text"===t.type?(a.type="text",a.text={preview_url:!0,body:t.text}):"template"===t.type?(a.type="template",a.template={name:t.template?.name,language:{code:t.template?.language||"pt_BR"},components:t.template?.components||[]}):"image"===t.type?(a.type="image",a.image={link:t.media?.url,caption:t.media?.caption}):"document"===t.type&&(a.type="document",a.document={link:t.media?.url,caption:t.media?.caption,filename:t.media?.filename});let s=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${e.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await s.json();return s.ok?{success:!0,messageId:n.messages?.[0]?.id}:{success:!1,error:n.error?.message||"Failed to send message"}}async function n(e,t){let r=`${e.apiUrl}/message`,a="",s={number:o(t.to)};"text"===t.type?(a=`${r}/sendText/${e.instanceName}`,s.textMessage={text:t.text}):"image"===t.type?(a=`${r}/sendMedia/${e.instanceName}`,s.mediaMessage={mediatype:"image",media:t.media?.url,caption:t.media?.caption}):"document"===t.type&&(a=`${r}/sendMedia/${e.instanceName}`,s.mediaMessage={mediatype:"document",media:t.media?.url,caption:t.media?.caption,fileName:t.media?.filename});let n=await fetch(a,{method:"POST",headers:{apikey:e.accessToken,"Content-Type":"application/json"},body:JSON.stringify(s)}),i=await n.json();return n.ok?{success:!0,messageId:i.key?.id}:{success:!1,error:i.message||"Failed to send message"}}async function i(e,t){let r=`https://api.twilio.com/2010-04-01/Accounts/${e.accountSid}/Messages.json`,a=new URLSearchParams;a.append("From",`whatsapp:${e.phoneNumberId}`),a.append("To",`whatsapp:+${o(t.to)}`),"text"===t.type?a.append("Body",t.text||""):t.media?.url&&(a.append("MediaUrl",t.media.url),t.media.caption&&a.append("Body",t.media.caption));let s=await fetch(r,{method:"POST",headers:{Authorization:"Basic "+Buffer.from(`${e.accountSid}:${e.accessToken}`).toString("base64"),"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()}),n=await s.json();return s.ok?{success:!0,messageId:n.sid}:{success:!1,error:n.message||"Failed to send message"}}function o(e){let t=e.replace(/\D/g,"");return(10===t.length||11===t.length)&&(t="55"+t),t}r.d(t,{U3:()=>a})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[89276,55972,54128,20958],()=>r(52355));module.exports=a})();