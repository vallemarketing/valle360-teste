"use strict";(()=>{var e={};e.id=20394,e.ids=[20394],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},41609:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var i={};r.r(i),r.d(i,{GET:()=>g,POST:()=>p,dynamic:()=>u});var s=r(49303),n=r(88716),a=r(60670),o=r(87070),c=r(20344),d=r(71615),l=r(90176);let u="force-dynamic";async function p(e){try{let t=(0,d.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:i}=await r.auth.getUser(),s=i?.user;if(!s)return o.NextResponse.json({success:!1,error:"N\xe3o autorizado"},{status:401});let n=(0,l.t)(),{data:a,error:u}=await n.from("clients").select("id, company_name, nome_fantasia").eq("user_id",s.id).maybeSingle();if(u||!a?.id)return o.NextResponse.json({success:!1,error:"Cliente n\xe3o encontrado"},{status:400});let{items:p}=await e.json();if(!p||!Array.isArray(p)||0===p.length)return o.NextResponse.json({success:!1,error:"items \xe9 obrigat\xf3rio"},{status:400});let g=a.company_name||a.nome_fantasia||"Cliente",{data:m,error:f}=await n.from("client_briefings").insert({client_id:a.id,status:"pending",items:p,created_at:new Date().toISOString()}).select().single();f&&console.log("client_briefings table not found, creating tasks directly");let _=[];for(let e of p){let t={post:"social_media",campanha:"marketing",video:"video",arte:"design",site:"dev",outro:"operations"},r={client_id:a.id,title:`[Briefing] ${e.title}`,description:e.description||"",status:"backlog",priority:e.deadline?"high":"medium",area:t[e.type]||"operations",due_date:e.deadline||null,tags:[e.type,"briefing","cliente"],metadata:{source:"client_briefing",briefing_id:m?.id,references:e.references||[],attachments:e.attachments||[],client_name:g},created_at:new Date().toISOString()};try{let{data:e,error:t}=await n.from("kanban_tasks").insert(r).select().single();!t&&e&&_.push(e)}catch(e){console.error("Error creating task:",e)}}try{await n.from("notifications").insert({type:"briefing_received",title:"Novo Briefing Recebido",message:`${g} enviou um briefing com ${p.length} item(s)`,data:{client_id:a.id,briefing_id:m?.id,items_count:p.length},read:!1,created_at:new Date().toISOString()})}catch(e){}return o.NextResponse.json({success:!0,briefing_id:m?.id,tasks_created:_.length,message:"Briefing enviado com sucesso!"})}catch(e){return console.error("Briefing submission error:",e),o.NextResponse.json({success:!1,error:e?.message||"Erro interno"},{status:500})}}async function g(e){try{let e=(0,d.cookies)(),t=(0,c.createRouteHandlerClient)({cookies:()=>e}),{data:r}=await t.auth.getUser(),i=r?.user;if(!i)return o.NextResponse.json({success:!1,error:"N\xe3o autorizado"},{status:401});let s=(0,l.t)(),{data:n}=await s.from("clients").select("id").eq("user_id",i.id).maybeSingle();if(!n?.id)return o.NextResponse.json({success:!1,error:"Cliente n\xe3o encontrado"},{status:400});let a=[];try{let{data:e}=await s.from("client_briefings").select("*").eq("client_id",n.id).order("created_at",{ascending:!1});a=e||[]}catch(e){}return o.NextResponse.json({success:!0,briefings:a})}catch(e){return console.error("Get briefings error:",e),o.NextResponse.json({success:!1,error:e?.message||"Erro interno"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/client/briefing/route",pathname:"/api/client/briefing",filename:"route",bundlePath:"app/api/client/briefing/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\client\\briefing\\route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:h}=m,b="/api/client/briefing/route";function x(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},90176:(e,t,r)=>{r.d(t,{t:()=>s});var i=r(54128);function s(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,i.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[89276,55972,54128,20958],()=>r(41609));module.exports=i})();