"use strict";(()=>{var e={};e.id=75810,e.ids=[75810],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},34584:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{POST:()=>p});var a=r(49303),s=r(88716),n=r(60670),i=r(87070),c=r(20344),u=r(71615);let l=new(r(54214)).ZP({apiKey:process.env.OPENAI_API_KEY});async function p(e){try{let t;let r=(0,c.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:o}}=await r.auth.getUser();if(!o)return i.NextResponse.json({error:"Unauthorized"},{status:401});let a=(await e.formData()).get("file");if(!a)return i.NextResponse.json({error:"No file provided"},{status:400});if(!process.env.OPENAI_API_KEY)return i.NextResponse.json({error:"OCR service not configured"},{status:500});let s=await a.arrayBuffer(),n=Buffer.from(s).toString("base64"),p=a.type||"image/png",d=await l.chat.completions.create({model:"gpt-4o",max_tokens:1e3,messages:[{role:"system",content:`Voc\xea \xe9 um assistente especializado em extrair dados de documentos brasileiros.
Extraia as seguintes informa\xe7\xf5es do documento enviado:
- Nome completo (clientName)
- Nome da empresa (clientCompany)
- CNPJ ou CPF (clientCNPJ)
- Endere\xe7o completo (clientAddress)
- Email (clientEmail)
- Telefone (clientPhone)

Retorne APENAS um JSON v\xe1lido com esses campos. Se n\xe3o encontrar algum campo, deixe como null.
Exemplo: {"clientName": "Jo\xe3o Silva", "clientCompany": "Empresa Ltda", "clientCNPJ": "00.000.000/0001-00", "clientAddress": null, "clientEmail": null, "clientPhone": null}`},{role:"user",content:[{type:"image_url",image_url:{url:`data:${p};base64,${n}`}},{type:"text",text:"Extraia os dados deste documento brasileiro (RG, CNPJ, Contrato Social, ou similar). Retorne apenas o JSON."}]}]}),m=d.choices[0]?.message?.content||"{}";try{let e=m.match(/\{[\s\S]*\}/);t=e?JSON.parse(e[0]):JSON.parse(m)}catch(e){console.error("Failed to parse OCR response:",m),t={raw:m,error:"Failed to parse extracted data"}}try{await r.from("audit_logs").insert({user_id:o.id,action:"ocr_extract",resource_type:"document",metadata:{filename:a.name,size:a.size,extracted:t},created_at:new Date().toISOString()})}catch{}return i.NextResponse.json(t)}catch(e){return console.error("OCR extraction error:",e),i.NextResponse.json({error:e.message||"Failed to extract data from document"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/ocr/extract/route",pathname:"/api/admin/ocr/extract",filename:"route",bundlePath:"app/api/admin/ocr/extract/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\ocr\\extract\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:f}=d,g="/api/admin/ocr/extract/route";function h(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[89276,55972,54128,20958,54214],()=>r(34584));module.exports=o})();