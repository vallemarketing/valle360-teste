"use strict";(()=>{var e={};e.id=5824,e.ids=[5824],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},40344:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>_});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>m,dynamic:()=>p});var o=r(49303),a=r(88716),i=r(60670),s=r(87070),c=r(20344),l=r(71615),u=r(10306);let p="force-dynamic";async function d(e){try{let t=(0,l.cookies)(),r=(0,c.createServerComponentClient)({cookies:()=>t}),{data:{user:n}}=await r.auth.getUser();if(!n)return s.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{searchParams:o}=new URL(e.url);switch(o.get("action")||"dashboard"){case"dashboard":let a=await (0,u.k3)();return s.NextResponse.json(a);case"profitability":let i=await (0,u.nN)();return s.NextResponse.json(i);case"forecast":let p=parseInt(o.get("months")||"3"),d=await (0,u.ed)(p);return s.NextResponse.json(d);case"pricing-health":let m=await (0,u.ki)();return s.NextResponse.json(m);default:return s.NextResponse.json({error:"A\xe7\xe3o inv\xe1lida"},{status:400})}}catch(e){return console.error("Erro na API CFO:",e),s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e){try{let t=(0,l.cookies)(),r=(0,c.createServerComponentClient)({cookies:()=>t}),{data:{user:n}}=await r.auth.getUser();if(!n)return s.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let o=await e.json(),{action:a}=o;switch(a){case"chat":let{message:i,context:p}=o;if(!i)return s.NextResponse.json({error:"Mensagem obrigat\xf3ria"},{status:400});let d=await (0,u.dL)(i,p);return s.NextResponse.json({response:d});case"calculate-price":let{serviceName:m,category:g,hoursEstimate:f,complexity:_,clientSegment:y,includeTools:x}=o;if(!m||!g||!f)return s.NextResponse.json({error:"Dados incompletos"},{status:400});let h=await (0,u.Qu)({serviceName:m,category:g,hoursEstimate:f,complexity:_||"medium",clientSegment:y,includeTools:x});return s.NextResponse.json(h);default:return s.NextResponse.json({error:"A\xe7\xe3o inv\xe1lida"},{status:400})}}catch(e){return console.error("Erro na API CFO:",e),s.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/csuite/cfo/route",pathname:"/api/csuite/cfo",filename:"route",bundlePath:"app/api/csuite/cfo/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\csuite\\cfo\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:y}=g,x="/api/csuite/cfo/route";function h(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:_})}},90176:(e,t,r)=>{r.d(t,{t:()=>o});var n=r(54128);function o(){let e="https://ikjgsqtykkhqimypacro.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin n\xe3o configurado (NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY).");return(0,n.eI)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}},51547:(e,t,r)=>{r.d(t,{F:()=>w,getProviderStatus:()=>v});var n=r(90176);function o(e){let t=e.match(/\{[\s\S]*\}|\[[\s\S]*\]/);if(!t)throw Error("Resposta n\xe3o cont\xe9m JSON");return JSON.parse(t[0])}function a(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function i(e){return e?Array.isArray(e)?e.map(e=>String(e).trim()).filter(Boolean):"string"==typeof e?[e.trim()].filter(Boolean):[]:[]}async function s(e){try{let t=(0,n.t)();await t.from("audit_logs").insert({user_id:e.userId||null,action:e.action,entity_type:e.entityType||"ai",entity_id:e.entityId||null,old_values:null,new_values:e.newValues,ip_address:null,user_agent:null,created_at:new Date().toISOString()})}catch{}}let c=null;async function l(){if(c&&Date.now()-c.fetchedAt<6e4)return{apiKey:c.apiKey,config:c.config};let e=null,t=null;try{let r=(0,n.t)(),{data:o}=await r.from("integration_configs").select("api_key, config").eq("integration_id","openrouter").single();e=o?.api_key||null,t=o?.config||null}catch{}return e=e||process.env.OPENROUTER_API_KEY||null,c={fetchedAt:Date.now(),apiKey:e,config:t},{apiKey:e,config:t}}function u(e){return e?"string"==typeof e?a(e):"object"==typeof e?e:null:null}async function p(e="general"){let t=process.env.OPENROUTER_MODEL;if(t)return[t].filter(Boolean);let{config:r}=await l(),n=r?.model?String(r.model).trim():"";if(n)return[n];let o=a(process.env.OPENROUTER_MODEL_POLICY_JSON),s=u(r?.model_policy)||u(r?.modelPolicy)||o||{default:["openrouter/auto"],general:["openrouter/auto"],analysis:["anthropic/claude-3.5-sonnet","openrouter/auto"],strategy:["anthropic/claude-3.5-sonnet","openrouter/auto"],kanban_insights:["anthropic/claude-3.5-sonnet","openrouter/auto"],kanban_message:["openai/gpt-4o","openrouter/auto"],copywriting:["openai/gpt-4o","openrouter/auto"],sales:["openai/gpt-4o","openrouter/auto"],sentiment:["google/gemini-1.5-pro","openrouter/auto"],classification:["google/gemini-1.5-pro","openrouter/auto"],hr:["anthropic/claude-3.5-sonnet","openrouter/auto"]},c=[...i(s[e]),...i(s.default),"openrouter/auto"],p=new Set,d=[];for(let e of c){let t=String(e).trim();!t||p.has(t)||(p.add(t),d.push(t))}return d.length?d:["openrouter/auto"]}async function d(){try{let e=(0,n.t)(),{data:t}=await e.from("integration_configs").select("api_key").eq("integration_id","anthropic").single();if(t?.api_key)return t.api_key}catch{}return process.env.ANTHROPIC_API_KEY||null}async function m(){try{let e=(0,n.t)(),{data:t}=await e.from("integration_configs").select("api_key").eq("integration_id","openai").single();if(t?.api_key)return t.api_key}catch{}return process.env.OPENAI_API_KEY||null}async function g(){try{let e=(0,n.t)(),{data:t}=await e.from("integration_configs").select("api_key").eq("integration_id","gemini").single();if(t?.api_key)return t.api_key}catch{}return process.env.GOOGLE_GEMINI_API_KEY||process.env.GOOGLE_CLOUD_API_KEY||null}async function f(e,t,r){let n=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json","HTTP-Referer":process.env.NEXT_PUBLIC_APP_URL||"http://localhost","X-Title":"Valle 360"},body:JSON.stringify({model:t,messages:e.messages,temperature:e.temperature??.7,max_tokens:e.maxTokens??1024,response_format:e.json?{type:"json_object"}:void 0})}),o=await n.text();if(!n.ok)throw Error(`OpenRouter error (${n.status}): ${o.slice(0,500)}`);let a=JSON.parse(o),i=a?.choices?.[0]?.message?.content||"";return{provider:"openrouter",model:a?.model||t,text:i,usage:a?.usage}}async function _(e){let{apiKey:t}=await l();if(!t)throw Error("OPENROUTER_API_KEY n\xe3o configurada");let r=await p(e.task),n=Date.now(),a=[];for(let c of r)try{let a=await f(e,c,t);return await s({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:a.provider,model:a.model,ok:!0,ms:Date.now()-n,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json,openrouter_models_tried:r}}),e.json&&(a.json=o(a.text)),a}catch(t){var i;let e=t?.message||String(t);if(a.push({model:c,error:e}),!(!(i=function(e){let t=e.match(/OpenRouter error \\((\\d+)\\):/);if(!t?.[1])return null;let r=Number(t[1]);return Number.isFinite(r)?r:null}(e))||401!==i&&403!==i&&(429===i||408===i||i>=500&&i<=599||400===i&&/model|not found|no such|invalid/i.test(e))))break}let c=a.map(e=>`${e.model}: ${e.error}`).join(" | ");throw Error(`OpenRouter falhou em ${a.length} tentativa(s). ${c}`)}async function y(e){let t=await d();if(!t)throw Error("ANTHROPIC_API_KEY n\xe3o configurada");let r=function(e="general"){return process.env.ANTHROPIC_MODEL||"claude-3-5-sonnet-20241022"}(e.task),n=Date.now(),a=e.messages.find(e=>"system"===e.role)?.content,i=e.messages.filter(e=>"system"!==e.role).map(e=>`${e.role.toUpperCase()}: ${e.content}`).join("\n\n"),c=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":t,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:r,max_tokens:e.maxTokens??1024,temperature:e.temperature??.7,system:e.json?`${a||""}

Responda APENAS com um JSON v\xe1lido, sem texto extra.`:a,messages:[{role:"user",content:i}]})}),l=await c.text();if(!c.ok)throw Error(`Claude error (${c.status}): ${l.slice(0,500)}`);let u=JSON.parse(l),p=u?.content?.[0]?.text||"",m={provider:"claude",model:r,text:p,usage:u?.usage};return await s({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:m.provider,model:m.model,ok:!0,ms:Date.now()-n,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json}}),e.json&&(m.json=o(p)),m}async function x(e){let t=await m();if(!t)throw Error("OPENAI_API_KEY n\xe3o configurada");let r=function(e="general"){return process.env.OPENAI_MODEL||"gpt-4o-mini"}(e.task),n=Date.now(),a=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,messages:e.messages,temperature:e.temperature??.7,max_tokens:e.maxTokens??1024,response_format:e.json?{type:"json_object"}:void 0})}),i=await a.text();if(!a.ok)throw Error(`OpenAI error (${a.status}): ${i.slice(0,500)}`);let c=JSON.parse(i),l=c?.choices?.[0]?.message?.content||"",u={provider:"openai",model:c?.model||r,text:l,usage:c?.usage};return await s({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:u.provider,model:u.model,ok:!0,ms:Date.now()-n,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json}}),e.json&&(u.json=o(l)),u}async function h(e){let t=await g();if(!t)throw Error("GOOGLE_GEMINI_API_KEY/GOOGLE_CLOUD_API_KEY n\xe3o configurada");let r=function(e="general"){return process.env.GEMINI_MODEL||"gemini-1.5-flash"}(e.task),n=Date.now(),a=e.messages.find(e=>"system"===e.role)?.content,i=e.messages.filter(e=>"system"!==e.role).map(e=>`${e.role.toUpperCase()}: ${e.content}`).join("\n\n"),c=e.json?`${a||""}

Responda APENAS com um JSON v\xe1lido, sem texto extra.

${i}`:`${a||""}

${i}`,l=`https://generativelanguage.googleapis.com/v1beta/models/${r}:generateContent?key=${encodeURIComponent(t)}`,u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:c}]}],generationConfig:{temperature:e.temperature??.7,maxOutputTokens:e.maxTokens??1024}})}),p=await u.text();if(!u.ok)throw Error(`Gemini error (${u.status}): ${p.slice(0,500)}`);let d=JSON.parse(p),m=d?.candidates?.[0]?.content?.parts?.map(e=>e.text).join("")||"",f={provider:"gemini",model:r,text:m,usage:d?.usageMetadata};return await s({userId:e.actorUserId||null,action:"ai.request",entityType:e.entityType||"ai",entityId:e.entityId||null,newValues:{provider:f.provider,model:f.model,ok:!0,ms:Date.now()-n,task:e.task||"general",correlation_id:e.correlationId,json:!!e.json}}),e.json&&(f.json=o(m)),f}function v(){return{openrouter:!!process.env.OPENROUTER_API_KEY,claude:!!process.env.ANTHROPIC_API_KEY,openai:!!process.env.OPENAI_API_KEY,gemini:!!(process.env.GOOGLE_GEMINI_API_KEY||process.env.GOOGLE_CLOUD_API_KEY)}}async function w(e){let t=e.correlationId||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),r={...e,correlationId:t},n=[];for(let e of[{provider:"openrouter",fn:_},{provider:"claude",fn:y},{provider:"openai",fn:x},{provider:"gemini",fn:h}])try{return await e.fn(r)}catch(a){let o=a?.message||String(a);n.push({provider:e.provider,error:o}),await s({userId:r.actorUserId||null,action:"ai.request_failed",entityType:r.entityType||"ai",entityId:r.entityId||null,newValues:{provider:e.provider,ok:!1,error:o.slice(0,500),task:r.task||"general",correlation_id:t,json:!!r.json}})}let o=n.map(e=>`${e.provider}: ${e.error}`).join(" | ");throw Error(`Falha em todos os provedores. ${o}`)}},10306:(e,t,r)=>{r.d(t,{Qu:()=>i,dL:()=>m,ed:()=>u,k3:()=>d,ki:()=>c,nN:()=>l});var n=r(1926),o=r(51547);let a=`Voc\xea \xe9 o CFO virtual da Valle 360, uma ag\xeancia de marketing digital.
Seu papel \xe9 analisar dados financeiros e fornecer insights estrat\xe9gicos como um diretor financeiro experiente.

Suas responsabilidades:
1. Precifica\xe7\xe3o inteligente de servi\xe7os
2. An\xe1lise de rentabilidade por cliente
3. Previs\xf5es financeiras
4. Identifica\xe7\xe3o de riscos e oportunidades
5. Recomenda\xe7\xf5es de ajustes de pre\xe7o

Sempre forne\xe7a:
- N\xfameros espec\xedficos e justificativas
- Compara\xe7\xf5es com benchmarks de mercado
- A\xe7\xf5es concretas e priorizadas
- An\xe1lise de risco vs retorno

Seja direto, anal\xedtico e focado em resultados financeiros.`;async function i(e){let{data:t}=await n.O.from("employee_costs").select("hourly_cost, department:user_profiles(role)").order("effective_date",{ascending:!1}),r=t?.length?t.reduce((e,t)=>e+(t.hourly_cost||0),0)/t.length:150,o={low:1,medium:1.3,high:1.6}[e.complexity],a={social_media:.4,design:.45,trafego:.35,video:.5,web:.45,default:.4},i=a[e.category]||a.default,c=e.hoursEstimate*r*o,l=e.includeTools?.1*c:0,u=c+l,p=u/(1-i),d=u/.75,m=u/(1-.55),g={social_media:3500,design:2800,trafego:4500,video:5e3,web:8e3}[e.category]||3e3,f=p<.9*g?"below":p>1.1*g?"above":"average",_=await s({service:e.serviceName,cost:u,price:p,margin:i,benchmark:g,marketComparison:f});return{service:e.serviceName,currentPrice:0,recommendedPrice:Math.round(p),minPrice:Math.round(d),maxPrice:Math.round(m),margin:100*i,justification:_,marketComparison:f}}async function s(e){try{return(await (0,o.F)({task:"analysis",json:!1,temperature:.7,maxTokens:200,entityType:"cfo_pricing_justification",entityId:null,messages:[{role:"system",content:a},{role:"user",content:`Gere uma justificativa de pre\xe7o em 2-3 frases para:
Servi\xe7o: ${e.service}
Custo base: R$ ${e.cost.toFixed(2)}
Pre\xe7o sugerido: R$ ${e.price.toFixed(2)}
Margem: ${(100*e.margin).toFixed(0)}%
Benchmark de mercado: R$ ${e.benchmark.toFixed(2)}
Posi\xe7\xe3o: ${e.marketComparison}

Seja direto e focado no valor.`}]})).text||`Pre\xe7o baseado em custo de R$ ${e.cost.toFixed(2)} com margem de ${(100*e.margin).toFixed(0)}%.`}catch{return`Pre\xe7o calculado com base nos custos operacionais e margem alvo de ${(100*e.margin).toFixed(0)}%.`}}async function c(){let{data:e}=await n.O.from("service_pricing").select("*").eq("is_active",!0),t=[],r=[],o=[],a=0;for(let n of e||[]){let e=n.margin_percentage-35;e>=0?t.push(n):(e>=-15?r.push(n):o.push(n),a+=n.suggested_price-n.current_price||0)}return{healthy:t,needsAttention:r,critical:o,totalPotentialRevenue:a}}async function l(){let{data:e}=await n.O.from("client_profitability").select(`
      *,
      clients:client_id(name, industry)
    `).order("margin_percentage",{ascending:!0}).limit(50);return e?e.map(e=>({client_id:e.client_id,client_name:e.clients?.name||"Cliente",revenue:e.revenue,direct_costs:e.direct_costs,hours_spent:e.hours_spent,gross_margin:e.gross_margin,margin_percentage:e.margin_percentage,profitability_score:e.profitability_score,trend:e.margin_percentage>30?"up":e.margin_percentage>20?"stable":"down",ai_insights:e.ai_insights||[]})):[]}async function u(e=3){let{data:t}=await n.O.from("financial_forecasts").select("*").order("period_month",{ascending:!1}).limit(12),{data:r}=await n.O.from("client_profitability").select("revenue").gte("period_month",new Date(Date.now()-7776e6).toISOString()),o=(r?.reduce((e,t)=>e+(t.revenue||0),0)||1e5)/3,a=[],i=new Date;for(let t=1;t<=e;t++){let e=new Date(i.getFullYear(),i.getMonth()+t,1),r=e.toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),n=e.getMonth()+1,s=1;(12===n||11===n)&&(s=1.2),(1===n||2===n)&&(s=.85);let c=1.05*o*s,l=1.15*c,u=.85*c,p=[];s>1&&p.push("Alta sazonalidade"),s<1&&p.push("Baixa temporada"),p.push("Tend\xeancia de crescimento de 5%"),a.push({period:r,optimistic:Math.round(l),expected:Math.round(c),conservative:Math.round(u),confidence:75,factors:p})}return a}async function p(){let e=[],{data:t}=await n.O.from("client_profitability").select("*, clients:client_id(name)").lt("margin_percentage",20).order("margin_percentage",{ascending:!0}).limit(5);for(let r of t||[])e.push({id:`margin-${r.client_id}`,type:"low_margin",severity:r.margin_percentage<10?"critical":"high",title:`Margem cr\xedtica: ${r.clients?.name||"Cliente"}`,description:`Margem de apenas ${r.margin_percentage?.toFixed(1)}%. Receita: R$ ${r.revenue?.toLocaleString("pt-BR")}, Custos: R$ ${r.direct_costs?.toLocaleString("pt-BR")}`,potentialImpact:(35-r.margin_percentage)*r.revenue/100,recommendedAction:"Renegociar valores ou reduzir escopo de servi\xe7os",createdAt:new Date().toISOString()});let{data:r}=await n.O.from("service_pricing").select("*").lt("margin_percentage",25).eq("is_active",!0);for(let t of r||[])e.push({id:`pricing-${t.id}`,type:"underpriced_service",severity:"medium",title:`Servi\xe7o subprecificado: ${t.service_name}`,description:`Pre\xe7o atual R$ ${t.current_price?.toLocaleString("pt-BR")} com margem de ${t.margin_percentage?.toFixed(1)}%. Sugest\xe3o: R$ ${t.suggested_price?.toLocaleString("pt-BR")}`,potentialImpact:(t.suggested_price||0)-(t.current_price||0),recommendedAction:"Ajustar pre\xe7o na pr\xf3xima renova\xe7\xe3o",createdAt:new Date().toISOString()});let o=(await u(1))[0];return o&&o.expected<1.1*o.conservative&&e.push({id:"forecast-warning",type:"revenue_forecast",severity:"high",title:"Previs\xe3o de queda de receita",description:`Pr\xf3ximo m\xeas previsto: R$ ${o.expected.toLocaleString("pt-BR")} (cen\xe1rio esperado)`,potentialImpact:o.expected-o.conservative,recommendedAction:"Acelerar prospec\xe7\xe3o e upsells",createdAt:new Date().toISOString()}),e.sort((e,t)=>{let r={critical:0,high:1,medium:2,low:3};return r[e.severity]-r[t.severity]})}async function d(){let{data:e}=await n.O.from("client_profitability").select("revenue, direct_costs, gross_margin, margin_percentage").gte("period_month",new Date(Date.now()-2592e6).toISOString()),t=e?.reduce((e,t)=>e+(t.revenue||0),0)||0,r=e?.reduce((e,t)=>e+(t.direct_costs||0),0)||0,o=e?.length?e.reduce((e,t)=>e+(t.margin_percentage||0),0)/e.length:0,{data:a}=await n.O.from("client_profitability").select("revenue").gte("period_month",new Date(Date.now()-5184e6).toISOString()).lt("period_month",new Date(Date.now()-2592e6).toISOString()),i=a?.reduce((e,t)=>e+(t.revenue||0),0)||t,s=await l(),d=[...s].sort((e,t)=>t.margin_percentage-e.margin_percentage).slice(0,5),m=[...s].sort((e,t)=>e.margin_percentage-t.margin_percentage).slice(0,5),g=await p(),f=await u(3),_=await c();return{kpis:{totalRevenue:t,totalCosts:r,grossMargin:t-r,averageMargin:o,mrr:t,revenueGrowth:i>0?(t-i)/i*100:0},alerts:g,topClients:d,worstClients:m,forecasts:f,pricingIssues:[..._.critical,..._.needsAttention].map(e=>({service:e.service_name,currentPrice:e.current_price,recommendedPrice:e.suggested_price,minPrice:1.25*e.base_cost,maxPrice:1.55*e.base_cost,margin:e.margin_percentage,justification:e.ai_recommendation||"Ajustar para margem saud\xe1vel",marketComparison:e.current_price<.9*(e.market_benchmark||0)?"below":"average"}))}}async function m(e,t){let r=await d(),n=`
DADOS ATUAIS DA EMPRESA:
- Receita mensal: R$ ${r.kpis.totalRevenue.toLocaleString("pt-BR")}
- Margem m\xe9dia: ${r.kpis.averageMargin.toFixed(1)}%
- Crescimento: ${r.kpis.revenueGrowth.toFixed(1)}%
- Alertas ativos: ${r.alerts.length}
- Clientes com margem cr\xedtica: ${r.worstClients.filter(e=>e.margin_percentage<25).length}

TOP 3 CLIENTES (por margem):
${r.topClients.slice(0,3).map(e=>`- ${e.client_name}: ${e.margin_percentage.toFixed(1)}% margem`).join("\n")}

CLIENTES EM RISCO:
${r.worstClients.slice(0,3).map(e=>`- ${e.client_name}: ${e.margin_percentage.toFixed(1)}% margem`).join("\n")}

PREVIS\xc3O PR\xd3XIMO M\xcaS:
- Otimista: R$ ${r.forecasts[0]?.optimistic.toLocaleString("pt-BR")}
- Esperado: R$ ${r.forecasts[0]?.expected.toLocaleString("pt-BR")}
- Conservador: R$ ${r.forecasts[0]?.conservative.toLocaleString("pt-BR")}
`;try{return(await (0,o.F)({task:"analysis",json:!1,temperature:.7,maxTokens:1e3,entityType:"cfo_chat",entityId:null,messages:[{role:"system",content:a},{role:"system",content:n},{role:"user",content:e}]})).text||"Desculpe, n\xe3o consegui processar sua solicita\xe7\xe3o."}catch(e){return console.error("Erro no chat CFO:",e),"Erro ao processar solicita\xe7\xe3o. Tente novamente."}}},1926:(e,t,r)=>{r.d(t,{O:()=>i});var n=r(54128);let o="https://ikjgsqtykkhqimypacro.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";o&&a||console.error("âŒ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let i=(0,n.eI)(o||"https://setup-missing.supabase.co",a||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958],()=>r(40344));module.exports=n})();