(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7418],{45389:function(e,r,s){Promise.resolve().then(s.bind(s,69423))},32660:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});let t=(0,s(79205).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},99376:function(e,r,s){"use strict";var t=s(35475);s.o(t,"useParams")&&s.d(r,{useParams:function(){return t.useParams}}),s.o(t,"usePathname")&&s.d(r,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(r,{useSearchParams:function(){return t.useSearchParams}})},69423:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return m}});var t=s(57437),a=s(2265),l=s(32660),c=s(31047),i=s(95252),n=s(3085),o=s(27648),d=s(79050),x=s(99376);function m(){let[e,r]=(0,a.useState)([]),[s,m]=(0,a.useState)(null),[h,u]=(0,a.useState)(!0),[y,b]=(0,a.useState)("all"),[p,v]=(0,a.useState)(null),[g,j]=(0,a.useState)(!1),f=(0,x.useRouter)();(0,a.useEffect)(()=>{N()},[y]);let N=async()=>{try{let e=await fetch("all"===y?"/api/admin/predictions/churn":"/api/admin/predictions/churn?riskLevel=".concat(y)),s=await e.json();s.success&&(r(s.predictions),m(s.stats))}catch(e){console.error("Error fetching churn predictions:",e)}finally{u(!1)}},k=e=>{switch(e){case"critical":return"#ef4444";case"high":return"#f97316";case"medium":return"#eab308";default:return"#10b981"}},C=e=>{switch(e){case"critical":return"bg-red-500 text-white";case"high":return"bg-orange-500 text-white";case"medium":return"bg-yellow-500 text-white";default:return"bg-green-500 text-white"}};return h?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Carregando predi\xe7\xf5es..."})]})}):(0,t.jsxs)("div",{className:"min-h-screen p-8",style:{backgroundColor:"var(--bg-primary)"},children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)(o.default,{href:"/admin/predictions",className:"flex items-center text-sm mb-4 hover:underline",style:{color:"var(--primary-500)"},children:[(0,t.jsx)(l.Z,{className:"w-4 h-4 mr-1"})," Voltar ao Dashboard"]}),(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"},children:"⚠️ Predi\xe7\xf5es de Churn de Clientes"}),(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Identifique clientes em risco e tome a\xe7\xf5es preventivas"})]}),s&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"p-6 rounded-xl border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[(0,t.jsx)("p",{className:"text-sm mb-1",style:{color:"var(--text-tertiary)"},children:"Total Analisado"}),(0,t.jsx)("p",{className:"text-3xl font-bold",style:{color:"var(--text-primary)"},children:s.total})]}),(0,t.jsxs)("div",{className:"p-6 rounded-xl border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[(0,t.jsx)("p",{className:"text-sm mb-1",style:{color:"var(--text-tertiary)"},children:"Risco Alto"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-orange-500",children:s.high_risk})]}),(0,t.jsxs)("div",{className:"p-6 rounded-xl border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[(0,t.jsx)("p",{className:"text-sm mb-1",style:{color:"var(--text-tertiary)"},children:"Risco Cr\xedtico"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-red-500",children:s.critical_risk})]}),(0,t.jsxs)("div",{className:"p-6 rounded-xl border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[(0,t.jsx)("p",{className:"text-sm mb-1",style:{color:"var(--text-tertiary)"},children:"Receita em Risco"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-red-500",children:["R$ ",(s.total_revenue_at_risk/1e3).toFixed(0),"k"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,t.jsxs)("button",{onClick:()=>b("all"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("all"===y?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700"),children:["Todos (",(null==s?void 0:s.total)||0,")"]}),(0,t.jsxs)("button",{onClick:()=>b("high"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("high"===y?"bg-orange-500 text-white":"bg-gray-200 dark:bg-gray-700"),children:["Alto Risco (",(null==s?void 0:s.high_risk)||0,")"]}),(0,t.jsxs)("button",{onClick:()=>b("critical"),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat("critical"===y?"bg-red-500 text-white":"bg-gray-200 dark:bg-gray-700"),children:["Cr\xedtico (",(null==s?void 0:s.critical_risk)||0,")"]})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===e.length?(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Nenhuma predi\xe7\xe3o encontrada"})}):e.map(e=>{var r,s,a,l;return(0,t.jsxs)("div",{className:"p-6 rounded-xl border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-1",style:{color:"var(--text-primary)"},children:(null===(r=e.clients)||void 0===r?void 0:r.company_name)||"Cliente"}),(0,t.jsxs)("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[null===(s=e.clients)||void 0===s?void 0:s.contact_name," • ",null===(a=e.clients)||void 0===a?void 0:a.contact_email]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-right mr-4",children:[(0,t.jsxs)("p",{className:"text-3xl font-bold",style:{color:k(e.risk_level)},children:[e.churn_probability,"%"]}),(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"probabilidade"})]}),(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-bold ".concat(C(e.risk_level)),children:e.risk_level.toUpperCase()})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4 p-4 rounded-lg",style:{backgroundColor:"var(--bg-primary)"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.Z,{className:"w-5 h-5",style:{color:"var(--text-tertiary)"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Dias at\xe9 churn"}),(0,t.jsx)("p",{className:"font-bold",style:{color:"var(--text-primary)"},children:e.days_until_churn||"N/A"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.Z,{className:"w-5 h-5",style:{color:"var(--text-tertiary)"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Valor mensal"}),(0,t.jsxs)("p",{className:"font-bold",style:{color:"var(--text-primary)"},children:["R$ ",(null===(l=e.clients)||void 0===l?void 0:l.monthly_value)||0]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Z,{className:"w-5 h-5",style:{color:"var(--text-tertiary)"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Confian\xe7a"}),(0,t.jsxs)("p",{className:"font-bold",style:{color:"var(--text-primary)"},children:[e.confidence_level,"%"]})]})]})]}),e.warning_signals&&e.warning_signals.length>0&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-sm font-bold mb-2",style:{color:"var(--text-primary)"},children:"⚠️ Sinais de Alerta:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.warning_signals.map((e,r)=>(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-xs",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-secondary)"},children:e},r))})]}),e.recommended_actions&&e.recommended_actions.length>0&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-sm font-bold mb-2",style:{color:"var(--text-primary)"},children:"\uD83D\uDCA1 A\xe7\xf5es Recomendadas:"}),(0,t.jsx)("ul",{className:"space-y-1",children:e.recommended_actions.map((e,r)=>(0,t.jsxs)("li",{className:"text-sm flex items-start",children:[(0,t.jsx)("span",{className:"mr-2",style:{color:"var(--primary-500)"},children:"•"}),(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:e})]},r))})]}),(0,t.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,t.jsx)("button",{onClick:()=>{v(e),j(!0)},className:"px-4 py-2 rounded-lg text-sm font-medium hover:opacity-80",style:{backgroundColor:"var(--primary-500)",color:"white"},children:"Iniciar Reten\xe7\xe3o"}),(0,t.jsx)("button",{onClick:()=>{f.push("/admin/clientes?id=".concat(e.client_id))},className:"px-4 py-2 rounded-lg text-sm font-medium border hover:bg-gray-50 dark:hover:bg-gray-800",style:{backgroundColor:"transparent",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:"Ver Hist\xf3rico"})]})]},e.id)})}),(0,t.jsx)(d.h,{clientId:(null==p?void 0:p.client_id)||null,churnData:p,isOpen:g,onClose:()=>{j(!1),v(null),N()}})]})}}},function(e){e.O(0,[2882,4438,2972,262,9050,2971,2117,1744],function(){return e(e.s=45389)}),_N_E=e.O()}]);