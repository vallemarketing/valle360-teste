"use strict";(()=>{var e={};e.id=18639,e.ids=[18639],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},17304:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>c,staticGenerationAsyncStorage:()=>m});var t={};a.r(t),a.d(t,{POST:()=>u});var o=a(49303),s=a(88716),i=a(60670),n=a(87070),l=a(54128);async function u(){try{if("1"!==process.env.ENABLE_SETUP_ROUTES)return n.NextResponse.json({error:"Not Found"},{status:404});let e=(0,l.eI)("https://ikjgsqtykkhqimypacro.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),r=process.env.SETUP_ADMIN_EMAIL,a=process.env.SETUP_ADMIN_PASSWORD,t=process.env.SETUP_ADMIN_FULL_NAME||"Super Admin";if(!r||!a)return n.NextResponse.json({error:"SETUP_ADMIN_EMAIL e SETUP_ADMIN_PASSWORD s\xe3o obrigat\xf3rios quando ENABLE_SETUP_ROUTES=1"},{status:400});let o=null,s=null;try{let{data:a,error:t}=await e.auth.admin.listUsers({page:1,perPage:200});if(!t){let e=(a?.users||[]).find(e=>String(e?.email||"").toLowerCase()===r.toLowerCase());e?.id&&(o=String(e.id),s=e)}}catch{}if(o){let{data:r,error:t}=await e.auth.admin.updateUserById(o,{password:a,email_confirm:!0,user_metadata:{full_name:"Guilherme Valle",role:"super_admin"},app_metadata:{provider:"email",providers:["email"],role:"super_admin"}});if(t)return console.error("Erro ao atualizar usu\xe1rio auth:",t),n.NextResponse.json({error:t.message},{status:400});s=r.user}else{let{data:i,error:l}=await e.auth.admin.createUser({email:r,password:a,email_confirm:!0,user_metadata:{full_name:t,role:"super_admin"},app_metadata:{provider:"email",providers:["email"],role:"super_admin"}});if(l)return console.error("Erro ao criar usu\xe1rio auth:",l),n.NextResponse.json({error:l.message},{status:400});o=i.user.id,s=i.user}if(!o)return n.NextResponse.json({error:"N\xe3o foi poss\xedvel resolver/criar o usu\xe1rio admin"},{status:500});console.log("✅ Usu\xe1rio admin pronto no auth.users:",o);let{error:i}=await e.from("user_profiles").upsert({id:o,user_id:o,full_name:t,email:r,role:"super_admin",user_type:"super_admin",is_active:!0,phone:"(00) 00000-0000",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});i?console.error("Erro ao criar perfil:",i):console.log("✅ Perfil criado/atualizado");let{error:u}=await e.from("users").upsert({id:o,email:r,full_name:t,role:"super_admin",is_active:!0,email_verified:!0,two_factor_enabled:!1,last_login_at:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()});u?console.error("Erro ao criar user:",u):console.log("✅ User criado/atualizado");let{data:d}=await e.from("employees").select("id").eq("email",r).maybeSingle(),p=d?.id;if(!p){let{data:a,error:t}=await e.from("employees").insert({user_id:o,full_name:"Guilherme Valle",email:r,phone:"(11) 99999-9999",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=guilherme",department:"Administra\xe7\xe3o",position:"CEO",area_of_expertise:"Gest\xe3o",hire_date:"2020-01-01",birth_date:"1985-01-01",emergency_contact:"Contato Emerg\xeancia",emergency_phone:"(11) 98888-8888",pix_key:r,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select("id").single();t?console.error("Erro ao criar employee:",t):(p=a.id,console.log("✅ Employee criado:",p))}return n.NextResponse.json({success:!0,message:"✅ Admin criado/atualizado com sucesso!",user:{id:o,email:s?.email||r,role:"super_admin"},credentials:{email:r,loginUrl:"/login",passwordConfigured:!0}})}catch(e){return console.error("Erro geral:",e),n.NextResponse.json({error:e.message||"Erro desconhecido"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/create-admin-guilherme/route",pathname:"/api/create-admin-guilherme",filename:"route",bundlePath:"app/api/create-admin-guilherme/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\create-admin-guilherme\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:c}=d,_="/api/create-admin-guilherme/route";function g(){return(0,i.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:m})}}};var r=require("../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[89276,55972,54128],()=>a(17304));module.exports=t})();