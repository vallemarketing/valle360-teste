"use strict";(()=>{var e={};e.id=67856,e.ids=[67856],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},88395:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>j,requestAsyncStorage:()=>_,routeModule:()=>g,serverHooks:()=>b,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{DELETE:()=>x,GET:()=>y,PUT:()=>f,dynamic:()=>p});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),c=r(20344),l=r(71615),d=r(96263),u=r(52390);let p="force-dynamic",m=d.Ryn({name:d.Z_8().min(2).optional(),description:d.Z_8().optional().nullable(),starts_at:d.Z_8().datetime().optional().nullable(),ends_at:d.Z_8().datetime().optional().nullable(),status:d.KmV(["draft","open","closed"]).optional(),ai_enabled:d.O72().optional(),config:d.IMB(d.Z_8(),d.YjB()).optional()});async function y(e,t){try{let e=(0,l.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>e}),s=await (0,u.V)({supabase:r});if(!s.allowed)return i.NextResponse.json({error:s.reason||"Acesso negado"},{status:403});let a=String(t.params.id),{data:o,error:n}=await r.from("nine_box_cycles").select("*").eq("id",a).maybeSingle();if(n)throw n;if(!o)return i.NextResponse.json({error:"Ciclo n\xe3o encontrado"},{status:404});return i.NextResponse.json({success:!0,cycle:o})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}async function f(e,t){try{let r=(0,l.cookies)(),s=(0,c.createRouteHandlerClient)({cookies:()=>r}),a=await (0,u.V)({supabase:s});if(!a.allowed)return i.NextResponse.json({error:a.reason||"Acesso negado"},{status:403});let o=String(t.params.id),n=m.parse(await e.json()),{data:d}=await s.from("nine_box_cycles").select("status").eq("id",o).maybeSingle();if(!d)return i.NextResponse.json({error:"Ciclo n\xe3o encontrado"},{status:404});if("closed"===d.status&&n.status&&"closed"!==n.status)return i.NextResponse.json({error:"Ciclo fechado n\xe3o pode ser reaberto"},{status:400});let{data:p,error:y}=await s.from("nine_box_cycles").update({...void 0!==n.name?{name:n.name}:{},...void 0!==n.description?{description:n.description}:{},...void 0!==n.starts_at?{starts_at:n.starts_at}:{},...void 0!==n.ends_at?{ends_at:n.ends_at}:{},...void 0!==n.status?{status:n.status}:{},...void 0!==n.ai_enabled?{ai_enabled:n.ai_enabled}:{},...void 0!==n.config?{config:n.config}:{}}).eq("id",o).select("*").single();if(y)throw y;return i.NextResponse.json({success:!0,cycle:p})}catch(e){if(e?.name==="ZodError")return i.NextResponse.json({error:"Payload inv\xe1lido",details:e.errors},{status:400});return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}async function x(e,t){try{let e=(0,l.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>e}),s=await (0,u.V)({supabase:r});if(!s.allowed)return i.NextResponse.json({error:s.reason||"Acesso negado"},{status:403});let a=String(t.params.id),{data:o,error:n}=await r.from("nine_box_cycles").select("status").eq("id",a).maybeSingle();if(n)throw n;if(!o)return i.NextResponse.json({error:"Ciclo n\xe3o encontrado"},{status:404});if("closed"===o.status)return i.NextResponse.json({error:"Ciclo fechado n\xe3o pode ser exclu\xeddo"},{status:400});let{error:d}=await r.from("nine_box_cycles").delete().eq("id",a);if(d)throw d;return i.NextResponse.json({success:!0})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/nine-box/cycles/[id]/route",pathname:"/api/nine-box/cycles/[id]",filename:"route",bundlePath:"app/api/nine-box/cycles/[id]/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\nine-box\\cycles\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:w,serverHooks:b}=g,R="/api/nine-box/cycles/[id]/route";function j(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:w})}},52390:(e,t,r)=>{async function s(e,t,r){try{let{data:s,error:a}=await e.rpc(t,r);if(a)return{ok:!1,error:a};return{ok:!0,data:s}}catch(e){return{ok:!1,error:e}}}function a(e){return Array.from(new Set(e.map(e=>String(e)).filter(Boolean)))}async function o(e){let t=e.supabase,{data:r}=await t.auth.getUser(),o=r.user?.id;if(!o)return{userId:"",isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let n=await s(t,"is_admin"),i=!!n.ok&&!!n.data;if(i)return{userId:o,isAdmin:i,allowed:!0,areaKeys:[]};let c=await s(t,"employee_area_keys");if(c.ok&&Array.isArray(c.data)){let e=a(c.data),t=e.includes("rh");return{userId:o,isAdmin:i,allowed:t,reason:t?void 0:"Acesso restrito: RH",areaKeys:e}}let{data:l}=await t.from("employees").select("areas, department, is_active").eq("user_id",o).maybeSingle(),d=a([...Array.isArray(l?.areas)?l.areas.map(String):[]]),u=d.includes("rh")||String(l?.department||"").toLowerCase().includes("rh");return{userId:o,isAdmin:i,allowed:u,reason:u?void 0:"Acesso restrito: RH",areaKeys:d}}r.d(t,{V:()=>o})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,96263],()=>r(88395));module.exports=s})();