(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[833],{47277:function(e,r,a){Promise.resolve().then(a.bind(a,63367))},63367:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return b}});var s=a(57437),t=a(2265),l=a(26892),o=a(57586),i=a(91723),n=a(41671),c=a(99388),d=a(87414),m=a(49322),p=a(49474),u=a(95252),x=a(73247),y=a(92369),v=a(33327),h=a(30401),j=a(32489),g=a(5526),f=a(59824);function b(){var e;let[r,a]=(0,t.useState)([]),[b,N]=(0,t.useState)(!0),[w,C]=(0,t.useState)("pending"),[_,k]=(0,t.useState)(""),[E,I]=(0,t.useState)(null),[R,S]=(0,t.useState)(null),[D,Z]=(0,t.useState)(""),[A,B]=(0,t.useState)(null),[F,O]=(0,t.useState)({pending:0,approved:0,rejected:0,totalValue:0});(0,t.useEffect)(()=>{T(),L()},[w]);let T=async()=>{let{data:{user:e}}=await g.supabase.auth.getUser();if(e){let{data:r}=await g.supabase.from("employees").select("id").eq("user_id",e.id).single();r&&B(r.id)}},L=async()=>{try{let e=g.supabase.from("employee_rewards").select("\n          *,\n          employee:employees!employee_id(id, full_name, email, avatar),\n          approver:employees!approved_by(id, full_name)\n        ").order("requested_at",{ascending:!1});"all"!==w&&(e=e.eq("status",w));let{data:r,error:s}=await e;if(s)throw s;a(r||[]);let t=r||[];O({pending:t.filter(e=>"pending"===e.status).length,approved:t.filter(e=>"approved"===e.status||"redeemed"===e.status).length,rejected:t.filter(e=>"rejected"===e.status).length,totalValue:t.filter(e=>"bonus"===e.reward_type&&("approved"===e.status||"redeemed"===e.status)).reduce((e,r)=>e+(parseFloat(r.reward_value)||0),0)})}catch(e){console.error("Erro ao carregar recompensas:",e)}finally{N(!1)}},P=async e=>{if(A){S(e);try{let r=await fetch("/api/gamification/rewards",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rewardId:e,action:"approve",approvedBy:A})}),a=await r.json();if(!a.success)throw Error(a.error);L(),I(null)}catch(e){console.error("Erro ao aprovar:",e),alert("Erro ao aprovar recompensa")}finally{S(null)}}},J=async e=>{if(!A||!D.trim()){alert("Por favor, informe o motivo da rejei\xe7\xe3o");return}S(e);try{let r=await fetch("/api/gamification/rewards",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({rewardId:e,action:"reject",approvedBy:A,rejectedReason:D})}),a=await r.json();if(!a.success)throw Error(a.error);L(),I(null),Z("")}catch(e){console.error("Erro ao rejeitar:",e),alert("Erro ao rejeitar recompensa")}finally{S(null)}},q=r.filter(e=>{var r,a;if(!_)return!0;let s=_.toLowerCase();return(null===(a=e.employee)||void 0===a?void 0:null===(r=a.full_name)||void 0===r?void 0:r.toLowerCase().includes(s))||e.badge_name.toLowerCase().includes(s)||e.reward_description.toLowerCase().includes(s)}),X=e=>{switch(e){case"pending":return(0,s.jsx)(i.Z,{className:"w-4 h-4"});case"approved":return(0,s.jsx)(n.Z,{className:"w-4 h-4"});case"rejected":return(0,s.jsx)(c.Z,{className:"w-4 h-4"});case"redeemed":return(0,s.jsx)(d.Z,{className:"w-4 h-4"});default:return(0,s.jsx)(m.Z,{className:"w-4 h-4"})}};return(0,s.jsxs)("div",{className:"min-h-screen p-6",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,s.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:"Gest\xe3o de Recompensas"}),(0,s.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--text-tertiary)"},children:"Aprove ou rejeite recompensas conquistadas pelos colaboradores (RH e SuperAdmin)"})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)(p.Z,{className:"w-8 h-8",style:{color:"var(--warning-500)"}})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-primary)"},children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--warning-100)"},children:(0,s.jsx)(i.Z,{className:"w-5 h-5",style:{color:"var(--warning-600)"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:F.pending}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Pendentes"})]})]})}),(0,s.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-primary)"},children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--success-100)"},children:(0,s.jsx)(n.Z,{className:"w-5 h-5",style:{color:"var(--success-600)"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:F.approved}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Aprovadas"})]})]})}),(0,s.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-primary)"},children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--error-100)"},children:(0,s.jsx)(c.Z,{className:"w-5 h-5",style:{color:"var(--error-600)"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:F.rejected}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Rejeitadas"})]})]})}),(0,s.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-primary)"},children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--primary-100)"},children:(0,s.jsx)(u.Z,{className:"w-5 h-5",style:{color:"var(--primary-600)"}})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:["R$ ",F.totalValue.toLocaleString("pt-BR")]}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Total em B\xf4nus"})]})]})})]}),(0,s.jsxs)("div",{className:"p-4 rounded-xl flex flex-wrap items-center gap-4",style:{backgroundColor:"var(--bg-primary)"},children:[(0,s.jsxs)("div",{className:"flex-1 min-w-[200px] relative",children:[(0,s.jsx)(x.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,s.jsx)("input",{type:"text",placeholder:"Buscar por colaborador, badge...",value:_,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"}})]}),(0,s.jsx)("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(e=>(0,s.jsx)("button",{onClick:()=>C(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all ".concat(w===e?"ring-2":""),style:{backgroundColor:w===e?"var(--primary-100)":"var(--bg-secondary)",color:w===e?"var(--primary-700)":"var(--text-secondary)","--tw-ring-color":"var(--primary-500)"},children:"all"===e?"Todas":"pending"===e?"Pendentes":"approved"===e?"Aprovadas":"Rejeitadas"},e))})]}),(0,s.jsx)("div",{className:"space-y-3",children:b?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{style:{color:"var(--text-tertiary)"},children:"Carregando recompensas..."})]}):0===q.length?(0,s.jsxs)("div",{className:"text-center py-12 rounded-xl",style:{backgroundColor:"var(--bg-primary)"},children:[(0,s.jsx)(d.Z,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--text-disabled)"}}),(0,s.jsx)("p",{className:"font-medium",style:{color:"var(--text-secondary)"},children:"Nenhuma recompensa encontrada"}),(0,s.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--text-tertiary)"},children:"pending"===w?"N\xe3o h\xe1 recompensas pendentes de aprova\xe7\xe3o":"Tente ajustar os filtros"})]}):q.map((e,r)=>{var a,t;return(0,s.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},className:"p-4 rounded-xl border",style:{backgroundColor:"var(--bg-primary)",borderColor:"pending"===e.status?"var(--warning-300)":"var(--border-light)"},children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"relative",children:(null===(a=e.employee)||void 0===a?void 0:a.avatar)?(0,s.jsx)("img",{src:e.employee.avatar,alt:e.employee.full_name,className:"w-12 h-12 rounded-full object-cover"}):(0,s.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--bg-secondary)"},children:(0,s.jsx)(y.Z,{className:"w-6 h-6",style:{color:"var(--text-tertiary)"}})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("p",{className:"font-semibold truncate",style:{color:"var(--text-primary)"},children:(null===(t=e.employee)||void 0===t?void 0:t.full_name)||"Colaborador"}),(0,s.jsxs)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium flex items-center gap-1",style:{backgroundColor:"".concat((0,f.Cm)(e.status),"20"),color:(0,f.Cm)(e.status)},children:[X(e.status),(0,f.wb)(e.status)]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[(0,s.jsx)(v.Z,{className:"w-4 h-4",style:{color:"var(--warning-500)"}}),(0,s.jsx)("span",{className:"font-medium",children:e.badge_name}),(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{children:[(0,f.FL)(e.reward_type)," ",e.reward_description]})]}),(0,s.jsxs)("p",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:["Solicitado em ",new Date(e.requested_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("p",{className:"font-bold text-lg",style:{color:"var(--primary-600)"},children:"bonus"===e.reward_type?"R$ ".concat(e.reward_value):"time_off"===e.reward_type?"".concat(e.reward_value,"h folga"):"points"===e.reward_type?"+".concat(e.reward_value," pts"):e.reward_description})}),"pending"===e.status&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>P(e.id),disabled:R===e.id,className:"p-2 rounded-lg transition-all hover:scale-105 disabled:opacity-50",style:{backgroundColor:"var(--success-100)"},children:(0,s.jsx)(h.Z,{className:"w-5 h-5",style:{color:"var(--success-600)"}})}),(0,s.jsx)("button",{onClick:()=>I(e),disabled:R===e.id,className:"p-2 rounded-lg transition-all hover:scale-105 disabled:opacity-50",style:{backgroundColor:"var(--error-100)"},children:(0,s.jsx)(j.Z,{className:"w-5 h-5",style:{color:"var(--error-600)"}})})]}),"rejected"===e.status&&e.rejected_reason&&(0,s.jsxs)("div",{className:"max-w-[200px] p-2 rounded-lg text-xs",style:{backgroundColor:"var(--error-50)"},children:[(0,s.jsx)("p",{className:"font-medium",style:{color:"var(--error-700)"},children:"Motivo:"}),(0,s.jsx)("p",{style:{color:"var(--error-600)"},children:e.rejected_reason})]})]})},e.id)})})]}),(0,s.jsx)(o.M,{children:E&&(0,s.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>I(null),children:(0,s.jsxs)(l.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"w-full max-w-md p-6 rounded-2xl shadow-2xl",style:{backgroundColor:"var(--bg-primary)"},children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",style:{color:"var(--text-primary)"},children:"Rejeitar Recompensa"}),(0,s.jsxs)("div",{className:"p-3 rounded-lg mb-4",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,s.jsx)("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:null===(e=E.employee)||void 0===e?void 0:e.full_name}),(0,s.jsxs)("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[E.badge_name," - ",E.reward_description]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Motivo da Rejei\xe7\xe3o *"}),(0,s.jsx)("textarea",{value:D,onChange:e=>Z(e.target.value),placeholder:"Informe o motivo da rejei\xe7\xe3o...",rows:3,className:"w-full px-4 py-2 rounded-lg border resize-none",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"}})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{I(null),Z("")},className:"flex-1 py-2 rounded-lg font-medium transition-all",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"},children:"Cancelar"}),(0,s.jsx)("button",{onClick:()=>J(E.id),disabled:R===E.id||!D.trim(),className:"flex-1 py-2 rounded-lg font-medium text-white transition-all disabled:opacity-50",style:{backgroundColor:"var(--error-500)"},children:R===E.id?"Rejeitando...":"Confirmar Rejei\xe7\xe3o"})]})]})})})]})}},59824:function(e,r,a){"use strict";function s(e){return({points:"⭐",time_off:"\uD83C\uDFD6️",bonus:"\uD83D\uDCB0",gift:"\uD83C\uDF81",certificate:"\uD83D\uDCDC",recognition:"\uD83C\uDFC6",promotion_priority:"\uD83D\uDCC8"})[e]||"\uD83C\uDFAF"}function t(e){return({pending:"#F59E0B",approved:"#10B981",rejected:"#EF4444",redeemed:"#6B7280",expired:"#9CA3AF"})[e]}function l(e){return({pending:"Pendente",approved:"Aprovada",rejected:"Rejeitada",redeemed:"Resgatada",expired:"Expirada"})[e]}a.d(r,{Cm:function(){return t},FL:function(){return s},wb:function(){return l}})},5526:function(e,r,a){"use strict";a.r(r),a.d(r,{supabase:function(){return o}});var s=a(62724);let t="https://ikjgsqtykkhqimypacro.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";t&&l||console.error("❌ ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let o=(0,s.eI)(t||"https://setup-missing.supabase.co",l||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}},function(e){e.O(0,[2882,4609,2724,3949,2971,2117,1744],function(){return e(e.s=47277)}),_N_E=e.O()}]);