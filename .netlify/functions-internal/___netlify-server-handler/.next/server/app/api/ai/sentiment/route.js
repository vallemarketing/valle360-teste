"use strict";(()=>{var e={};e.id=27571,e.ids=[27571],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},10743:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>d,dynamic:()=>p});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),c=r(20344),u=r(71615),l=r(74211);let p="force-dynamic";async function d(e){try{let t;let r=(0,u.cookies)(),s=(0,c.createRouteHandlerClient)({cookies:()=>r}),{data:{user:a},error:o}=await s.auth.getUser();if(o||!a)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{type:n,data:p}=await e.json(),{data:d}=await s.from("integration_configs").select("api_key").eq("integration_id","openai").single(),m=d?.api_key||process.env.OPENAI_API_KEY;if(!m)return i.NextResponse.json({error:"OpenAI n\xe3o configurada",details:"Configure a API Key da OpenAI nas integra\xe7\xf5es"},{status:400});switch(n){case"single":if(!p.text)return i.NextResponse.json({error:"Texto \xe9 obrigat\xf3rio"},{status:400});t=await (0,l.iF)({text:p.text,context:p.context,language:p.language},m);break;case"batch":if(!p.texts||!Array.isArray(p.texts))return i.NextResponse.json({error:"Array de textos \xe9 obrigat\xf3rio"},{status:400});t=await (0,l.UR)(p.texts.map(e=>({text:e,context:p.context})),m);break;case"social":if(!p.posts||!Array.isArray(p.posts))return i.NextResponse.json({error:"Array de posts \xe9 obrigat\xf3rio"},{status:400});t=await (0,l.uX)(p.posts,m);break;default:return i.NextResponse.json({error:"Tipo de an\xe1lise inv\xe1lido"},{status:400})}return await s.from("integration_logs").insert({integration_id:"openai",action:`sentiment_${n}`,status:"success",request_data:{type:n,dataSize:JSON.stringify(p).length},response_data:{hasResult:!!t}}),i.NextResponse.json({success:!0,result:t})}catch(e){return console.error("Erro na an\xe1lise de sentimento:",e),i.NextResponse.json({error:"Erro na an\xe1lise",details:e.message},{status:500})}}async function m(e){try{let t=(0,u.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:{user:s},error:a}=await r.auth.getUser();if(a||!s)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{searchParams:o}=new URL(e.url),n=o.get("text");if(!n)return i.NextResponse.json({error:"Par\xe2metro text \xe9 obrigat\xf3rio"},{status:400});let{data:p}=await r.from("integration_configs").select("api_key").eq("integration_id","openai").single(),d=p?.api_key||process.env.OPENAI_API_KEY;if(!d)return i.NextResponse.json({error:"OpenAI n\xe3o configurada"},{status:400});let m=await (0,l.iF)({text:n},d);return i.NextResponse.json({success:!0,result:m})}catch(e){return console.error("Erro na an\xe1lise de sentimento:",e),i.NextResponse.json({error:"Erro na an\xe1lise",details:e.message},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ai/sentiment/route",pathname:"/api/ai/sentiment",filename:"route",bundlePath:"app/api/ai/sentiment/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\ai\\sentiment\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y}=x,h="/api/ai/sentiment/route";function v(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},98724:(e,t,r)=>{r.d(t,{$J:()=>o,JF:()=>n});var s=r(54214);let a=null;function o(e){let t=e||process.env.OPENAI_API_KEY;if(!t)throw Error("OpenAI API Key n\xe3o configurada");return(!a||e)&&(a=new s.ZP({apiKey:t})),a}let n={chat:"gpt-4-turbo-preview",embedding:"text-embedding-3-small",analysis:"gpt-4-turbo-preview"}},74211:(e,t,r)=>{r.d(t,{UR:()=>o,iF:()=>a,uX:()=>n});var s=r(98724);async function a(e,t){let r=(0,s.$J)(t),a=`Voc\xea \xe9 um especialista em an\xe1lise de sentimentos. Analise o texto fornecido e retorne APENAS um JSON v\xe1lido com a seguinte estrutura:
{
  "overall": "positive" | "neutral" | "negative",
  "score": n\xfamero de -1 (muito negativo) a 1 (muito positivo),
  "confidence": n\xfamero de 0 a 1 indicando confian\xe7a na an\xe1lise,
  "emotions": {
    "joy": 0-1,
    "sadness": 0-1,
    "anger": 0-1,
    "fear": 0-1,
    "surprise": 0-1,
    "trust": 0-1
  },
  "keywords": ["palavras-chave", "relevantes"],
  "summary": "Resumo breve do sentimento em uma frase"
}

${e.context?`Contexto adicional: ${e.context}`:""}
Idioma do texto: ${e.language||"portugu\xeas brasileiro"}`;try{let t=await r.chat.completions.create({model:s.JF.analysis,messages:[{role:"system",content:a},{role:"user",content:e.text}],temperature:.3,response_format:{type:"json_object"}}),o=t.choices[0]?.message?.content;if(!o)throw Error("Resposta vazia da OpenAI");return JSON.parse(o)}catch(e){throw console.error("Erro na an\xe1lise de sentimento:",e),Error(`Falha na an\xe1lise de sentimento: ${e.message}`)}}async function o(e,t){let r;let s=[];for(let r=0;r<e.length;r+=5){let o=e.slice(r,r+5),n=await Promise.all(o.map(e=>a(e,t)));s.push(...n)}let o=s.reduce((e,t)=>e+t.score,0)/s.length;r=o>.2?"positive":o<-.2?"negative":"neutral";let n=Math.floor(s.length/2),i=s.slice(0,n).reduce((e,t)=>e+t.score,0)/n,c=s.slice(n).reduce((e,t)=>e+t.score,0)/(s.length-n)-i;return{results:s,averageScore:o,overallSentiment:r,trendDirection:c>.1?"improving":c<-.1?"declining":"stable"}}async function n(e,t){let r=(0,s.$J)(t),a=`Voc\xea \xe9 um especialista em an\xe1lise de sentimentos de redes sociais. Analise os posts fornecidos e retorne APENAS um JSON v\xe1lido com:
{
  "bySentiment": { "positive": %, "neutral": %, "negative": % },
  "byPlatform": { "plataforma": { "score": -1 a 1, "count": n\xfamero } },
  "topKeywords": ["palavras", "mais", "mencionadas"],
  "recommendations": ["recomenda\xe7\xf5es", "para", "melhorar", "engajamento"]
}`;try{let t=await r.chat.completions.create({model:s.JF.analysis,messages:[{role:"system",content:a},{role:"user",content:JSON.stringify(e)}],temperature:.3,response_format:{type:"json_object"}}),o=t.choices[0]?.message?.content;if(!o)throw Error("Resposta vazia da OpenAI");return JSON.parse(o)}catch(e){throw console.error("Erro na an\xe1lise de redes sociais:",e),Error(`Falha na an\xe1lise: ${e.message}`)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,54214],()=>r(10743));module.exports=s})();