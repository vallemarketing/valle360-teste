(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2204],{80229:function(e,a,s){Promise.resolve().then(s.bind(s,80443))},30401:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(79205).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},96362:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(79205).Z)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},98728:function(e,a,s){"use strict";s.d(a,{Z:function(){return t}});let t=(0,s(79205).Z)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},80443:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return C}});var t=s(57437),r=s(2265),n=s(99376),o=s(26892),i=s(57586),c=s(37760),l=s(79219),d=s(50598),u=s(42351),m=s(74767),x=s(88906),p=s(76865),h=s(82431),g=s(98728),f=s(91879),b=s(96362),v=s(30401);let j=[{id:"instagram",name:"Instagram",icon:(0,t.jsx)(c.Z,{className:"w-6 h-6"}),color:"#E4405F",gradient:"from-purple-500 via-pink-500 to-amber-400",permissions:["Publicar posts","Agendar stories","Acessar m\xe9tricas"],oauthUrl:"/api/oauth/instagram"},{id:"facebook",name:"Facebook",icon:(0,t.jsx)(l.Z,{className:"w-6 h-6"}),color:"#1877F2",gradient:"from-blue-600 to-blue-500",permissions:["Publicar na p\xe1gina","Acessar insights","Gerenciar coment\xe1rios"],oauthUrl:"/api/oauth/facebook"},{id:"linkedin",name:"LinkedIn",icon:(0,t.jsx)(d.Z,{className:"w-6 h-6"}),color:"#0A66C2",gradient:"from-blue-700 to-blue-600",permissions:["Publicar posts","Compartilhar artigos"],oauthUrl:"/api/oauth/linkedin"},{id:"twitter",name:"Twitter/X",icon:(0,t.jsx)(u.Z,{className:"w-6 h-6"}),color:"#1DA1F2",gradient:"from-sky-500 to-sky-400",permissions:["Publicar tweets","Acessar timeline"],oauthUrl:"/api/oauth/twitter"},{id:"youtube",name:"YouTube",icon:(0,t.jsx)(m.Z,{className:"w-6 h-6"}),color:"#FF0000",gradient:"from-red-600 to-red-500",permissions:["Publicar v\xeddeos","Acessar analytics"],oauthUrl:"/api/oauth/youtube"},{id:"tiktok",name:"TikTok",icon:(0,t.jsx)("span",{className:"text-xl",children:"\uD83D\uDCF1"}),color:"#000000",gradient:"from-gray-900 to-gray-800",permissions:["Publicar v\xeddeos"],oauthUrl:"/api/oauth/tiktok"}];var N=function(e){let{clientId:a,accounts:s=[],onConnect:n,onDisconnect:c,onRefresh:l,isClientView:d=!1}=e,[u,m]=(0,r.useState)(null),[N,w]=(0,r.useState)(!1),y=e=>s.find(a=>a.platform===e),k=e=>{j.find(a=>a.id===e)&&(m(e),w(!0))},C=()=>{u&&(null==n||n(u)),w(!1),m(null)},E=e=>{switch(e){case"active":return{label:"Conectado",className:"bg-success-50 text-success-700 border-success-200"};case"expired":return{label:"Expirado",className:"bg-danger-50 text-danger-700 border-danger-200"};case"error":return{label:"Erro",className:"bg-warning-50 text-warning-800 border-warning-200"};default:return{label:"Desconectado",className:"bg-muted text-muted-foreground border-border"}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-foreground",children:d?"Minhas Redes Sociais":"Redes Sociais do Cliente"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conecte suas contas para agendar publica\xe7\xf5es"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs bg-primary/10 text-primary border border-primary/20",children:[(0,t.jsx)(x.Z,{className:"w-4 h-4"}),"Conex\xe3o segura via OAuth"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(e=>{var a;let s=y(e.id),r=s?E(s.status):null;return(0,t.jsxs)(o.E.div,{whileHover:{y:-4},className:"rounded-xl border border-border overflow-hidden bg-card",children:[(0,t.jsx)("div",{className:"p-4 bg-gradient-to-r ".concat(e.gradient),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-white",children:e.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-white",children:e.name}),(null==s?void 0:s.connected)&&(0,t.jsx)("p",{className:"text-xs text-white/80",children:s.username})]})]}),r&&(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium border ".concat(r.className),children:r.label})]})}),(0,t.jsx)("div",{className:"p-4",children:(null==s?void 0:s.connected)?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[s.profileImage&&(0,t.jsx)("img",{src:s.profileImage,alt:s.displayName,className:"w-10 h-10 rounded-full"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-sm text-foreground",children:s.displayName}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Conectado em ",null===(a=s.connectedAt)||void 0===a?void 0:a.toLocaleDateString("pt-BR")]})]})]}),"expired"===s.status&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded-lg text-xs bg-danger-50 text-danger-700 border border-danger-200",children:[(0,t.jsx)(p.Z,{className:"w-4 h-4"}),"Token expirado. Reconecte para continuar."]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["expired"===s.status?(0,t.jsxs)("button",{onClick:()=>null==l?void 0:l(s.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-white bg-valle-primary hover:bg-valle-primary-dark transition-colors",children:[(0,t.jsx)(h.Z,{className:"w-4 h-4"}),"Reconectar"]}):(0,t.jsxs)("button",{className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-muted text-muted-foreground hover:text-foreground transition-colors",children:[(0,t.jsx)(g.Z,{className:"w-4 h-4"}),"Configurar"]}),(0,t.jsx)("button",{onClick:()=>null==c?void 0:c(s.id),className:"p-2 rounded-lg bg-danger-50 text-danger-700 hover:bg-danger-100 transition-colors",children:(0,t.jsx)(f.Z,{className:"w-4 h-4"})})]})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conecte sua conta para agendar publica\xe7\xf5es automaticamente."}),(0,t.jsxs)("button",{onClick:()=>k(e.id),className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium text-white transition-colors",style:{backgroundColor:e.color},children:["Conectar ",e.name,(0,t.jsx)(b.Z,{className:"w-4 h-4"})]})]})})]},e.id)})}),(0,t.jsx)(i.M,{children:N&&u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>w(!1),className:"fixed inset-0 bg-black/50 z-50"}),(0,t.jsx)(o.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6 rounded-2xl z-50 bg-card border border-border text-foreground shadow-2xl",children:(()=>{let e=j.find(e=>e.id===u);return e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-gradient-to-r ".concat(e.gradient),children:(0,t.jsx)("div",{className:"text-white",children:e.icon})}),(0,t.jsxs)("h3",{className:"text-lg font-bold text-foreground",children:["Conectar ",e.name]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"A Valle 360 solicita as seguintes permiss\xf5es:"})]}),(0,t.jsx)("div",{className:"space-y-2 mb-6",children:e.permissions.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg",style:{},children:[(0,t.jsx)(v.Z,{className:"w-5 h-5 text-success-600"}),(0,t.jsx)("span",{className:"text-sm text-foreground",children:e})]},a))}),(0,t.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg mb-6",style:{backgroundColor:"var(--info-100)"},children:[(0,t.jsx)(x.Z,{className:"w-5 h-5 flex-shrink-0",style:{color:"var(--info-600)"}}),(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--info-700)"},children:"Sua senha nunca \xe9 compartilhada conosco. A conex\xe3o \xe9 feita de forma segura via OAuth. Voc\xea pode revogar o acesso a qualquer momento."})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>w(!1),className:"flex-1 px-4 py-2 rounded-xl font-medium",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"},children:"Cancelar"}),(0,t.jsx)("button",{onClick:C,className:"flex-1 px-4 py-2 rounded-xl font-medium text-white",style:{backgroundColor:e.color},children:"Conectar"})]})]}):null})()})]})})]})},w=s(5526),y=s(14438),k=s(40257);function C(){let[e,a]=(0,r.useState)(null),[s,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null),u=(0,n.useRouter)(),m=(k.env.NEXT_PUBLIC_APP_URL||"").replace(/\/+$/,""),x=(()=>{try{return m?new URL(m).origin:""}catch(e){return""}})();async function p(){c(!0),d(null);try{var e,s;let{data:t}=await w.supabase.auth.getSession(),r=(null===(e=t.session)||void 0===e?void 0:e.access_token)||null,n=r?{Authorization:"Bearer ".concat(r)}:{},i=await fetch("/api/client/me",{cache:"no-store",headers:n}),c=await i.json();if(!i.ok)throw Error((null==c?void 0:c.error)||"Falha ao carregar cliente");a(String(null==c?void 0:null===(s=c.client)||void 0===s?void 0:s.id));let l=await fetch("/api/client/social/accounts",{cache:"no-store",headers:n}),d=await l.json();if(!l.ok)throw Error((null==d?void 0:d.error)||"Falha ao carregar contas");o((null==d?void 0:d.accounts)||[])}catch(e){d((null==e?void 0:e.message)||"Erro")}finally{c(!1)}}(0,r.useEffect)(()=>{p()},[]),(0,r.useEffect)(()=>{let e=new URL(window.location.href);if("1"!==e.searchParams.get("connected"))return;let a="1"===e.searchParams.get("ok"),s=e.searchParams.get("platform")||"rede",t=e.searchParams.get("error")||"";a?y.Am.success("Conta conectada!",{description:"Plataforma: ".concat(s)}):y.Am.error("Falha ao conectar",{description:t||"Plataforma: ".concat(s)}),u.replace("/cliente/redes"),p()},[]),(0,r.useEffect)(()=>{function e(e){if(e.origin!==window.location.origin)return;let a=e.data;(null==a?void 0:a.type)==="oauth_connected"&&p()}return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]);let h=(0,r.useMemo)(()=>s.map(e=>({id:e.id,platform:e.platform,username:e.username?e.username.startsWith("@")?e.username:"@".concat(e.username):e.display_name||e.external_account_id,displayName:e.display_name||e.username||e.external_account_id,profileImage:e.profile_picture_url||void 0,connected:!0,connectedAt:void 0,expiresAt:void 0,permissions:[],status:e.status||"active"})),[s]);async function g(e){try{var a;let{data:s}=await w.supabase.auth.getSession(),t=(null===(a=s.session)||void 0===a?void 0:a.access_token)||null,r=await fetch("/api/client/social/accounts?account_id=".concat(encodeURIComponent(e)),{method:"DELETE",headers:t?{Authorization:"Bearer ".concat(t)}:{}}),n=await r.json();if(!r.ok)throw Error((null==n?void 0:n.error)||"Falha ao desconectar");await p()}catch(e){d((null==e?void 0:e.message)||"Erro ao desconectar")}}return(0,t.jsxs)("div",{className:"p-4 lg:p-6 max-w-7xl mx-auto space-y-4",children:[l&&(0,t.jsx)("div",{className:"rounded-xl border border-danger-200 bg-danger-50 p-3 text-sm text-danger-700",children:l}),i?(0,t.jsxs)("div",{className:"rounded-2xl border border-border bg-card p-6",children:[(0,t.jsx)("div",{className:"h-4 w-40 bg-muted rounded mb-3"}),(0,t.jsx)("div",{className:"h-4 w-64 bg-muted rounded"})]}):e?(0,t.jsx)(N,{clientId:e||"unknown",accounts:h,onConnect:function(a){if(!e){d("Voc\xea precisa estar logado como Cliente (com perfil vinculado) para conectar redes. Recarregue ou fa\xe7a login novamente.");return}if("instagram"!==a&&"facebook"!==a&&"linkedin"!==a){d("Conex\xe3o para esta plataforma ainda n\xe3o est\xe1 dispon\xedvel.");return}if(x&&window.location.origin!==x){d("Conex\xe3o dispon\xedvel apenas em Produ\xe7\xe3o. Acesse: ".concat(m||x));return}let s="/api/oauth/".concat(a,"?client_id=").concat(encodeURIComponent(e));window.location.assign(s)},onDisconnect:g,onRefresh:()=>{d("Para reconectar, clique em Conectar novamente na plataforma.")},isClientView:!0}):(0,t.jsxs)("div",{className:"rounded-2xl border border-border bg-card p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-foreground",children:"Minhas Redes Sociais"}),(0,t.jsxs)("p",{className:"mt-2 text-sm text-muted-foreground",children:["Para conectar redes sociais, voc\xea precisa estar logado como ",(0,t.jsx)("span",{className:"font-semibold",children:"Cliente"})," e ter seu cadastro vinculado."]}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>p(),className:"px-4 py-2 rounded-lg bg-[#1672d6] text-white text-sm",children:"Recarregar"}),(0,t.jsx)("a",{href:"/login",className:"px-4 py-2 rounded-lg border border-border text-sm text-foreground",children:"Ir para Login"})]})]})]})}},5526:function(e,a,s){"use strict";s.r(a),s.d(a,{supabase:function(){return o}});var t=s(62724);let r="https://ikjgsqtykkhqimypacro.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";r&&n||console.error("‚ùå ERRO CR\xcdTICO: Vari\xe1veis de ambiente NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY n\xe3o encontradas!");let o=(0,t.eI)(r||"https://setup-missing.supabase.co",n||"setup-missing",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}},function(e){e.O(0,[2882,4609,2724,4438,2757,2971,2117,1744],function(){return e(e.s=80229)}),_N_E=e.O()}]);