"use strict";exports.id=52134,exports.ids=[52134],exports.modules={52134:(e,r,a)=>{a.d(r,{m:()=>F});var l=a(10326),s=a(17577),t=a(90434),o=a(28870),i=a(85999),d=a(37358),n=a(83855),c=a(88307),m=a(29389),x=a(66697),u=a(26754),h=a(34738),p=a(71806),v=a(32019),g=a(74857),b=a(7027),y=a(98091),f=a(81398),j=a(14958),N=a(62637),C=a(9997),w=a(89495),k=a(72462),S=a(18598),A=a(20855);function _(e){return String(e??"").trim()}function F(e){let r=e.uploadHref,[a,F]=(0,s.useState)("list"),[P,E]=(0,s.useState)(!0),[Z,M]=(0,s.useState)(null),[L,T]=(0,s.useState)([]),[$,B]=(0,s.useState)("all"),[I,R]=(0,s.useState)(""),[D,z]=(0,s.useState)("all"),[K,U]=(0,s.useState)("all"),[V,W]=(0,s.useState)([]),[G,H]=(0,s.useState)(null),[O,q]=(0,s.useState)(!1),[J,Q]=(0,s.useState)(null),[X,Y]=(0,s.useState)(!1),ee=async e=>{e?.silent||E(!0),M(null);try{let e=$&&"all"!==$?`?client_id=${encodeURIComponent($)}`:"",[r,a]=await Promise.all([fetch(`/api/social/posts-mirror${e}`,{cache:"no-store"}),fetch("/api/social/clients",{cache:"no-store"})]),l=await r.json().catch(()=>null),s=await a.json().catch(()=>null);if(!r.ok)throw Error(l?.error||"Falha ao carregar posts");if(!a.ok)throw Error(s?.error||"Falha ao carregar clientes");W(Array.isArray(l?.posts)?l.posts:[]),T((Array.isArray(s?.clients)?s.clients:[]).map(e=>({id:_(e?.id),name:_(e?.name||"Cliente")})))}catch(e){console.error("Erro ao carregar gest\xe3o de posts:",e),W([]),T([]),M(String(e?.message||"Falha ao carregar gest\xe3o de posts"))}finally{e?.silent||E(!1)}},er=async()=>{if(H(null),$&&"all"!==$)try{let e=await fetch(`/api/social/metrics?client_id=${encodeURIComponent($)}&days=30`,{cache:"no-store"}),r=await e.json().catch(()=>null);if(!e.ok)throw Error(r?.error||"Falha ao carregar m\xe9tricas");H({latest:r?.latest||null,daily:Array.isArray(r?.daily)?r.daily:[],range_days:Number(r?.range_days||30)})}catch(e){console.error("Falha ao carregar m\xe9tricas:",e),M(String(e?.message||"Falha ao carregar m\xe9tricas"))}},ea=(0,s.useMemo)(()=>new Map(L.map(e=>[e.id,e.name])),[L]),el=(0,s.useMemo)(()=>(V||[]).map(e=>{let r=_(e?.caption),a=r?r.slice(0,64)+(r.length>64?"…":""):`Post (${_(e?.post_type||"m\xeddia")})`,l=_(e?.client_id),s=ea.get(l)||"Cliente",t=e?.scheduled_at||e?.published_at||e?.created_at||new Date().toISOString(),o=function(e,r,a,l){let s=String(e||"").toLowerCase();return r||"draft"===s?"draft":"failed"===s?"failed":"published"===s||l?"published":"scheduled"}(e?.status,e?.is_draft,e?.scheduled_at,e?.published_at),i=(Array.isArray(e?.platforms)?e.platforms.map(String):[]).filter(e=>["instagram","facebook","linkedin","twitter"].includes(String(e))),d=Array.isArray(e?.media_urls)?e.media_urls:[],n=d.length?_(d[0]):void 0,c=_(e?.error_message);return{id:_(e?.id),title:a,caption:r,clientId:l,clientName:s,scheduledAt:t,status:o,platforms:i.length?i:["instagram"],thumbnail:n,errorMessage:c,raw:e}}).filter(e=>!!e.id),[V,ea]),es=(0,s.useMemo)(()=>{let e=I.trim().toLowerCase();return el.filter(r=>!!("all"===D||r.platforms.includes(D))&&("all"===K||String(r.status)===K)&&(!e||`${r.title} ${r.caption} ${r.clientName}`.toLowerCase().includes(e)))},[el,I,D,K]),et=(0,s.useMemo)(()=>es.filter(e=>"failed"===e.status||!!e.errorMessage),[es]),eo=(0,s.useMemo)(()=>{let e=es.filter(e=>"scheduled"===e.status).length,r=es.filter(e=>"draft"===e.status).length;return{scheduled:e,drafts:r,published:es.filter(e=>"published"===e.status).length,failed:es.filter(e=>"failed"===e.status).length,activeClients:new Set(es.map(e=>e.clientId).filter(Boolean)).size}},[es]),ei=e=>{Q(e),q(!0)},ed=async()=>{if(J){Y(!0),M(null);try{let e=await fetch(`/api/social/posts-mirror?id=${encodeURIComponent(J)}`,{method:"DELETE"}),r=await e.json().catch(()=>null);if(!e.ok)throw Error(r?.error||"Falha ao deletar post");i.Am.success("Post deletado."),q(!1),Q(null),await ee({silent:!0})}catch(e){console.error("Falha ao deletar post:",e),i.Am.error(String(e?.message||"Falha ao deletar post")),M(String(e?.message||"Falha ao deletar post"))}finally{Y(!1)}}},en=e.titlePrefix?`${e.titlePrefix} - Gest\xe3o de Posts`:"Gest\xe3o de Posts";return l.jsx("div",{className:"min-h-screen p-6",style:{backgroundColor:"var(--bg-secondary)"},children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{backgroundColor:"var(--primary-50)"},children:l.jsx(d.Z,{className:"w-7 h-7",style:{color:"var(--primary-500)"}})}),(0,l.jsxs)("div",{children:[l.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:en}),l.jsx("p",{style:{color:"var(--text-secondary)"},children:"Vis\xe3o r\xe1pida (Calend\xe1rio/Lista/Monitoramento) baseada em `instagram_posts`."})]})]}),l.jsx("div",{className:"flex items-center gap-3",children:(0,l.jsxs)(t.default,{href:r,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl font-medium text-white",style:{backgroundColor:"var(--primary-500)"},children:[l.jsx(n.Z,{className:"w-4 h-4"}),"Agendar Postagem"]})})]}),Z?l.jsx("div",{className:"rounded-xl border p-3 text-sm",style:{backgroundColor:"var(--error-50)",borderColor:"var(--error-200)",color:"var(--error-700)"},children:Z}):null,l.jsx("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,l.jsxs)("div",{className:"flex-1 relative",children:[l.jsx(c.Z,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2",style:{color:"var(--text-tertiary)"}}),l.jsx("input",{value:I,onChange:e=>R(e.target.value),placeholder:"Buscar por legenda/cliente…",className:"w-full pl-10 pr-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"}})]}),(0,l.jsxs)("select",{value:$,onChange:e=>B(e.target.value),className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[l.jsx("option",{value:"all",children:"Todos os clientes"}),L.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsxs)("select",{value:D,onChange:e=>z(e.target.value),className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[l.jsx("option",{value:"all",children:"Todas as plataformas"}),l.jsx("option",{value:"instagram",children:"Instagram"}),l.jsx("option",{value:"facebook",children:"Facebook"}),l.jsx("option",{value:"linkedin",children:"LinkedIn"}),l.jsx("option",{value:"twitter",children:"Twitter"})]}),(0,l.jsxs)("select",{value:K,onChange:e=>U(e.target.value),className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:[l.jsx("option",{value:"all",children:"Todos os status"}),l.jsx("option",{value:"draft",children:"Rascunho"}),l.jsx("option",{value:"scheduled",children:"Agendado"}),l.jsx("option",{value:"published",children:"Publicado"}),l.jsx("option",{value:"failed",children:"Falhou"})]})]})}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Agendados",value:eo.scheduled},{label:"Rascunhos",value:eo.drafts},{label:"Publicados",value:eo.published},{label:"Falhas",value:eo.failed},{label:"Clientes ativos",value:eo.activeClients}].map(e=>(0,l.jsxs)("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[l.jsx("div",{className:"text-xs font-medium",style:{color:"var(--text-tertiary)"},children:e.label}),l.jsx("div",{className:"text-2xl font-bold mt-1",style:{color:"var(--text-primary)"},children:e.value})]},e.label))}),l.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"list",label:"Lista",icon:m.Z},{id:"calendar",label:"Calend\xe1rio",icon:d.Z},{id:"monitor",label:"Monitoramento",icon:x.Z},{id:"metrics",label:"M\xe9tricas",icon:u.Z}].map(e=>{let r=e.icon,s=a===e.id;return(0,l.jsxs)("button",{onClick:()=>F(e.id),className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl border text-sm font-medium",style:{backgroundColor:s?"var(--primary-50)":"var(--bg-primary)",borderColor:s?"var(--primary-200)":"var(--border-light)",color:s?"var(--primary-700)":"var(--text-primary)"},children:[l.jsx(r,{className:"w-4 h-4"}),e.label]},e.id)})}),P?l.jsx("div",{className:"rounded-2xl border p-6",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:l.jsx("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Carregando…"})}):null,P||"calendar"!==a?null:l.jsx("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:l.jsx(S.d,{posts:es,onAddPost:()=>{window.location.href=r},onEditPost:()=>{window.location.href=r},onViewPost:()=>{window.location.href=r},onDeletePost:e=>ei(String(e))})}),P||"list"!==a?null:(0,l.jsxs)("div",{className:"rounded-2xl border overflow-hidden",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,l.jsxs)("div",{className:"p-4 border-b",style:{borderColor:"var(--border-light)"},children:[(0,l.jsxs)("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["\xdaltimos posts (",es.length,")"]}),l.jsx("div",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"A\xe7\xf5es avan\xe7adas (reagendar/editar m\xeddia) continuam no “Agendar Postagem”."})]}),(0,l.jsxs)("div",{className:"divide-y",style:{borderColor:"var(--border-light)"},children:[es.slice(0,100).map(e=>{var a;let s=function(e){let r=String(e||"").toLowerCase();return"published"===r?{bg:"var(--success-100)",text:"var(--success-700)"}:"failed"===r?{bg:"var(--error-100)",text:"var(--error-700)"}:"draft"===r?{bg:"var(--neutral-200)",text:"var(--neutral-700)"}:{bg:"var(--primary-100)",text:"var(--primary-700)"}}(e.status);return(0,l.jsxs)("div",{className:"p-4 flex flex-col md:flex-row md:items-center gap-3",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:s.bg,color:s.text},children:"draft"===(a=e.status)?"Rascunho":"scheduled"===a?"Agendado":"published"===a?"Publicado":"failed"===a?"Falhou":a}),l.jsx("span",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:e.clientName})]}),l.jsx("div",{className:"mt-1 font-medium truncate",style:{color:"var(--text-primary)"},children:e.title}),l.jsx("div",{className:"text-xs truncate mt-1",style:{color:"var(--text-secondary)"},children:e.caption||"—"}),e.errorMessage?(0,l.jsxs)("div",{className:"text-xs mt-1",style:{color:"var(--error-600)"},children:["Erro: ",e.errorMessage]}):null,(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-xs",style:{color:"var(--text-tertiary)"},children:[e.platforms.includes("instagram")?l.jsx(h.Z,{className:"w-4 h-4"}):null,e.platforms.includes("facebook")?l.jsx(p.Z,{className:"w-4 h-4"}):null,e.platforms.includes("linkedin")?l.jsx(v.Z,{className:"w-4 h-4"}):null,e.platforms.includes("twitter")?l.jsx(g.Z,{className:"w-4 h-4"}):null,l.jsx("span",{className:"ml-2",children:new Date(e.scheduledAt).toLocaleString("pt-BR")})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(t.default,{href:r,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:["Abrir no Agendar ",l.jsx(b.Z,{className:"w-4 h-4"})]}),(0,l.jsxs)(o.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ei(e.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--error-50)",borderColor:"var(--error-200)",color:"var(--error-700)"},children:[l.jsx(y.Z,{className:"w-4 h-4"}),"Excluir"]})]})]},e.id)}),0===es.length?l.jsx("div",{className:"p-6 text-sm",style:{color:"var(--text-secondary)"},children:"Nenhum post encontrado com os filtros atuais."}):null]})]}),P||"monitor"!==a?null:(0,l.jsxs)("div",{className:"rounded-2xl border p-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,l.jsxs)("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:["Falhas e erros (",et.length,")"]}),l.jsx("div",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"Use esta lista para identificar posts com `status=failed` ou `error_message`."}),(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:[et.slice(0,100).map(e=>l.jsx("div",{className:"rounded-xl border p-3",style:{borderColor:"var(--border-light)",backgroundColor:"var(--bg-secondary)"},children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsxs)("div",{className:"text-sm font-medium truncate",style:{color:"var(--text-primary)"},children:[e.clientName," — ",e.title]}),l.jsx("div",{className:"text-xs mt-1",style:{color:"var(--error-700)"},children:e.errorMessage||"Falha sem mensagem detalhada."})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(t.default,{href:r,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:["Abrir ",l.jsx(b.Z,{className:"w-4 h-4"})]}),(0,l.jsxs)("button",{onClick:()=>ei(e.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--error-50)",borderColor:"var(--error-200)",color:"var(--error-700)"},children:[l.jsx(y.Z,{className:"w-4 h-4"}),"Excluir"]})]})]})},e.id)),0===et.length?l.jsx("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Nenhuma falha encontrada com os filtros atuais."}):null]})]}),P||"metrics"!==a?null:(0,l.jsxs)("div",{className:"rounded-2xl border p-4 space-y-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{children:[l.jsx("div",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"M\xe9tricas (30 dias)"}),l.jsx("div",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"Baseado em `social_account_metrics_daily` (agregado por dia e plataforma)."})]}),l.jsx("button",{onClick:er,className:"px-3 py-2 rounded-xl border text-sm",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:"Atualizar"})]}),"all"===$?l.jsx("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Selecione um cliente para ver m\xe9tricas."}):G?(0,l.jsxs)(l.Fragment,{children:[l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[{label:"Impress\xf5es",value:G.latest?.impressions??0},{label:"Alcance",value:G.latest?.reach??0},{label:"Engajados",value:G.latest?.engaged??0},{label:"Fans",value:G.latest?.fans??0},{label:"Visitas Perfil",value:G.latest?.profile_views??0}].map(e=>(0,l.jsxs)("div",{className:"rounded-xl border p-3",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-light)"},children:[l.jsx("div",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:e.label}),l.jsx("div",{className:"text-lg font-semibold mt-1",style:{color:"var(--text-primary)"},children:Number(e.value||0).toLocaleString("pt-BR")})]},e.label))}),l.jsx("div",{className:"h-72 rounded-xl border p-3",style:{borderColor:"var(--border-light)",backgroundColor:"var(--bg-secondary)"},children:l.jsx(f.h,{width:"100%",height:"100%",children:(0,l.jsxs)(j.w,{data:G.daily,children:[l.jsx(N.K,{dataKey:"date",tick:{fontSize:12}}),l.jsx(C.B,{tick:{fontSize:12}}),l.jsx(w.u,{}),l.jsx(k.x,{type:"monotone",dataKey:"impressions",stroke:"#1672d6",strokeWidth:2,dot:!1}),l.jsx(k.x,{type:"monotone",dataKey:"reach",stroke:"#10B981",strokeWidth:2,dot:!1}),l.jsx(k.x,{type:"monotone",dataKey:"engaged",stroke:"#F59E0B",strokeWidth:2,dot:!1})]})})})]}):l.jsx("div",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Sem dados de m\xe9tricas para este cliente (ou ainda n\xe3o coletado)."})]}),l.jsx(A.do,{isOpen:O,onClose:()=>{X||(q(!1),Q(null))},onConfirm:ed,title:"Deletar post",message:"Tem certeza que deseja deletar este post? Essa a\xe7\xe3o n\xe3o pode ser desfeita.",confirmText:"Deletar",cancelText:"Cancelar",variant:"danger",loading:X})]})})}}};