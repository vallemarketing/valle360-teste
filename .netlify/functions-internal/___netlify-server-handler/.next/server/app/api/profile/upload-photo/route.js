"use strict";(()=>{var e={};e.id=46325,e.ids=[46325],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},11154:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{POST:()=>c,dynamic:()=>l});var a=t(49303),s=t(88716),i=t(60670),n=t(87070),p=t(67721),u=t(71615);let l="force-dynamic";async function c(e){try{let r=(0,u.cookies)(),t=(0,p.createServerClient)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{cookies:{get:e=>r.get(e)?.value}}),{data:{user:o}}=await t.auth.getUser();if(!o)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let a=(await e.formData()).get("file");if(!a)return n.NextResponse.json({error:"Arquivo n\xe3o fornecido"},{status:400});if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type))return n.NextResponse.json({error:"Tipo de arquivo n\xe3o suportado. Use JPG, PNG, GIF ou WebP."},{status:400});if(a.size>5242880)return n.NextResponse.json({error:"Arquivo muito grande. M\xe1ximo: 5MB"},{status:400});let s=`${o.id}-${Date.now()}.${a.type.split("/")[1]}`,i=`avatars/${s}`,{data:l,error:c}=await t.storage.from("profile-photos").upload(i,a,{cacheControl:"3600",upsert:!0});if(c)return console.error("Erro no upload:",c),n.NextResponse.json({error:c.message},{status:500});let{data:{publicUrl:d}}=t.storage.from("profile-photos").getPublicUrl(i),{error:m}=await t.from("user_profiles").update({avatar_url:d}).eq("user_id",o.id);if(m)return console.error("Erro ao atualizar perfil:",m),n.NextResponse.json({error:m.message},{status:500});return n.NextResponse.json({success:!0,avatarUrl:d})}catch(e){return console.error("Erro no upload de foto:",e),n.NextResponse.json({error:e.message},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/profile/upload-photo/route",pathname:"/api/profile/upload-photo",filename:"route",bundlePath:"app/api/profile/upload-photo/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\profile\\upload-photo\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:f}=d,x="/api/profile/upload-photo/route";function h(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[89276,55972,54128,39702],()=>t(11154));module.exports=o})();