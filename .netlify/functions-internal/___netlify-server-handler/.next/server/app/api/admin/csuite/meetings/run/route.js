"use strict";(()=>{var e={};e.id=87091,e.ids=[87091],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},19871:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>f,patchFetch:()=>S,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var n={};i.r(n),i.d(n,{POST:()=>_,dynamic:()=>l});var s=i(49303),r=i(88716),o=i(60670),a=i(87070),c=i(17478),d=i(90176),u=i(51547),p=i(31683),m=i(17743);let l="force-dynamic";async function _(e){let t;let i=await (0,c.k)(e);if(!i.ok)return i.res;try{t=await e.json()}catch{return a.NextResponse.json({success:!1,error:"Body inv\xe1lido (JSON)"},{status:400})}let n=String(t?.meeting_id||"").trim();if(!n||!/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n))return a.NextResponse.json({success:!1,error:"meeting_id inv\xe1lido"},{status:400});let s=(0,d.t)(),{data:r}=await s.from("ai_executive_meetings").select("*").eq("id",n).maybeSingle();if(!r?.id)return a.NextResponse.json({success:!1,error:"Reuni\xe3o n\xe3o encontrada"},{status:404});let o=Array.isArray(r.participants)?r.participants.map(e=>String(e)):[],{data:l}=await s.from("ai_executives").select("*").in("id",o),_=l||[];if(!_.length)return a.NextResponse.json({success:!1,error:"Reuni\xe3o sem participantes v\xe1lidos"},{status:400});_.sort((e,t)=>("ceo"===String(e.role)?1:0)-("ceo"===String(t.role)?1:0)),await s.from("ai_executive_meetings").update({status:"running",started_at:new Date().toISOString()}).eq("id",n);let g=r.agenda??[],x=[];try{for(let e of _){let t=(0,m.U)(e.role);if(!t)continue;let o=await (0,p.tJ)({role:t,actorUserId:i.userId,includePredictions:!0,touchKnowledge:!1}),a=`${String(e.system_prompt||"").trim()}

${p.e$}

Voc\xea est\xe1 em uma REUNI\xc3O executiva. Contribua com um posicionamento objetivo (m\xe1x. 12 linhas).
Se houver conflito com outro executivo, explicite o trade-off.
`,c=await (0,u.F)({task:(0,p.Ph)(t),temperature:.35,maxTokens:650,actorUserId:i.userId,entityType:"ai_executive_meeting",entityId:n,messages:[{role:"system",content:a},{role:"user",content:`Reuni\xe3o: ${r.title} (type=${r.meeting_type})

Agenda: ${JSON.stringify(g)}

Contexto interno (JSON):
${JSON.stringify(o).slice(0,16e3)}

Pergunta: qual sua recomenda\xe7\xe3o e por qu\xea?`}]}),d=String(c.text||"").trim();d&&(x.push({role:t,executive_id:String(e.id),content:d}),await s.from("ai_executive_meeting_messages").insert({meeting_id:n,executive_id:e.id,message_type:"statement",content:d,data_presented:{used_market:!1,missing:o.missing,predictions_count:o.signals.predictions.length},confidence_level:.75}))}let e=_.find(e=>"ceo"===String(e.role).toLowerCase())||_[_.length-1];String(e.role||"").toLowerCase();let t=`${String(e.system_prompt||"").trim()}

${p.e$}

Agora voc\xea \xe9 o mediador. Gere uma s\xedntese e uma decis\xe3o consultiva.
Sa\xedda em JSON v\xe1lido com chaves: summary, decision{decision_type,category,title,description,rationale,options_considered,chosen_option,success_metrics,implementation_plan,human_approval_required}.
`,o=(await (0,u.F)({task:"strategy",json:!0,temperature:.25,maxTokens:900,actorUserId:i.userId,entityType:"ai_executive_meeting_ceo",entityId:n,messages:[{role:"system",content:t},{role:"user",content:`Reuni\xe3o: ${r.title} (${r.meeting_type})

Agenda: ${JSON.stringify(g)}

Declara\xe7\xf5es:
${x.map(e=>`- ${e.role.toUpperCase()}: ${e.content}`).join("\n")}

Gere a s\xedntese e a decis\xe3o (consultiva).`}]})).json||{},c=String(o?.summary||"").trim()||"S\xedntese indispon\xedvel.",d=o?.decision||{};await s.from("ai_executive_meeting_messages").insert({meeting_id:n,executive_id:e.id,message_type:"summary",content:c,data_presented:{decision:d},confidence_level:.8});let l={decision_type:String(d?.decision_type||"strategy"),category:String(d?.category||"general"),title:String(d?.title||`Decis\xe3o â€” ${r.title}`),description:String(d?.description||c),proposed_by:e.id,approved_by:[],meeting_id:n,insight_ids:[],options_considered:d?.options_considered??[],chosen_option:d?.chosen_option?String(d.chosen_option):null,rationale:d?.rationale?String(d.rationale):null,expected_impact:d?.expected_impact??{},success_metrics:d?.success_metrics??{},implementation_plan:d?.implementation_plan??{},status:"proposed",human_approval_required:d?.human_approval_required!==!1},{data:y}=await s.from("ai_executive_decisions").insert(l).select("id").single();try{let e=new Date().toISOString(),t=y?.id?String(y.id):null,i=Array.from(new Set(_.map(e=>String(e.id)).filter(Boolean))),o=_.map(e=>String(e.role||"").toLowerCase()).filter(Boolean);if(t){let a={meeting_id:n,meeting_title:r.title,meeting_type:r.meeting_type,agenda:g,participants_roles:o,summary:c,decision:{id:t,decision_type:l.decision_type,category:l.category,title:l.title,description:l.description,chosen_option:l.chosen_option,rationale:l.rationale,options_considered:l.options_considered,success_metrics:l.success_metrics,implementation_plan:l.implementation_plan,human_approval_required:l.human_approval_required},captured_at:e},d=i.map(i=>({executive_id:i,knowledge_type:"decision",category:l.category,key:`decision:${t}`,value:a,confidence:.9,source:"ai_executive_meetings",source_id:n,valid_from:e}));await s.from("ai_executive_knowledge").upsert(d,{onConflict:"executive_id,knowledge_type,key"})}}catch{}return await s.from("ai_executive_meetings").update({status:"completed",completed_at:new Date().toISOString(),outcome_summary:c,decisions_made:[{decision_id:y?.id||null,title:l.title}]}).eq("id",n),a.NextResponse.json({success:!0,meeting_id:n,summary:c,decision_id:y?.id||null})}catch(i){let e=(0,u.getProviderStatus)(),t=e.openrouter||e.claude||e.openai||e.gemini?"Falha ao conduzir reuni\xe3o agora. Tente novamente.":"Integra\xe7\xf5es de IA n\xe3o est\xe3o configuradas. Configure em Integra\xe7\xf5es (OpenRouter/Claude/OpenAI/Gemini).";return await s.from("ai_executive_meetings").update({status:"scheduled"}).eq("id",n),a.NextResponse.json({success:!1,error:t},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/csuite/meetings/run/route",pathname:"/api/admin/csuite/meetings/run",filename:"route",bundlePath:"app/api/admin/csuite/meetings/run/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\csuite\\meetings\\run\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:v}=g,f="/api/admin/csuite/meetings/run/route";function S(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958,79263,44518],()=>i(19871));module.exports=n})();