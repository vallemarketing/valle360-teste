"use strict";(()=>{var e={};e.id=47019,e.ids=[47019],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},55580:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>c});var s=r(49303),i=r(88716),o=r(60670),a=r(87070),l=r(20344),u=r(71615);async function c(e){try{let t=(0,l.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:r}}=await t.auth.getUser();if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n}=await t.from("user_profiles").select("client_id").eq("user_id",r.id).single();if(!n?.client_id)return a.NextResponse.json({error:"Client not found"},{status:404});let s=e.nextUrl.searchParams,i=s.get("status"),o=s.get("year"),c=parseInt(s.get("limit")||"50"),d=t.from("invoices").select("*, contracts(services)").eq("client_id",n.client_id).order("due_date",{ascending:!1}).limit(c);if(i&&(d=d.eq("status",i)),o){let e=`${o}-01-01`,t=`${o}-12-31`;d=d.gte("due_date",e).lte("due_date",t)}let{data:p,error:g}=await d;if(g)return console.error("Error fetching invoices:",g),a.NextResponse.json({error:"Failed to fetch invoices"},{status:500});let v={total:p?.length||0,pending:p?.filter(e=>"pending"===e.status).length||0,overdue:p?.filter(e=>"overdue"===e.status).length||0,paid:p?.filter(e=>"paid"===e.status).length||0,totalPending:p?.filter(e=>["pending","overdue"].includes(e.status)).reduce((e,t)=>e+(t.amount||0),0)||0,totalPaid:p?.filter(e=>"paid"===e.status).reduce((e,t)=>e+(t.amount||0),0)||0};return a.NextResponse.json({invoices:p||[],summary:v})}catch(e){return console.error("Error in client invoices API:",e),a.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/client/invoices/route",pathname:"/api/client/invoices",filename:"route",bundlePath:"app/api/client/invoices/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\client\\invoices\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:v}=d,x="/api/client/invoices/route";function m(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958],()=>r(55580));module.exports=n})();