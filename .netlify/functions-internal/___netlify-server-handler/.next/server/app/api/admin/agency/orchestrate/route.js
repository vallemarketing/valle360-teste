"use strict";(()=>{var e={};e.id=63622,e.ids=[63622,92880],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},88250:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var a={};s.r(a),s.d(a,{POST:()=>l,dynamic:()=>p,maxDuration:()=>u});var r=s(49303),i=s(88716),o=s(60670),n=s(87070),c=s(17478);s(36066);var d=s(92880);let p="force-dynamic",u=300;async function l(e){let t;let s=await (0,c.k)(e);if(!s.ok)return s.res;try{t=await e.json()}catch{return n.NextResponse.json({success:!1,error:"Invalid JSON body"},{status:400})}let{client_id:a,demand_type:r,topic:i,objective:o,additional_context:p,use_focus_group:u,min_focus_group_score:l}=t;if(!a||!r||!i)return n.NextResponse.json({success:!1,error:"client_id, demand_type, and topic are required"},{status:400});let g=["instagram_post","linkedin_post","youtube_video","meta_ads_campaign","carousel","reels","full_campaign"];if(!g.includes(r))return n.NextResponse.json({success:!1,error:`Invalid demand_type. Must be one of: ${g.join(", ")}`},{status:400});try{let e=(0,d._)(a),t=await e.orchestrate({clientId:a,demandType:r,topic:i,objective:o,additionalContext:p,useFocusGroup:u??!1,minFocusGroupScore:l??7});return n.NextResponse.json({success:!0,result:t})}catch(e){return console.error("Orchestration error:",e),n.NextResponse.json({success:!1,error:e.message||"Orchestration failed"},{status:500})}}let g=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/agency/orchestrate/route",pathname:"/api/admin/agency/orchestrate",filename:"route",bundlePath:"app/api/admin/agency/orchestrate/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\admin\\agency\\orchestrate\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:h}=g,x="/api/admin/agency/orchestrate/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},64470:(e,t,s)=>{s.d(t,{i:()=>a});class a{constructor(e){this.id=e.id,this.description=e.description,this.expectedOutput=e.expectedOutput,this.agentId=e.agentId,this.context=e.context,this.dependencies=e.dependencies}assignAgent(e){this.agent=e,this.agentId=e.id}async execute(e){if(!this.agent)throw Error(`Task ${this.id} has no assigned agent`);let t=[this.context,e,`OUTPUT ESPERADO: ${this.expectedOutput}`].filter(Boolean).join("\n\n");if(this.result=await this.agent.execute(this.description,t),!this.result)throw Error(`Task ${this.id} execution returned undefined result`);return this.result}getResult(){return this.result}}},36066:(e,t,s)=>{s.d(t,{O:()=>u,Q:()=>l});var a=s(93916),r=s(64470),i=s(70685),o=s(20928),n=s(9846),c=s(11567),d=s(35550);let p={head_strategist:i.D0,trend_hunter:i.Y1,competitor_analyst:i.gr,campaign_planner:i.u7,copy_instagram_expert:o.zk,copy_linkedin_expert:o.jN,copy_youtube_expert:o.f6,copy_ads_expert:o.hH,cta_specialist:o.du,hook_specialist:o.C0,graphic_designer_posts:n.xm,graphic_designer_carousels:n.Bl,video_script_writer:n.zp,video_hook_specialist:n.xQ,reels_specialist:n.PB,social_media_manager:c.hJ,scheduler_agent:c.sX,traffic_manager:c.Qs,meta_ads_specialist:c.UG,brand_guardian:d.Ke,persona_skeptic:d.Pj,persona_enthusiast:d.ud,persona_busy_executive:d._o};function u(e,t,s,i){let o=new a.c({id:`${e.crewRecommended}_${Date.now()}`,name:e.crewRecommended,description:`Crew para ${e.demandType}: ${s}`,agents:e.agentsNeeded,tasks:[],process:"sequential"}),n=[];for(let s of e.agentsNeeded){let e=p[s];if(e){let s=e(t);n.push(s),o.addAgent(s)}}let c=[];for(let t=0;t<e.suggestedTasks.length;t++){let a=e.suggestedTasks[t],n=e.agentsNeeded[t%e.agentsNeeded.length],d=new r.i({id:`task_${t+1}`,description:`${a}

Tema: ${s}${i?`
Objetivo: ${i}`:""}`,expectedOutput:function(e){let t={"An\xe1lise estrat\xe9gica":"Briefing estrat\xe9gico com \xe2ngulo, tom e mensagens-chave","Pesquisa de tend\xeancias":"Lista de 3-5 tend\xeancias aplic\xe1veis com sugest\xf5es","Cria\xe7\xe3o do copy":"Copy completo com varia\xe7\xf5es, hashtags e CTA","Dire\xe7\xe3o de arte":"Prompt detalhado para criativo com cores, tipografia e estilo","Otimiza\xe7\xe3o de hook":"5 op\xe7\xf5es de hook ranqueadas por potencial",default:"Entreg\xe1vel completo e pronto para uso"};for(let[s,a]of Object.entries(t))if(e.toLowerCase().includes(s.toLowerCase()))return a;return t.default}(a),agentId:n,dependencies:t>0?[`task_${t}`]:void 0});c.push(d),o.addTask(d)}return{crew:o,agents:n,tasks:c}}function l(e){let t=new a.c({id:`focus_group_${Date.now()}`,name:"focus_group_crew",description:"Focus Group Sint\xe9tico para valida\xe7\xe3o de conte\xfado",agents:["brand_guardian","persona_skeptic","persona_enthusiast","persona_busy_executive"],tasks:[],process:"sequential"}),s=[(0,d.Ke)(e),(0,d.Pj)(),(0,d.ud)(),(0,d._o)()];s.forEach(e=>t.addAgent(e));let i=[new r.i({id:"brand_validation",description:"Valide o conte\xfado contra as diretrizes da marca",expectedOutput:"Aprovado ou lista de ajustes necess\xe1rios",agentId:"brand_guardian"}),new r.i({id:"skeptic_review",description:"Avalie o conte\xfado com olhar cr\xedtico",expectedOutput:"Nota 0-10, positivos, negativos, sugest\xf5es",agentId:"persona_skeptic",dependencies:["brand_validation"]}),new r.i({id:"enthusiast_review",description:"Avalie o conte\xfado com olhar de entusiasta",expectedOutput:"Nota 0-10, positivos, negativos, sugest\xf5es",agentId:"persona_enthusiast",dependencies:["brand_validation"]}),new r.i({id:"executive_review",description:"Avalie o conte\xfado com olhar de executivo ocupado",expectedOutput:"Nota 0-10, positivos, negativos, sugest\xf5es",agentId:"persona_busy_executive",dependencies:["brand_validation"]})];return i.forEach(e=>t.addTask(e)),{crew:t,agents:s,tasks:i}}},92880:(e,t,s)=>{s.d(t,{_:()=>o,executeCrew:()=>n});var a=s(36066),r=s(14065);class i{constructor(e){this.clientId=e}async orchestrate(e){let t=Date.now(),s=`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;try{let i;let o=await (0,r.$y)(this.clientId),n=function(e){let{demandType:t,topic:s,objective:a,useFocusGroup:r}=e,i={instagram_post:{crewRecommended:"organic_content_crew",agentsNeeded:["head_strategist","trend_hunter","copy_instagram_expert","graphic_designer_posts","hook_specialist","cta_specialist"],complexity:"medium",estimatedTime:45,suggestedTasks:["An\xe1lise estrat\xe9gica e briefing","Pesquisa de tend\xeancias","Cria\xe7\xe3o do copy","Dire\xe7\xe3o de arte","Otimiza\xe7\xe3o de hook e CTA"]},linkedin_post:{crewRecommended:"organic_content_crew",agentsNeeded:["head_strategist","copy_linkedin_expert","graphic_designer_posts","hook_specialist"],complexity:"medium",estimatedTime:40,suggestedTasks:["An\xe1lise estrat\xe9gica","Cria\xe7\xe3o do copy","Dire\xe7\xe3o de arte","Otimiza\xe7\xe3o de hook"]},youtube_video:{crewRecommended:"video_content_crew",agentsNeeded:["head_strategist","trend_hunter","copy_youtube_expert","video_script_writer","video_hook_specialist","graphic_designer_posts"],complexity:"complex",estimatedTime:120,suggestedTasks:["An\xe1lise estrat\xe9gica","Pesquisa de tend\xeancias","Cria\xe7\xe3o de t\xedtulos e descri\xe7\xf5es","Roteiro completo","Hooks para reten\xe7\xe3o","Thumbnail"]},reels:{crewRecommended:"video_content_crew",agentsNeeded:["trend_hunter","copy_instagram_expert","reels_specialist","video_hook_specialist"],complexity:"medium",estimatedTime:35,suggestedTasks:["Pesquisa de trends","Copy e legenda","Roteiro do Reels","Hook de abertura"]},carousel:{crewRecommended:"organic_content_crew",agentsNeeded:["head_strategist","copy_instagram_expert","graphic_designer_carousels","hook_specialist","cta_specialist"],complexity:"medium",estimatedTime:60,suggestedTasks:["Estrutura narrativa","Copy por slide","Design do carrossel","Hook inicial","CTA final"]},meta_ads_campaign:{crewRecommended:"paid_content_crew",agentsNeeded:["head_strategist","campaign_planner","copy_ads_expert","traffic_manager","meta_ads_specialist","graphic_designer_posts"],complexity:"complex",estimatedTime:90,suggestedTasks:["Estrat\xe9gia de campanha","Planejamento de funil","Copies para ads","Estrutura de campanha","Configura\xe7\xe3o Meta Ads","Criativos"]},full_campaign:{crewRecommended:"campaign_crew",agentsNeeded:["head_strategist","campaign_planner","trend_hunter","competitor_analyst","copy_instagram_expert","copy_linkedin_expert","copy_ads_expert","graphic_designer_posts","graphic_designer_carousels","video_script_writer","traffic_manager","social_media_manager"],complexity:"complex",estimatedTime:300,suggestedTasks:["Estrat\xe9gia geral","Planejamento de campanha","An\xe1lise de tend\xeancias","An\xe1lise competitiva","Conte\xfado org\xe2nico","Conte\xfado pago","Criativos visuais","V\xeddeos","Gest\xe3o de tr\xe1fego","Calend\xe1rio"]}},o=i[t]||i.instagram_post;return{demandType:t,crewRecommended:o.crewRecommended,agentsNeeded:o.agentsNeeded,complexity:o.complexity,estimatedTime:o.estimatedTime,requiresFocusGroup:r??"complex"===o.complexity,suggestedTasks:o.suggestedTasks}}(e),{crew:c,agents:d}=(0,a.O)(n,this.clientId,e.topic,e.objective),p=await c.kickoff(o||"");if(!p.success)throw Error(p.error||"Crew execution failed");let u=this.parseOutputs(p.finalOutput,e.demandType);return(n.requiresFocusGroup||e.useFocusGroup)&&(i=await this.runFocusGroup(u,e.minFocusGroupScore??7)),{success:!0,requestId:s,demandType:e.demandType,crewUsed:n.crewRecommended,agentsInvolved:d.map(e=>e.name),outputs:u,focusGroupResult:i,executionTime:Date.now()-t,tokenUsage:p.totalTokens}}catch(a){return{success:!1,requestId:s,demandType:e.demandType,crewUsed:"",agentsInvolved:[],outputs:{},executionTime:Date.now()-t,tokenUsage:0}}}async runFocusGroup(e,t){let s=0,r=[],i=0;for(;s<3;){s++;let{crew:o}=(0,a.Q)(this.clientId),n=this.formatOutputsForReview(e),c=await o.kickoff(n);if(r=this.parseEvaluations(c.finalOutput),(i=this.calculateAverageScore(r))>=t)return{averageScore:i,passed:!0,iterations:s,evaluations:r};console.log(`Focus group iteration ${s}: Score ${i} < ${t}`)}return{averageScore:i,passed:i>=t,iterations:s,evaluations:r}}parseOutputs(e,t){let s={},a=e.match(/(?:estratég|briefing|análise)[^]*?(?=\n\n---|\n\n\[|$)/i);a&&(s.strategy=a[0].trim());let r=e.match(/(?:copy|legenda|texto|post)[^]*?(?=\n\n---|\n\n\[|$)/i);r&&(s.copy=r[0].trim());let i=e.match(/#[^\s#]+/g);i&&(s.hashtags=i.slice(0,15));let o=e.match(/(?:prompt|visual|arte|design)[^]*?(?=\n\n---|\n\n\[|$)/i);o&&(s.visualPrompt=o[0].trim());let n=e.match(/(?:cta|call.to.action|chamada)[^]*?(?=\n\n---|\n\n\[|$)/i);return n&&(s.cta=n[0].trim()),0===Object.keys(s).length&&(s.copy=e),s}formatOutputsForReview(e){let t=[];return e.strategy&&t.push(`ESTRAT\xc9GIA:
${e.strategy}`),e.copy&&t.push(`COPY:
${e.copy}`),e.hashtags?.length&&t.push(`HASHTAGS:
${e.hashtags.join(" ")}`),e.visualPrompt&&t.push(`VISUAL:
${e.visualPrompt}`),e.cta&&t.push(`CTA:
${e.cta}`),t.join("\n\n---\n\n")}parseEvaluations(e){let t=[],s=e.match(/\{[^{}]*"nota"[^{}]*\}/g);if(s)for(let e of s)try{let s=JSON.parse(e);t.push({personaId:s.persona_id||"unknown",personaName:s.persona_name||"Unknown",score:s.nota||5,positives:s.pontos_positivos||[],negatives:s.pontos_negativos||[],suggestions:s.sugestoes||[],verdict:s.veredicto||"precisa_ajustes"})}catch{let s=e.match(/"nota"\s*:\s*(\d+)/);s&&t.push({personaId:"unknown",personaName:"Unknown",score:parseInt(s[1]),positives:[],negatives:[],suggestions:[],verdict:"precisa_ajustes"})}return t}calculateAverageScore(e){return 0===e.length?0:e.reduce((e,t)=>e+t.score,0)/e.length}}function o(e){return new i(e)}async function n(e,t,s,a){let r=o(t),i={clientId:t,demandType:"test_campaign"===e?"marketing_campaign":s.demandType||"social_media_post",topic:s.topic||s.campaignName||"Conte\xfado de teste",tone:s.tone||"profissional",targetAudience:s.targetAudience||"p\xfablico geral",additionalContext:s.additionalContext||""};return await r.orchestrate(i)}},17478:(e,t,s)=>{s.d(t,{k:()=>n});var a=s(87070),r=s(20344),i=s(71615),o=s(54128);async function n(e){let t=(0,i.cookies)(),s=(0,r.createRouteHandlerClient)({cookies:()=>t}),n=e.headers.get("authorization")||"",c=n.toLowerCase().startsWith("bearer ")?n.slice(7).trim():null,d=c?(0,o.eI)("https://ikjgsqtykkhqimypacro.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI",{global:{headers:{Authorization:`Bearer ${c}`}},auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):s,{data:p}=await d.auth.getUser();if(!p.user?.id)return{ok:!1,res:a.NextResponse.json({error:"N\xe3o autorizado"},{status:401})};let{data:u,error:l}=await d.rpc("is_admin");return l||!u?{ok:!1,res:a.NextResponse.json({error:"Acesso negado (admin)"},{status:403})}:{ok:!0,userId:p.user.id}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[89276,55972,54128,20958,54214,18871],()=>s(88250));module.exports=a})();