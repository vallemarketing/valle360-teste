"use strict";exports.id=29235,exports.ids=[29235],exports.modules={29235:(e,t,a)=>{a.d(t,{C_:()=>n,K1:()=>c,Mb:()=>u,ae:()=>h,pL:()=>m,qI:()=>g});var i=a(1926),o=a(51547);let r=`Voc\xea \xe9 o CMO virtual da Valle 360, uma ag\xeancia de marketing digital.
Seu papel \xe9 maximizar receita atrav\xe9s de estrat\xe9gias de aquisi\xe7\xe3o, upsell e reten\xe7\xe3o.

Suas responsabilidades:
1. An\xe1lise de segmentos de mercado
2. Identifica\xe7\xe3o de oportunidades de upsell e cross-sell
3. Predi\xe7\xe3o e preven\xe7\xe3o de churn
4. Estrat\xe9gias de fideliza\xe7\xe3o
5. Defini\xe7\xe3o de perfil de cliente ideal

Sempre forne\xe7a:
- An\xe1lises baseadas em dados de comportamento
- Scripts de abordagem personalizados
- Timing ideal para cada a\xe7\xe3o
- M\xe9tricas de sucesso esperadas

Seja persuasivo, estrat\xe9gico e focado em crescimento de receita.`;async function n(){let{data:e}=await i.O.from("clients").select("id, name, industry, monthly_value, created_at, status");if(!e?.length)return[{segmentName:"E-commerce",clientCount:12,totalRevenue:84e3,averageTicket:7e3,averageLtv:168e3,churnRate:8,acquisitionCost:3e3,profitabilityScore:92,growthPotential:"very_high",recommendation:"Expandir prospec\xe7\xe3o neste segmento. Alto ticket e baixo churn indicam fit perfeito."},{segmentName:"Cl\xednicas e Sa\xfade",clientCount:8,totalRevenue:48e3,averageTicket:6e3,averageLtv:144e3,churnRate:5,acquisitionCost:2500,profitabilityScore:88,growthPotential:"very_high",recommendation:"Foco em upsell de gest\xe3o de reputa\xe7\xe3o e Google Ads para cl\xednicas."},{segmentName:"Franquias",clientCount:5,totalRevenue:75e3,averageTicket:15e3,averageLtv:36e4,churnRate:3,acquisitionCost:5e3,profitabilityScore:95,growthPotential:"high",recommendation:"Ticket mais alto e fidelidade excepcional. Criar programa VIP para este segmento."},{segmentName:"Restaurantes",clientCount:15,totalRevenue:45e3,averageTicket:3e3,averageLtv:54e3,churnRate:18,acquisitionCost:1500,profitabilityScore:65,growthPotential:"medium",recommendation:"Alto churn indica necessidade de revis\xe3o do servi\xe7o ou ticket. Considerar pacotes mais acess\xedveis."}];let t={};for(let a of e){let e=a.industry||"Outros";t[e]||(t[e]=[]),t[e].push(a)}let a=[];for(let[e,i]of Object.entries(t)){let t=i.reduce((e,t)=>e+(t.monthly_value||0),0),o=i.filter(e=>"active"===e.status),r=i.filter(e=>"churned"===e.status),n={segmentName:e,clientCount:i.length,totalRevenue:t,averageTicket:t/(o.length||1),averageLtv:12*t,churnRate:r.length/i.length*100,acquisitionCost:2500,profitabilityScore:Math.min(100,t/(i.length||1)/3e3*100),growthPotential:function(e){let t=e.toLowerCase();return["e-commerce","sa\xfade","tecnologia","educa\xe7\xe3o"].some(e=>t.includes(e))?"very_high":["varejo","alimenta\xe7\xe3o","servi\xe7os"].some(e=>t.includes(e))?"high":"medium"}(e),recommendation:""};n.recommendation=await s(n),a.push(n)}return a.sort((e,t)=>t.profitabilityScore-e.profitabilityScore)}async function s(e){try{return(await (0,o.F)({task:"strategy",json:!1,temperature:.7,maxTokens:150,entityType:"cmo_segment_reco",entityId:null,messages:[{role:"system",content:r},{role:"user",content:`Gere 1 recomenda\xe7\xe3o estrat\xe9gica em 2 frases para este segmento:
Segmento: ${e.segmentName}
Clientes: ${e.clientCount}
Ticket m\xe9dio: R$ ${e.averageTicket.toFixed(0)}
Churn: ${e.churnRate.toFixed(1)}%
Potencial: ${e.growthPotential}`}]})).text||"Avaliar potencial de crescimento."}catch{return"Avaliar potencial de crescimento e oportunidades de upsell."}}async function c(){let{data:e}=await i.O.from("clients").select("id, name, industry, monthly_value, services, created_at").eq("status","active");if(!e?.length)return[{id:"upsell-1",clientId:"client-1",clientName:"Tech Solutions",currentServices:["social_media"],suggestedService:"trafego",opportunityType:"upsell",estimatedValue:4500,probability:85,bestTiming:"Pr\xf3xima semana - ap\xf3s relat\xf3rio mensal",approachScript:"Tech Solutions, seus resultados em redes sociais est\xe3o excelentes! Para multiplicar essas convers\xf5es, tr\xe1fego pago \xe9 o pr\xf3ximo passo natural. Vamos conversar?",reasonsToOffer:["Cliente h\xe1 8 meses","NPS 9","Crescimento de 40% no engajamento"],status:"identified"},{id:"upsell-2",clientId:"client-2",clientName:"Cl\xednica Bem-Estar",currentServices:["social_media","trafego"],suggestedService:"video",opportunityType:"cross_sell",estimatedValue:5e3,probability:72,bestTiming:"Ap\xf3s Black Friday",approachScript:"Cl\xednica Bem-Estar, conte\xfado em v\xeddeo tem 3x mais engajamento no setor de sa\xfade. Que tal criarmos v\xeddeos curtos para seus procedimentos?",reasonsToOffer:["Setor valoriza v\xeddeo","J\xe1 tem base de tr\xe1fego","Competidores usando v\xeddeo"],status:"identified"}];let t=[];for(let a of e){let e=a.services||[],i=Math.floor((Date.now()-new Date(a.created_at).getTime())/2592e6);for(let o of["social_media","trafego","design","video","web","seo","email_marketing"].filter(t=>!e.includes(t)).slice(0,2)){let e=await l(a,o,i);e.probability>=40&&t.push(e)}}return t.sort((e,t)=>t.probability-e.probability)}async function l(e,t,a){let i={social_media:3500,trafego:4500,design:2800,video:5e3,web:8e3,seo:3e3,email_marketing:2e3}[t]||3e3,o=50;a>=6&&(o+=15),e.monthly_value>=5e3&&(o+=10),"e-commerce"===e.industry&&(o+=10);let r=await d(e,t);return{id:`upsell-${e.id}-${t}`,clientId:e.id,clientName:e.name,currentServices:e.services||[],suggestedService:t,opportunityType:"upsell",estimatedValue:i,probability:Math.min(95,o),bestTiming:a<3?"Aguardar maturidade (3 meses)":"Pr\xf3xima reuni\xe3o de resultados",approachScript:r,reasonsToOffer:[`Cliente h\xe1 ${a} meses - momento ideal`,`Servi\xe7o complementa ${e.services?.[0]||"atual"}`,`Potencial de aumento de ${Math.round(i/(e.monthly_value||1)*100)}% na receita`],status:"identified"}}async function d(e,t){try{return(await (0,o.F)({task:"sales",json:!1,temperature:.8,maxTokens:200,entityType:"cmo_upsell_script",entityId:null,messages:[{role:"system",content:r},{role:"user",content:`Crie um script de abordagem de upsell em 3-4 frases:
Cliente: ${e.name}
Setor: ${e.industry}
Servi\xe7os atuais: ${e.services?.join(", ")||"N\xe3o informado"}
Servi\xe7o a oferecer: ${t}

Seja natural e focado no valor para o cliente.`}]})).text||"Apresentar benef\xedcios do servi\xe7o."}catch{return`Ol\xe1 [Nome], notamos que voc\xea est\xe1 tendo \xf3timos resultados com nossos servi\xe7os atuais. Tenho uma proposta que pode potencializar ainda mais: ${t}. Podemos conversar?`}}async function m(){let{data:e}=await i.O.from("clients").select("id, name, monthly_value, created_at, last_contact, nps_score").eq("status","active");if(!e?.length)return[{clientId:"risk-1",clientName:"Loja Virtual XYZ",riskScore:78,riskLevel:"critical",factors:[{factor:"Sem contato recente",impact:35,description:"45 dias sem intera\xe7\xe3o"},{factor:"NPS baixo",impact:30,description:"NPS de 4 (detrator)"},{factor:"Reclama\xe7\xe3o n\xe3o resolvida",impact:13,description:"Ticket aberto h\xe1 15 dias"}],predictedChurnDate:new Date(Date.now()+2592e6).toISOString(),potentialRevenueLoss:6e4,recommendedActions:["URGENTE: Ligar para o cliente hoje","Preparar plano de a\xe7\xe3o para reclama\xe7\xe3o","Oferecer reuni\xe3o com diretor"],lastInteraction:new Date(Date.now()-3888e6).toISOString(),npsScore:4},{clientId:"risk-2",clientName:"Restaurante Sabor",riskScore:52,riskLevel:"high",factors:[{factor:"Resultados abaixo do esperado",impact:32,description:"ROAS caiu 30%"},{factor:"Questionou valor",impact:20,description:"Pediu revis\xe3o de contrato"}],predictedChurnDate:null,potentialRevenueLoss:36e3,recommendedActions:["Preparar an\xe1lise de otimiza\xe7\xe3o de campanha","Agendar reuni\xe3o de revis\xe3o estrat\xe9gica","Considerar desconto tempor\xe1rio"],lastInteraction:new Date(Date.now()-864e6).toISOString(),npsScore:6}];let t=[];for(let a of e){let e=[],i=0,o=a.last_contact?Math.floor((Date.now()-new Date(a.last_contact).getTime())/864e5):30;if(o>30){let t=Math.min(30,o-30);i+=t,e.push({factor:"Sem contato recente",impact:t,description:`${o} dias sem intera\xe7\xe3o`})}if(null!==a.nps_score&&a.nps_score<7){let t=(7-a.nps_score)*10;i+=t,e.push({factor:"NPS baixo",impact:t,description:`NPS de ${a.nps_score} (detrator)`})}3>Math.floor((Date.now()-new Date(a.created_at).getTime())/2592e6)&&(i+=15,e.push({factor:"Cliente recente",impact:15,description:"Primeiros 3 meses s\xe3o cr\xedticos"}));let r=i>=60?"critical":i>=40?"high":i>=20?"medium":"low";i>=20&&t.push({clientId:a.id,clientName:a.name,riskScore:Math.min(100,i),riskLevel:r,factors:e,predictedChurnDate:"critical"===r?new Date(Date.now()+2592e6).toISOString():null,potentialRevenueLoss:12*(a.monthly_value||0),recommendedActions:function(e){let t=[];for(let a of e)switch(a.factor){case"Sem contato recente":t.push("Agendar liga\xe7\xe3o de relacionamento"),t.push("Enviar relat\xf3rio de resultados personalizado");break;case"NPS baixo":t.push("Realizar pesquisa de satisfa\xe7\xe3o detalhada"),t.push("Oferecer reuni\xe3o com gestor para ouvir feedback");break;case"Cliente recente":t.push("Intensificar onboarding"),t.push("Enviar quick wins e primeiros resultados")}return[...new Set(t)].slice(0,4)}(e),lastInteraction:a.last_contact||"N\xe3o registrado",npsScore:a.nps_score})}return t.sort((e,t)=>t.riskScore-e.riskScore)}async function u(e){let t=e.filter(e=>"critical"===e.riskLevel||"high"===e.riskLevel);if(0===t.length)return{id:"campaign-loyalty",name:"Programa de Fidelidade",targetClients:[],type:"loyalty",message:"Obrigado por fazer parte da nossa jornada! Como forma de agradecimento...",expectedRetention:95,cost:0,status:"planned"};let a=t.reduce((e,t)=>e+t.potentialRevenueLoss,0),i=await p(t);return{id:`campaign-${Date.now()}`,name:`Campanha de Reten\xe7\xe3o - ${t.length} clientes em risco`,targetClients:t.map(e=>e.clientId),type:"personal_touch",message:i,expectedRetention:70,cost:.1*a,status:"planned"}}async function p(e){try{return(await (0,o.F)({task:"copywriting",json:!1,temperature:.7,maxTokens:200,entityType:"cmo_retention_message",entityId:null,messages:[{role:"system",content:r},{role:"user",content:`Crie uma mensagem de reten\xe7\xe3o emp\xe1tica e profissional (3-4 frases) para clientes em risco de churn.
Principais problemas detectados: ${[...new Set(e.flatMap(e=>e.factors.map(e=>e.factor)))].join(", ")}

A mensagem deve reconhecer poss\xedveis falhas e propor uma conversa.`}]})).text||"Gostar\xedamos de conversar sobre como podemos melhorar nossa parceria."}catch{return"Percebemos que podemos melhorar. Gostar\xedamos de agendar uma conversa para entender suas necessidades e garantir que estamos entregando o melhor para voc\xea."}}async function g(){let e=await n(),t=await c(),a=await m(),{data:o}=await i.O.from("clients").select("id, status, monthly_value, nps_score"),r=o||[],s=r.filter(e=>"active"===e.status),l=r.filter(e=>"churned"===e.status),d=s.filter(e=>null!==e.nps_score).map(e=>e.nps_score),u=t.reduce((e,t)=>e+t.estimatedValue,0),p=[];for(let e of a.filter(e=>"critical"===e.riskLevel).slice(0,3))p.push({id:`churn-${e.clientId}`,type:"churn_critical",severity:"critical",title:`URGENTE: ${e.clientName} em risco cr\xedtico`,description:`Score de risco: ${e.riskScore}. Perda potencial: R$ ${e.potentialRevenueLoss.toLocaleString("pt-BR")}/ano`,clientId:e.clientId,recommendedAction:e.recommendedActions[0]||"Contato imediato",potentialImpact:e.potentialRevenueLoss,createdAt:new Date().toISOString()});let g=t.filter(e=>e.probability>=70);return g.length>0&&p.push({id:"hot-opportunities",type:"upsell_opportunity",severity:"medium",title:`${g.length} oportunidades quentes de upsell`,description:`Potencial de R$ ${g.reduce((e,t)=>e+t.estimatedValue,0).toLocaleString("pt-BR")}/m\xeas`,recommendedAction:"Priorizar contato com clientes de alta probabilidade",potentialImpact:g.reduce((e,t)=>e+12*t.estimatedValue,0),createdAt:new Date().toISOString()}),{kpis:{totalClients:r.length,activeClients:s.length,churnRate:r.length>0?l.length/r.length*100:0,npsAverage:d.length>0?d.reduce((e,t)=>e+t,0)/d.length:0,upsellPipeline:u,retentionRate:r.length>0?s.length/r.length*100:100},segmentAnalysis:e,upsellOpportunities:t,churnRisks:a,topPerformingClients:s.sort((e,t)=>(t.monthly_value||0)-(e.monthly_value||0)).slice(0,5).map(e=>({id:e.id,name:"Cliente "+e.id.slice(0,4),revenue:e.monthly_value||0,nps:e.nps_score||0,timeAsClient:12})),alerts:p}}async function h(e,t){let a=await g(),i=`
DADOS ATUAIS DE CLIENTES:
- Total de clientes: ${a.kpis.totalClients}
- Clientes ativos: ${a.kpis.activeClients}
- Taxa de churn: ${a.kpis.churnRate.toFixed(1)}%
- NPS m\xe9dio: ${a.kpis.npsAverage.toFixed(1)}
- Pipeline de upsell: R$ ${a.kpis.upsellPipeline.toLocaleString("pt-BR")}/m\xeas

SEGMENTOS MAIS RENT\xc1VEIS:
${a.segmentAnalysis.slice(0,3).map(e=>`- ${e.segmentName}: ${e.clientCount} clientes, ticket R$ ${e.averageTicket.toLocaleString("pt-BR")}`).join("\n")}

CLIENTES EM RISCO:
${a.churnRisks.slice(0,3).map(e=>`- ${e.clientName}: score ${e.riskScore}, perda potencial R$ ${e.potentialRevenueLoss.toLocaleString("pt-BR")}`).join("\n")}

OPORTUNIDADES DE UPSELL:
${a.upsellOpportunities.slice(0,3).map(e=>`- ${e.clientName}: ${e.suggestedService}, R$ ${e.estimatedValue.toLocaleString("pt-BR")}, ${e.probability}% probabilidade`).join("\n")}
`;try{return(await (0,o.F)({task:"strategy",json:!1,temperature:.7,maxTokens:1e3,entityType:"cmo_chat",entityId:null,messages:[{role:"system",content:r},{role:"system",content:i},{role:"user",content:e}]})).text||"Desculpe, n\xe3o consegui processar sua solicita\xe7\xe3o."}catch(e){return console.error("Erro no chat CMO:",e),"Erro ao processar solicita\xe7\xe3o. Tente novamente."}}}};