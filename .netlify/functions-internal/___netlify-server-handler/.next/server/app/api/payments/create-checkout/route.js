"use strict";(()=>{var e={};e.id=70525,e.ids=[70525],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},21764:e=>{e.exports=require("util")},45051:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>l,dynamic:()=>d});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),c=r(20344),u=r(71615),p=r(46691);let d="force-dynamic";async function l(e){try{let t=(0,u.cookies)(),r=(0,c.createRouteHandlerClient)({cookies:()=>t}),{data:{user:s},error:a}=await r.auth.getUser();if(a||!s)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:n,error:o}=await r.from("integration_configs").select("*").eq("integration_id","stripe").single();if(o||!n||"connected"!==n.status)return i.NextResponse.json({error:"Stripe n\xe3o est\xe1 conectado",needsSetup:!0},{status:400});let{items:d,mode:l="payment",customerId:m,customerEmail:g,successUrl:y,cancelUrl:x,metadata:h}=await e.json();if(!d||!Array.isArray(d)||0===d.length)return i.NextResponse.json({error:"Items s\xe3o obrigat\xf3rios"},{status:400});if(!y||!x)return i.NextResponse.json({error:"URLs de sucesso e cancelamento s\xe3o obrigat\xf3rias"},{status:400});let q=d.map(e=>e.priceId?{priceId:e.priceId,quantity:e.quantity||1}:{name:e.name,amount:Math.round(100*e.price),quantity:e.quantity||1}),f=await (0,p.Mc)({customerId:m,customerEmail:g,lineItems:q,mode:l,successUrl:y,cancelUrl:x,metadata:{...h,userId:s.id}},n.api_key);return await r.from("integration_logs").insert({integration_id:"stripe",action:"create_checkout",status:"success",request_data:{mode:l,itemsCount:d.length},response_data:{sessionId:f.id}}),i.NextResponse.json({success:!0,sessionId:f.id,url:f.url})}catch(e){return console.error("Erro ao criar checkout:",e),i.NextResponse.json({error:"Erro ao criar checkout",details:e.message},{status:500})}}async function m(e){try{let e=(0,u.cookies)(),t=(0,c.createRouteHandlerClient)({cookies:()=>e}),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return i.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{data:a}=await t.from("integration_configs").select("*").eq("integration_id","stripe").single();if(!a||"connected"!==a.status)return i.NextResponse.json({error:"Stripe n\xe3o est\xe1 conectado"},{status:400});let n=(0,p.w)(a.api_key),o=await n.products.list({active:!0,limit:100}),d=await Promise.all(o.data.map(async e=>{let t=await n.prices.list({product:e.id,active:!0});return{id:e.id,name:e.name,description:e.description,images:e.images,prices:t.data.map(e=>({id:e.id,unitAmount:e.unit_amount,currency:e.currency,recurring:e.recurring?{interval:e.recurring.interval,intervalCount:e.recurring.interval_count}:null}))}}));return i.NextResponse.json({success:!0,products:d})}catch(e){return console.error("Erro ao listar produtos:",e),i.NextResponse.json({error:"Erro ao listar produtos",details:e.message},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payments/create-checkout/route",pathname:"/api/payments/create-checkout",filename:"route",bundlePath:"app/api/payments/create-checkout/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\payments\\create-checkout\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:x,serverHooks:h}=g,q="/api/payments/create-checkout/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},46691:(e,t,r)=>{r.d(t,{MP:()=>i,Mc:()=>o,w:()=>n});var s=r(48472);let a=null;function n(e){let t=e||process.env.STRIPE_SECRET_KEY;if(!t)throw Error("Stripe Secret Key n\xe3o configurada");return(!a||e)&&(a=new s.Z(t,{apiVersion:"2023-10-16",typescript:!0})),a}async function o(e,t){let r=n(t),s=e.lineItems.map(e=>e.priceId?{price:e.priceId,quantity:e.quantity}:{price_data:{currency:"brl",product_data:{name:e.name||"Produto"},unit_amount:e.amount||0},quantity:e.quantity});return r.checkout.sessions.create({customer:e.customerId,customer_email:e.customerEmail,line_items:s,mode:e.mode,success_url:e.successUrl,cancel_url:e.cancelUrl,metadata:e.metadata})}function i(e,t,r){return n().webhooks.constructEvent(e,t,r)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89276,55972,54128,20958,2749,6684,48472],()=>r(45051));module.exports=s})();