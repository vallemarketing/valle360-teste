(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8376],{18980:function(e,t,r){Promise.resolve().then(r.bind(r,76651))},76651:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var a=r(57437),s=r(2265),l=r(53417),i=r(91723),n=r(22135),o=r(40875),d=r(32489),c=r(30401),x=r(26892),u=r(57586),h=r(93448),m=r(12381),v=r(69174),b=r(64319),p=r(14438);function f(){var e;let[t,r]=(0,s.useState)([]),[f,g]=(0,s.useState)(null),[w,j]=(0,s.useState)(""),[N,y]=(0,s.useState)(null),[k,C]=(0,s.useState)(!0),[S,z]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{C(!0);try{let e=await fetch("/api/client/approvals"),t=await e.json().catch(()=>null);if(!e.ok||!(null==t?void 0:t.success))throw Error((null==t?void 0:t.error)||"Falha ao carregar aprova\xe7\xf5es");r(t.approvals||[])}catch(e){console.error(e),r([])}finally{C(!1)}})()},[]);let _=(0,s.useMemo)(()=>t,[t]);(0,s.useMemo)(()=>[],[]);let E=(0,s.useMemo)(()=>new Map(b.Nd.map(e=>[String(e.areaKey),String(e.label)])),[]),D=async(e,t)=>{if("request_changes"!==t||w.trim()){z(!0);try{let a=await fetch("/api/client/approvals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e,action:t,comment:w.trim()||void 0})}),s=await a.json().catch(()=>null);if(!a.ok||!(null==s?void 0:s.success))throw Error((null==s?void 0:s.error)||"Falha ao enviar aprova\xe7\xe3o");r(t=>t.filter(t=>t.id!==e)),g(null),j("")}catch(e){console.error(e),p.Am.error(e instanceof Error?e.message:"Falha ao enviar")}finally{z(!1)}}},A=e=>{y(N===e?null:e)};return(0,a.jsxs)("div",{className:"p-4 lg:p-6 max-w-4xl mx-auto",children:[(0,a.jsxs)("header",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-[#001533] dark:text-white",children:"Aprova\xe7\xf5es"}),(0,a.jsx)("p",{className:"text-[#001533]/60 dark:text-white/60 mt-1",children:k?"Carregando...":"".concat(_.length," itens aguardando sua aprova\xe7\xe3o")})]}),(0,a.jsx)("div",{className:"space-y-3",children:0===_.length?(0,a.jsxs)("div",{className:"text-center py-12 bg-white dark:bg-[#001533]/50 rounded-xl border-2 border-[#001533]/10 dark:border-white/10",children:[(0,a.jsx)("div",{className:"text-4xl mb-3",children:"\uD83C\uDF89"}),(0,a.jsx)("p",{className:"text-[#001533]/60 dark:text-white/60",children:"Todas as aprova\xe7\xf5es foram processadas!"})]}):_.map(e=>(()=>{var t;let r=!e.overdue&&function(e){let t=new Date(e).getTime()-Date.now();return t>0&&t<=432e5}(e.due_at),s=e.overdue?"Atrasado":r?"Em risco":"Dentro do prazo",b=e.overdue?"text-red-600":r?"text-primary":"text-emerald-700";return(0,a.jsxs)(x.E.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white dark:bg-[#001533]/50 rounded-xl border-2 border-[#001533]/10 dark:border-white/10 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center gap-4 cursor-pointer hover:bg-[#001533]/5 dark:hover:bg-white/5 transition-colors",onClick:()=>A(e.id),children:[(0,a.jsx)("div",{className:"relative w-20 h-20 rounded-lg overflow-hidden flex-shrink-0 cursor-pointer group",onClick:t=>{t.stopPropagation(),g(e)},children:(0,a.jsx)("div",{className:"w-full h-full bg-[#001533]/5 dark:bg-white/5 flex items-center justify-center",children:(0,a.jsx)(l.Z,{className:"w-6 h-6 text-[#001533]/40 dark:text-white/40"})})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-[#001533] dark:text-white truncate",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(v.C,{variant:"secondary",className:"text-xs bg-[#1672d6]/10 text-[#1672d6]",children:E.get(String((null===(t=e.board)||void 0===t?void 0:t.area_key)||""))||"Equipe"}),(0,a.jsx)("span",{className:(0,h.cn)("text-xs",b),children:s})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-[#001533]/50 dark:text-white/50 flex items-center gap-1",children:[(0,a.jsx)(i.Z,{className:"w-3 h-3"}),"vence ",new Date(e.due_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})]}),N===e.id?(0,a.jsx)(n.Z,{className:"w-5 h-5 text-[#001533]/40"}):(0,a.jsx)(o.Z,{className:"w-5 h-5 text-[#001533]/40"})]})]})})]}),(0,a.jsx)(u.M,{children:N===e.id&&(0,a.jsx)(x.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"px-4 pb-4 pt-2 border-t border-[#001533]/10 dark:border-white/10",children:[e.description&&(0,a.jsx)("p",{className:"text-sm text-[#001533]/70 dark:text-white/70 mb-4",children:e.description}),(0,a.jsx)("textarea",{value:w,onChange:e=>j(e.target.value),rows:2,className:"w-full p-3 text-sm border-2 border-[#001533]/10 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#1672d6] focus:border-transparent resize-none bg-[#001533]/5 dark:bg-white/5 text-[#001533] dark:text-white placeholder:text-[#001533]/40",placeholder:"Coment\xe1rios ou ajustes necess\xe1rios..."}),(0,a.jsxs)("div",{className:"flex gap-3 mt-3",children:[(0,a.jsxs)(m.z,{onClick:()=>D(e.id,"request_changes"),variant:"outline",className:"flex-1 border-red-200 text-red-600 hover:bg-red-50",disabled:S,children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"Solicitar Ajustes"]}),(0,a.jsxs)(m.z,{onClick:()=>D(e.id,"approve"),className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white",disabled:S,children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"Aprovar"]})]})]})})})]},e.id)})())}),(0,a.jsx)(u.M,{children:f&&(0,a.jsxs)(x.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex",children:[(0,a.jsxs)("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[(0,a.jsx)("button",{onClick:()=>g(null),className:"absolute top-4 left-4 z-10 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors backdrop-blur-sm",children:(0,a.jsx)(d.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"text-white/70 text-center px-8",children:[(0,a.jsx)("div",{className:"flex items-center justify-center mb-3",children:(0,a.jsx)(l.Z,{className:"w-10 h-10"})}),(0,a.jsx)("p",{className:"text-sm",children:"Preview do arquivo ser\xe1 integrado via anexos (pr\xf3ximo passo)."})]})]}),(0,a.jsxs)(x.E.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},className:"w-[380px] bg-white dark:bg-[#0a0f1a] flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-[#001533]/10 dark:border-white/10",children:[(0,a.jsx)(v.C,{className:"bg-[#1672d6]/10 text-[#1672d6] mb-3",children:(null===(e=f.board)||void 0===e?void 0:e.area_key)&&E.get(String(f.board.area_key))||"Kanban"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-[#001533] dark:text-white mb-2",children:f.title}),(0,a.jsx)("p",{className:"text-sm text-[#001533]/60 dark:text-white/60",children:f.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-xs text-[#001533]/50 dark:text-white/50",children:[(0,a.jsx)("span",{children:f.overdue?"Atrasado":"Dentro do prazo"}),(0,a.jsx)("span",{children:"â€¢"}),(0,a.jsxs)("span",{children:["Vence ",new Date(f.due_at).toLocaleDateString("pt-BR")]})]})]}),(0,a.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-[#001533] dark:text-white mb-2",children:"Coment\xe1rios ou Ajustes"}),(0,a.jsx)("textarea",{value:w,onChange:e=>j(e.target.value),rows:6,className:"w-full p-4 text-sm border-2 border-[#001533]/10 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-[#1672d6] focus:border-transparent resize-none bg-[#001533]/5 dark:bg-white/5 text-[#001533] dark:text-white placeholder:text-[#001533]/40",placeholder:"Descreva aqui os ajustes necess\xe1rios ou deixe em branco para aprovar..."})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-[#001533]/10 dark:border-white/10 space-y-3",children:[(0,a.jsxs)(m.z,{onClick:()=>D(f.id,"approve"),size:"lg",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-12",disabled:S,children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 mr-2"}),"Aprovar Material"]}),(0,a.jsxs)(m.z,{onClick:()=>D(f.id,"request_changes"),variant:"outline",size:"lg",className:"w-full border-red-200 text-red-600 hover:bg-red-50 h-12",disabled:S,children:[(0,a.jsx)(d.Z,{className:"w-5 h-5 mr-2"}),"Solicitar Ajustes"]})]})]})]})})]})}},69174:function(e,t,r){"use strict";r.d(t,{C:function(){return n}});var a=r(57437);r(2265);var s=r(90535),l=r(93448);let i=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-valle-blue-600 text-white",secondary:"border-transparent bg-valle-silver-300 text-valle-navy-800",outline:"text-valle-navy-700 border-valle-silver-400",success:"border-transparent bg-green-600 text-white",warning:"border-transparent bg-yellow-600 text-white",danger:"border-transparent bg-red-600 text-white"}},defaultVariants:{variant:"default"}});function n(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)(i({variant:r}),t),...s})}},12381:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var a=r(57437),s=r(2265),l=r(90535),i=r(93448);let n=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-valle-blue-600 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-gradient-to-r from-valle-blue-600 to-valle-blue-700 text-white hover:from-valle-blue-700 hover:to-valle-blue-800 shadow-lg",secondary:"bg-valle-silver-200 text-valle-navy-800 hover:bg-valle-silver-300",outline:"border-2 border-valle-blue-600 text-valle-blue-600 hover:bg-valle-blue-50",ghost:"hover:bg-valle-blue-50 hover:text-valle-blue-600",danger:"bg-red-600 text-white hover:bg-red-700"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,t)=>{let{className:r,variant:s,size:l,...o}=e;return(0,a.jsx)("button",{className:(0,i.cn)(n({variant:s,size:l,className:r})),ref:t,...o})});o.displayName="Button"},93448:function(e,t,r){"use strict";r.d(t,{cn:function(){return l},x:function(){return i}});var a=r(61994),s=r(53335);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}function i(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}}},function(e){e.O(0,[2882,6137,4438,7029,2768,2971,2117,1744],function(){return e(e.s=18980)}),_N_E=e.O()}]);