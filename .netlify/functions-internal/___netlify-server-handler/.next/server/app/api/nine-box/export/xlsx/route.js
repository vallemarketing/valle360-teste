"use strict";(()=>{var e={};e.id=4005,e.ids=[4005],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},31323:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>S,requestAsyncStorage:()=>_,routeModule:()=>w,serverHooks:()=>v,staticGenerationAsyncStorage:()=>k});var n={};r.r(n),r.d(n,{GET:()=>y,dynamic:()=>h});var a=r(49303),o=r(88716),s=r(60670),i=r(87070),l=r(20344),m=r(71615),p=r(52390);let u=(()=>{let e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r>>>0}return e})();function c(e){let t=Buffer.alloc(2);return t.writeUInt16LE(65535&e,0),t}function d(e){let t=Buffer.alloc(4);return t.writeUInt32LE(e>>>0,0),t}function f(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}let h="force-dynamic";function x(e){return null==e?"":String(e)}function g(e){return e?Array.isArray(e)?e[0]||null:e:null}async function y(e){try{let t=(0,m.cookies)(),r=(0,l.createRouteHandlerClient)({cookies:()=>t}),n=await (0,p.V)({supabase:r});if(!n.allowed)return i.NextResponse.json({error:n.reason||"Acesso negado"},{status:403});let{searchParams:a}=new URL(e.url),o=a.get("cycle_id");if(!o)return i.NextResponse.json({error:"cycle_id \xe9 obrigat\xf3rio"},{status:400});let{data:s}=await r.from("nine_box_cycles").select("*").eq("id",o).maybeSingle(),{data:h,error:y}=await r.from("nine_box_assessments").select(`
        id, status, submitted_at, updated_at,
        employee:employees(id, full_name, department, position),
        result:nine_box_results(performance_score, potential_score, performance_level, potential_level, quadrant)
      `).eq("cycle_id",o).order("updated_at",{ascending:!1}).limit(5e3);if(y)throw y;let{data:w}=await r.from("nine_box_action_items").select("title, description, status, due_date, employee_id").eq("cycle_id",o).order("created_at",{ascending:!1}).limit(5e3),_=[["Ciclo",x(s?.name||o)],["Status",x(s?.status||"")],["Gerado em",new Date().toISOString()]],k=[["Colaborador","Departamento","Cargo","Status","Desempenho","Potencial","Quadrante","Atualizado em","Submetido em"],...(h||[]).map(e=>{let t=g(e?.employee);return[x(t?.full_name||t?.name||t?.id),x(t?.department||""),x(t?.position||""),x(e.status||""),e.result?Number(e.result.performance_score):"",e.result?Number(e.result.potential_score):"",x(e.result?.quadrant||""),x(e.updated_at||""),x(e.submitted_at||"")]})],v=[["Colaborador","T\xedtulo","Descri\xe7\xe3o","Status","Vencimento"],...(w||[]).map(e=>{let t=(h||[]).find(t=>{let r=g(t?.employee);return String(r?.id||"")===String(e.employee_id||"")}),r=g(t?.employee);return[x(r?.full_name||r?.name||e.employee_id),x(e.title),x(e.description||""),x(e.status||""),x(e.due_date||"")]})],b=function(e){let t=new Map,r=[],n=e.sheets.map((e,t)=>{let r=`rId${t+1}`;return{name:e.name,sheetId:t+1,relId:r}});for(let n=0;n<e.sheets.length;n++){let a=function(e,t){let r=[];for(let n=0;n<e.length;n++){let a=e[n]||[],o=[];for(let e=0;e<a.length;e++){let r=a[e];if(null==r||""===r)continue;let s=`${function(e){let t=e,r="";for(;t>0;)r=String.fromCharCode(65+(t-1)%26)+r,t=Math.floor((t-1)/26);return r}(e+1)}${n+1}`;if("number"==typeof r&&Number.isFinite(r))o.push(`<c r="${s}"><v>${r}</v></c>`);else{let e=String(r),n=t.get(e);void 0===n&&(n=t.size,t.set(e,n)),o.push(`<c r="${s}" t="s"><v>${n}</v></c>`)}}r.push(`<row r="${n+1}">${o.join("")}</row>`)}return`<?xml version="1.0" encoding="UTF-8" standalone="yes"?><worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"><sheetData>${r.join("")}</sheetData></worksheet>`}(e.sheets[n].rows,t);r.push({path:`xl/worksheets/sheet${n+1}.xml`,data:Buffer.from(a,"utf8")})}let a=Array.from(t.keys()).map(e=>`<si><t>${f(e)}</t></si>`).join(""),o=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?><sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" count="${t.size}" uniqueCount="${t.size}">${a}</sst>`,s='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><sheets>'+n.map(e=>`<sheet name="${f(e.name)}" sheetId="${e.sheetId}" r:id="${e.relId}"/>`).join("")+"</sheets></workbook>",i='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">'+n.map(e=>`<Relationship Id="${e.relId}" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet${e.sheetId}.xml"/>`).join("")+'<Relationship Id="rIdSharedStrings" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings" Target="sharedStrings.xml"/></Relationships>',l='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/><Default Extension="xml" ContentType="application/xml"/><Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/><Override PartName="/xl/sharedStrings.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"/>'+n.map(e=>`<Override PartName="/xl/worksheets/sheet${e.sheetId}.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/>`).join("")+"</Types>";return function(e){let t=[],r=[],n=0;for(let a of e){let e=Buffer.from(a.path,"utf8"),o=Buffer.from(a.data),s=function(e){let t=4294967295;for(let r=0;r<e.length;r++)t=u[(t^e[r])&255]^t>>>8;return(4294967295^t)>>>0}(o),i=o.length,l=Buffer.concat([d(67324752),c(20),c(0),c(0),c(0),c(0),d(s),d(i),d(i),c(e.length),c(0),e]);t.push(l,o);let m=Buffer.concat([d(33639248),c(20),c(20),c(0),c(0),c(0),c(0),d(s),d(i),d(i),c(e.length),c(0),c(0),c(0),c(0),d(0),d(n),e]);r.push(m),n+=l.length+i}let a=Buffer.concat(r),o=Buffer.concat(t),s=o.length,i=Buffer.concat([d(101010256),c(0),c(0),c(e.length),c(e.length),d(a.length),d(s),c(0)]);return Buffer.concat([o,a,i])}([{path:"[Content_Types].xml",data:Buffer.from(l,"utf8")},{path:"_rels/.rels",data:Buffer.from('<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',"utf8")},{path:"xl/workbook.xml",data:Buffer.from(s,"utf8")},{path:"xl/_rels/workbook.xml.rels",data:Buffer.from(i,"utf8")},{path:"xl/sharedStrings.xml",data:Buffer.from(o,"utf8")},...r])}({sheets:[{name:"Resumo",rows:[["Campo","Valor"],..._]},{name:"Matriz",rows:k},{name:"Plano_de_Acao",rows:v}]}),S=`nine-box_${o}.xlsx`,T=new Uint8Array(b);return new i.NextResponse(T,{status:200,headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":`attachment; filename="${S}"`,"Cache-Control":"no-store"}})}catch(e){return i.NextResponse.json({error:e?.message||"Erro interno"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/nine-box/export/xlsx/route",pathname:"/api/nine-box/export/xlsx",filename:"route",bundlePath:"app/api/nine-box/export/xlsx/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\nine-box\\export\\xlsx\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:_,staticGenerationAsyncStorage:k,serverHooks:v}=w,b="/api/nine-box/export/xlsx/route";function S(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:k})}},52390:(e,t,r)=>{async function n(e,t,r){try{let{data:n,error:a}=await e.rpc(t,r);if(a)return{ok:!1,error:a};return{ok:!0,data:n}}catch(e){return{ok:!1,error:e}}}function a(e){return Array.from(new Set(e.map(e=>String(e)).filter(Boolean)))}async function o(e){let t=e.supabase,{data:r}=await t.auth.getUser(),o=r.user?.id;if(!o)return{userId:"",isAdmin:!1,allowed:!1,reason:"N\xe3o autenticado",areaKeys:[]};let s=await n(t,"is_admin"),i=!!s.ok&&!!s.data;if(i)return{userId:o,isAdmin:i,allowed:!0,areaKeys:[]};let l=await n(t,"employee_area_keys");if(l.ok&&Array.isArray(l.data)){let e=a(l.data),t=e.includes("rh");return{userId:o,isAdmin:i,allowed:t,reason:t?void 0:"Acesso restrito: RH",areaKeys:e}}let{data:m}=await t.from("employees").select("areas, department, is_active").eq("user_id",o).maybeSingle(),p=a([...Array.isArray(m?.areas)?m.areas.map(String):[]]),u=p.includes("rh")||String(m?.department||"").toLowerCase().includes("rh");return{userId:o,isAdmin:i,allowed:u,reason:u?void 0:"Acesso restrito: RH",areaKeys:p}}r.d(t,{V:()=>o})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[89276,55972,54128,20958],()=>r(31323));module.exports=n})();