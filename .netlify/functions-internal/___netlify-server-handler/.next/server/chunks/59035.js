"use strict";exports.id=59035,exports.ids=[59035],exports.modules={59035:(e,a,t)=>{t.r(a),t.d(a,{default:()=>eI});var l=t(10326),s=t(17577),r=t.n(s),i=t(35047),n=t(40815),o=t(77197),d=t(29752),c=t(38443),u=t(91664),m=t(41190),x=t(45480),g=t(12714),p=t(85206),h=t(98091),b=t(40617),f=t(56418),v=t(32933),y=t(94019),j=t(83855),N=t(88307),w=t(82616),k=t(2777),_=t(79635);function C({selectedUserId:e,onSelect:a,label:t="Respons\xe1vel",placeholder:r="Selecione um respons\xe1vel"}){let[i,n]=(0,s.useState)([]),[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!1),[x,g]=(0,s.useState)(""),[p,h]=(0,s.useState)(null),[b,f]=(0,s.useState)(!0),v=e=>{h(e),a(e.user_id),u(!1),g("")},j=e=>[e.department,e.area_of_expertise].filter(Boolean).join(" • ").trim()||"Colaborador",w=()=>"bg-gray-600",k=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,l.jsxs)("div",{className:"relative",children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block",children:t}),p?(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-md bg-gray-50 dark:bg-gray-800",children:[l.jsx("div",{className:`w-8 h-8 rounded-full ${w()} flex items-center justify-center text-xs text-white font-medium`,children:k(p.full_name)}),(0,l.jsxs)("div",{className:"flex-1",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.full_name}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:j(p)})]}),l.jsx("button",{type:"button",onClick:()=>{h(null),a(void 0)},className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded",children:l.jsx(y.Z,{className:"w-4 h-4 text-gray-500"})})]}):(0,l.jsxs)("button",{type:"button",onClick:()=>u(!c),className:"w-full flex items-center gap-2 p-2 border rounded-md bg-white dark:bg-gray-800 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[l.jsx(_.Z,{className:"w-4 h-4 text-gray-400"}),l.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),c&&(0,l.jsxs)("div",{className:"absolute z-50 mt-2 w-full bg-white dark:bg-gray-800 border rounded-lg shadow-lg max-h-80 overflow-hidden",children:[l.jsx("div",{className:"p-2 border-b",children:(0,l.jsxs)("div",{className:"relative",children:[l.jsx(N.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),l.jsx(m.II,{type:"text",placeholder:"Buscar por nome, email ou cargo...",value:x,onChange:e=>g(e.target.value),className:"pl-9",autoFocus:!0})]})}),l.jsx("div",{className:"overflow-y-auto max-h-64",children:b?l.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"Carregando..."}):0===o.length?l.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"Nenhum usu\xe1rio encontrado"}):o.map(e=>(0,l.jsxs)("button",{type:"button",onClick:()=>v(e),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[l.jsx("div",{className:`w-10 h-10 rounded-full ${w()} flex items-center justify-center text-sm text-white font-medium flex-shrink-0`,children:k(e.full_name)}),(0,l.jsxs)("div",{className:"flex-1 text-left",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.full_name}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.email}),l.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:j(e)})]})]},e.user_id))})]}),c&&l.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)})]})}var S=t(50384),D=t(91119),E=t(69436),I=t(43931),q=t(51858),z=t(51478),T=t(8130);function A({task:e,isOpen:a,onClose:t,onUpdate:r}){let[i,n]=(0,s.useState)("comments"),[o,c]=(0,s.useState)([]),[x,g]=(0,s.useState)(""),[p,h]=(0,s.useState)(!1),[f,v]=(0,s.useState)(""),[j,N]=(0,s.useState)([]),[w,_]=(0,s.useState)(!1),[A,Z]=(0,s.useState)(""),[M,P]=(0,s.useState)(null),F=(0,s.useRef)(null),[O,L]=(0,s.useState)(new Map),[R,$]=(0,s.useState)(!1),[K,V]=(0,s.useState)(!1),[B,H]=(0,s.useState)("designer_grafico"),[U,G]=(0,s.useState)(void 0),[Y,W]=(0,s.useState)(""),[J,Q]=(0,s.useState)(""),X=async()=>{try{let{data:a,error:t}=await k.O.from("kanban_task_comments").select("id, task_id, user_id, comment, created_at").eq("task_id",e.id).order("created_at",{ascending:!0});if(t)throw t;let l=Array.from(new Set((a||[]).map(e=>e.user_id))).filter(Boolean),s=new Map;if(l.length>0){let e=await (0,I.m)(k.O,l);l.forEach(a=>{let t=e.get(a)?.full_name;t&&s.set(a,t)})}let r=(a||[]).map(e=>({...e,user_name:s.get(e.user_id)||"Usu\xe1rio"}));c(r);try{let e=Array.from(new Set((a||[]).flatMap(e=>(0,z.MN)(String(e.comment||"")))));if(e.length>0){let a=await (0,I.m)(k.O,e);L(a)}}catch{}}catch(e){console.error("Erro ao carregar coment\xe1rios:",e)}},ee=(0,s.useMemo)(()=>(0,T.X)(j,A),[j,A]),ea=()=>{let e=F.current;if(!e)return;let a=String(e.value||""),t="number"==typeof e.selectionStart?e.selectionStart:a.length,l=(0,z.XI)(a,t);if(!l.active){_(!1),Z(""),P(null);return}_(!0),Z(l.query),P({start:l.startIndex,end:l.endIndex})},et=e=>{let a=F.current;if(!a||!M)return;let t=String(a.value||""),{nextValue:l,nextCaretIndex:s}=(0,z.CE)({value:t,startIndex:M.start,endIndex:M.end,userId:e.userId,trailingSpace:!0});g(l),_(!1),Z(""),P(null),requestAnimationFrame(()=>{try{a.focus(),a.setSelectionRange(s,s)}catch{}})},el=async a=>{if(a.preventDefault(),x.trim()){h(!0);try{let{data:a}=await k.O.auth.getUser(),t=a?.user;if(!t)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:l,error:s}=await k.O.from("kanban_task_comments").insert({task_id:e.id,user_id:t.id,comment:x.trim()}).select("id").single();if(s)throw s;if(l?.id)try{await fetch("/api/mentions/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entityType:"kanban_task_comment",entityId:l.id,taskId:e.id})})}catch{}g(""),await X(),r()}catch(e){console.error("Erro ao comentar:",e),alert(e?.message||"Erro ao comentar")}finally{h(!1)}}},es=async()=>{let a=x.trim();if(a){h(!0);try{let{data:t}=await k.O.auth.getUser(),l=t?.user;if(!l)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:s,error:i}=await k.O.from("kanban_task_comments").insert({task_id:e.id,user_id:l.id,comment:a}).select("id").single();if(i)throw i;if(s?.id)try{await fetch("/api/mentions/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entityType:"kanban_task_comment",entityId:s.id,taskId:e.id})})}catch{}g(""),await X(),r();let n=await fetch("/api/kanban/handoff",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"message_origin",taskId:e.id,message:a})}),o=await n.json();if(!n.ok||!o?.success){alert(o?.error||"Coment\xe1rio salvo, mas n\xe3o consegui notificar o solicitante.");return}alert("Mensagem enviada ao solicitante.")}catch(e){console.error("Erro ao perguntar ao solicitante:",e),alert(e?.message||"Erro ao perguntar ao solicitante")}finally{h(!1)}}},er=async()=>{try{let a=await fetch("/api/kanban/handoff",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"forward",sourceTaskId:e.id,targetAreaKey:B,targetUserId:U,note:Y||void 0})}),t=await a.json();if(!a.ok||!t?.success){alert(t?.error||"Erro ao encaminhar");return}alert("Encaminhado com sucesso."),$(!1),W(""),G(void 0),r()}catch(e){alert(e?.message||"Erro ao encaminhar")}},ei=async()=>{try{let a=await fetch("/api/kanban/handoff",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"return",taskId:e.id,note:J||void 0})}),t=await a.json();if(!a.ok||!t?.success){alert(t?.error||"Erro ao enviar para o Head");return}alert("Enviado para o Head com sucesso."),V(!1),Q(""),r()}catch(e){alert(e?.message||"Erro ao enviar para o Head")}};return a?(0,l.jsxs)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:[(0,l.jsxs)(d.Zb,{className:"w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,l.jsxs)(d.Ol,{className:"border-b",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[l.jsx(d.ll,{className:"text-xl",children:e.title}),e.description&&l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 whitespace-pre-wrap",children:e.description})]}),l.jsx(u.z,{variant:"ghost",size:"sm",onClick:t,children:l.jsx(y.Z,{className:"w-5 h-5"})})]}),(0,l.jsxs)("div",{className:"mt-4 flex gap-2",children:[l.jsx(u.z,{variant:"outline",onClick:()=>$(!0),children:"Encaminhar"}),l.jsx(u.z,{className:"bg-primary hover:bg-[#1260b5]",onClick:()=>V(!0),children:"Enviar para Head"})]})]}),(0,l.jsxs)(d.aY,{className:"flex-1 overflow-y-auto p-4",children:[l.jsx(S.mQ,{value:i,onValueChange:e=>n(e),children:l.jsx(S.dr,{children:l.jsx(S.SP,{value:"comments",children:(0,l.jsxs)("span",{className:"inline-flex items-center gap-2",children:[l.jsx(b.Z,{className:"w-4 h-4"}),"Coment\xe1rios"]})})})}),(0,l.jsxs)("div",{className:"mt-4 space-y-4",children:[l.jsx("div",{className:"space-y-3",children:0===o.length?l.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum coment\xe1rio ainda"}):o.map(e=>(0,l.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.user_name||"Usu\xe1rio"}),l.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString("pt-BR")})]}),l.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-2 whitespace-pre-wrap",children:l.jsx(q.d,{text:e.comment,profilesById:O,highlightUserId:f||void 0})})]},e.id))}),(0,l.jsxs)("form",{onSubmit:el,className:"flex gap-2 items-start",children:[(0,l.jsxs)("div",{className:"relative flex-1",children:[l.jsx(m.II,{ref:F,value:x,onChange:e=>{g(e.target.value),requestAnimationFrame(()=>ea())},onKeyUp:()=>ea(),onClick:()=>ea(),onBlur:()=>{setTimeout(()=>_(!1),150)},placeholder:"Escreva um coment\xe1rio... (use @ para mencionar)",disabled:p}),w&&ee.length>0&&l.jsx("div",{className:"absolute left-0 right-0 bottom-full mb-2 z-50 rounded-lg border bg-white dark:bg-gray-900 shadow-lg overflow-hidden",children:l.jsx("div",{className:"max-h-56 overflow-y-auto",children:ee.map(e=>(0,l.jsxs)("button",{type:"button",onMouseDown:e=>e.preventDefault(),onClick:()=>et(e),className:"w-full px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,l.jsxs)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.label,e.userId===f?" (voc\xea)":""]}),e.email&&l.jsx("div",{className:"text-xs text-gray-500",children:e.email})]},e.userId))})})]}),l.jsx(u.z,{type:"submit",disabled:p||!x.trim(),title:"Comentar",children:l.jsx(E.Z,{className:"w-4 h-4"})}),l.jsx(u.z,{type:"button",variant:"outline",disabled:p||!x.trim(),onClick:es,title:"Enviar esta mensagem tamb\xe9m para o solicitante (Head/origem)",children:"Perguntar ao solicitante"})]})]})]})]}),R&&l.jsx("div",{className:"fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4",children:(0,l.jsxs)(d.Zb,{className:"w-full max-w-lg",children:[l.jsx(d.Ol,{children:l.jsx(d.ll,{children:"Encaminhar para outra \xe1rea"})}),(0,l.jsxs)(d.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"\xc1rea destino"}),l.jsx("select",{value:B,onChange:e=>H(e.target.value),className:"mt-1 w-full px-3 py-2 border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:D.Nd.map(e=>l.jsx("option",{value:e.areaKey,children:e.label},e.areaKey))})]}),l.jsx(C,{selectedUserId:U,onSelect:e=>G(e),label:"Colaborador (opcional)",placeholder:"Selecione quem vai executar (opcional)"}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nota"}),l.jsx(m.II,{value:Y,onChange:e=>W(e.target.value),placeholder:"Contexto para a \xe1rea (opcional)"})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[l.jsx(u.z,{variant:"outline",onClick:()=>$(!1),children:"Cancelar"}),l.jsx(u.z,{className:"bg-primary hover:bg-[#1260b5]",onClick:er,children:"Encaminhar"})]})]})]})}),K&&l.jsx("div",{className:"fixed inset-0 z-[60] bg-black/50 flex items-center justify-center p-4",children:(0,l.jsxs)(d.Zb,{className:"w-full max-w-lg",children:[l.jsx(d.Ol,{children:l.jsx(d.ll,{children:"Enviar para o Head"})}),(0,l.jsxs)(d.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nota de retorno"}),l.jsx(m.II,{value:J,onChange:e=>Q(e.target.value),placeholder:"Resumo do que foi feito / pend\xeancias"})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[l.jsx(u.z,{variant:"outline",onClick:()=>V(!1),children:"Cancelar"}),l.jsx(u.z,{className:"bg-primary hover:bg-[#1260b5]",onClick:ei,children:"Enviar"})]})]})]})})]}):null}var Z=t(69561),M=t(40765),P=t(41291),F=t(37358);function O({onFiltersChange:e,availableTags:a}){let[t,r]=(0,s.useState)(!1),[i,n]=(0,s.useState)([]),[o,d]=(0,s.useState)({assignees:[],tags:[],priorities:[],dueDateFilter:"all"}),m=e=>{d(a=>({...a,assignees:a.assignees.includes(e)?a.assignees.filter(a=>a!==e):[...a.assignees,e]}))},x=e=>{d(a=>({...a,tags:a.tags.includes(e)?a.tags.filter(a=>a!==e):[...a.tags,e]}))},g=e=>{d(a=>({...a,priorities:a.priorities.includes(e)?a.priorities.filter(a=>a!==e):[...a.priorities,e]}))},p=e=>{d(a=>({...a,dueDateFilter:e}))},h=()=>{d({assignees:[],tags:[],priorities:[],dueDateFilter:"all"})};return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(u.z,{variant:"outline",onClick:()=>r(!t),className:`${o.assignees.length>0||o.tags.length>0||o.priorities.length>0||"all"!==o.dueDateFilter?"border-primary text-primary":""}`,children:[l.jsx(Z.Z,{className:"w-4 h-4 mr-2"}),"Filtros",(o.assignees.length>0||o.tags.length>0||o.priorities.length>0||"all"!==o.dueDateFilter)&&l.jsx(c.C,{className:"ml-2 bg-primary text-white",children:o.assignees.length+o.tags.length+o.priorities.length+("all"!==o.dueDateFilter?1:0)})]}),(o.assignees.length>0||o.tags.length>0||o.priorities.length>0||"all"!==o.dueDateFilter)&&(0,l.jsxs)(u.z,{variant:"ghost",size:"sm",onClick:h,children:[l.jsx(y.Z,{className:"w-4 h-4 mr-1"}),"Limpar filtros"]})]}),t&&(0,l.jsxs)(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)}),(0,l.jsxs)("div",{className:"absolute top-full mt-2 left-0 z-50 w-96 bg-white dark:bg-gray-800 border rounded-lg shadow-xl p-4 space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[l.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Filtros"}),l.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:l.jsx(y.Z,{className:"w-5 h-5"})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[l.jsx(_.Z,{className:"w-4 h-4"}),"Respons\xe1veis"]}),l.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:i.map(e=>(0,l.jsxs)("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:o.assignees.includes(e.id),onChange:()=>m(e.id),className:"rounded text-primary focus:ring-primary"}),l.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:e.full_name})]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[l.jsx(M.Z,{className:"w-4 h-4"}),"Tags"]}),0===a.length?l.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma tag dispon\xedvel"}):l.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(e=>l.jsx("button",{onClick:()=>x(e),className:`px-3 py-1 rounded-full text-sm transition-colors ${o.tags.includes(e)?"bg-primary text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[l.jsx(P.Z,{className:"w-4 h-4"}),"Prioridade"]}),l.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"urgent",label:"Urgente",color:"bg-red-600"},{value:"high",label:"Alta",color:"bg-red-100 text-red-700"},{value:"medium",label:"M\xe9dia",color:"bg-yellow-100 text-yellow-700"},{value:"low",label:"Baixa",color:"bg-gray-100 text-gray-700"}].map(e=>l.jsx("button",{onClick:()=>g(e.value),className:`p-2 rounded-lg border text-sm font-medium transition-colors ${o.priorities.includes(e.value)?"border-primary bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:l.jsx(c.C,{className:e.color,children:e.label})},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[l.jsx(F.Z,{className:"w-4 h-4"}),"Data de Vencimento"]}),l.jsx("div",{className:"space-y-1",children:[{value:"all",label:"Todas"},{value:"overdue",label:"Vencidas"},{value:"today",label:"Hoje"},{value:"this_week",label:"Esta semana"},{value:"this_month",label:"Este m\xeas"},{value:"no_date",label:"Sem data"}].map(e=>(0,l.jsxs)("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer",children:[l.jsx("input",{type:"radio",name:"dueDate",checked:o.dueDateFilter===e.value,onChange:()=>p(e.value),className:"text-primary focus:ring-primary"}),l.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:e.label})]},e.value))})]})]}),(0,l.jsxs)("div",{className:"pt-3 border-t flex gap-2",children:[l.jsx(u.z,{variant:"outline",onClick:h,className:"flex-1",children:"Limpar"}),l.jsx(u.z,{onClick:()=>r(!1),className:"flex-1 bg-primary hover:bg-[#1260b5]",children:"Aplicar"})]})]})]})]})}var L=t(74975),R=t(99598),$=t(69508),K=t(6507);function V({onNotificationClick:e}){let[a,t]=(0,s.useState)(!1),[r,i]=(0,s.useState)([]),[n,o]=(0,s.useState)(0),[d,m]=(0,s.useState)(!0),x=async()=>{try{m(!0);let e=await fetch("/api/notifications?limit=20"),a=await e.json();if(!a?.success)return;let t=(a.notifications||[]).map(e=>({id:e.id,type:e.type,title:e.title,message:e.message,is_read:!!e.read,created_at:e.created_at,task_id:e.metadata?.task_id||void 0,triggered_by_name:e.metadata?.triggered_by_name||e.metadata?.from_name||void 0}));i(t),o(Number(a.unreadCount||0))}catch(e){console.error("Erro ao carregar notifica\xe7\xf5es:",e)}finally{m(!1)}},g=async e=>{try{await fetch("/api/notifications",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"mark_read",notificationId:e})}),await x()}catch(e){console.error("Erro ao marcar como lida:",e)}},p=async()=>{try{await fetch("/api/notifications",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"mark_all_read"})}),await x()}catch(e){console.error("Erro ao marcar todas como lidas:",e)}},h=async e=>{try{await g(e)}catch(e){console.error("Erro ao deletar notifica\xe7\xe3o:",e)}},f=async a=>{a.is_read||await g(a.id),e&&a.task_id&&(e(a.task_id),t(!1))},j=e=>{switch(e){case"mention":case"comment":return l.jsx(b.Z,{className:"w-4 h-4"});case"assignment":return l.jsx(L.Z,{className:"w-4 h-4"});case"move":return l.jsx(R.Z,{className:"w-4 h-4"});case"update":return l.jsx($.Z,{className:"w-4 h-4"});default:return l.jsx(K.Z,{className:"w-4 h-4"})}},N=e=>{let a=new Date(e),t=new Date().getTime()-a.getTime(),l=Math.floor(t/6e4),s=Math.floor(t/36e5),r=Math.floor(t/864e5);return l<1?"Agora":l<60?`${l}m`:s<24?`${s}h`:r<7?`${r}d`:a.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})};return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)(u.z,{variant:"ghost",size:"sm",onClick:()=>t(!a),className:"relative",children:[l.jsx(K.Z,{className:"w-5 h-5"}),n>0&&l.jsx(c.C,{className:"absolute -top-1 -right-1 h-5 min-w-5 flex items-center justify-center p-0 bg-red-600 text-white text-xs",children:n>9?"9+":n})]}),a&&(0,l.jsxs)(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1)}),(0,l.jsxs)("div",{className:"absolute top-full right-0 mt-2 z-50 w-96 bg-white dark:bg-gray-800 border rounded-lg shadow-xl",children:[(0,l.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[l.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Notifica\xe7\xf5es"}),n>0&&l.jsx(u.z,{variant:"ghost",size:"sm",onClick:p,className:"text-xs text-primary hover:text-amber-700",children:"Marcar todas como lidas"})]}),l.jsx("div",{className:"max-h-96 overflow-y-auto",children:d?(0,l.jsxs)("div",{className:"p-8 text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),l.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Carregando..."})]}):0===r.length?(0,l.jsxs)("div",{className:"p-8 text-center",children:[l.jsx(K.Z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),l.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma notifica\xe7\xe3o"})]}):r.map(e=>l.jsx("div",{className:`p-4 border-b last:border-b-0 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer group ${e.is_read?"":"bg-amber-50 dark:bg-amber-900/10"}`,onClick:()=>f(e),children:(0,l.jsxs)("div",{className:"flex gap-3",children:[l.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${e.is_read?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400":"bg-amber-100 dark:bg-amber-900/30 text-primary"}`,children:j(e.type)}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.title}),l.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0",children:N(e.created_at)})]}),l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.message}),e.task_id&&l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 italic",children:"Abrir tarefa relacionada"}),e.triggered_by_name&&(0,l.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Por ",e.triggered_by_name]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[!e.is_read&&l.jsx(u.z,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),g(e.id)},className:"h-6 w-6 p-0",title:"Marcar como lida",children:l.jsx(v.Z,{className:"w-3 h-3"})}),l.jsx(u.z,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),h(e.id)},className:"h-6 w-6 p-0 text-red-600",title:"Deletar",children:l.jsx(y.Z,{className:"w-3 h-3"})})]})]})},e.id))}),r.length>0&&l.jsx("div",{className:"p-3 border-t bg-gray-50 dark:bg-gray-900",children:l.jsx(u.z,{variant:"ghost",onClick:()=>t(!1),className:"w-full text-sm",children:"Fechar"})})]})]})]})}var B=t(28870),H=t(9086),U=t(66307),G=t(3634),Y=t(48998),W=t(50949),J=t(26754),Q=t(59593),X=t(79256),ee=t(25696),ea=t(39183),et=t(17069),el=t(43810),es=t(51223);function er(e){return String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function ei(e,a){let t=er(e||""),l=er(a);return t===l||t.includes(l)}function en(e){let a=er(e||"");return"finalizado"===a||a.includes("finaliz")||"done"===a||a.includes("conclu")}function eo({columns:e,area:a,boardId:t}){let[i,n]=(0,s.useState)(null),[o,d]=(0,s.useState)([]),[m,x]=(0,s.useState)(""),[p,h]=(0,s.useState)(""),[f,v]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[w,k]=(0,s.useState)(0),[_,C]=(0,s.useState)([]),S=Date.now(),D=new Date,I=(0,s.useMemo)(()=>e.reduce((e,a)=>e+a.cards.length,0),[e]),q=(0,s.useMemo)(()=>e.filter(e=>en(e.stageKey||e.id)).reduce((e,a)=>e+a.cards.length,0),[e]),z=(0,s.useMemo)(()=>e.filter(e=>{let a=e.stageKey||e.id;return!(en(a)||ei(a,"bloqueado")||ei(a,"demanda"))}).flatMap(e=>e.cards.map(a=>({...a,stageKey:e.stageKey||e.id}))),[e]),T=(0,s.useMemo)(()=>e.filter(e=>ei(e.stageKey||e.id,"demanda")).flatMap(e=>e.cards.map(a=>({...a,stageKey:e.stageKey||e.id}))),[e]),A=(0,s.useMemo)(()=>e.filter(e=>!en(e.stageKey||e.id)).flatMap(e=>e.cards.map(a=>({...a,stageKey:e.stageKey||e.id}))).filter(e=>!!e.dueDate&&e.dueDate.getTime()<S),[e,S]),Z=(0,s.useMemo)(()=>[...new Set(e.flatMap(e=>e.cards.flatMap(e=>e.assignees)).filter(Boolean))],[e]),M=I>0?Math.round(q/I*100):0,P=(0,s.useMemo)(()=>{let a=e.filter(e=>!en(e.stageKey||e.id)&&!ei(e.stageKey||e.id,"bloqueado"));return 0===a.length?null:a.reduce((e,a)=>a.cards.length>e.cards.length?a:e,a[0])},[e]),F=e=>{switch(e){case"overdue":d(A);break;case"pending":d(T);break;case"inProgress":d(z)}n(e)};async function O(e){v(!0),N(!1),h(""),x(e.collaborator||"");try{let a=await fetch("/api/kanban/insights",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"generate_message",boardId:t||"",messageType:e.messageType,collaboratorId:e.collaborator||void 0,taskIds:(e.cards||[]).map(e=>e.id)})}),l=await a.json().catch(()=>null);if(!a.ok||!l?.success)throw Error(l?.error||"Falha ao gerar mensagem");h(String(l.message||"").trim())}catch(e){h(e?.message?`Erro ao gerar mensagem: ${e.message}`:"Erro ao gerar mensagem")}finally{v(!1)}}let L=async e=>{x(e),n("praise"),await O({messageType:"praise",collaborator:e})},R=async(e,a)=>{x(e),d(a),n("charge"),await O({messageType:"charge",collaborator:e,cards:a})},$=()=>{N(!0),setTimeout(()=>{n(null),N(!1),h(""),x("")},2e3)},K=()=>{navigator.clipboard.writeText(p),alert("✅ Mensagem copiada!")},V=[{id:"completion",title:"Taxa de Conclus\xe3o",value:`${M}%`,icon:U.Z,color:"#10b981",clickable:!1},{id:"in_progress",title:"Em Andamento",value:z.length.toString(),subtitle:"cards ativos",icon:G.Z,color:"#f97316",clickable:!0,onClick:()=>F("inProgress")},{id:"pending",title:"Aguardando",value:T.length.toString(),subtitle:"na fila",icon:Y.Z,color:"#6366f1",clickable:!0,onClick:()=>F("pending")},{id:"overdue",title:"Atrasados",value:A.length.toString(),subtitle:A.length>0?"aten\xe7\xe3o!":"nenhum",icon:W.Z,color:A.length>0?"#ef4444":"#10b981",alert:A.length>0,clickable:A.length>0,onClick:()=>F("overdue")},{id:"risk",title:"Em risco",value:String(w||0),subtitle:w>0?"priorizar":"ok",icon:W.Z,color:w>0?"#f97316":"#10b981",alert:w>0,clickable:!1}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"bg-white rounded-xl border shadow-sm p-4 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[l.jsx(J.Z,{className:"w-5 h-5 text-blue-500"}),"Insights do Kanban"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:a}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsxs)(u.z,{size:"sm",variant:"outline",className:"text-xs text-emerald-600 border-emerald-500/30 hover:bg-emerald-500/10",onClick:()=>{Z.length>0&&L(Z[0])},children:[l.jsx(Q.Z,{className:"w-3 h-3 mr-1"}),"Elogiar"]}),(0,l.jsxs)(u.z,{size:"sm",variant:"outline",className:"text-xs text-primary border-primary/30 hover:bg-primary/10",onClick:()=>{A.length>0&&A[0].assignees.length>0&&R(A[0].assignees[0],A.filter(e=>e.assignees.includes(A[0].assignees[0])))},children:[l.jsx(b.Z,{className:"w-3 h-3 mr-1"}),"Cobrar"]})]})]})]}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:V.map((e,a)=>{let t=e.icon;return(0,l.jsxs)(B.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*a},onClick:e.clickable?e.onClick:void 0,className:(0,es.cn)("p-3 rounded-xl border transition-all",e.alert?"border-red-200 bg-red-50":"border-gray-100 bg-gray-50",e.clickable&&"cursor-pointer hover:shadow-md hover:scale-[1.02]"),children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:`${e.color}20`},children:l.jsx(t,{className:"w-4 h-4",style:{color:e.color}})}),l.jsx("span",{className:"text-xs text-gray-500",children:e.title}),e.clickable&&l.jsx(g.Z,{className:"w-3 h-3 text-gray-400 ml-auto"})]}),(0,l.jsxs)("div",{className:"flex items-end justify-between",children:[l.jsx("span",{className:"text-2xl font-bold",style:{color:e.color},children:e.value}),e.change&&(0,l.jsxs)("span",{className:`text-xs flex items-center gap-0.5 ${e.positive?"text-green-600":"text-red-600"}`,children:[e.positive?l.jsx(X.Z,{className:"w-3 h-3"}):l.jsx(ee.Z,{className:"w-3 h-3"}),e.change]}),e.subtitle&&l.jsx("span",{className:"text-xs text-gray-400",children:e.subtitle})]})]},e.id)})}),(0,l.jsxs)("div",{className:"space-y-2",children:[P&&P.cards.length>3&&(0,l.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[l.jsx(W.Z,{className:"w-4 h-4 text-amber-600 mt-0.5"}),(0,l.jsxs)("div",{children:[l.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Gargalo identificado"}),(0,l.jsxs)("p",{className:"text-xs text-amber-700",children:["A fase ",l.jsx("strong",{children:P.title})," tem ",P.cards.length," cards acumulados. Considere redistribuir tarefas ou adicionar recursos."]})]})]}),A.length>0&&(0,l.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>F("overdue"),children:[l.jsx(Y.Z,{className:"w-4 h-4 text-red-600 mt-0.5"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("p",{className:"text-sm font-medium text-red-800",children:[A.length," ",1===A.length?"card atrasado":"cards atrasados"]}),(0,l.jsxs)("p",{className:"text-xs text-red-700",children:[A.slice(0,3).map(e=>e.title).join(", "),A.length>3&&` e mais ${A.length-3}`]})]}),l.jsx(ea.Z,{className:"w-4 h-4 text-red-400"})]}),M>=70&&0===A.length&&(0,l.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[l.jsx(et.Z,{className:"w-4 h-4 text-green-600 mt-0.5"}),(0,l.jsxs)("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-800",children:"Excelente performance!"}),(0,l.jsxs)("p",{className:"text-xs text-green-700",children:["Sua taxa de conclus\xe3o est\xe1 em ",M,"% e n\xe3o h\xe1 cards atrasados. Continue assim!"]})]})]}),w>0&&_.length>0&&(0,l.jsxs)("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[l.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Itens em risco"}),l.jsx("ul",{className:"mt-1 space-y-1",children:_.slice(0,3).map(e=>(0,l.jsxs)("li",{className:"text-xs text-amber-700",children:[l.jsx("strong",{children:e.score})," — ",e.title,e.reasons?.length?` (${e.reasons[0]})`:""]},e.id))}),_.length>3&&(0,l.jsxs)("p",{className:"text-xs text-amber-700 mt-1",children:["+",_.length-3," outros"]})]})]}),(0,l.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[l.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Distribui\xe7\xe3o por fase"}),l.jsx("div",{className:"flex h-3 rounded-full overflow-hidden bg-gray-100",children:e.map((e,a)=>{let t=I>0?e.cards.length/I*100:0;return 0===t?null:l.jsx(B.E.div,{initial:{width:0},animate:{width:`${t}%`},transition:{delay:.1*a,duration:.5},className:"h-full",style:{backgroundColor:e.color},title:`${e.title}: ${e.cards.length} cards (${Math.round(t)}%)`},e.id)})}),l.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:e.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[l.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e.color}}),l.jsx("span",{className:"text-gray-600",children:e.title}),(0,l.jsxs)("span",{className:"text-gray-400",children:["(",e.cards.length,")"]})]},e.id))})]}),Z.length>0&&(0,l.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[l.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Colaboradores Ativos"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:Z.map(a=>{let t=e.flatMap(e=>e.cards.filter(e=>e.assignees.includes(a))),s=t.some(e=>e.dueDate&&new Date(e.dueDate)<D);return(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg border",children:[l.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium text-sm",children:a.charAt(0)}),(0,l.jsxs)("div",{children:[l.jsx("p",{className:"text-sm font-medium text-gray-800",children:a}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:[t.length," cards"]})]}),(0,l.jsxs)("div",{className:"flex gap-1 ml-2",children:[l.jsx(u.z,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-emerald-600 hover:bg-emerald-50",onClick:()=>L(a),title:"Elogiar",children:l.jsx(Q.Z,{className:"w-3.5 h-3.5"})}),s&&l.jsx(u.z,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-primary hover:bg-primary/10",onClick:()=>R(a,t.filter(e=>e.dueDate&&new Date(e.dueDate)<D)),title:"Cobrar",children:l.jsx(b.Z,{className:"w-3.5 h-3.5"})})]})]},a)})})]})]}),l.jsx(H.M,{children:("overdue"===i||"pending"===i||"inProgress"===i)&&l.jsx(B.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>n(null),children:(0,l.jsxs)(B.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl max-h-[80vh] overflow-hidden",children:[l.jsx("div",{className:"p-6 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:(0,es.cn)("p-3 rounded-xl","overdue"===i?"bg-red-100":"pending"===i?"bg-indigo-100":"bg-amber-100"),children:"overdue"===i?l.jsx(W.Z,{className:"w-6 h-6 text-red-600"}):"pending"===i?l.jsx(Y.Z,{className:"w-6 h-6 text-indigo-600"}):l.jsx(G.Z,{className:"w-6 h-6 text-primary"})}),(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"overdue"===i?"Cards Atrasados":"pending"===i?"Cards Aguardando":"Cards em Andamento"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[o.length," demandas"]})]})]}),l.jsx(u.z,{variant:"ghost",size:"icon",onClick:()=>n(null),children:l.jsx(y.Z,{className:"w-5 h-5"})})]})}),l.jsx("div",{className:"p-6 overflow-auto max-h-[50vh] space-y-3",children:o.map(e=>(0,l.jsxs)("div",{className:(0,es.cn)("p-4 rounded-xl border transition-all hover:shadow-md","overdue"===i?"bg-red-50 border-red-200":"pending"===i?"bg-indigo-50 border-indigo-200":"bg-amber-50 border-amber-200"),children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),l.jsx(c.C,{className:(0,es.cn)("text-white text-xs","hot"===e.temperature?"bg-red-500":"warm"===e.temperature?"bg-amber-500":"bg-blue-500"),children:"hot"===e.temperature?"Quente":"warm"===e.temperature?"Morno":"Frio"})]}),e.clientName&&(0,l.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Cliente: ",e.clientName]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[e.assignees.map((e,a)=>l.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-medium",title:e,children:e.charAt(0)},a)),l.jsx("span",{className:"text-xs text-gray-500",children:e.assignees.join(", ")})]}),l.jsx("div",{className:"flex gap-1",children:e.assignees.map(a=>(0,l.jsxs)(r().Fragment,{children:[(0,l.jsxs)(u.z,{size:"sm",variant:"ghost",className:"h-7 px-2 text-xs text-emerald-600",onClick:()=>L(a),children:[l.jsx(Q.Z,{className:"w-3 h-3 mr-1"}),"Elogiar"]}),"overdue"===i&&(0,l.jsxs)(u.z,{size:"sm",variant:"ghost",className:"h-7 px-2 text-xs text-primary",onClick:()=>R(a,[e]),children:[l.jsx(b.Z,{className:"w-3 h-3 mr-1"}),"Cobrar"]})]},a))})]})]},e.id))})]})})}),l.jsx(H.M,{children:"praise"===i&&l.jsx(B.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>!f&&n(null),children:(0,l.jsxs)(B.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl",children:[l.jsx("div",{className:"p-6 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-3 rounded-xl bg-emerald-100",children:l.jsx(Q.Z,{className:"w-6 h-6 text-emerald-600"})}),(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Elogiar Colaborador"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["Mensagem para ",m]})]})]})}),l.jsx("div",{className:"p-6",children:f?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mb-4"}),l.jsx("p",{className:"text-gray-600",children:"Gerando mensagem com IA..."})]}):j?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[l.jsx(U.Z,{className:"w-16 h-16 text-emerald-500 mb-4"}),l.jsx("p",{className:"text-xl font-bold text-gray-900",children:"Mensagem Enviada!"}),l.jsx("p",{className:"text-gray-500 mt-2",children:"O colaborador ser\xe1 notificado."})]}):(0,l.jsxs)(l.Fragment,{children:[l.jsx("div",{className:"p-4 rounded-xl bg-emerald-50 border border-emerald-200 mb-4",children:l.jsx("p",{className:"whitespace-pre-line text-gray-700",children:p})}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsxs)(u.z,{variant:"outline",className:"flex-1",onClick:K,children:[l.jsx(el.Z,{className:"w-4 h-4 mr-2"}),"Copiar"]}),(0,l.jsxs)(u.z,{className:"flex-1 bg-emerald-600 hover:bg-emerald-700",onClick:$,children:[l.jsx(E.Z,{className:"w-4 h-4 mr-2"}),"Enviar"]})]})]})})]})})}),l.jsx(H.M,{children:"charge"===i&&l.jsx(B.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>!f&&n(null),children:(0,l.jsxs)(B.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl",children:[l.jsx("div",{className:"p-6 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-3 rounded-xl bg-amber-100",children:l.jsx(b.Z,{className:"w-6 h-6 text-primary"})}),(0,l.jsxs)("div",{children:[l.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cobrar Colaborador"}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["Mensagem para ",m]})]})]})}),l.jsx("div",{className:"p-6",children:f?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-primary/30 border-t-primary rounded-full animate-spin mb-4"}),l.jsx("p",{className:"text-gray-600",children:"Gerando mensagem com IA..."})]}):j?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[l.jsx(U.Z,{className:"w-16 h-16 text-primary mb-4"}),l.jsx("p",{className:"text-xl font-bold text-gray-900",children:"Mensagem Enviada!"}),l.jsx("p",{className:"text-gray-500 mt-2",children:"O colaborador ser\xe1 notificado."})]}):(0,l.jsxs)(l.Fragment,{children:[l.jsx("div",{className:"p-4 rounded-xl bg-amber-50 border border-amber-200 mb-4",children:l.jsx("p",{className:"whitespace-pre-line text-gray-700",children:p})}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsxs)(u.z,{variant:"outline",className:"flex-1",onClick:K,children:[l.jsx(el.Z,{className:"w-4 h-4 mr-2"}),"Copiar"]}),(0,l.jsxs)(u.z,{className:"flex-1 bg-primary hover:bg-[#1260b5]",onClick:$,children:[l.jsx(E.Z,{className:"w-4 h-4 mr-2"}),"Enviar"]})]})]})})]})})})]})}t(11672);var ed=t(24230),ec=t(71383),eu=t(77506);let em={demandas:[{id:"title",label:"T\xedtulo da Demanda",type:"text",required:!0,placeholder:"Ex: Cria\xe7\xe3o de Landing Page"},{id:"description",label:"Descri\xe7\xe3o",type:"textarea",placeholder:"Descreva os detalhes da demanda..."},{id:"client_id",label:"Cliente",type:"select",required:!0,placeholder:"Selecione o cliente"},{id:"priority",label:"Prioridade",type:"select",required:!0,options:[{value:"low",label:"\uD83D\uDFE2 Baixa"},{value:"medium",label:"\uD83D\uDFE1 M\xe9dia"},{value:"high",label:"\uD83D\uDFE0 Alta"},{value:"urgent",label:"\uD83D\uDD34 Urgente"}]},{id:"due_date",label:"Data de Entrega Prevista",type:"date",required:!0}],em_progresso:[{id:"briefing_link",label:"Link do Briefing",type:"url",placeholder:"https://..."},{id:"references",label:"Refer\xeancias de Site",type:"textarea",placeholder:"Links ou descri\xe7\xe3o das refer\xeancias..."},{id:"assigned_to",label:"Respons\xe1vel",type:"select",required:!0},{id:"started_at",label:"Data de In\xedcio",type:"date"},{id:"notes",label:"Observa\xe7\xf5es",type:"textarea",placeholder:"Anota\xe7\xf5es sobre o andamento..."}],revisao:[{id:"material_link",label:"Link do Material",type:"url",required:!0,placeholder:"Link do arquivo para revis\xe3o"},{id:"checklist_quality",label:"Checklist de Qualidade",type:"multiselect",options:[{value:"ortografia",label:"Ortografia verificada"},{value:"design",label:"Design conforme briefing"},{value:"responsivo",label:"Responsivo/Adaptado"},{value:"links",label:"Links funcionando"},{value:"imagens",label:"Imagens otimizadas"}]},{id:"adjustment_points",label:"Pontos de Ajuste",type:"textarea",placeholder:"Liste os pontos que precisam de ajuste..."},{id:"reviewer",label:"Revisor",type:"select"}],aprovacao:[{id:"client_link",label:"Link Enviado ao Cliente",type:"url",required:!0},{id:"sent_at",label:"Data de Envio",type:"date"},{id:"approval_status",label:"Status da Aprova\xe7\xe3o",type:"select",options:[{value:"pending",label:"⏳ Aguardando"},{value:"approved",label:"✅ Aprovado"},{value:"changes_requested",label:"\uD83D\uDD04 Altera\xe7\xf5es Solicitadas"},{value:"rejected",label:"❌ Rejeitado"}]},{id:"client_feedback",label:"Feedback do Cliente",type:"textarea",placeholder:"Coment\xe1rios do cliente..."}],concluido:[{id:"completed_at",label:"Data de Conclus\xe3o",type:"date",required:!0},{id:"final_files",label:"Arquivos Finais",type:"url",placeholder:"Link para os arquivos finais"},{id:"delivery_notes",label:"Notas de Entrega",type:"textarea"},{id:"client_satisfaction",label:"Satisfa\xe7\xe3o do Cliente",type:"select",options:[{value:"5",label:"⭐⭐⭐⭐⭐ Excelente"},{value:"4",label:"⭐⭐⭐⭐ Bom"},{value:"3",label:"⭐⭐⭐ Regular"},{value:"2",label:"⭐⭐ Ruim"},{value:"1",label:"⭐ P\xe9ssimo"}]}]},ex={"Web Designer":[{id:"site_type",label:"Tipo de Site",type:"select",options:[{value:"landing",label:"Landing Page"},{value:"institutional",label:"Institucional"},{value:"ecommerce",label:"E-commerce"},{value:"blog",label:"Blog"},{value:"portfolio",label:"Portf\xf3lio"},{value:"webapp",label:"Web App"}]},{id:"pages_count",label:"Quantidade de P\xe1ginas",type:"number",placeholder:"Ex: 5"},{id:"functionalities",label:"Funcionalidades",type:"multiselect",options:[{value:"form",label:"Formul\xe1rio de Contato"},{value:"chat",label:"Chat/WhatsApp"},{value:"gallery",label:"Galeria de Fotos"},{value:"blog",label:"Blog Integrado"},{value:"payment",label:"Pagamento Online"},{value:"login",label:"\xc1rea de Login"}]},{id:"has_domain",label:"Tem dom\xednio?",type:"checkbox"},{id:"has_hosting",label:"Tem hospedagem?",type:"checkbox"}],"Social Media":[{id:"platforms",label:"Plataformas",type:"multiselect",required:!0,options:[{value:"instagram",label:"Instagram"},{value:"facebook",label:"Facebook"},{value:"linkedin",label:"LinkedIn"},{value:"tiktok",label:"TikTok"},{value:"youtube",label:"YouTube"},{value:"twitter",label:"Twitter/X"}]},{id:"content_format",label:"Formato",type:"multiselect",options:[{value:"reels",label:"Reels"},{value:"carousel",label:"Carrossel"},{value:"stories",label:"Stories"},{value:"feed",label:"Post Feed"},{value:"video_long",label:"V\xeddeo Longo"},{value:"live",label:"Live"}]},{id:"publish_date",label:"Data de Publica\xe7\xe3o",type:"date"},{id:"publish_time",label:"Hor\xe1rio de Publica\xe7\xe3o",type:"text",placeholder:"Ex: 18:00"},{id:"caption",label:"Legenda/Copy",type:"textarea"}],Tráfego:[{id:"ads_platform",label:"Plataforma de Ads",type:"multiselect",required:!0,options:[{value:"google",label:"Google Ads"},{value:"meta",label:"Meta Ads (Facebook/Instagram)"},{value:"tiktok",label:"TikTok Ads"},{value:"linkedin",label:"LinkedIn Ads"},{value:"youtube",label:"YouTube Ads"}]},{id:"budget",label:"Or\xe7amento (R$)",type:"number",placeholder:"Ex: 5000"},{id:"objective",label:"Objetivo",type:"select",options:[{value:"awareness",label:"Reconhecimento"},{value:"traffic",label:"Tr\xe1fego"},{value:"engagement",label:"Engajamento"},{value:"leads",label:"Gera\xe7\xe3o de Leads"},{value:"conversions",label:"Convers\xf5es"},{value:"sales",label:"Vendas"}]},{id:"target_audience",label:"P\xfablico-Alvo",type:"textarea",placeholder:"Descreva o p\xfablico-alvo..."},{id:"campaign_period",label:"Per\xedodo da Campanha",type:"text",placeholder:"Ex: 01/01 a 31/01"}],"Video Maker":[{id:"video_duration",label:"Dura\xe7\xe3o",type:"select",options:[{value:"15s",label:"At\xe9 15 segundos"},{value:"30s",label:"30 segundos"},{value:"60s",label:"1 minuto"},{value:"3min",label:"At\xe9 3 minutos"},{value:"5min",label:"At\xe9 5 minutos"},{value:"10min+",label:"Mais de 10 minutos"}]},{id:"video_format",label:"Formato",type:"select",options:[{value:"vertical",label:"Vertical (9:16)"},{value:"horizontal",label:"Horizontal (16:9)"},{value:"square",label:"Quadrado (1:1)"}]},{id:"has_soundtrack",label:"Trilha Sonora",type:"checkbox"},{id:"has_subtitles",label:"Legendas",type:"checkbox"},{id:"resolution",label:"Resolu\xe7\xe3o",type:"select",options:[{value:"hd",label:"HD (720p)"},{value:"fullhd",label:"Full HD (1080p)"},{value:"4k",label:"4K"}]},{id:"style",label:"Estilo do V\xeddeo",type:"text",placeholder:"Ex: Motion Graphics, Filmagem, etc."}],Designer:[{id:"art_type",label:"Tipo de Arte",type:"select",options:[{value:"social",label:"Post para Redes Sociais"},{value:"banner",label:"Banner"},{value:"logo",label:"Logo/Identidade Visual"},{value:"flyer",label:"Flyer/Panfleto"},{value:"presentation",label:"Apresenta\xe7\xe3o"},{value:"ebook",label:"E-book/Material Rico"},{value:"packaging",label:"Embalagem"}]},{id:"dimensions",label:"Dimens\xf5es",type:"text",placeholder:"Ex: 1080x1080px"},{id:"file_format",label:"Formato de Arquivo",type:"multiselect",options:[{value:"png",label:"PNG"},{value:"jpg",label:"JPG"},{value:"pdf",label:"PDF"},{value:"psd",label:"PSD (Edit\xe1vel)"},{value:"ai",label:"AI (Edit\xe1vel)"},{value:"svg",label:"SVG"}]},{id:"color_palette",label:"Paleta de Cores",type:"text",placeholder:"Cores principais..."}],"Head Marketing":[{id:"campaign_name",label:"Nome da Campanha",type:"text",required:!0},{id:"campaign_type",label:"Tipo de Campanha",type:"select",options:[{value:"launch",label:"Lan\xe7amento"},{value:"seasonal",label:"Sazonal"},{value:"institutional",label:"Institucional"},{value:"promotion",label:"Promo\xe7\xe3o"},{value:"branding",label:"Branding"}]},{id:"teams_involved",label:"Equipes Envolvidas",type:"multiselect",options:[{value:"social",label:"Social Media"},{value:"design",label:"Design"},{value:"video",label:"Video Maker"},{value:"trafego",label:"Tr\xe1fego"},{value:"web",label:"Web Designer"}]},{id:"total_budget",label:"Or\xe7amento Total",type:"number"},{id:"expected_results",label:"Resultados Esperados",type:"textarea"}],Comercial:[{id:"proposal_value",label:"Valor da Proposta (R$)",type:"number",required:!0},{id:"services_included",label:"Servi\xe7os Inclusos",type:"multiselect",options:[{value:"social",label:"Gest\xe3o de Redes Sociais"},{value:"trafego",label:"Tr\xe1fego Pago"},{value:"site",label:"Cria\xe7\xe3o de Site"},{value:"design",label:"Design Gr\xe1fico"},{value:"video",label:"Produ\xe7\xe3o de V\xeddeo"},{value:"consultoria",label:"Consultoria"}]},{id:"contract_duration",label:"Dura\xe7\xe3o do Contrato",type:"select",options:[{value:"3",label:"3 meses"},{value:"6",label:"6 meses"},{value:"12",label:"12 meses"},{value:"project",label:"Por Projeto"}]},{id:"payment_conditions",label:"Condi\xe7\xf5es de Pagamento",type:"text"},{id:"decision_maker",label:"Decisor",type:"text"}],RH:[{id:"job_title",label:"Cargo/Vaga",type:"text",required:!0},{id:"candidate_name",label:"Nome do Candidato",type:"text"},{id:"selection_stage",label:"Etapa da Sele\xe7\xe3o",type:"select",options:[{value:"screening",label:"Triagem de Curr\xedculo"},{value:"interview1",label:"Primeira Entrevista"},{value:"technical",label:"Teste T\xe9cnico"},{value:"interview2",label:"Entrevista Final"},{value:"offer",label:"Proposta"},{value:"hired",label:"Contratado"}]},{id:"salary_range",label:"Faixa Salarial",type:"text",placeholder:"Ex: R$ 3.000 - R$ 4.000"},{id:"benefits",label:"Benef\xedcios",type:"textarea"},{id:"start_date",label:"Previs\xe3o de In\xedcio",type:"date"}],Financeiro:[{id:"document_type",label:"Tipo de Documento",type:"select",options:[{value:"invoice",label:"Nota Fiscal"},{value:"boleto",label:"Boleto"},{value:"receipt",label:"Recibo"},{value:"contract",label:"Contrato"}]},{id:"value",label:"Valor (R$)",type:"number",required:!0},{id:"due_date",label:"Vencimento",type:"date",required:!0},{id:"category",label:"Categoria",type:"select",options:[{value:"servicos",label:"Servi\xe7os"},{value:"software",label:"Software/Assinaturas"},{value:"marketing",label:"Marketing"},{value:"pessoal",label:"Pessoal"},{value:"infraestrutura",label:"Infraestrutura"}]}]},eg={default:[{id:"demandas",title:"Demandas",color:"#6366f1",fields:em.demandas},{id:"em_progresso",title:"Em Progresso",color:"#f97316",fields:em.em_progresso},{id:"revisao",title:"Revis\xe3o",color:"#eab308",fields:em.revisao},{id:"aprovacao",title:"Aprova\xe7\xe3o Cliente",color:"#06b6d4",fields:em.aprovacao},{id:"concluido",title:"Conclu\xeddo",color:"#10b981",fields:em.concluido}],contas_pagar:[{id:"pendente",title:"Pendente",color:"#ef4444",fields:[{id:"supplier",label:"Fornecedor",type:"text",required:!0},{id:"value",label:"Valor (R$)",type:"number",required:!0},{id:"due_date",label:"Vencimento",type:"date",required:!0},{id:"category",label:"Categoria",type:"select",options:[{value:"servicos",label:"Servi\xe7os"},{value:"software",label:"Software/Assinaturas"},{value:"marketing",label:"Marketing/Ads"},{value:"pessoal",label:"Pessoal"},{value:"infraestrutura",label:"Infraestrutura"},{value:"impostos",label:"Impostos"},{value:"outros",label:"Outros"}]},{id:"cost_center",label:"Centro de Custo",type:"select",options:[{value:"operacional",label:"Operacional"},{value:"administrativo",label:"Administrativo"},{value:"comercial",label:"Comercial"},{value:"marketing",label:"Marketing"}]},{id:"description",label:"Descri\xe7\xe3o",type:"textarea"}]},{id:"agendado",title:"Agendado",color:"#f97316",fields:[{id:"payment_date",label:"Data do Pagamento",type:"date",required:!0},{id:"payment_method",label:"Forma de Pagamento",type:"select",options:[{value:"pix",label:"PIX"},{value:"boleto",label:"Boleto"},{value:"transferencia",label:"Transfer\xeancia"},{value:"cartao",label:"Cart\xe3o"},{value:"debito",label:"D\xe9bito Autom\xe1tico"}]},{id:"bank_account",label:"Conta Banc\xe1ria",type:"select"}]},{id:"pago",title:"Pago",color:"#10b981",fields:[{id:"paid_at",label:"Data do Pagamento",type:"date",required:!0},{id:"paid_value",label:"Valor Pago (R$)",type:"number",required:!0},{id:"receipt",label:"Comprovante",type:"url"}]},{id:"arquivado",title:"Arquivado",color:"#6b7280",fields:[]}],contas_receber:[{id:"a_faturar",title:"A Faturar",color:"#8b5cf6",fields:[{id:"client_id",label:"Cliente",type:"select",required:!0},{id:"value",label:"Valor (R$)",type:"number",required:!0},{id:"service",label:"Servi\xe7o",type:"text",required:!0},{id:"reference_month",label:"M\xeas de Refer\xeancia",type:"text",placeholder:"Ex: Janeiro/2025"},{id:"description",label:"Descri\xe7\xe3o",type:"textarea"}]},{id:"faturado",title:"Faturado",color:"#06b6d4",fields:[{id:"invoice_number",label:"N\xfamero da NF",type:"text",required:!0},{id:"invoice_date",label:"Data da Emiss\xe3o",type:"date",required:!0},{id:"due_date",label:"Vencimento",type:"date",required:!0},{id:"invoice_link",label:"Link da NF",type:"url"},{id:"billing_status",label:"Status da Cobran\xe7a",type:"select",options:[{value:"sent",label:"Enviado"},{value:"viewed",label:"Visualizado"},{value:"reminded",label:"Lembrete Enviado"}]}]},{id:"recebido",title:"Recebido",color:"#10b981",fields:[{id:"received_at",label:"Data do Recebimento",type:"date",required:!0},{id:"received_value",label:"Valor Recebido (R$)",type:"number",required:!0},{id:"payment_method",label:"Forma de Recebimento",type:"select",options:[{value:"pix",label:"PIX"},{value:"boleto",label:"Boleto"},{value:"transferencia",label:"Transfer\xeancia"},{value:"cartao",label:"Cart\xe3o"}]}]},{id:"arquivado",title:"Arquivado",color:"#6b7280",fields:[]}]};function ep({isOpen:e,onClose:a,onConfirm:t,cardTitle:r,fromPhase:i,toPhase:n,area:o,clients:d=[],employees:c=[],existingData:u={},fieldsOverride:m}){let[x,g]=(0,s.useState)({}),[p,h]=(0,s.useState)({}),[b,f]=(0,s.useState)(!1),v=m??function(e,a){let t=(eg[e]||eg.default).find(e=>e.id===a);if(!t)return[];let l=ex[e]||[];return"demandas"===a||"em_progresso"===a?[...t.fields,...l]:t.fields}(o,n.id),j=(e,a)=>{g(t=>({...t,[e]:a})),p[e]&&h(a=>{let t={...a};return delete t[e],t})},N=(e,a,t)=>{let l=x[e]||[];j(e,t?[...l,a]:l.filter(e=>e!==a))},w=()=>{let e={};return v.forEach(a=>{a.required&&!x[a.id]&&(e[a.id]=`${a.label} \xe9 obrigat\xf3rio`)}),h(e),0===Object.keys(e).length},k=async()=>{if(w()){f(!0);try{await t(x)}finally{f(!1)}}},_=e=>{let a=x[e.id]||"",t=p[e.id],s=`w-full px-3 py-2 rounded-lg border transition-colors ${t?"border-red-500 bg-red-50":"border-gray-300 focus:border-blue-500"} focus:outline-none focus:ring-2 focus:ring-blue-200`;switch(e.type){case"text":case"url":case"number":return l.jsx("input",{type:"url"===e.type?"url":e.type,value:a,onChange:a=>j(e.id,"number"===e.type?Number(a.target.value):a.target.value),placeholder:e.placeholder,className:s});case"textarea":return l.jsx("textarea",{value:a,onChange:a=>j(e.id,a.target.value),placeholder:e.placeholder,rows:3,className:s});case"date":return l.jsx("input",{type:"date",value:a,onChange:a=>j(e.id,a.target.value),className:s});case"select":if("client_id"===e.id){if(!d?.length)return l.jsx("input",{type:"text",value:a,onChange:a=>j(e.id,a.target.value),placeholder:e.placeholder||"ID do cliente (opcional)",className:s});return(0,l.jsxs)("select",{value:a,onChange:a=>j(e.id,a.target.value),className:s,children:[l.jsx("option",{value:"",children:"Selecione o cliente..."}),d.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))]})}if("assigned_to"===e.id||"reviewer"===e.id)return l.jsx(C,{selectedUserId:a||void 0,onSelect:a=>j(e.id,a),label:e.label,placeholder:e.placeholder||"Selecione um respons\xe1vel"});return(0,l.jsxs)("select",{value:a,onChange:a=>j(e.id,a.target.value),className:s,children:[l.jsx("option",{value:"",children:"Selecione..."}),e.options?.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))]});case"multiselect":let r=a||[];return l.jsx("div",{className:"space-y-2 p-3 bg-gray-50 rounded-lg max-h-40 overflow-y-auto",children:e.options?.map(a=>l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-100 p-1 rounded",children:[l.jsx("input",{type:"checkbox",checked:r.includes(a.value),onChange:t=>N(e.id,a.value,t.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),l.jsx("span",{className:"text-sm text-gray-700",children:a.label})]},a.value))});case"checkbox":return(0,l.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:!!a,onChange:a=>j(e.id,a.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),l.jsx("span",{className:"text-sm text-gray-700",children:"Sim"})]});default:return null}};return e?l.jsx(H.M,{children:l.jsx(B.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:a,children:(0,l.jsxs)(B.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"p-6 border-b bg-gradient-to-r from-gray-50 to-white",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Mover Card"}),l.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:l.jsx(y.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl p-4 border shadow-sm",children:[l.jsx("p",{className:"font-semibold text-gray-900 mb-3",children:r}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"px-3 py-1.5 rounded-lg text-white text-sm font-medium",style:{backgroundColor:i.color},children:i.title}),l.jsx(ed.Z,{className:"w-5 h-5 text-gray-400"}),l.jsx("div",{className:"px-3 py-1.5 rounded-lg text-white text-sm font-medium",style:{backgroundColor:n.color},children:n.title})]})]})]}),l.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:0===v.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[l.jsx(ec.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),l.jsx("p",{children:"Nenhuma informa\xe7\xe3o adicional necess\xe1ria para esta fase."})]}):(0,l.jsxs)("div",{className:"space-y-5",children:[(0,l.jsxs)("p",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg flex items-center gap-2",children:[l.jsx(P.Z,{className:"w-4 h-4 text-blue-500"}),"Preencha as informa\xe7\xf5es necess\xe1rias para a fase ",l.jsx("strong",{children:n.title})]}),v.map(e=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:[e.label,e.required&&l.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),_(e),e.helpText&&l.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.helpText}),p[e.id]&&(0,l.jsxs)("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[l.jsx(P.Z,{className:"w-3 h-3"}),p[e.id]]})]},e.id))]})}),(0,l.jsxs)("div",{className:"p-6 border-t bg-gray-50 flex items-center justify-end gap-3",children:[l.jsx("button",{onClick:a,disabled:b,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),l.jsx("button",{onClick:k,disabled:b,className:"px-6 py-2 text-white rounded-lg transition-colors flex items-center gap-2",style:{backgroundColor:n.color},children:b?(0,l.jsxs)(l.Fragment,{children:[l.jsx(eu.Z,{className:"w-4 h-4 animate-spin"}),"Movendo..."]}):(0,l.jsxs)(l.Fragment,{children:["Confirmar",l.jsx(ed.Z,{className:"w-4 h-4"})]})})]})]})})}):null}function eh(e){let a=e.areaKey?String(e.areaKey):"",t=e.stageKey?String(e.stageKey):"";if(!a||!t)return"outros";let l=D.Nd.find(e=>e.areaKey===a),s=l?.columns?.find(e=>e.stageKey===t);return s?.stageGroup||"outros"}function eb(e){return Array.from(new Set(e))}let ef={demanda:[{id:"title",label:"T\xedtulo",type:"text",required:!0,placeholder:"Ex: Ajuste de Landing Page"},{id:"description",label:"Descri\xe7\xe3o",type:"textarea",placeholder:"Contexto, objetivo, detalhes..."},{id:"priority",label:"Prioridade",type:"select",options:[{value:"low",label:"\uD83D\uDFE2 Baixa"},{value:"medium",label:"\uD83D\uDFE1 M\xe9dia"},{value:"high",label:"\uD83D\uDFE0 Alta"},{value:"urgent",label:"\uD83D\uDD34 Urgente"}]},{id:"due_date",label:"Data prevista",type:"date"},{id:"assigned_to",label:"Respons\xe1vel",type:"select"}],escopo:[{id:"description",label:"Escopo/Descri\xe7\xe3o",type:"textarea",required:!0,placeholder:"Defina claramente o escopo..."},{id:"briefing_link",label:"Link do Briefing",type:"url",placeholder:"https://..."},{id:"references",label:"Refer\xeancias",type:"textarea",placeholder:"Links e exemplos..."},{id:"assigned_to",label:"Respons\xe1vel",type:"select"},{id:"due_date",label:"Data prevista",type:"date"}],planejamento:[{id:"assigned_to",label:"Respons\xe1vel",type:"select",required:!0},{id:"started_at",label:"In\xedcio",type:"date"},{id:"notes",label:"Observa\xe7\xf5es",type:"textarea"}],producao:[{id:"assigned_to",label:"Respons\xe1vel",type:"select",required:!0},{id:"due_date",label:"Entrega prevista",type:"date"},{id:"notes",label:"Observa\xe7\xf5es",type:"textarea"}],revisao_interna:[{id:"material_link",label:"Link do Material",type:"url",required:!0,placeholder:"Link do arquivo para revis\xe3o"},{id:"checklist_quality",label:"Checklist de Qualidade",type:"multiselect",options:[{value:"ortografia",label:"Ortografia verificada"},{value:"design",label:"Design conforme briefing"},{value:"responsivo",label:"Responsivo/Adaptado"},{value:"links",label:"Links funcionando"},{value:"imagens",label:"Imagens otimizadas"}]},{id:"adjustment_points",label:"Pontos de Ajuste",type:"textarea"},{id:"reviewer",label:"Revisor",type:"select"}],aprovacao:[{id:"client_link",label:"Link enviado ao cliente",type:"url",required:!0},{id:"sent_at",label:"Data de envio",type:"date"},{id:"approval_status",label:"Status da aprova\xe7\xe3o",type:"select",options:[{value:"pending",label:"⏳ Aguardando"},{value:"approved",label:"✅ Aprovado"},{value:"changes_requested",label:"\uD83D\uDD04 Altera\xe7\xf5es solicitadas"},{value:"rejected",label:"❌ Rejeitado"}]},{id:"client_feedback",label:"Feedback do cliente",type:"textarea"}],ajustes:[{id:"adjustment_points",label:"Pontos de Ajuste",type:"textarea",required:!0,placeholder:"Liste o que precisa ser ajustado..."},{id:"material_link",label:"Link do Material",type:"url",placeholder:"Link atualizado para revis\xe3o"}],publicacao_entrega:[{id:"publish_date",label:"Data de publica\xe7\xe3o/entrega",type:"date"},{id:"publish_time",label:"Hor\xe1rio",type:"text",placeholder:"Ex: 18:00"},{id:"delivery_notes",label:"Notas de entrega",type:"textarea"}],finalizado:[{id:"completed_at",label:"Data de conclus\xe3o",type:"date",required:!0},{id:"final_files",label:"Arquivos finais (link)",type:"url",placeholder:"https://..."},{id:"delivery_notes",label:"Notas finais",type:"textarea"}],bloqueado:[{id:"block_reason",label:"Motivo do bloqueio",type:"textarea",required:!0,placeholder:"Explique o bloqueio e o que falta..."}],outros:[{id:"description",label:"Descri\xe7\xe3o",type:"textarea"}]};var ev=t(85999);let ey=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;function ej(e){return String(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function eN(e,a){let t=String(a||"").trim();if(!t)return null;if(ey.test(t))return e&&0!==e.length?e.some(e=>e.id===t)?t:null:t;let l=ej(t),s=e.find(e=>ej(e.stage_key)===l);if(s?.id&&ey.test(s.id))return s.id;let r=e.find(e=>{let a=ej(e.name);return a===l||a.includes(l)||l.includes(a)});if(r?.id&&ey.test(r.id))return r.id;let i=e.find(e=>e_(e)===t);return i?.id&&ey.test(i.id)?i.id:null}function ew(e,a,t){if(!t)return null;let l=String(t.id||"").trim();if(!l)return null;if(!ey.test(l)){let a=eN(e,l);if(a)return a}if(e.some(e=>e.id===l))return l;let s=a.find(e=>e.id===l)||null,r=s?.column_id?String(s.column_id):"";return r&&e.some(e=>e.id===r)?r:null}function ek(e,a){let t=String(a??"").trim();return t?ey.test(t)?t:eN(e,t):null}function e_(e){let a=String(e?.stage_key||"").toLowerCase(),t=String(e?.name||"").toLowerCase(),l=a||t;return t.includes("backlog")?"backlog":t.includes("a fazer")?"todo":t.includes("em progresso")?"in_progress":t.includes("revis")?"in_review":t.includes("conclu")?"done":t.includes("bloque")?"blocked":t.includes("cancel")?"cancelled":"finalizado"===l||l.includes("final")?"done":"bloqueado"===l||l.includes("bloque")?"blocked":"aprovacao"===l||l.includes("aprov")||l.includes("revisao")?"in_review":"demanda"===l||l.includes("lead_demanda")||l.includes("lead")?"todo":"in_progress"}function eC({task:e,onDelete:a,onEdit:t,onView:s}){let{attributes:r,listeners:i,setNodeRef:n,transform:m,transition:v,isDragging:y}=(0,o.nB)({id:e.id}),j={transform:w.ux.Transform.toString(m),transition:v,opacity:y?.5:1};return l.jsx("div",{ref:n,style:j,...r,className:"mb-3",children:(0,l.jsxs)(d.Zb,{className:"cursor-grab active:cursor-grabbing hover:shadow-lg transition-shadow group",children:[l.jsx(d.Ol,{className:"pb-3 pt-3",children:(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[l.jsx("div",{...i,className:"cursor-grab active:cursor-grabbing mt-1",children:l.jsx(x.Z,{className:"w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-colors"})}),(0,l.jsxs)("div",{className:"flex-1",onClick:()=>s(e),style:{cursor:"pointer"},children:[l.jsx(d.ll,{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.title}),e.description&&l.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:e.description}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[l.jsx(c.C,{className:(e=>{switch(e){case"urgent":return"bg-red-600 text-white";case"high":return"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200";case"medium":return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200"}})(e.priority),children:(e=>{switch(e){case"urgent":return"Urgente";case"high":return"Alta";case"medium":return"M\xe9dia";default:return"Baixa"}})(e.priority)}),e.tags?.map(e=>l.jsx(c.C,{variant:"outline",className:"text-xs",children:e},e))]})]}),(0,l.jsxs)("div",{className:"flex gap-1",children:[l.jsx(u.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100",onClick:()=>s(e),title:"Ver detalhes",children:l.jsx(g.Z,{className:"w-3 h-3"})}),l.jsx(u.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100",onClick:()=>t(e),children:l.jsx(p.Z,{className:"w-3 h-3"})}),l.jsx(u.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 text-red-600",onClick:()=>a(e.id),children:l.jsx(h.Z,{className:"w-3 h-3"})})]})]})}),l.jsx(d.aY,{className:"pt-0",children:(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400",children:[l.jsx("div",{className:"flex items-center gap-2",children:e.assignee_name&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-[#1672d6] to-[#001533] flex items-center justify-center text-xs text-white font-medium",children:e.assignee_name.charAt(0)}),l.jsx("span",{children:e.assignee_name})]})}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[e.comments_count&&e.comments_count>0&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[l.jsx(b.Z,{className:"w-3 h-3"}),l.jsx("span",{children:e.comments_count})]}),e.attachments_count&&e.attachments_count>0&&(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[l.jsx(f.Z,{className:"w-3 h-3"}),l.jsx("span",{children:e.attachments_count})]})]})]})})]})})}function eS({column:e,children:a}){let{setNodeRef:t}=(0,n.Zj)({id:e.id});return l.jsx("div",{ref:t,className:"flex-1 min-h-[400px] p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:a})}function eD({column:e,taskCount:a,onEdit:t,onDelete:r,canDelete:i}){let[n,o]=(0,s.useState)(!1),[d,x]=(0,s.useState)(e.name),g=()=>{d.trim()&&d!==e.name&&t(e.id,d.trim()),o(!1)},b=()=>{x(e.name),o(!1)};return l.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-800 rounded-lg border-l-4 mb-3 group",style:{borderLeftColor:e.color},children:n?(0,l.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[l.jsx(m.II,{value:d,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&g(),"Escape"===e.key&&b()},className:"h-8 text-sm font-semibold",autoFocus:!0}),l.jsx(u.z,{size:"sm",variant:"ghost",onClick:g,className:"h-8 w-8 p-0",children:l.jsx(v.Z,{className:"w-4 h-4 text-green-600"})}),l.jsx(u.z,{size:"sm",variant:"ghost",onClick:b,className:"h-8 w-8 p-0",children:l.jsx(y.Z,{className:"w-4 h-4 text-red-600"})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),i&&l.jsx(u.z,{size:"sm",variant:"ghost",onClick:()=>o(!0),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:l.jsx(p.Z,{className:"w-3 h-3"})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[l.jsx(c.C,{variant:"outline",children:a}),i&&l.jsx(u.z,{size:"sm",variant:"ghost",onClick:()=>r(e.id),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity text-red-600",children:l.jsx(h.Z,{className:"w-3 h-3"})})]})]})})}function eE({isOpen:e,onClose:a,onSave:t,task:r,columnId:i}){let[n,o]=(0,s.useState)({});return e?l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)(d.Zb,{className:"w-full max-w-lg",children:[l.jsx(d.Ol,{children:l.jsx(d.ll,{children:r?"Editar Tarefa":"Nova Tarefa"})}),l.jsx(d.aY,{children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t({...n,column_id:n.column_id||i||""}),a()},className:"space-y-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"T\xedtulo"}),l.jsx(m.II,{value:n.title,onChange:e=>o({...n,title:e.target.value}),placeholder:"Digite o t\xedtulo da tarefa",required:!0})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descri\xe7\xe3o"}),l.jsx("textarea",{value:n.description,onChange:e=>o({...n,description:e.target.value}),placeholder:"Digite a descri\xe7\xe3o (opcional)",className:"w-full px-3 py-2 border rounded-md min-h-[100px] bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),l.jsx(C,{selectedUserId:n.assigned_to,onSelect:e=>o({...n,assigned_to:e}),label:"Respons\xe1vel",placeholder:"Atribuir a algu\xe9m (opcional)"}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Prioridade"}),(0,l.jsxs)("select",{value:n.priority,onChange:e=>o({...n,priority:e.target.value}),className:"w-full px-3 py-2 border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[l.jsx("option",{value:"low",children:"Baixa"}),l.jsx("option",{value:"medium",children:"M\xe9dia"}),l.jsx("option",{value:"high",children:"Alta"}),l.jsx("option",{value:"urgent",children:"Urgente"})]})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tags (separadas por v\xedrgula)"}),l.jsx(m.II,{value:n.tags?.join(", "),onChange:e=>o({...n,tags:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)}),placeholder:"Ex: Marketing, Design, Urgente"})]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[l.jsx(u.z,{type:"button",variant:"outline",onClick:a,children:"Cancelar"}),l.jsx(u.z,{type:"submit",className:"bg-primary hover:bg-[#1260b5]",children:r?"Salvar":"Criar"})]})]})})]})}):null}function eI(){let e=(0,i.usePathname)();e.startsWith("/admin/kanban-app")||e.startsWith("/colaborador/kanban");let a=!e.startsWith("/colaborador/kanban"),t=e.startsWith("/colaborador/kanban"),[r,c]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),[p,h]=(0,s.useState)([]),[b,f]=(0,s.useState)([]),[v,y]=(0,s.useState)([]),[w,_]=(0,s.useState)(null),[C,S]=(0,s.useState)(null),[D,E]=(0,s.useState)(!0),[q,z]=(0,s.useState)(!1),[T,Z]=(0,s.useState)(void 0),[M,P]=(0,s.useState)(""),[F,L]=(0,s.useState)(null),[R,$]=(0,s.useState)(""),[K,B]=(0,s.useState)({assignees:[],tags:[],priorities:[],dueDateFilter:"all"}),[H,U]=(0,s.useState)(""),[G,Y]=(0,s.useState)(null),[W,J]=(0,s.useState)(null),[Q,X]=(0,s.useState)(!1),[ee,ea]=(0,s.useState)(null),[et,el]=(0,s.useState)({}),es=e=>{if(!e)return"";let a=new Date(e);if(Number.isNaN(a.getTime()))return"";let t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${t}-${l}-${s}`},er=e=>{let a=String(e||"").trim();if(!a)return null;let t=new Date(`${a}T12:00:00.000Z`);return Number.isNaN(t.getTime())?null:t.toISOString()},ei=e=>{let a=e.task,t=String(e.toColumn.stage_key||"").trim();if(!t)return!1;let l=String(e.fromColumn?.stage_key||"").trim(),s=a?.reference_links||{},r=s?.stage_forms||{},i=r?.[t]||{};return el({...i,title:i.title??a.title??"",description:i.description??a.description??"",priority:i.priority??a.priority??"medium",due_date:i.due_date??es(a.due_date),assigned_to:i.assigned_to??a.assigned_to??""}),ea({taskId:a.id,fromColumnId:String(e.fromColumn?.id||a.column_id||""),toColumnId:e.toColumnId,fromColumnTitle:e.fromColumn?.name||l||"Atual",fromColumnColor:e.fromColumn?.color||"#6B7280",toColumnTitle:e.toColumn.name,toColumnColor:e.toColumn.color,toStageKey:t}),X(!0),!0},en=async e=>{if(!ee?.taskId||!ee.toColumnId)return;let a=p.find(e=>e.id===ee.taskId)||null;if(!a)return;let t=b.find(e=>e.id===ee.toColumnId)||null;if(t)try{let l=new Date().toISOString(),s=b.find(e=>e.id===String(a.column_id))||null,r="aprovacao"===String(t?.stage_key||"").toLowerCase()&&"aprovacao"!==String(s?.stage_key||"").toLowerCase(),i=a?.reference_links||{},n=i?.client_approval||{},o={...i?.stage_forms||{},[ee.toStageKey]:e},d={...i,stage_forms:o},c=r?{...d,client_approval:{...n,status:"pending",requested_at:n.requested_at||l,due_at:n.due_at||function(e,a){let t=new Date(e);return t.setHours(t.getHours()+a),t.toISOString()}(n.requested_at||l,Number(t?.sla_hours||48))}}:d,u=e_(t),m=p.filter(e=>e.column_id===ee.toColumnId&&e.id!==ee.taskId).length,x={column_id:ee.toColumnId,position:m,status:u,updated_at:l,reference_links:c};"string"==typeof e.title&&e.title.trim()&&(x.title=e.title.trim()),"string"==typeof e.description&&(x.description=e.description),"string"==typeof e.priority&&e.priority&&(x.priority=e.priority),"string"==typeof e.assigned_to&&(x.assigned_to=e.assigned_to||null);let g=er(e.due_date);g&&(x.due_date=g);let{error:h}=await k.O.from("kanban_tasks").update(x).eq("id",ee.taskId);if(h)throw h;C&&await em(C)}catch(a){let e=String(a?.message||"Falha ao mover tarefa");ev.Am.error(e),C&&await em(C)}finally{X(!1),ea(null),el({})}},ed=async e=>{if(!e?.taskId||!e?.toColumnId)return;let a=String(e.taskId),t=String(e.toColumnId);if(!ey.test(t))return;let l=p.find(e=>e.id===a)||null;if(!l)return;let s=new Date().toISOString(),r=b.find(e=>e.id===t)||null,i=e_(r),n=p.filter(e=>e.column_id===t&&e.id!==a).length,o=b.find(e=>e.id===String(l.column_id))||null,d="aprovacao"===String(r?.stage_key||"").toLowerCase()&&"aprovacao"!==String(o?.stage_key||"").toLowerCase(),c=l?.reference_links||{},u=c?.client_approval||{},m=d?{...c,client_approval:{...u,status:"pending",requested_at:u.requested_at||s,due_at:u.due_at||function(e,a){let t=new Date(e);return t.setHours(t.getHours()+a),t.toISOString()}(u.requested_at||s,Number(r?.sla_hours||48))}}:c,{error:x}=await k.O.from("kanban_tasks").update({column_id:t,position:n,status:i,updated_at:s,...d?{reference_links:m}:{}}).eq("id",a);if(x)throw x},ec=(0,s.useMemo)(()=>(b||[]).map(e=>{let a=(p||[]).filter(a=>a.column_id===e.id).map(a=>{let t=a.reference_links||{},l=t?.client?.company_name||t?.client?.name||t?.client_profile?.name||void 0;return{id:a.id,title:a.title,clientName:l,assignees:[a.assigned_to].filter(Boolean),dueDate:a.due_date?new Date(String(a.due_date)):void 0,stageKey:e.stage_key||e.name||void 0}});return{id:e.id,stageKey:e.stage_key||e.name||void 0,title:e.name,color:e.color,cards:a,wipLimit:e.wip_limit||void 0}}),[b,p]),eu=(0,n.Dy)((0,n.VT)(n.we,{activationConstraint:{distance:8}}),(0,n.VT)(n.Lg,{coordinateGetter:o.is})),em=async e=>{try{E(!0),_(v.find(a=>a.id===e)||null);let{data:a,error:t}=await k.O.from("kanban_columns").select("*").eq("board_id",e).order("position");if(t)throw t;f(a||[]);let{data:l,error:s}=await k.O.from("kanban_tasks").select("*").eq("board_id",e).order("position");if(s)throw s;let r=Array.from(new Set((l||[]).map(e=>e.assigned_to).filter(Boolean))),i=new Map;if(r.length>0){let e=await (0,I.m)(k.O,r);r.forEach(a=>{let t=e.get(a)?.full_name;t&&i.set(a,t)})}let n=(l||[]).map(e=>({...e,assignee_name:e.assigned_to?i.get(e.assigned_to):void 0}));h(n)}catch(e){console.error("Erro ao carregar dados do Kanban:",e)}finally{E(!1)}},eg=(0,s.useMemo)(()=>{let e=new Set;return p.forEach(a=>{a.tags?.forEach(a=>e.add(a))}),Array.from(e)},[p]),ej=(0,s.useMemo)(()=>p.filter(e=>{if(R){let a=R.toLowerCase();if(!(e.title.toLowerCase().includes(a)||e.description?.toLowerCase().includes(a)||e.tags?.some(e=>e.toLowerCase().includes(a))))return!1}if(K.assignees.length>0&&(!e.assigned_to||!K.assignees.includes(e.assigned_to))||K.tags.length>0&&!e.tags?.some(e=>K.tags.includes(e))||K.priorities.length>0&&!K.priorities.includes(e.priority))return!1;if("all"!==K.dueDateFilter){let a=new Date,t=e.due_date?new Date(e.due_date):null;switch(K.dueDateFilter){case"overdue":if(!t||t>=a)return!1;break;case"today":if(!t||t.toDateString()!==a.toDateString())return!1;break;case"this_week":if(!t)return!1;let l=new Date(a.getTime()+6048e5);if(t<a||t>l)return!1;break;case"this_month":if(!t||t.getMonth()!==a.getMonth()||t.getFullYear()!==a.getFullYear())return!1;break;case"no_date":if(t)return!1}}return!0}),[p,R,K]),eI=async e=>{c(null);let{active:a,over:t}=e,l=a.id,s=p.find(e=>e.id===l);if(s)try{let e=new Date().toISOString(),a=x?.taskId===l?x.fromColumnId:s.column_id,r=ek(b,a),i=ew(b,p,t)??s.column_id??null,n=ek(b,i);if(!n){console.error("DnD: coluna destino inv\xe1lida (n\xe3o encontrada no board)",{overId:t?.id,activeTaskColumnId:s.column_id}),C&&await em(C);return}let o=b.find(e=>e.id===n)||null,d=e_(o);if(r&&n&&r!==n&&o?.stage_key){let e=b.find(e=>e.id===r)||null;if(ei({task:s,fromColumn:e,toColumn:o,toColumnId:n}))return}if(o?.stage_key){let e=function(e){if(!String(e.stageKey||"").trim())return[];let a=eh(e),t=[];return"demanda"!==a&&t.push("description"),["producao","revisao_interna","aprovacao","publicacao_entrega","finalizado"].includes(a)&&t.push("assigned_to"),eb(t)}({areaKey:w?.area_key,stageKey:o.stage_key});if(e.length){let a=function(e,a){let t=[];for(let l of a)"description"===l?String(e.description||"").trim()||t.push("description"):"assigned_to"!==l||String(e.assigned_to||"").trim()||t.push("assigned_to");return t.length?{ok:!1,missing:eb(t)}:{ok:!0}}({description:s.description,assigned_to:s.assigned_to},e);if(!a.ok){let e=a.missing.map(e=>"description"===e?"Descri\xe7\xe3o":"assigned_to"===e?"Respons\xe1vel":e);ev.Am.error(`Antes de mover para "${o.name}", preencha: ${e.join(", ")}`),C&&await em(C),J({taskId:l,toColumnId:n}),Z(s),P(String(s.column_id||"")),z(!0);return}}}let c=t?.id?String(t.id):null,u=c&&p.find(e=>e.id===c)||null,m=p.filter(e=>e.column_id===n&&e.id!==l),g=m.length;if(u&&u.column_id===n){let e=m.findIndex(e=>e.id===u.id);e>=0&&(g=e)}let h=[...m];h.splice(g,0,{...s,column_id:n});let f=h.findIndex(e=>e.id===l),v=r&&b.find(e=>e.id===r)||null,y="aprovacao"===String(o?.stage_key||"").toLowerCase()&&"aprovacao"!==String(v?.stage_key||"").toLowerCase(),j=s?.reference_links||{},N=j?.client_approval||{},_=y?{...j,client_approval:{...N,status:"pending",requested_at:N.requested_at||e,due_at:N.due_at||function(e,a){let t=new Date(e);return t.setHours(t.getHours()+a),t.toISOString()}(N.requested_at||e,Number(o?.sla_hours||48))}}:j,{error:S}=await k.O.from("kanban_tasks").update({column_id:n,position:f,status:d,updated_at:e,...y?{reference_links:_}:{}}).eq("id",l);if(S)throw S;for(let e=0;e<h.length;e++){let a=h[e];a.id!==l&&Number(a.position)!==e&&await k.O.from("kanban_tasks").update({position:e}).eq("id",a.id)}if(r&&r!==n&&ey.test(String(r))){let e=p.filter(e=>e.column_id===r&&e.id!==l).slice().sort((e,a)=>Number(e.position)-Number(a.position));for(let a=0;a<e.length;a++){let t=e[a];Number(t.position)!==a&&await k.O.from("kanban_tasks").update({position:a}).eq("id",t.id)}}}catch(e){console.error("Erro ao atualizar tarefa:",e),C&&em(C)}finally{g(null)}},eq=async(e,a)=>{try{let{error:t}=await k.O.from("kanban_columns").update({name:a}).eq("id",e);if(t)throw t;f(t=>t.map(t=>t.id===e?{...t,name:a}:t))}catch(e){console.error("Erro ao atualizar coluna:",e)}},ez=async e=>{if(confirm("Tem certeza que deseja deletar esta coluna? Todas as tarefas ser\xe3o removidas."))try{let{error:a}=await k.O.from("kanban_columns").delete().eq("id",e);if(a)throw a;f(a=>a.filter(a=>a.id!==e)),h(a=>a.filter(a=>a.column_id!==e))}catch(e){console.error("Erro ao deletar coluna:",e),alert("Erro ao deletar coluna. Verifique suas permiss\xf5es.")}},eT=async e=>{try{let{data:{user:a}}=await k.O.auth.getUser();if(!a)throw Error("Usu\xe1rio n\xe3o autenticado");let t=new Date().toISOString();if(T){let{error:a}=await k.O.from("kanban_tasks").update({title:e.title,description:e.description,priority:e.priority,tags:e.tags,assigned_to:e.assigned_to,updated_at:t}).eq("id",T.id);if(a)throw a;if(C&&await em(C),W?.taskId===T.id&&W?.toColumnId)try{await ed({taskId:W.taskId,toColumnId:W.toColumnId}),C&&await em(C),ev.Am.success("Movimenta\xe7\xe3o conclu\xedda.")}catch(e){ev.Am.error(e?.message||"N\xe3o foi poss\xedvel mover a tarefa ap\xf3s salvar.")}finally{J(null)}}else{if(!w)return;if(!e.column_id){console.error("Erro ao salvar tarefa: column_id ausente");return}let l=eN(b,e.column_id);if(!l){console.error("Erro ao salvar tarefa: column_id inv\xe1lido (n\xe3o-uuid)",e.column_id);return}let s=p.filter(e=>e.column_id===l).length,r=b.find(e=>e.id===l)||null,i=e_(r),{data:n,error:o}=await k.O.from("kanban_tasks").insert({board_id:w.id,column_id:l,title:e.title,description:e.description,priority:e.priority,status:i,tags:e.tags,position:s,assigned_to:e.assigned_to,created_by:a.id,updated_at:t}).select().single();if(o)throw o;n&&C&&await em(C)}Z(void 0)}catch(e){console.error("Erro ao salvar tarefa:",e)}},eA=async e=>{if(confirm("Tem certeza que deseja deletar esta tarefa?"))try{let{error:a}=await k.O.from("kanban_tasks").delete().eq("id",e);if(a)throw a;h(a=>a.filter(a=>a.id!==e))}catch(e){console.error("Erro ao deletar tarefa:",e)}},eZ=e=>{Z(e),z(!0)},eM=e=>{L(e)},eP=e=>{P(e),Z(void 0),z(!0)};return D?l.jsx("div",{className:"flex items-center justify-center h-96",children:(0,l.jsxs)("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),l.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Carregando..."})]})}):(0,l.jsxs)("div",{className:"space-y-6 pb-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[l.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:w?.name||"Kanban"}),l.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:w?.description||"Gerencie tarefas e projetos com drag & drop"}),a&&v.length>1&&(0,l.jsxs)("div",{className:"mt-4",children:[l.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Quadro"}),l.jsx("select",{value:C||"",onChange:e=>S(e.target.value),className:"mt-1 w-full max-w-sm px-3 py-2 border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:v.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[l.jsx(V,{onNotificationClick:e=>{let a=p.find(a=>a.id===e);a&&L(a)}}),(0,l.jsxs)(u.z,{className:"bg-primary hover:bg-[#1260b5]",onClick:()=>eP(b[0]?.id),disabled:0===b.length,children:[l.jsx(j.Z,{className:"w-4 h-4 mr-2"}),"Nova Tarefa"]})]})]}),w?.id&&l.jsx(eo,{boardId:w.id,area:w?.name||"Kanban",columns:ec}),(0,l.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,l.jsxs)("div",{className:"flex-1 relative",children:[l.jsx(N.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),l.jsx(m.II,{type:"text",placeholder:"Buscar tarefas por t\xedtulo, descri\xe7\xe3o ou tags...",value:R,onChange:e=>$(e.target.value),className:"pl-10"})]}),l.jsx(O,{onFiltersChange:B,availableTags:eg})]}),0===v.length?l.jsx(d.Zb,{children:l.jsx(d.aY,{className:"p-12 text-center",children:l.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t?"Nenhum quadro foi encontrado para sua \xe1rea. Verifique se seu cadastro tem \xe1rea preenchida (department/area_of_expertise) e se o admin executou a seed de boards por \xe1rea.":"Nenhum quadro encontrado."})})}):0===b.length?l.jsx(d.Zb,{children:l.jsx(d.aY,{className:"p-12 text-center",children:l.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Nenhuma coluna encontrada para este quadro. Confirme se a seed de boards por \xe1rea foi aplicada no Supabase."})})}):(0,l.jsxs)(n.LB,{sensors:eu,collisionDetection:n.ey,onDragStart:e=>{let a=e.active.id;c(a);let t=p.find(e=>e.id===a);t?.column_id&&g({taskId:a,fromColumnId:eN(b,t.column_id)||t.column_id})},onDragOver:e=>{let{active:a,over:t}=e;if(!t)return;let l=a.id,s=p.find(e=>e.id===l);if(!s)return;let r=ew(b,p,t);if(r&&s.column_id!==r)h(e=>e.map(e=>e.id===l?{...e,column_id:r}:e));else{let e=t.id,a=p.find(a=>a.id===e);if(!a||s.column_id!==a.column_id)return;h(a=>{let t=a.filter(e=>e.column_id===s.column_id),r=t.findIndex(e=>e.id===l),i=t.findIndex(a=>a.id===e);if(r!==i){let e=(0,o.Rp)(t,r,i);return[...a.filter(e=>e.column_id!==s.column_id),...e]}return a})}},onDragEnd:eI,children:[l.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",children:b.map(e=>{let a=ej.filter(a=>a.column_id===e.id);return(0,l.jsxs)("div",{className:"flex flex-col flex-shrink-0 w-[340px]",children:[l.jsx(eD,{column:e,taskCount:a.length,onEdit:eq,onDelete:ez,canDelete:"super_admin"===H&&!w?.area_key}),l.jsx(o.Fo,{items:a.map(e=>e.id),strategy:o.qw,children:(0,l.jsxs)(eS,{column:e,children:[a.map(e=>l.jsx(eC,{task:e,onDelete:eA,onEdit:eZ,onView:eM},e.id)),(0,l.jsxs)(u.z,{variant:"ghost",className:"w-full justify-start text-gray-600 dark:text-gray-400",onClick:()=>eP(e.id),children:[l.jsx(j.Z,{className:"w-4 h-4 mr-2"}),"Adicionar tarefa"]})]})})]},e.id)})}),l.jsx(n.y9,{children:r&&p.find(e=>e.id===r)?l.jsx("div",{className:"rotate-3",children:l.jsx(eC,{task:p.find(e=>e.id===r),onDelete:()=>{},onEdit:()=>{},onView:()=>{}})}):null})]}),l.jsx(eE,{isOpen:q,onClose:()=>{z(!1),Z(void 0)},onSave:eT,task:T,columnId:M}),F&&l.jsx(A,{task:F,isOpen:!!F,onClose:()=>L(null),onUpdate:()=>{C&&em(C)}}),Q&&ee&&l.jsx(ep,{isOpen:Q,onClose:()=>{X(!1),ea(null),el({}),C&&em(C)},onConfirm:en,cardTitle:p.find(e=>e.id===ee.taskId)?.title||"Card",fromPhase:{id:ee.fromColumnId,title:ee.fromColumnTitle,color:ee.fromColumnColor},toPhase:{id:ee.toStageKey,title:ee.toColumnTitle,color:ee.toColumnColor},area:String(w?.area_key||""),existingData:et,fieldsOverride:function(e){let a=eh(e),t=ef[a]||ef.outros,l=function(e){let a=String(e||"").trim();if(!a)return null;switch(a){case"webdesigner":return"Web Designer";case"social_media":return"Social Media";case"trafego_pago":return"Tr\xe1fego";case"video_maker":return"Video Maker";case"designer_grafico":return"Designer";case"head_marketing":return"Head Marketing";case"comercial":return"Comercial";case"rh":return"RH";case"financeiro_pagar":case"financeiro_receber":return"Financeiro";default:return null}}(e.areaKey),s=l&&ex[l]||[];return function(e){let a=new Set,t=[];for(let l of e)l?.id&&(a.has(l.id)||(a.add(l.id),t.push(l)));return t}(["demanda","escopo","planejamento","producao"].includes(a)?[...t,...s]:t)}({areaKey:w?.area_key,stageKey:ee.toStageKey})})]})}},29752:(e,a,t)=>{t.d(a,{Ol:()=>n,SZ:()=>d,Zb:()=>i,aY:()=>c,ll:()=>o});var l=t(10326),s=t(17577),r=t(51223);let i=s.forwardRef(({className:e,...a},t)=>l.jsx("div",{ref:t,className:(0,r.cn)("rounded-xl border-2 border-valle-silver-200 bg-white shadow-md",e),...a}));i.displayName="Card";let n=s.forwardRef(({className:e,...a},t)=>l.jsx("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...a}));n.displayName="CardHeader";let o=s.forwardRef(({className:e,...a},t)=>l.jsx("h3",{ref:t,className:(0,r.cn)("font-semibold leading-none tracking-tight text-lg",e),...a}));o.displayName="CardTitle";let d=s.forwardRef(({className:e,...a},t)=>l.jsx("p",{ref:t,className:(0,r.cn)("text-sm text-foreground/70",e),...a}));d.displayName="CardDescription";let c=s.forwardRef(({className:e,...a},t)=>l.jsx("div",{ref:t,className:(0,r.cn)("p-6 pt-0",e),...a}));c.displayName="CardContent",s.forwardRef(({className:e,...a},t)=>l.jsx("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter"},50384:(e,a,t)=>{t.d(a,{SP:()=>d,dr:()=>o,mQ:()=>n,nU:()=>c});var l=t(10326),s=t(17577),r=t(51223);let i=s.createContext(void 0);function n({defaultValue:e,value:a,onValueChange:t,children:n,className:o}){if(void 0===a&&void 0===e)throw Error("Tabs requires either `value` (controlled) or `defaultValue` (uncontrolled).");let d=a??e??"",[c,u]=s.useState(d);return s.useEffect(()=>{void 0!==a&&u(a)},[a]),l.jsx(i.Provider,{value:{activeTab:c,setActiveTab:e=>{void 0===a&&u(e),t?.(e)}},children:l.jsx("div",{className:(0,r.cn)("",o),children:n})})}function o({children:e,className:a}){return l.jsx("div",{className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-800 p-1 text-gray-600 dark:text-gray-400",a),children:e})}function d({value:e,children:a,className:t}){let n=s.useContext(i);if(!n)throw Error("TabsTrigger must be used within Tabs");let{activeTab:o,setActiveTab:d}=n,c=o===e;return l.jsx("button",{type:"button",onClick:()=>d(e),className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",c?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",t),children:a})}function c({value:e,children:a,className:t}){let n=s.useContext(i);if(!n)throw Error("TabsContent must be used within Tabs");let{activeTab:o}=n;return o!==e?null:l.jsx("div",{className:(0,r.cn)("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2",t),children:a})}},51478:(e,a,t)=>{t.d(a,{CE:()=>i,MN:()=>s,XI:()=>r});let l=/@\{([0-9a-fA-F-]{36})\}/g;function s(e){return Array.from(new Set((function(e){let a;let t=String(e||""),s=[];for(;a=l.exec(t);){let e=a[1];s.push({userId:e,raw:a[0],index:a.index})}return s})(e).map(e=>e.userId)))}function r(e,a){let t=String(e||""),l=Math.max(0,Math.min(t.length,a)),s=t.slice(0,l),r=s.lastIndexOf("@");if(r<0)return{active:!1};let i=s.slice(r+1);if(/\s/.test(i)||i.startsWith("{"))return{active:!1};let n=r>0?s[r-1]:"";return n&&/[0-9a-zA-Z._%+-]/.test(n)?{active:!1}:{active:!0,startIndex:r,endIndex:l,query:i}}function i(e){let{value:a,startIndex:t,endIndex:l,userId:s}=e,r=!1!==e.trailingSpace,i=a.slice(0,t),n=a.slice(l),o=`@{${s}}`,d=r?`${o} `:o;return{nextValue:`${i}${d}${n}`,nextCaretIndex:(i+d).length}}},51858:(e,a,t)=>{t.d(a,{d:()=>n});var l=t(10326),s=t(17577),r=t.n(s);let i=/@\{([0-9a-fA-F-]{36})\}/g;function n({text:e,profilesById:a,highlightUserId:t,className:s}){let n;let o=String(e||""),d=[],c=0;for(;n=i.exec(o);){let e=n.index,a=e+n[0].length;e>c&&d.push({type:"text",value:o.slice(c,e),key:`t-${c}`}),d.push({type:"mention",userId:n[1],key:`m-${e}`}),c=a}return c<o.length&&d.push({type:"text",value:o.slice(c),key:`t-${c}`}),l.jsx("span",{className:s,children:d.map(e=>{if("text"===e.type)return l.jsx(r().Fragment,{children:e.value},e.key);let s=a?.get(e.userId),i=s?.full_name||"Usu\xe1rio",n=t&&e.userId===t;return(0,l.jsxs)("span",{className:["inline-flex items-center rounded-md px-1.5 py-0.5 mx-0.5",n?"bg-yellow-200/80 text-yellow-900 dark:bg-yellow-400/20 dark:text-yellow-200":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-200"].join(" "),"data-mention-user-id":e.userId,title:s?.email||void 0,children:["@",i]},e.key)})})}},8130:(e,a,t)=>{t.d(a,{X:()=>l});function l(e,a){let t=String(a||"").trim().toLowerCase();return t?e.map(e=>{let a=String(e.label||"").toLowerCase(),l=String(e.email||"").toLowerCase();return{c:e,score:(a.startsWith(t)||l.startsWith(t)?2:0)+(a.includes(t)||l.includes(t)?1:0)}}).filter(e=>e.score>0).sort((e,a)=>a.score-e.score||e.c.label.localeCompare(a.c.label)).slice(0,8).map(e=>e.c):e.slice(0,8)}},43931:(e,a,t)=>{function l(e,a){return{user_id:a,full_name:String(e.full_name||"Usu\xe1rio"),email:e.email?String(e.email):void 0,avatar_url:e.avatar_url?String(e.avatar_url):e.avatar?String(e.avatar):void 0,user_type:e.user_type?String(e.user_type):e.role?String(e.role):void 0}}async function s(e,a,t){try{let{data:l,error:s}=await e.from("user_profiles").select("id"===a?"id, full_name, email, avatar_url, avatar, user_type, role":"user_id, full_name, email, avatar_url, avatar, user_type, role").in(a,t);if(s)return[];return l||[]}catch{return[]}}async function r(e,a){let t=Array.from(new Set((a||[]).filter(Boolean))),r=new Map;if(0===t.length)return r;for(let a of(await s(e,"id",t))){let e=a?.id?String(a.id):null;e&&r.set(e,l(a,e))}for(let a of(await s(e,"user_id",t))){let e=a?.user_id?String(a.user_id):null;e&&r.set(e,l(a,e))}return r}async function i(e,a){return a&&(await r(e,[a])).get(a)||null}t.d(a,{T:()=>i,m:()=>r})}};