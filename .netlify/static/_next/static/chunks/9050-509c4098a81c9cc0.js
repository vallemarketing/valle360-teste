"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9050],{79050:function(e,a,s){s.d(a,{h:function(){return f}});var r=s(57437),l=s(2265),t=s(57586),o=s(26892),n=s(14438),i=s(76865),c=s(32489),d=s(51817),m=s(58896),x=s(41671),v=s(3085),y=s(31047),h=s(95252),u=s(11239),p=s(60044),b=s(92369),g=s(89345),j=s(13041),N=s(91723);function f(e){var a,s,f,C,_,k;let{clientId:w,churnData:S,onClose:Z,isOpen:A}=e,[E,D]=(0,l.useState)("overview"),[O,I]=(0,l.useState)(!1),[R,T]=(0,l.useState)(S),[F,z]=(0,l.useState)([]),[K,P]=(0,l.useState)(""),[B,L]=(0,l.useState)(!1);(0,l.useEffect)(()=>{A&&w&&!S?M():S&&(T(S),S.recommended_actions&&z(S.recommended_actions))},[A,w,S]);let M=async()=>{I(!0);try{var e;let a=await fetch("/api/admin/predictions/churn?clientId=".concat(w)),s=await a.json();if(s.success&&(null===(e=s.predictions)||void 0===e?void 0:e.length)>0){let e=s.predictions[0];T(e),e.recommended_actions&&z(e.recommended_actions)}}catch(e){console.error("Error fetching churn data:",e),n.Am.error("Erro ao carregar dados do cliente")}finally{I(!1)}},V=e=>{z(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},q=()=>{K.trim()&&(z(e=>[...e,K.trim()]),P(""))},J=async()=>{if(0===F.length){n.Am.error("Selecione pelo menos uma a\xe7\xe3o");return}L(!0);try{var e,a;let s=await fetch("/api/admin/predictions/actions/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:w,prediction_id:null==R?void 0:R.id,selected_actions:F,risk_level:null==R?void 0:R.risk_level,churn_probability:null==R?void 0:R.churn_probability,days_until_churn:null==R?void 0:R.days_until_churn,company_name:null==R?void 0:null===(e=R.clients)||void 0===e?void 0:e.company_name,monthly_value:null==R?void 0:null===(a=R.clients)||void 0===a?void 0:a.monthly_value})}),r=await s.json();if(r.success)n.Am.success("Tarefa criada no Kanban!",{description:r.kanban_url?"Clique para visualizar":void 0,action:r.kanban_url?{label:"Ver Tarefa",onClick:()=>window.location.href=r.kanban_url}:void 0}),Z();else throw Error(r.error||"Erro ao criar tarefa")}catch(e){console.error("Error creating task:",e),n.Am.error("Erro ao criar tarefa no Kanban")}finally{L(!1)}},G=e=>{switch(e){case"critical":return"#ef4444";case"high":return"#f97316";case"medium":return"#eab308";default:return"#10b981"}};if(!A)return null;let X=(e=>{switch(e){case"critical":return{label:"CR\xcdTICO",class:"bg-red-500"};case"high":return{label:"ALTO RISCO",class:"bg-orange-500"};case"medium":return{label:"M\xc9DIO RISCO",class:"bg-yellow-500"};default:return{label:"BAIXO RISCO",class:"bg-green-500"}}})(null==R?void 0:R.risk_level);return(0,r.jsx)(t.M,{children:(0,r.jsx)(o.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.7)"},onClick:Z,children:(0,r.jsxs)(o.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative max-w-4xl w-full max-h-[90vh] overflow-auto rounded-2xl shadow-2xl",style:{backgroundColor:"var(--bg-primary)"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"sticky top-0 z-10 p-6 border-b",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)(i.Z,{className:"w-6 h-6",style:{color:G(null==R?void 0:R.risk_level)}}),(0,r.jsx)("h2",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:"A\xe7\xe3o de Reten\xe7\xe3o"}),(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-bold text-white ".concat(X.class),children:X.label})]}),(0,r.jsx)("p",{className:"text-lg font-medium",style:{color:"var(--text-secondary)"},children:(null==R?void 0:null===(a=R.clients)||void 0===a?void 0:a.company_name)||"Cliente"})]}),(0,r.jsx)("button",{onClick:Z,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:(0,r.jsx)(c.Z,{className:"w-5 h-5",style:{color:"var(--text-secondary)"}})})]})}),O?(0,r.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,r.jsx)(d.Z,{className:"w-8 h-8 animate-spin",style:{color:"var(--primary-500)"}}),(0,r.jsx)("span",{className:"ml-3",style:{color:"var(--text-secondary)"},children:"Carregando dados..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex border-b px-6",style:{borderColor:"var(--border-light)"},children:[{id:"overview",label:"Vis\xe3o Geral",icon:m.Z},{id:"signals",label:"Sinais de Alerta",icon:i.Z},{id:"actions",label:"A\xe7\xf5es Recomendadas",icon:x.Z},{id:"factors",label:"Fatores",icon:v.Z}].map(e=>{let a=e.icon;return(0,r.jsxs)("button",{onClick:()=>D(e.id),className:"flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ".concat(E===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent"),style:E!==e.id?{color:"var(--text-secondary)"}:{},children:[(0,r.jsx)(a,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:e.label})]},e.id)})}),(0,r.jsxs)("div",{className:"p-6",children:["overview"===E&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Probabilidade"})]}),(0,r.jsxs)("p",{className:"text-2xl font-bold",style:{color:G(null==R?void 0:R.risk_level)},children:[(null==R?void 0:R.churn_probability)||0,"%"]})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(y.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Dias at\xe9 Churn"})]}),(0,r.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:(null==R?void 0:R.days_until_churn)||0})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Valor Mensal"})]}),(0,r.jsxs)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:["R$ ",(null==R?void 0:null===(f=R.clients)||void 0===f?void 0:null===(s=f.monthly_value)||void 0===s?void 0:s.toLocaleString("pt-BR"))||"0"]})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--text-tertiary)"},children:"Confian\xe7a"})]}),(0,r.jsxs)("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:[(null==R?void 0:R.confidence_level)||0,"%"]})]})]}),(0,r.jsxs)("div",{className:"p-4 rounded-lg space-y-3",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsxs)("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[(0,r.jsx)(p.Z,{className:"w-4 h-4"}),"Informa\xe7\xf5es do Cliente"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(null==R?void 0:null===(C=R.clients)||void 0===C?void 0:C.contact_name)&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(b.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:R.clients.contact_name})]}),(null==R?void 0:null===(_=R.clients)||void 0===_?void 0:_.contact_email)&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:R.clients.contact_email})]}),(null==R?void 0:null===(k=R.clients)||void 0===k?void 0:k.contact_phone)&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsx)("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:R.clients.contact_phone})]}),(null==R?void 0:R.predicted_churn_date)&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(N.Z,{className:"w-4 h-4",style:{color:"var(--text-tertiary)"}}),(0,r.jsxs)("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Churn previsto: ",new Date(R.predicted_churn_date).toLocaleDateString("pt-BR")]})]})]})]})]}),"signals"===E&&(0,r.jsx)("div",{children:(null==R?void 0:R.warning_signals)&&R.warning_signals.length>0?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h3",{className:"text-sm font-bold mb-3",style:{color:"var(--text-primary)"},children:"⚠️ Sinais de Alerta Identificados"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:R.warning_signals.map((e,a)=>(0,r.jsx)("span",{className:"px-4 py-2 rounded-lg text-sm font-medium",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)"},children:e},a))})]}):(0,r.jsx)("p",{className:"text-center py-8",style:{color:"var(--text-tertiary)"},children:"Nenhum sinal de alerta espec\xedfico identificado"})}),"actions"===E&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:"\uD83D\uDCA1 Selecione as a\xe7\xf5es que deseja executar"}),(0,r.jsx)("div",{className:"space-y-2",children:(null==R?void 0:R.recommended_actions)&&R.recommended_actions.length>0?R.recommended_actions.map((e,a)=>(0,r.jsxs)("label",{className:"flex items-start gap-3 p-3 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",style:{backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsx)("input",{type:"checkbox",checked:F.includes(e),onChange:()=>V(e),className:"mt-1 w-4 h-4 rounded"}),(0,r.jsx)("span",{className:"flex-1 text-sm",style:{color:"var(--text-secondary)"},children:e})]},a)):(0,r.jsx)("p",{className:"text-center py-4",style:{color:"var(--text-tertiary)"},children:"Nenhuma a\xe7\xe3o recomendada dispon\xedvel"})}),(0,r.jsxs)("div",{className:"pt-4 border-t",style:{borderColor:"var(--border-light)"},children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Adicionar a\xe7\xe3o customizada"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:K,onChange:e=>P(e.target.value),onKeyPress:e=>"Enter"===e.key&&q(),placeholder:"Digite uma a\xe7\xe3o espec\xedfica...",className:"flex-1 px-4 py-2 rounded-lg border",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)",color:"var(--text-primary)"}}),(0,r.jsx)("button",{onClick:q,className:"px-4 py-2 rounded-lg text-white transition-colors",style:{backgroundColor:"var(--primary-500)"},children:"Adicionar"})]})]}),F.length>0&&(0,r.jsx)("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:(0,r.jsxs)("p",{className:"text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:[F.length," ",1===F.length?"a\xe7\xe3o selecionada":"a\xe7\xf5es selecionadas"]})})]}),"factors"===E&&(0,r.jsx)("div",{children:(null==R?void 0:R.contributing_factors)?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h3",{className:"text-sm font-bold mb-3",style:{color:"var(--text-primary)"},children:"\uD83D\uDCCA Fatores Contribuintes"}),(0,r.jsx)("pre",{className:"p-4 rounded-lg overflow-auto text-xs",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-secondary)"},children:JSON.stringify(R.contributing_factors,null,2)})]}):(0,r.jsx)("p",{className:"text-center py-8",style:{color:"var(--text-tertiary)"},children:"Nenhum fator contribuinte detalhado dispon\xedvel"})})]}),(0,r.jsxs)("div",{className:"sticky bottom-0 p-6 border-t flex items-center justify-between gap-4",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-light)"},children:[(0,r.jsx)("div",{className:"text-sm",style:{color:"var(--text-tertiary)"},children:F.length>0&&(0,r.jsxs)("span",{children:[F.length," ",1===F.length?"a\xe7\xe3o":"a\xe7\xf5es"," ser\xe1(\xe3o) inclu\xedda(s) na tarefa"]})}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:Z,className:"px-6 py-2 rounded-lg border font-medium transition-colors",style:{backgroundColor:"transparent",borderColor:"var(--border-light)",color:"var(--text-primary)"},children:"Cancelar"}),(0,r.jsx)("button",{onClick:J,disabled:B||0===F.length,className:"px-6 py-2 rounded-lg font-medium text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",style:{backgroundColor:"var(--primary-500)"},children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}),"Criando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{className:"w-4 h-4"}),"Criar Tarefa no Kanban"]})})]})]})]})]})})})}}}]);