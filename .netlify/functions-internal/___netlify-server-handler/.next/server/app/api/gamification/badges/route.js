"use strict";(()=>{var e={};e.id=13152,e.ids=[13152],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84231:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>_,serverHooks:()=>b,staticGenerationAsyncStorage:()=>f});var r={};t.r(r),t.d(r,{GET:()=>u,POST:()=>g,dynamic:()=>c});var s=t(49303),i=t(88716),o=t(60670),n=t(87070),d=t(54128),l=t(29317);let c="force-dynamic",m="https://ikjgsqtykkhqimypacro.supabase.co",p=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlramdzcXR5a2tocWlteXBhY3JvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTE4OTksImV4cCI6MjA3ODc4Nzg5OX0.vgVCpFIt-5ajFhcXg65dqrEw915pqW8fGZ8xgJxrnxI";async function u(e){let a=(0,d.eI)(m,p);try{let{searchParams:t}=new URL(e.url),r=t.get("employeeId");if("true"===t.get("listAll"))return n.NextResponse.json({success:!0,badges:l.Er,categories:l.D6,totalBadges:l.Er.length});if(!r)return n.NextResponse.json({success:!1,error:"employeeId \xe9 obrigat\xf3rio"},{status:400});let{data:s,error:i}=await a.from("employee_badges").select("*").eq("employee_id",r).order("earned_at",{ascending:!1});if(i)throw i;let{data:o,error:d}=await a.from("employee_metrics").select("*").eq("employee_id",r);if(d)throw d;let c={};o?.forEach(e=>{c[e.metric_name]=e.metric_value});let m=s?.map(e=>e.badge_id)||[],p=l.Er.filter(e=>!m.includes(e.id)),u=(0,l.LS)(c,10),g=s?.reduce((e,a)=>e+(a.points_awarded||0),0)||0;return n.NextResponse.json({success:!0,earnedBadges:s||[],availableBadges:p,upcomingBadges:u,totalPoints:g,totalEarned:s?.length||0,totalAvailable:l.Er.length,metrics:c})}catch(e){return console.error("Erro ao buscar badges:",e),n.NextResponse.json({success:!1,error:e.message},{status:500})}}async function g(e){let a=(0,d.eI)(m,p);try{let{employeeId:t,metricName:r,metricValue:s,incrementBy:i}=await e.json();if(!t)return n.NextResponse.json({success:!1,error:"employeeId \xe9 obrigat\xf3rio"},{status:400});if(r){let{data:e}=await a.from("employee_metrics").select("*").eq("employee_id",t).eq("metric_name",r).eq("period","alltime").single();if(e){let t=i?e.metric_value+i:s||e.metric_value;await a.from("employee_metrics").update({metric_value:t,last_updated:new Date().toISOString()}).eq("id",e.id)}else await a.from("employee_metrics").insert({employee_id:t,metric_name:r,metric_value:s||i||1,period:"alltime"})}let{data:o}=await a.from("employee_metrics").select("*").eq("employee_id",t),d={};o?.forEach(e=>{d[e.metric_name]=e.metric_value});let{data:c}=await a.from("employee_badges").select("badge_id").eq("employee_id",t),m=c?.map(e=>e.badge_id)||[],p=[];for(let e of l.Er)if(!m.includes(e.id)&&(0,l.qC)(e,d)){let{error:r}=await a.from("employee_badges").insert({employee_id:t,badge_id:e.id,badge_name:e.name,badge_category:e.category,badge_rarity:e.rarity,points_awarded:e.pointsAwarded});if(!r){p.push(e);let r=e.rewards.map(a=>({employee_id:t,badge_id:e.id,badge_name:e.name,reward_type:a.type,reward_value:String(a.value),reward_description:a.description,status:a.requiresHRApproval?"pending":"approved",expires_at:"time_off"===a.type?new Date(Date.now()+7776e6).toISOString():null}));await a.from("employee_rewards").insert(r)}}return n.NextResponse.json({success:!0,newBadgesEarned:p,totalNewBadges:p.length,message:p.length>0?`Parab\xe9ns! Voc\xea conquistou ${p.length} nova(s) badge(s)!`:"M\xe9tricas atualizadas. Continue assim!"})}catch(e){return console.error("Erro ao verificar badges:",e),n.NextResponse.json({success:!1,error:e.message},{status:500})}}let _=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/gamification/badges/route",pathname:"/api/gamification/badges",filename:"route",bundlePath:"app/api/gamification/badges/route"},resolvedPagePath:"C:\\Users\\User\\Downloads\\valle-360-main\\valle-360-main\\src\\app\\api\\gamification\\badges\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:b}=_,w="/api/gamification/badges/route";function h(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:f})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[89276,55972,54128,64394],()=>t(84231));module.exports=r})();